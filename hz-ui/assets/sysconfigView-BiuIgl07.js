import{d as F,g as T,y as j,u as Z,v as G,a as B,r as k,z as H,h as s,bb as ne,c as f,o as p,f as o,w as n,b as se,q as h,t as U,bU as $,m as J,cy as le,co as re,E as D,bL as I,k as L,F as ie,i as ce,B as O,cg as ue,aO as N,bZ as P}from"./index-x4baBB9A.js";const r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));function _e(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}let q;const de=new Uint8Array(16);function me(){if(!q){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");q=crypto.getRandomValues.bind(crypto)}return q(de)}const pe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),M={randomUUID:pe};function be(e,t,i){var b;if(M.randomUUID&&!e)return M.randomUUID();e=e||{};const c=e.random??((b=e.rng)==null?void 0:b.call(e))??me();if(c.length<16)throw new Error("Random bytes length must be >= 16");return c[6]=c[6]&15|64,c[8]=c[8]&63|128,_e(c)}const ge={class:"card"},ye={style:{"margin-right":"20px"}},fe=F({__name:"securityConfig",setup(e){const{proxy:t}=T();j();const i=Z(),c=G(()=>i.gmCry),b=B({key:"",region:"",date:""}),m=k({}),_=async()=>{let y=await t.$api.getSysConfig({param_name:"secret_key"});m.value=y.data[0]},g=async()=>{let y=be().replace(/-/g,"").slice(0,16);const C=re.service({lock:!0,text:"更新中...",background:"rgba(0, 0, 0, 0.7)"});let v=await t.$api.updateSysConfig({id:m.value.id,param_name:"secret_key",param_value:y});if(v.status=="200"){console.log(`旧密钥：${c.value.key};新密钥：${v.data.param_value}`);let x=await t.$api.reEncrypt({},3e5);x.status=="204"||x.status=="200"?D({title:"Success",message:"数据重新加密成功~",type:"success",duration:3e3}):(D({title:"Error",message:"数据重新加密失败！",type:"error"}),console.log("数据重新加密失败"));let V=await t.$api.getSysConfig({params:"gm"});i.setGmCry(V.data)}else D({title:"Error",message:"密钥更新失败！",type:"error",duration:3e3}),console.log("更新密钥失败");setTimeout(()=>{C.close(),window.location.reload()},2e3)};return H(()=>{_()}),(y,C)=>{const v=s("CopyDocument"),x=s("el-icon"),V=s("el-button"),A=s("el-tooltip"),S=s("el-form-item"),u=s("el-form"),a=ne("copy");return p(),f("div",ge,[o(u,{model:b,class:"demo-form-inline"},{default:n(()=>[o(S,{label:"密码密钥"},{default:n(()=>[se("span",ye,[h(U(c.value.key)+" ",1),o(x,null,{default:n(()=>[$(o(v,null,null,512),[[a,c.value.key]])]),_:1})]),o(A,{class:"box-item",effect:"dark",content:"更新密钥",placement:"top"},{default:n(()=>[o(V,{size:"small",onClick:g,type:"warning",icon:J(le),circle:""},null,8,["icon"])]),_:1})]),_:1})]),_:1},8,["model"])])}}}),ve={class:"card"},xe={key:0},we={key:1},ze={key:0},he={key:1},ke=F({__name:"zabbixConfig",setup(e){const{proxy:t}=T();j(),Z();const i=k(!1),c=k([]),b=["zabbix_url","zabbix_server","zabbix_username","zabbix_password","zabbix_host_template","zabbix_ipmi_template","zabbix_network_template","zabbix_interval"],m=k(null),_=B({zabbix_is_sync:"0",zabbix_url:null,zabbix_server:null,zabbix_username:null,zabbix_password:null,zabbix_ipmi_template:null,zabbix_host_template:null,zabbix_network_template:null,zabbix_interval:0}),g=G(()=>{var a;let u=new Object;return(a=c.value)==null||a.forEach(l=>{u[l.param_name]=l}),u}),y=async()=>{let u=await t.$api.getSysConfig({param_name:"zabbix"});console.log(u.data),c.value=u.data,u.data.forEach(a=>{_[a.param_name]=a.param_value})},C=()=>{i.value=!0,console.log(i.value),N(()=>{var u;(u=c.value)==null||u.forEach(a=>{_[a.param_name]=a.param_value})})},v=()=>{i.value=!1,N(()=>{m.value.resetFields()})},x=async()=>{await m.value.validate(async(u,a)=>{if(u){let l=await t.$api.updateZabbixConfig(_);l.status==200?(P({type:"success",message:"更新成功"}),N(()=>{i.value=!1,y()})):P({type:"error",message:`${l.data}`})}})},S=B({zabbix_url:[{required:!0,message:"请输入正确格式的zabbix接口地址",trigger:"blur"},{validator:(u,a,l)=>{a===""?l(new Error("url地址不正确")):/^(https?):\/\/((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))([\/\w .-]*)*\/?$/.test(a)?l():l(new Error("url地址不符合正则表达式"))},trigger:"blur"}],zabbix_server:[{required:!0,message:"不能为空",trigger:"blur"}],zabbix_username:[{required:!0,message:"不能为空",trigger:"blur"}],zabbix_password:[{required:!0,message:"不能为空",trigger:"blur"}],zabbix_interval:[{required:!0,message:"不能为空",trigger:"blur"},{validator:(u,a,l)=>{a===""?l(new Error("不能为空")):/^\d+$/.test(a)?l():l(new Error("不符合正则表达式"))},trigger:"blur"}]});return H(()=>{y()}),(u,a)=>{const l=s("el-button"),R=s("el-divider"),Q=s("el-switch"),K=s("el-form-item"),W=s("el-text"),X=s("el-icon"),Y=s("el-tooltip"),ee=s("el-space"),te=s("el-input"),ae=s("el-form");return p(),f("div",ve,[$(o(l,{type:"primary",onClick:C},{default:n(()=>[...a[1]||(a[1]=[h("编辑",-1)])]),_:1},512),[[I,!i.value]]),$(o(l,{onClick:v},{default:n(()=>[...a[2]||(a[2]=[h("取消",-1)])]),_:1},512),[[I,i.value]]),$(o(l,{type:"primary",onClick:x},{default:n(()=>[...a[3]||(a[3]=[h("保存",-1)])]),_:1},512),[[I,i.value]]),o(R),o(ae,{model:_,class:"demo-form-inline",ref_key:"formRef",ref:m,"label-width":"auto","label-position":"right",rules:S},{default:n(()=>[o(K,{label:"是否同步",prop:"zabbix_is_sync"},{default:n(()=>[o(Q,{style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!i.value,modelValue:_.zabbix_is_sync,"onUpdate:modelValue":a[0]||(a[0]=d=>_.zabbix_is_sync=d),"active-value":"1","inactive-value":"0"},null,8,["disabled","modelValue"])]),_:1}),_.zabbix_is_sync==="1"?(p(),f("div",xe,[(p(),f(ie,null,ce(b,(d,oe)=>o(K,{prop:d,key:oe},{label:n(()=>[o(ee,{size:2},{default:n(()=>{var w,z;return[o(W,{tag:"b"},{default:n(()=>{var E;return[h(U((E=g.value[d])==null?void 0:E.verbose_name)+": ",1)]}),_:2},1024),((w=g.value[d])==null?void 0:w.description.length)!=0?(p(),O(Y,{key:0,content:(z=g.value[d])==null?void 0:z.description,placement:"right",effect:"dark"},{default:n(()=>[o(X,null,{default:n(()=>[o(J(ue))]),_:1})]),_:1},8,["content"])):L("",!0)]}),_:2},1024)]),default:n(()=>{var w,z;return[i.value?(p(),O(te,{key:0,modelValue:_[d],"onUpdate:modelValue":E=>_[d]=E,style:{"min-width":"80px","max-width":"400px"},type:d.includes("password")?"password":"text","show-password":d.includes("password")},null,8,["modelValue","onUpdate:modelValue","type","show-password"])):(p(),f("div",we,[d.includes("password")?(p(),f("span",ze,U("*".repeat((w=g.value[d])==null?void 0:w.param_value.length)),1)):(p(),f("span",he,U((z=g.value[d])==null?void 0:z.param_value),1))]))]}),_:2},1032,["prop"])),64))])):L("",!0)]),_:1},8,["model","rules"])])}}}),Ce={class:"card"},Ee=F({name:"sysconfig",__name:"sysconfigView",setup(e){const{proxy:t}=T();j();const i=k("zabbix"),c=(b,m)=>{console.log(b,m)};return(b,m)=>{const _=s("el-tab-pane"),g=s("el-tabs");return p(),f("div",Ce,[o(g,{modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=y=>i.value=y),class:"demo-tabs",onTabClick:c},{default:n(()=>[o(_,{label:"zabbix配置",name:"zabbix"},{default:n(()=>[o(ke)]),_:1}),o(_,{label:"安全参数",name:"security"},{default:n(()=>[o(fe)]),_:1})]),_:1},8,["modelValue"])])}}});export{Ee as default};
