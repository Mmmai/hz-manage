import{d as ce,r as s,g as pe,j as me,x as fe,a as L,z as _e,v as be,bO as ge,h as i,bb as O,c as E,o as v,b as p,f as o,bU as k,m,B as $,w as a,q as F,F as I,i as ve,cb as ye,cc as he,cr as we,aP as Ce,t as ke,c3 as K,bZ as d,aO as M,_ as xe}from"./index-x4baBB9A.js";const Ve={class:"card"},$e={class:"user-header"},Fe={style:{border:"1px solid var(--el-border-color)",width:"90%"}},Re=ce({__name:"roleView",setup(Se){const U=s({}),{proxy:r}=pe(),R=me(),f=fe(),A=({tree_type:l},e)=>l==="menu"?"is-menu":l==="button"?"is-button":"";L({search:""});const j=s(!1),_=s([]),q=s("auto"),J=s([{prop:"role",label:"角色名"},{prop:"role_name",label:"角色名称"},{prop:"userGroup_count",label:"用户组数量"},{prop:"user_count",label:"用户数量"}]);s(0);const z=s({});_e(async()=>{await y(),se()});const y=async()=>{let l=await r.$api.getRole();_.value=l.data.results;for(let e in _.value){let u=_.value[e].role,g=_.value[e].id;z.value[g]=u}},G=l=>{U.value=l},b=s(!1),n=L({role:"",role_name:"",rolePermission:[]}),S=s("add"),W=()=>{R.push({path:f.path+"/new"})},Z=()=>{b.value=!1,r.$refs.userFrom.resetFields(),h([])},H=l=>{K.confirm("是否确认关闭?").then(()=>{r.$refs.userFrom.resetFields(),h([]),l()}).catch(()=>{})},Q=be(()=>{let l=new Array;return c.value.getCheckedNodes().forEach(e=>{e.tree_type==="button"&&l.push(e.id)}),l}),X=()=>{n.rolePermission=Q.value,console.log(JSON.stringify(n)),r.$refs.userFrom.validate(async l=>{if(l)if(S.value=="add"){let e=await r.$api.roleadd(n);e.status==201?(b.value=!1,d({type:"success",message:"添加成功"}),r.$refs.userFrom.resetFields(),h([]),y(),console.log(c.value.getCheckedKeys())):d({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await r.$api.roleupdate({id:B.value.id,...n});console.log(e),e.status==200?(b.value=!1,r.$refs.userFrom.resetFields(),h([]),console.log(c.value.getCheckedKeys()),y(),d({type:"success",message:"更新成功"})):d({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else d({showClose:!0,message:"请输入正确内容.",type:"error"})})},B=s({}),Y=l=>{R.push({path:f.path+"/"+l.id})},ee=l=>{K.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await r.$api.roledel(l.id)).status==204?(d({type:"success",message:"删除成功"}),M(()=>{y()})):d({type:"error",message:"删除失败"})}).catch(()=>{d({type:"info",message:"取消删除"})})},le=s([]),te=(l,e)=>l.role!="sysadmin",oe=l=>{le.value=l},c=s(),N=s([]),se=async()=>{let l=await r.$api.getPermissionToRole();console.log(l),N.value=l.data.results},h=l=>{M().then(()=>{c.value.setCheckedKeys(l,!1),console.log(c.value.getCheckedKeys())})},x=s(!1);return ge(()=>n.role,l=>{l=="sysadmin"?x.value=!0:x.value=!1}),(l,e)=>{var P;const u=i("el-button"),g=i("el-table-column"),ae=i("el-table"),T=i("el-input"),w=i("el-form-item"),ne=i("el-row"),re=i("el-form"),ie=i("el-dialog"),V=O("permission"),de=O("loading");return v(),E(I,null,[p("div",Ve,[p("div",$e,[p("div",null,[k((v(),$(u,{type:"primary",onClick:W},{default:a(()=>[...e[4]||(e[4]=[F("新增",-1)])]),_:1})),[[V,`${(P=m(f).name)==null?void 0:P.replace("_info","")}:add`]])])]),p("div",null,[k((v(),$(ae,{border:"",data:_.value,style:{width:"100%"},"max-height":"500px","highlight-current-row":"","table-layout":q.value,onSelectionChange:oe,onRowClick:G},{default:a(()=>[o(g,{type:"selection",width:"55",selectable:te}),(v(!0),E(I,null,ve(J.value,t=>(v(),$(g,{key:t.prop,label:t.label,prop:t.prop},null,8,["label","prop"]))),128)),o(g,{fixed:"right",label:"操作",width:"150"},{default:a(t=>{var C,D;return[k(o(u,{link:"",type:"primary",icon:m(ye),onClick:ue=>Y(t.row)},null,8,["icon","onClick"]),[[V,`${(C=m(f).name)==null?void 0:C.replace("_info","")}:edit`]]),k(o(u,{disabled:t.row.built_in,"icon-position":"right",link:"",type:"danger",icon:m(he),onClick:ue=>ee(t.row)},null,8,["disabled","icon","onClick"]),[[V,`${(D=m(f).name)==null?void 0:D.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data","table-layout"])),[[de,j.value]])])]),o(ie,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),title:S.value=="add"?"新增角色":"编辑角色",width:"50%","before-close":H},{default:a(()=>[o(re,{model:n,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"userFrom","status-icon":""},{default:a(()=>[o(w,{label:"角色",prop:"role",rules:[{required:!0}]},{default:a(()=>[o(T,{modelValue:n.role,"onUpdate:modelValue":e[0]||(e[0]=t=>n.role=t),placeholder:"请输入英文",clearable:"",style:{width:"30%"},disabled:B.value.built_in},null,8,["modelValue","disabled"])]),_:1}),o(w,{label:"角色名称",prop:"role_name",rules:[{required:!0}]},{default:a(()=>[o(T,{modelValue:n.role_name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.role_name=t),placeholder:"中文名称",style:{width:"30%"},clearable:"",disabled:x.value},null,8,["modelValue","disabled"])]),_:1}),o(w,{label:"菜单授权",prop:"rolePermission"},{default:a(()=>[p("div",Fe,[o(m(we),{ref_key:"menuTreeRef",ref:c,modelValue:n.rolePermission,"onUpdate:modelValue":e[2]||(e[2]=t=>n.rolePermission=t),data:N.value,"show-checkbox":"","node-key":"id","default-expand-all":"","expand-on-click-node":!1,props:{class:A}},{default:a(({node:t,data:C})=>[p("span",{class:Ce({buttonList:C.tree_type==="button"})},ke(t.label),3)]),_:1},8,["modelValue","data","props"])])]),_:1}),o(ne,{style:{"justify-content":"space-around"}},{default:a(()=>[o(w,null,{default:a(()=>[o(u,{onClick:Z},{default:a(()=>[...e[5]||(e[5]=[F("取消",-1)])]),_:1}),o(u,{type:"primary",onClick:X},{default:a(()=>[...e[6]||(e[6]=[F(" 确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}}),Ne=xe(Re,[["__scopeId","data-v-949004e6"]]);export{Ne as default};
