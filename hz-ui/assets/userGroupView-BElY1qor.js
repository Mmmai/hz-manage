import{d as ee,x as le,g as te,y as ae,r as i,v as se,a as oe,z as ne,h as n,bb as re,c as b,o as d,b as V,f as a,bU as F,m as v,B as y,w as s,q as w,F as C,i as h,t as M,cb as ue,cc as ie,aO as de,c3 as pe,bZ as c}from"./index-x4baBB9A.js";const ce={class:"card"},_e={class:"table-header"},me={class:"header-button-lf"},fe={class:"flexJstart gap-5"},ge={class:"flexJstart gap-5"},ye=ee({name:"userGroup",__name:"userGroupView",setup(be){const $=le(),{proxy:_}=te();ae();const G=i([]);i(!1);const p=i(!1),U=i(null),B=i([]);i("add"),se(()=>{let t=new Object;return B.value.forEach(e=>{t[e.id]=e}),t});const o=oe({group_name:"",role_ids:[],user_ids:[]}),R=t=>{t&&t.resetFields()},j=async()=>{let t=await _.$api.getRole();B.value=t.data.results},T=i([]),q=async()=>{let t=await _.$api.user();T.value=t.data.results},k=async()=>{let t=await _.$api.getUserGroup();G.value=t.data.results,console.log(G.value)},z=i(null),N=()=>{p.value=!1,R(U.value)},E=()=>{p.value=!0,f.value={}},f=i({}),g=i(!0),L=t=>{p.value=!0,f.value=t,g.value=!1,de(()=>{o.group_name=t.group_name,o.role_ids=t.roles.map(e=>e.id),o.user_ids=t.users.map(e=>e.id),console.log(o)}),console.log(o)},Z=t=>{pe.confirm("是否确认删除?","删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await _.$api.deleteUserGroup(t)).status==204?(c({type:"success",message:"删除成功"}),await k()):c({type:"error",message:"删除失败"})}).catch(()=>{c({type:"info",message:"取消删除"})})},H=async t=>{await t.validate(async(e,m)=>{if(e)if(g.value){let r=await _.$api.addUserGroup({...o});r.status=="201"?(c({type:"success",message:"添加成功"}),p.value=!1,R(t),await k()):c({showClose:!0,message:"添加失败:"+JSON.stringify(r.data),type:"error"})}else{console.log(o);let r=await _.$api.updateUserGroup({id:f.value.id,...o});r.status=="200"?(c({type:"success",message:"更新成功"}),p.value=!1,R(t),await k()):c({showClose:!0,message:"更新失败:"+JSON.stringify(r.data),type:"error"})}})};return ne(async()=>{await j(),await q(),await k()}),(t,e)=>{var A;const m=n("el-button"),r=n("el-table-column"),I=n("el-tag"),J=n("el-tooltip"),K=n("el-table"),P=n("el-input"),x=n("el-form-item"),O=n("el-option"),S=n("el-select"),Q=n("el-row"),W=n("el-form"),X=n("el-dialog"),D=re("permission");return d(),b("div",ce,[V("div",_e,[V("div",me,[F((d(),y(m,{type:"primary",onClick:E},{default:s(()=>[...e[5]||(e[5]=[w("添加",-1)])]),_:1})),[[D,`${(A=v($).name)==null?void 0:A.replace("_info","")}:add`]])])]),a(K,{ref_key:"multipleTableRef",ref:z,data:G.value,style:{width:"100%"},border:""},{default:s(()=>[a(r,{property:"group_name",label:"用户组名",sortable:"custom"}),a(r,{property:"user_count",label:"关联用户数"}),a(r,{property:"users",label:"用户列表"},{default:s(l=>[V("div",fe,[(d(!0),b(C,null,h(l.row.users,u=>(d(),y(I,{key:u},{default:s(()=>[w(M(u.username),1)]),_:2},1024))),128))])]),_:1}),a(r,{property:"roles",label:"角色列表"},{default:s(l=>[V("div",ge,[(d(!0),b(C,null,h(l.row.roles,u=>(d(),y(I,{key:u,type:"warning"},{default:s(()=>[w(M(u.role_name),1)]),_:2},1024))),128))])]),_:1}),a(r,{fixed:"right",width:"100",label:"操作"},{default:s(l=>[a(J,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:s(()=>{var u;return[F(a(m,{link:"",type:"primary",icon:v(ue),onClick:Y=>L(l.row)},null,8,["icon","onClick"]),[[D,`${(u=v($).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),a(J,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:s(()=>{var u;return[F(a(m,{link:"",disabled:l.row.built_in,type:"danger",icon:v(ie),onClick:Y=>Z(l.row.id)},null,8,["disabled","icon","onClick"]),[[D,`${(u=v($).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"]),a(X,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),title:g.value?"新增用户组":"编辑用户组",width:"45%","before-close":N},{default:s(()=>[a(W,{inline:!0,model:o,class:"demo-form-inline","label-position":"right",ref_key:"userGroupFrom",ref:U,"status-icon":""},{default:s(()=>[a(x,{label:"用户组名称",prop:"group_name",rules:[{required:!0}]},{default:s(()=>[a(P,{modelValue:o.group_name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.group_name=l),placeholder:"",clearable:"",disabled:!g.value&&f.value.built_in,style:{width:"220px"}},null,8,["modelValue","disabled"])]),_:1}),a(x,{label:"关联用户",prop:"user_ids"},{default:s(()=>[a(S,{modelValue:o.user_ids,"onUpdate:modelValue":e[1]||(e[1]=l=>o.user_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,style:{width:"220px"}},{default:s(()=>[(d(!0),b(C,null,h(T.value,l=>(d(),y(O,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"关联角色",prop:"role_ids"},{default:s(()=>[a(S,{modelValue:o.role_ids,"onUpdate:modelValue":e[2]||(e[2]=l=>o.role_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:!g.value&&f.value.built_in,style:{width:"220px"}},{default:s(()=>[(d(!0),b(C,null,h(B.value,l=>(d(),y(O,{key:l.id,label:l.role,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(Q,{style:{"justify-content":"space-around"}},{default:s(()=>[a(x,null,{default:s(()=>[a(m,{onClick:N},{default:s(()=>[...e[6]||(e[6]=[w("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:e[3]||(e[3]=l=>H(U.value))},{default:s(()=>[...e[7]||(e[7]=[w(" 确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ye as default};
