import{d as E,aM as q,g as D,bA as U,r as y,bO as H,h as w,B as d,o as f,w as o,f as i,q as s,b as c,aP as K,aO as W,_ as G}from"./index-x4baBB9A.js";const Q={class:"my-header"},j=["id"],z=["innerHTML"],P={class:"dialog-footer"},J=E({__name:"nearLogCom",props:q(["url","highlightKey"],{isShow:{},isShowModifiers:{}}),emits:["update:isShow"],setup(x,{expose:T}){const{proxy:u}=D(),N=(t,e)=>{if(e){const l=new RegExp(e,"gi");return t.replace(l,'<span style="background-color: #ff9b2d;">$&</span>')}else return t},b=U(x,"isShow"),L=x,R=y(10),_=y(10),$=async()=>{R.value+=10,await k(m.value),v(u.$refs.nearLogRef,0)},C=async()=>{_.value+=10,await k(m.value),v(u.$refs.nearLogRef,p.value.length)},A=()=>{R.value=10,_.value=10,h.value=0},p=y([]),m=y(""),k=async t=>{let l=(await u.$api.lokiNearQuery({url:L.url,targetLog:t,limit:R.value,direction:"backward"})).data.queryResult,n=(await u.$api.lokiNearQuery({url:L.url,targetLog:t,limit:_.value,direction:"forward"})).data.queryResult;p.value=[...l,...n]},S=async t=>{m.value=t,b.value=!0,await k(t),W(()=>{v(u.$refs.nearLogRef,h.value)})};function v(t,e,l=!0){const a=t.$el.querySelectorAll(".el-table__body tbody .el-table__row");let n=0;for(let g=0;g<a.length&&g!==e;g++)if(n+=a[g].offsetHeight,!l){n*=e-2;break}t.scrollTo(0,n)}const h=y(0);H(()=>p.value,t=>{h.value=t.findIndex(e=>e.lokiTime===m.value.lokiTime)});const B=()=>{v(u.$refs.nearLogRef,h.value)},F=({row:t})=>{if(t.lokiTime==m.value.lokiTime)return"highlight-class"},O=t=>{let e=[];t.forEach(a=>{e.push(`${a.logTime},${a.level},${a.logLine}
`)});let l=u.$commonFunc.getCurrentTimeString("-","-","_",":",":");console.log(l),u.$commonFunc.downloadArray(`export-log-${l}`,e)};return T({showNearLog:S}),(t,e)=>{const l=w("el-button"),a=w("el-table-column"),n=w("el-tag"),g=w("el-table"),I=w("el-dialog");return f(),d(I,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=r=>b.value=r),title:"日志上下文",width:"95%",top:"9vh",onClose:A},{header:o(({close:r,titleId:M,titleClass:V})=>[c("div",Q,[c("div",{id:M,class:K(V),style:{display:"flex","justify-content":"space-between"}},[e[3]||(e[3]=c("span",null,"日志上下文",-1)),i(l,{type:"primary",onClick:e[0]||(e[0]=X=>O(p.value)),style:{"margin-right":"20px"}},{default:o(()=>[...e[2]||(e[2]=[s(" 下载日志 ",-1)])]),_:1})],10,j)])]),footer:o(()=>[c("div",P,[i(l,{type:"primary",onClick:$},{default:o(()=>[...e[10]||(e[10]=[s("往前翻",-1)])]),_:1}),i(l,{type:"primary",onClick:C},{default:o(()=>[...e[11]||(e[11]=[s("往后翻",-1)])]),_:1}),i(l,{type:"primary",onClick:B},{default:o(()=>[...e[12]||(e[12]=[s("跳转到分析行",-1)])]),_:1})])]),default:o(()=>[i(g,{data:p.value,ref:"nearLogRef",style:{width:"100%"},height:"600","row-class-name":F},{default:o(()=>[i(a,{type:"index",width:"50"}),i(a,{label:"日志时间",prop:"logTime",width:"200px"}),i(a,{label:"日志等级",prop:"level",width:"100px"},{default:o(r=>[r.row.level=="DEBUG"?(f(),d(n,{key:0,type:"primary",effect:"light"},{default:o(()=>[...e[4]||(e[4]=[s("DEBUG",-1)])]),_:1})):r.row.level=="INFO"?(f(),d(n,{key:1,type:"success",effect:"light"},{default:o(()=>[...e[5]||(e[5]=[s("INFO",-1)])]),_:1})):r.row.level=="WARN"?(f(),d(n,{key:2,type:"warning",effect:"light"},{default:o(()=>[...e[6]||(e[6]=[s("WARN",-1)])]),_:1})):r.row.level=="ERROR"?(f(),d(n,{key:3,type:"danger",effect:"light"},{default:o(()=>[...e[7]||(e[7]=[s("ERROR",-1)])]),_:1})):r.row.level=="FATAL"?(f(),d(n,{key:4,type:"danger",effect:"light"},{default:o(()=>[...e[8]||(e[8]=[s("FATAL",-1)])]),_:1})):(f(),d(n,{key:5,type:"info",effect:"light"},{default:o(()=>[...e[9]||(e[9]=[s("UNKNOWN",-1)])]),_:1}))]),_:1}),i(a,{label:"日志内容"},{default:o(({row:r})=>[c("span",{innerHTML:N(r.logLine,L.highlightKey)},null,8,z)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}}),Z=G(J,[["__scopeId","data-v-d830aa43"]]);export{Z as n};
