import{d as ae,h as te,g as se,u as oe,r as d,A as re,a as ne,q as ue,e as r,ak as ie,c as f,o as c,i as k,b as t,ab as D,v as b,D as g,w as s,k as v,a7 as x,a8 as V,t as M,al as de,am as ce,s as pe,I as _e,ap as _}from"./index-BGjJrjF8.js";const me={class:"card"},fe={class:"table-header"},be={class:"header-button-lf"},ge={class:"flexJstart gap-5"},ve={class:"flexJstart gap-5"},ke=ae({name:"userGroup",__name:"userGroupView",setup(ye){const C=te(),{proxy:m}=se();oe();const h=d([]),$=d(!1),p=d(!1),R=d(null),G=d([]),q=d("add");re(()=>{let a=new Object;return G.value.forEach(e=>{a[e.id]=e}),a});const o=ne({group_name:"",role_ids:[],user_ids:[]}),B=a=>{a&&a.resetFields()},E=async()=>{let a=await m.$api.getRole();G.value=a.data.results},T=d([]),L=async()=>{let a=await m.$api.user();T.value=a.data.results},y=async()=>{let a=await m.$api.getUserGroup();h.value=a.data.results,console.log(h.value)},z=d(null),F=()=>{p.value=!1},H=()=>{p.value=!0},I=d({}),N=d(!0),K=a=>{I.value=a,console.log(a),p.value=!0,N.value=!1,pe(()=>{Object.keys(o).forEach(e=>{["user_ids"].includes(e)?o[e]=a.users.map(i=>i.id):["role_ids"].includes(e)?o[e]=a.roles.map(i=>i.id):o[e]=a[e]})}),console.log(o)},P=a=>{_e.confirm("是否确认删除?","删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await m.$api.deleteUserGroup(a)).status==204?(_({type:"success",message:"删除成功"}),await y()):_({type:"error",message:"删除失败"})}).catch(()=>{_({type:"info",message:"取消删除"})})},Q=async a=>{await a.validate(async(e,i)=>{if(e)if(N.value){let n=await m.$api.addUserGroup({...o});n.status=="201"?(_({type:"success",message:"添加成功"}),p.value=!1,B(a),await y()):_({showClose:!0,message:"添加失败:"+JSON.stringify(n.data),type:"error"})}else{let n=await m.$api.updateUserGroup({id:I.value.id,...o});n.status=="200"?(_({type:"success",message:"更新成功"}),p.value=!1,B(a),await y()):_({showClose:!0,message:"更新失败:"+JSON.stringify(n.data),type:"error"})}})};return ue(async()=>{await E(),await L(),await y()}),(a,e)=>{var j;const i=r("el-button"),n=r("el-table-column"),A=r("el-tag"),J=r("el-tooltip"),W=r("el-table"),X=r("el-input"),w=r("el-form-item"),O=r("el-option"),S=r("el-select"),Y=r("el-row"),Z=r("el-form"),ee=r("el-dialog"),U=ie("permission");return c(),f("div",me,[k("div",fe,[k("div",be,[D((c(),g(i,{type:"primary",onClick:H},{default:s(()=>e[5]||(e[5]=[v("添加")])),_:1})),[[U,`${(j=b(C).name)==null?void 0:j.replace("_info","")}:add`]])])]),t(W,{ref_key:"multipleTableRef",ref:z,data:h.value,style:{width:"100%"},border:""},{default:s(()=>[t(n,{property:"group_name",label:"用户组名",sortable:"custom"}),t(n,{property:"user_count",label:"关联用户数"}),t(n,{property:"users",label:"用户列表"},{default:s(l=>[k("div",ge,[(c(!0),f(x,null,V(l.row.users,u=>(c(),g(A,{key:u},{default:s(()=>[v(M(u.username),1)]),_:2},1024))),128))])]),_:1}),t(n,{property:"roles",label:"角色列表"},{default:s(l=>[k("div",ve,[(c(!0),f(x,null,V(l.row.roles,u=>(c(),g(A,{key:u},{default:s(()=>[v(M(u.role),1)]),_:2},1024))),128))])]),_:1}),t(n,{fixed:"right",width:"100",label:"操作"},{default:s(l=>[t(J,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:s(()=>{var u;return[D(t(i,{disabled:l.row.group_name==="系统管理组",link:"",type:"primary",icon:b(de),onClick:le=>K(l.row)},null,8,["disabled","icon","onClick"]),[[U,`${(u=b(C).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),t(J,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:s(()=>{var u;return[D(t(i,{link:"",disabled:l.row.group_name==="系统管理组",type:"danger",icon:b(ce),onClick:le=>P(l.row.id)},null,8,["disabled","icon","onClick"]),[[U,`${(u=b(C).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"]),t(ee,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),title:q.value=="add"?"新增用户组":"编辑用户组",width:"45%","before-close":F},{default:s(()=>[t(Z,{inline:!0,model:o,class:"demo-form-inline","label-position":"right",ref_key:"userGroupFrom",ref:R,"status-icon":""},{default:s(()=>[t(w,{label:"用户组名称",prop:"group_name",rules:[{required:!0}]},{default:s(()=>[t(X,{modelValue:o.group_name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.group_name=l),placeholder:"",clearable:"",disabled:$.value,style:{width:"220px"}},null,8,["modelValue","disabled"])]),_:1}),t(w,{label:"关联用户",prop:"user_ids"},{default:s(()=>[t(S,{modelValue:o.user_ids,"onUpdate:modelValue":e[1]||(e[1]=l=>o.user_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:$.value,style:{width:"220px"}},{default:s(()=>[(c(!0),f(x,null,V(T.value,l=>(c(),g(O,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(w,{label:"关联角色",prop:"role_ids"},{default:s(()=>[t(S,{modelValue:o.role_ids,"onUpdate:modelValue":e[2]||(e[2]=l=>o.role_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:$.value,style:{width:"220px"}},{default:s(()=>[(c(!0),f(x,null,V(G.value,l=>(c(),g(O,{key:l.id,label:l.role,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(Y,{style:{"justify-content":"space-around"}},{default:s(()=>[t(w,null,{default:s(()=>[t(i,{onClick:F},{default:s(()=>e[6]||(e[6]=[v("取消")])),_:1}),t(i,{type:"primary",onClick:e[3]||(e[3]=l=>Q(R.value))},{default:s(()=>e[7]||(e[7]=[v(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ke as default};
