import{d as le,h as te,g as ae,u as se,r as i,l as oe,a as re,m as ne,e as r,b7 as ue,c as f,o as d,i as k,b as a,bQ as R,y as g,q as b,w as s,k as v,F as x,p as V,t as j,c6 as ie,c7 as de,aK as pe,bY as ce,c3 as c}from"./index-DD1IBG_Z.js";const _e={class:"card"},me={class:"table-header"},fe={class:"header-button-lf"},ge={class:"flexJstart gap-5"},be={class:"flexJstart gap-5"},we=le({name:"userGroup",__name:"userGroupView",setup(ve){const C=te(),{proxy:_}=ae();se();const h=i([]),$=i(!1),p=i(!1),B=i(null),G=i([]);i("add"),oe(()=>{let t=new Object;return G.value.forEach(e=>{t[e.id]=e}),t});const o=re({group_name:"",role_ids:[],user_ids:[]}),F=t=>{t&&t.resetFields()},q=async()=>{let t=await _.$api.getRole();G.value=t.data.results},T=i([]),E=async()=>{let t=await _.$api.user();T.value=t.data.results},y=async()=>{let t=await _.$api.getUserGroup();h.value=t.data.results,console.log(h.value)},K=i(null),N=()=>{p.value=!1},L=()=>{p.value=!0},I=i({}),U=i(!0),Q=t=>{p.value=!0,I.value=t,U.value=!1,pe(()=>{o.group_name=t.group_name,o.role_ids=t.roles.map(e=>e.id),o.user_ids=t.users.map(e=>e.id),console.log(o)}),console.log(o)},Y=t=>{ce.confirm("是否确认删除?","删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await _.$api.deleteUserGroup(t)).status==204?(c({type:"success",message:"删除成功"}),await y()):c({type:"error",message:"删除失败"})}).catch(()=>{c({type:"info",message:"取消删除"})})},z=async t=>{await t.validate(async(e,m)=>{if(e)if(U.value){let n=await _.$api.addUserGroup({...o});n.status=="201"?(c({type:"success",message:"添加成功"}),p.value=!1,F(t),await y()):c({showClose:!0,message:"添加失败:"+JSON.stringify(n.data),type:"error"})}else{console.log(o);let n=await _.$api.updateUserGroup({id:I.value.id,...o});n.status=="200"?(c({type:"success",message:"更新成功"}),p.value=!1,F(t),await y()):c({showClose:!0,message:"更新失败:"+JSON.stringify(n.data),type:"error"})}})};return ne(async()=>{await q(),await E(),await y()}),(t,e)=>{var O;const m=r("el-button"),n=r("el-table-column"),J=r("el-tag"),S=r("el-tooltip"),H=r("el-table"),P=r("el-input"),w=r("el-form-item"),A=r("el-option"),M=r("el-select"),W=r("el-row"),X=r("el-form"),Z=r("el-dialog"),D=ue("permission");return d(),f("div",_e,[k("div",me,[k("div",fe,[R((d(),b(m,{type:"primary",onClick:L},{default:s(()=>[...e[5]||(e[5]=[v("添加",-1)])]),_:1})),[[D,`${(O=g(C).name)==null?void 0:O.replace("_info","")}:add`]])])]),a(H,{ref_key:"multipleTableRef",ref:K,data:h.value,style:{width:"100%"},border:""},{default:s(()=>[a(n,{property:"group_name",label:"用户组名",sortable:"custom"}),a(n,{property:"user_count",label:"关联用户数"}),a(n,{property:"users",label:"用户列表"},{default:s(l=>[k("div",ge,[(d(!0),f(x,null,V(l.row.users,u=>(d(),b(J,{key:u},{default:s(()=>[v(j(u.username),1)]),_:2},1024))),128))])]),_:1}),a(n,{property:"roles",label:"角色列表"},{default:s(l=>[k("div",be,[(d(!0),f(x,null,V(l.row.roles,u=>(d(),b(J,{key:u},{default:s(()=>[v(j(u.role),1)]),_:2},1024))),128))])]),_:1}),a(n,{fixed:"right",width:"100",label:"操作"},{default:s(l=>[a(S,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:s(()=>{var u;return[R(a(m,{disabled:l.row.group_name==="系统管理组",link:"",type:"primary",icon:g(ie),onClick:ee=>Q(l.row)},null,8,["disabled","icon","onClick"]),[[D,`${(u=g(C).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),a(S,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:s(()=>{var u;return[R(a(m,{link:"",disabled:l.row.group_name==="系统管理组",type:"danger",icon:g(de),onClick:ee=>Y(l.row.id)},null,8,["disabled","icon","onClick"]),[[D,`${(u=g(C).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"]),a(Z,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),title:U.value?"新增用户组":"编辑用户组",width:"45%","before-close":N},{default:s(()=>[a(X,{inline:!0,model:o,class:"demo-form-inline","label-position":"right",ref_key:"userGroupFrom",ref:B,"status-icon":""},{default:s(()=>[a(w,{label:"用户组名称",prop:"group_name",rules:[{required:!0}]},{default:s(()=>[a(P,{modelValue:o.group_name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.group_name=l),placeholder:"",clearable:"",disabled:$.value,style:{width:"220px"}},null,8,["modelValue","disabled"])]),_:1}),a(w,{label:"关联用户",prop:"user_ids"},{default:s(()=>[a(M,{modelValue:o.user_ids,"onUpdate:modelValue":e[1]||(e[1]=l=>o.user_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:$.value,style:{width:"220px"}},{default:s(()=>[(d(!0),f(x,null,V(T.value,l=>(d(),b(A,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(w,{label:"关联角色",prop:"role_ids"},{default:s(()=>[a(M,{modelValue:o.role_ids,"onUpdate:modelValue":e[2]||(e[2]=l=>o.role_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:$.value,style:{width:"220px"}},{default:s(()=>[(d(!0),f(x,null,V(G.value,l=>(d(),b(A,{key:l.id,label:l.role,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(W,{style:{"justify-content":"space-around"}},{default:s(()=>[a(w,null,{default:s(()=>[a(m,{onClick:N},{default:s(()=>[...e[6]||(e[6]=[v("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:e[3]||(e[3]=l=>z(B.value))},{default:s(()=>[...e[7]||(e[7]=[v(" 确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{we as default};
