import{_ as K,aN as Z,bB as ee,r as f,bP as le,h as n,c as S,o as s,B as m,k as b,w as l,f as e,m as ae,cd as te,q as y,t as oe,g as de,x as ue,j as ne,v as se,a as re,z as ie,F as G,i as H,b as x,aP as L,b_ as I}from"./index-BSX4TNZE.js";import{m as me}from"./model-Ds6Q2RXn.js";const pe={class:"attribute-schema-editor"},ce={key:2,style:{"margin-top":"20px"}},_e={__name:"AttributeSchemaEditor",props:Z({editable:{type:Boolean,default:!1},relation:{type:Boolean,default:!1}},{schema:{},schemaModifiers:{}}),emits:["update:schema"],setup(p,{expose:N}){const c=ee(p,"schema"),q=p,_=f([]),U=()=>{c.value!==void 0&&(_.value=Object.keys(c.value).map(d=>({key:d,value:{...c.value[d]}})))},R=()=>{const d={};return _.value.forEach(r=>{r.key&&(d[r.key]={...r.value})}),d},C=()=>{q.relation?_.value.push({key:"",value:{type:"string",required:!1,verbose_name:"",default:""}}):_.value.push({key:"",value:{type:"string",required:!1,verbose_name:""}})},M=d=>{_.value.splice(d,1)},$=d=>({string:"字符串"})[d]||d;return le(()=>c.value,(d,r)=>{U()},{deep:!0,immediate:!0}),N({updateSchema:()=>{c.value=R()}}),(d,r)=>{const o=n("el-input"),i=n("el-table-column"),O=n("el-option"),g=n("el-select"),h=n("el-checkbox"),V=n("el-button"),B=n("el-table"),D=n("el-tag");return s(),S("div",pe,[p.editable?(s(),m(B,{key:0,data:_.value,style:{width:"100%"}},{default:l(()=>[e(i,{label:"属性名",width:"150"},{default:l(t=>[e(o,{modelValue:t.row.key,"onUpdate:modelValue":a=>t.row.key=a,placeholder:"属性名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(i,{label:"类型",width:"120"},{default:l(t=>[e(g,{modelValue:t.row.value.type,"onUpdate:modelValue":a=>t.row.value.type=a,placeholder:"类型"},{default:l(()=>[e(O,{label:"字符串",value:"string"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(i,{label:"显示名称",width:"150"},{default:l(t=>[e(o,{modelValue:t.row.value.verbose_name,"onUpdate:modelValue":a=>t.row.value.verbose_name=a,placeholder:"显示名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),p.relation?(s(),m(i,{key:0,prop:"value.unit",label:"单位",width:"100"},{default:l(t=>[e(o,{modelValue:t.row.value.unit,"onUpdate:modelValue":a=>t.row.value.unit=a,placeholder:"单位"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):b("",!0),p.relation?(s(),m(i,{key:1,prop:"value.default",label:"默认值",width:"120"},{default:l(t=>[e(o,{modelValue:t.row.value.default,"onUpdate:modelValue":a=>t.row.value.default=a,placeholder:"单位"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):b("",!0),e(i,{label:"必填",width:"80"},{default:l(t=>[e(h,{modelValue:t.row.value.required,"onUpdate:modelValue":a=>t.row.value.required=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(i,{label:"操作",width:"80"},{default:l(t=>[e(V,{type:"danger",icon:ae(te),link:"",onClick:a=>M(t.$index)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])):(s(),m(B,{key:1,data:_.value,style:{width:"100%"}},{default:l(()=>[e(i,{prop:"key",label:"属性名",width:"150"}),e(i,{label:"类型",width:"120"},{default:l(t=>[y(oe($(t.row.value.type)),1)]),_:1}),e(i,{prop:"value.verbose_name",label:"显示名称",width:"150"}),p.relation?(s(),m(i,{key:0,prop:"value.unit",label:"单位",width:"100"})):b("",!0),p.relation?(s(),m(i,{key:1,prop:"value.default",label:"默认值",width:"120"})):b("",!0),e(i,{label:"必填",width:"80"},{default:l(t=>[t.row.value.required?(s(),m(D,{key:0,type:"success"},{default:l(()=>[...r[0]||(r[0]=[y("是",-1)])]),_:1})):(s(),m(D,{key:1},{default:l(()=>[...r[1]||(r[1]=[y("否",-1)])]),_:1}))]),_:1})]),_:1},8,["data"])),p.editable?(s(),S("div",ce,[e(V,{type:"primary",onClick:C},{default:l(()=>[...r[2]||(r[2]=[y("添加属性",-1)])]),_:1})])):b("",!0)])}}},P=K(_e,[["__scopeId","data-v-345bbbd5"]]),fe={class:"relation-type-view"},be={class:"card-header"},ve={__name:"modelRelationInfoView",setup(p){const N=me(),{proxy:c}=de(),q=ue(),_=ne(),U=se(()=>N.modelOptions),R=()=>{_.push({path:"/cmdb/cimodelManage/modelRelation"})},C=f(null),M=f(null),$=f(null),E=f(null),d=f(!1),r=f({}),o=re({name:"",topology_type:"directed",forward_verb:"",reverse_verb:"",attribute_schema:{source:{},target:{},relation:{}},description:null,source_model:"",target_model:""}),i=()=>{M.value.updateSchema(),$.value.updateSchema(),E.value.updateSchema(),L(()=>{h.value?D():B()})},O=()=>{d.value=!1,Object.assign(o,r.value)},g=f(""),h=f(!1),V=async()=>{const t=await c.$api.getModelRelationDefineInfo(g.value);t.status===200&&(r.value=t.data,o.name=t.data.name,o.topology_type=t.data.topology_type,o.forward_verb=t.data.forward_verb,o.reverse_verb=t.data.reverse_verb,o.attribute_schema=t.data.attribute_schema,o.description=t.data.description,o.source_model=t.data.source_model,o.target_model=t.data.target_model)},B=async()=>{const t=await c.$api.updateModelRelationDefine({id:g.value,...o});t.status==200?(I({type:"success",message:"更新成功"}),d.value=!1,L(()=>{V()})):I({type:"error",message:`更新失败:  ${JSON.stringify(t.data)}`})},D=async()=>{const t=await c.$api.addModelRelationDefine(o);t.status==201?(I.success("添加成功"),d.value=!1,C.value.resetFields(),L(()=>{R()})):I({type:"error",message:`添加失败: ${JSON.stringify(t.data)}`})};return ie(()=>{g.value=q.path.split("/").at(-1),g.value.includes("new")?(h.value=!0,d.value=!0):V()}),(t,a)=>{const Q=n("el-page-header"),T=n("el-button"),W=n("el-tooltip"),A=n("el-input"),v=n("el-form-item"),w=n("el-col"),k=n("el-option"),j=n("el-select"),F=n("el-row"),X=n("el-form"),z=n("el-card"),J=n("el-tab-pane"),Y=n("el-tabs");return s(),S("div",fe,[e(z,{class:"relation-card"},{header:l(()=>[x("div",be,[e(Q,{onBack:R},{content:l(()=>[...a[11]||(a[11]=[x("span",null,"关系类型详情",-1)])]),_:1}),x("div",null,[e(W,{content:`
                  
                  编辑关联关系
              `,placement:"top"},{default:l(()=>[d.value?b("",!0):(s(),m(T,{key:0,type:"primary",onClick:a[0]||(a[0]=u=>d.value=!0)},{default:l(()=>[...a[12]||(a[12]=[y("编辑",-1)])]),_:1}))]),_:1}),d.value?(s(),m(T,{key:0,type:"success",onClick:i},{default:l(()=>[...a[13]||(a[13]=[y("保存",-1)])]),_:1})):b("",!0),d.value?(s(),m(T,{key:1,onClick:O},{default:l(()=>[...a[14]||(a[14]=[y("取消",-1)])]),_:1})):b("",!0)])])]),default:l(()=>[e(X,{model:o,"label-width":"120px",disabled:!d.value,ref_key:"formRef",ref:C},{default:l(()=>[e(F,{gutter:20},{default:l(()=>[e(w,{span:6},{default:l(()=>[e(v,{label:"名称"},{default:l(()=>[e(A,{modelValue:o.name,"onUpdate:modelValue":a[1]||(a[1]=u=>o.name=u),disabled:!d.value||!h.value,style:{"max-width":"300px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(w,{span:6},{default:l(()=>[e(v,{label:"拓扑关系"},{default:l(()=>[e(j,{modelValue:o.topology_type,"onUpdate:modelValue":a[2]||(a[2]=u=>o.topology_type=u),disabled:!d.value,style:{"max-width":"300px"}},{default:l(()=>[e(k,{label:"有向",value:"directed"}),e(k,{label:"无向",value:"undirected"}),e(k,{label:"有向无环",value:"daggered"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(F,{gutter:20},{default:l(()=>[e(w,{span:6},{default:l(()=>[e(v,{label:"源模型"},{default:l(()=>[e(j,{modelValue:o.source_model,"onUpdate:modelValue":a[3]||(a[3]=u=>o.source_model=u),disabled:!d.value,clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,style:{"max-width":"300px"}},{default:l(()=>[(s(!0),S(G,null,H(U.value,u=>(s(),m(k,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(w,{span:6},{default:l(()=>[e(v,{label:"目标模型"},{default:l(()=>[e(j,{modelValue:o.target_model,"onUpdate:modelValue":a[4]||(a[4]=u=>o.target_model=u),disabled:!d.value,clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,style:{"max-width":"300px"}},{default:l(()=>[(s(!0),S(G,null,H(U.value,u=>(s(),m(k,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(F,{gutter:20},{default:l(()=>[e(w,{span:6},{default:l(()=>[e(v,{label:"正向动词"},{default:l(()=>[e(A,{modelValue:o.forward_verb,"onUpdate:modelValue":a[5]||(a[5]=u=>o.forward_verb=u),disabled:!d.value,style:{"max-width":"300px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(w,{span:6},{default:l(()=>[e(v,{label:"反向动词"},{default:l(()=>[e(A,{modelValue:o.reverse_verb,"onUpdate:modelValue":a[6]||(a[6]=u=>o.reverse_verb=u),disabled:!d.value,style:{"max-width":"300px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(v,{label:"描述"},{default:l(()=>[e(A,{modelValue:o.description,"onUpdate:modelValue":a[7]||(a[7]=u=>o.description=u),type:"textarea",disabled:!d.value,style:{"max-width":"1000px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","disabled"])]),_:1}),e(z,{class:"attribute-card"},{header:l(()=>[...a[15]||(a[15]=[x("div",{class:"card-header"},[x("span",null,"属性模式")],-1)])]),default:l(()=>[e(Y,{type:"card"},{default:l(()=>[e(J,{label:"源属性"},{default:l(()=>[e(P,{ref_key:"sourceSchemaRef",ref:M,schema:o.attribute_schema.source,"onUpdate:schema":a[8]||(a[8]=u=>o.attribute_schema.source=u),editable:d.value},null,8,["schema","editable"])]),_:1}),e(J,{label:"目标属性"},{default:l(()=>[e(P,{ref_key:"targetSchemaRef",ref:$,schema:o.attribute_schema.target,"onUpdate:schema":a[9]||(a[9]=u=>o.attribute_schema.target=u),editable:d.value},null,8,["schema","editable"])]),_:1}),e(J,{label:"关系属性"},{default:l(()=>[e(P,{schema:o.attribute_schema.relation,ref_key:"relationSchemaRef",ref:E,"onUpdate:schema":a[10]||(a[10]=u=>o.attribute_schema.relation=u),editable:d.value,relation:!0},null,8,["schema","editable"])]),_:1})]),_:1})]),_:1})])}}},we=K(ve,[["__scopeId","data-v-18951cbc"]]);export{we as default};
