import{d as il,aB as He,bu as rl,r as i,c as al,e as c,o as t,O as d,w as l,g as a,h as C,j as v,t as V,f as r,bo as b,c4 as Ve,P as O,c1 as fa,c3 as I,k as Ul,M as L,bI as Fl,F as ue,b1 as ce,bS as ma,c5 as Ka,aD as Me,_ as Il,c6 as ll,bQ as hl,b as _a,u as Ha,aN as ya,b3 as dl,c7 as Wa,c8 as Ga,bO as Z,bZ as Qa,c9 as zl,ca as Za,cb as Xa,cc as et,bF as Bl,Y as lt,b$ as at,cd as va,ce as tt,aE as Ie,c0 as ot,bV as Jl,cf as nt,i as st,cg as ut,ch as dt,ci as rt}from"./index-gMsChr2z.js";import{l as it}from"./vue-draggable-plus-DV3AXNfs.js";import{u as ga}from"./config-CmCM-JND.js";import{e as Al,d as Yl}from"./gmCrypto-DttI_P9U.js";const ct={class:"flexJstart gap-1"},pt={key:0,class:"flexJstart gap-1"},vt={key:3,class:"flexJstart gap-1"},ft=il({__name:"ciDataUpload",props:He(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:He(["getCiData"],["update:isShowUpload"]),setup(pe,{emit:ve}){const{proxy:W}=Ul(),M=pe,z=ve,k=rl(pe,"isShowUpload"),A=i([]),fe=i(null),h=["xlsx"],S=i({}),T=i({}),ye=al({"Content-Type":"multipart/form-data"}),te=i({}),le=async()=>{Object.keys(T.value).length>0?Object.entries(T.value).forEach(async([x,F])=>{let J=await W.$api.importCiDataStatus(F);S.value[x]=J.data,J.data.status==="completed"&&delete T.value[x]}):(clearInterval(oe),oe=null,z("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId}))};let oe=null;const G=async x=>{let F=new FormData;F.append("file",x.file),F.append("model",M.ciModelId);let J=await W.$api.importCiData(F,ye,2*60*1e3);J.status==200?(T.value[x.file.uid]=J.data,te.value[x.file.uid]=!0,oe===null&&(oe=setInterval(le,1e3))):(te.value[x.file.uid]=!1,I({message:`导入异常: ${JSON.stringify(J.data)}`,type:"error",showClose:!0}))},P=x=>{let F=x.name;if(x.type!=""||x.type!=null||x.type!=null){const J=x.name.replace(/.+\./,"").toLowerCase();return x.size/1024/1024<5?h.includes(J)?A.value.find(K=>K.name==F&&K.lastModified==x.lastModified)?(I({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(I({message:`不能上传${J}类型的文件`,type:"error",showClose:!0}),!1):(I.error("上传文件大小不能超过 5MB!"),!1)}},X=async x=>{let F=await W.$api.downloadErrorRecords({error_file_key:x});console.log(F)},Q=async()=>{let x=await W.$api.downloadImportTemplate({model:M.ciModelId});console.log(x)};return(x,F)=>{const J=c("upload-filled"),g=c("el-icon"),p=c("el-col"),K=c("el-button"),ie=c("el-row"),Oe=c("Loading"),ge=c("CircleCheck"),se=c("el-link"),H=c("el-upload"),Y=c("el-dialog");return t(),d(Y,{modelValue:k.value,"onUpdate:modelValue":F[1]||(F[1]=E=>k.value=E),title:"导入",width:"800"},{default:l(()=>[a(H,{class:"upload-demo",drag:"",action:"",multiple:"",ref_key:"refUpload",ref:fe,headers:ye,"http-request":G,"file-list":A.value,"before-upload":P,limit:10,"show-file-list":""},{tip:l(()=>[a(ie,{justify:"space-between",align:"middle"},{default:l(()=>[a(p,{span:18},{default:l(()=>F[2]||(F[2]=[C("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(p,{span:3},{default:l(()=>[a(K,{link:"",type:"primary",onClick:F[0]||(F[0]=E=>Q())},{default:l(()=>F[3]||(F[3]=[v("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:E,index:Pe})=>{var Ue,Ee,Ye,$,Ne,N,tl,Be,Je;return[C("div",ct,[C("span",null,V(E.name),1),te.value[E.uid]==!0?(t(),r("div",pt,[((Ue=S.value[E.uid])==null?void 0:Ue.status)!=="completed"?(t(),d(g,{key:0,class:"is-loading"},{default:l(()=>[a(Oe)]),_:1})):((Ee=S.value[E.uid])==null?void 0:Ee.failed)>>>0?(t(),d(g,{key:1},{default:l(()=>[a(b(Ve),{color:"var(--el-color-warning)"})]),_:1})):(t(),d(g,{key:2},{default:l(()=>[a(ge,{color:"var(--el-color-success)"})]),_:1})),S.value[E.uid]?(t(),r("div",vt,[C("span",null,V(`进度: ${(Ye=S.value[E.uid])==null?void 0:Ye.progress}%`),1),C("span",null,V(`结果: 总条数: ${($=S.value[E.uid])==null?void 0:$.total},创建: ${(Ne=S.value[E.uid])==null?void 0:Ne.created},更新: ${(N=S.value[E.uid])==null?void 0:N.updated},跳过: ${(tl=S.value[E.uid])==null?void 0:tl.skipped},失败: ${(Be=S.value[E.uid])==null?void 0:Be.failed}.`),1),((Je=S.value[E.uid])==null?void 0:Je.failed)>>>0?(t(),d(se,{key:0,type:"danger",onClick:cl=>{var ol;return X((ol=S.value[E.uid])==null?void 0:ol.error_file_key)}},{default:l(()=>F[4]||(F[4]=[v("查看导入失败数据")])),_:2},1032,["onClick"])):O("",!0)])):O("",!0)])):te.value[E.uid]==!1?(t(),d(g,{key:1},{default:l(()=>[a(b(fa),{color:"var(--el-color-error)"})]),_:1})):O("",!0)])]}),default:l(()=>[a(g,{class:"el-icon--upload"},{default:l(()=>[a(J)]),_:1}),F[5]||(F[5]=C("div",{class:"el-upload__text"},[v("拖拽文件到此或者 "),C("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list"])]),_:1},8,["modelValue"])}}}),mt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},_t={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},yt={style:{width:"100%",overflow:"auto"}},gt={class:"listItem"},bt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},wt={class:"listItem"},kt={style:{flex:"auto"}},ht=il({__name:"ciDataTableCol",props:He(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:He(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(pe,{expose:ve,emit:W}){const M=pe,z=rl(pe,"isShowTableCol"),k=rl(pe,"hasConfigField"),{proxy:A}=Ul(),fe=i(""),h=i(""),S=L(()=>fe.value===""?J.value:J.value.filter(g=>g.verbose_name.includes(fe.value)));function T(){z.value=!1}const ye=g=>{k.value.push(g)},te=g=>{let p=k.value.indexOf(g);k.value.splice(p,1)},le=g=>{console.log("start",g)},oe=g=>{console.log("onEnd",g),console.log(k.value)},G=()=>{console.log("update")},P=i({}),X=async()=>{let g=await A.$api.getCiModelCol({model:M.ciModelId});P.value=g.data;let p=[];g.data.fields_preferred.forEach(K=>{p.push(M.allModelFieldInfo[K])}),k.value=p},Q=L(()=>k.value.map(g=>g.id)),x=W;Fl(()=>k.value,g=>{console.log("更新表格"),x("reloadTable")},{deep:!0});const F=async()=>{let g=await A.$api.updateCiModelCol({id:P.value.id,fields_preferred:Q.value});g.status=="200"?(I({type:"success",message:"更新成功"}),Me(()=>{h.value.clear(),z.value=!1})):I({showClose:!0,message:"更新失败:"+JSON.stringify(g.data),type:"error"})},J=L(()=>M.allModelField.filter(g=>!k.value.includes(g)));return ve({getHasConfigField:X}),(g,p)=>{const K=c("el-text"),ie=c("el-divider"),Oe=c("el-input"),ge=c("el-icon"),se=c("el-button"),H=c("el-drawer");return t(),d(H,{modelValue:z.value,"onUpdate:modelValue":p[2]||(p[2]=Y=>z.value=Y),direction:"rtl",size:"40%"},{header:l(()=>[a(K,{tag:"b"},{default:l(()=>p[3]||(p[3]=[v("表格列显示配置")])),_:1})]),default:l(()=>[C("div",mt,[C("div",_t,[a(K,{tag:"b"},{default:l(()=>p[4]||(p[4]=[v("模型字段")])),_:1}),a(ie),a(Oe,{modelValue:fe.value,"onUpdate:modelValue":p[0]||(p[0]=Y=>fe.value=Y),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:h},null,8,["modelValue"]),C("div",yt,[(t(!0),r(ue,null,ce(S.value,(Y,E)=>(t(),r("div",{key:E},[C("div",gt,[C("span",null,V(Y.verbose_name),1),a(ge,null,{default:l(()=>[a(b(ma),{onClick:Pe=>ye(Y)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),C("div",bt,[a(K,{tag:"b"},{default:l(()=>p[5]||(p[5]=[v("已显示字段")])),_:1}),a(ie),a(b(it),{ref:"el",modelValue:k.value,"onUpdate:modelValue":p[1]||(p[1]=Y=>k.value=Y),onStart:le,onUpdate:G,onEnd:oe,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(ue,null,ce(k.value,(Y,E)=>(t(),r("div",{key:E},[C("div",wt,[C("span",null,V(Y.verbose_name),1),a(ge,null,{default:l(()=>[a(b(Ka),{onClick:Pe=>te(Y)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[C("div",kt,[a(se,{onClick:T},{default:l(()=>p[6]||(p[6]=[v("取消")])),_:1}),a(se,{type:"primary",onClick:F},{default:l(()=>p[7]||(p[7]=[v("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),Ct=Il(ht,[["__scopeId","data-v-fc40893b"]]),xt={class:"dialog-footer"},Vt=il({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(pe){const ve=ga(),W=rl(pe,"showAllPassDia"),M=L(()=>ve.gmCry),z=i(),k=al({secret:null,time:3});i(""),i(!1);const A=async S=>{S.validate(async T=>{T&&(k.secret===M.value.key?(ll({title:"操作成功",message:"解密成功,"+k.time+"分钟后过期！",type:"success",duration:2e3}),ve.updateShowAllPass(!0),W.value=!1,ve.setShowAllPassTime(k.time*60*1e3),fe(z.value)):ll({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},fe=S=>{S&&S.resetFields()},h=()=>{W.value=!1,fe(z.value)};return(S,T)=>{const ye=c("el-input"),te=c("el-form-item"),le=c("el-input-number"),oe=c("el-form"),G=c("el-button"),P=c("el-dialog");return t(),d(P,{modelValue:W.value,"onUpdate:modelValue":T[3]||(T[3]=X=>W.value=X),title:"查看密码",width:"400"},{footer:l(()=>[C("div",xt,[a(G,{onClick:h},{default:l(()=>T[5]||(T[5]=[v("取消")])),_:1}),a(G,{type:"primary",onClick:T[2]||(T[2]=X=>A(z.value))},{default:l(()=>T[6]||(T[6]=[v(" 查看 ")])),_:1})])]),default:l(()=>[a(oe,{ref_key:"allPassFormRef",ref:z,inline:!0,model:k,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(te,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(ye,{type:"password",modelValue:k.secret,"onUpdate:modelValue":T[0]||(T[0]=X=>k.secret=X),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(te,{label:"有效时间",prop:"time"},{default:l(()=>[a(le,{modelValue:k.time,"onUpdate:modelValue":T[1]||(T[1]=X=>k.time=X),min:1,step:1,max:30},{suffix:l(()=>T[4]||(T[4]=[C("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Mt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Ot={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},$t={style:{width:"100%",overflow:"auto"}},Dt={class:"listItem"},Ut={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Ft={style:{"margin-right":"5px"}},It={style:{float:"left"}},Pt={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Nt={key:0},St={key:1},Tt={key:0},jt={key:1},qt={key:2},Et={key:3},Rt={style:{flex:"auto"}},Lt=il({__name:"ciDataFilter",props:He(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:He(["getCiData","updateFilterParam"],["update:showFilter"]),setup(pe,{expose:ve,emit:W}){const M=pe,z=rl(pe,"showFilter"),k=i(""),A=i(""),fe=L(()=>k.value===""?te.value:te.value.filter(g=>g.verbose_name.includes(k.value)));function h(){z.value=!1}const S=g=>{X.value.push(g)},T=g=>{let p=G.filterParams.indexOf(g);X.value.splice(p,1)},ye=(g,p)=>{g==="instance_name"?G.instance_name="":X.value.splice(p,1),Me(()=>{le("updateFilterParam",Q.value)})},te=L(()=>M.allModelField.filter(g=>!X.value.includes(g)));i({});const le=W,oe=i(""),G=al({filterParams:[],instance_name:""}),P=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"包含",description:"包含以,分隔"},{value:"not:in:",label:"不包含",description:"不包含以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"!null",label:"非空",description:"正则表达式"}]),X=i([]),Q=L(()=>{let g=new Object;return G.filterParams.forEach(p=>{if(p.match==="null"||p.match==="!null"){g[p.name]=p.match;return}if(p.value!==""){let K=null;p.value!==null?K=p.value:K="null",p.match==="="?g[p.name]=K:g[p.name]=p.match+K}}),G.instance_name!==""&&(g.instance_name=G.instance_name),g}),x=()=>{console.log(Q.value),le("updateFilterParam",Q.value),console.log(Q.value),Me(()=>{le("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId})}),z.value=!1},F=L(()=>{var g;return(g=G.filterParams)==null?void 0:g.map(p=>p.name)});Fl(()=>X.value,g=>{var K;let p=new Array;(K=X.value)==null||K.forEach((ie,Oe)=>{var ge;if(((ge=F.value)==null?void 0:ge.indexOf(ie.name))>>>-1)p.push({name:ie.name,value:"",match:"=",label:ie.verbose_name});else{let se=G.filterParams.findIndex(H=>H.name===ie.name);p.push(G.filterParams[se])}}),G.filterParams=p},{deep:!0});const J=g=>{g&&(g.resetFields(),le("updateFilterParam",Q.value),Me(()=>{le("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId})}))};return ve({removeFilterParam:ye}),(g,p)=>{const K=c("el-text"),ie=c("el-divider"),Oe=c("el-input"),ge=c("el-icon"),se=c("el-form-item"),H=c("el-button"),Y=c("el-option"),E=c("el-select"),Pe=c("el-switch"),Ue=c("el-space"),Ee=c("el-form"),Ye=c("el-drawer");return t(),d(Ye,{modelValue:z.value,"onUpdate:modelValue":p[4]||(p[4]=$=>z.value=$),direction:"rtl",size:"50%","before-close":h},{header:l(()=>[a(K,{tag:"b"},{default:l(()=>p[5]||(p[5]=[v("筛选")])),_:1})]),default:l(()=>[C("div",Mt,[C("div",Ot,[a(K,{tag:"b"},{default:l(()=>p[6]||(p[6]=[v("模型字段")])),_:1}),a(ie),a(Oe,{modelValue:k.value,"onUpdate:modelValue":p[0]||(p[0]=$=>k.value=$),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:A},null,8,["modelValue"]),C("div",$t,[(t(!0),r(ue,null,ce(fe.value,($,Ne)=>(t(),r("div",{key:Ne},[C("div",Dt,[C("span",null,V($.verbose_name),1),a(ge,null,{default:l(()=>[a(b(ma),{onClick:N=>S($)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),C("div",Ut,[a(K,{tag:"b"},{default:l(()=>p[7]||(p[7]=[v("过滤器")])),_:1}),a(ie),a(Ee,{ref_key:"filterFormRef",ref:oe,model:G,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(Ue,{wrap:""},{default:l(()=>[a(se,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(Oe,{modelValue:G.instance_name,"onUpdate:modelValue":p[1]||(p[1]=$=>G.instance_name=$),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(ue,null,ce(G.filterParams,($,Ne)=>(t(),d(se,{key:$.index,prop:"filterParams."+Ne+".value"},{label:l(()=>[C("span",Ft,V($.label),1),a(H,{icon:b(fa),size:"small",circle:"",onClick:hl(N=>T($),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(Ue,null,{default:l(()=>[a(E,{modelValue:$.match,"onUpdate:modelValue":N=>$.match=N,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(ue,null,ce(P.value,N=>(t(),d(Y,{key:N.value,label:N.label,value:N.value},{default:l(()=>[C("span",It,V(N.label),1),C("span",Pt,V(N.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),$.match==="null"||$.match==="!null"?(t(),r("div",Nt)):(t(),r("div",St,[["enum"].indexOf(M.allModelFieldByNameObj[$.name].type)>>>-1?["model_ref"].indexOf(M.allModelFieldByNameObj[$.name].type)>>>-1?["boolean"].indexOf(M.allModelFieldByNameObj[$.name].type)>>>-1?(t(),r("div",Et,[a(Oe,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",qt,[a(Pe,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",jt,[a(E,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ue,null,ce(M.modelRefOptions[$.name],N=>(t(),d(Y,{key:N.value,label:N.label,value:N.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Tt,[a(E,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ue,null,ce(M.enumOptionObj[M.allModelFieldByNameObj[$.name].validation_rule],N=>(t(),d(Y,{key:N.value,label:N.label,value:N.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[C("div",Rt,[a(H,{onClick:p[2]||(p[2]=$=>J(oe.value))},{default:l(()=>p[8]||(p[8]=[v("重置")])),_:1}),a(H,{onClick:p[3]||(p[3]=$=>x()),type:"primary"},{default:l(()=>p[9]||(p[9]=[v("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),zt=Il(Lt,[["__scopeId","data-v-6ac62773"]]),At={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},Yt={class:"table-header"},Bt={class:"header-button-lf"},Jt={class:"header-button-ri"},Kt={class:"flexJstart gap-1",style:{overflow:"auto"}},Ht={class:"text-class"},Wt={key:0,class:"text-class"},Gt={key:1,class:"text-class"},Qt={class:"text-class"},Zt={style:{"margin-left":"12px"}},Xt={key:1,class:"requiredClass"},eo={key:0},lo={key:1},ao={key:0},to={key:1},oo={key:0},no={key:1},so={key:0},uo={key:1},ro={key:0},io={key:0},co={key:0},po={key:1},vo={key:0},fo={key:1},mo={key:0},_o={key:1},yo={key:0},go={key:1},bo={key:0},wo={key:1},ko={key:0},ho={key:1},Co={style:{flex:"auto"},class:"footerButtonClass"},xo={key:0},Vo={key:1},Mo={key:0},Oo={key:1},$o={key:0},Do={key:0},Uo={key:1},Fo={key:2},Io={key:3},Po={key:4},No={key:5},So={key:6},To={key:7},jo={key:8},qo={key:9},Eo={class:"dialog-footer"},Ro={class:"dialog-footer"},Lo=il({__name:"ciDataShow",props:He(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:He(["getTree"],["update:showTree"]),setup(pe,{expose:ve,emit:W}){const{proxy:M}=Ul(),z=ga(),k=_a(),A=Ha(),fe=W,h=pe,S=rl(pe,"showTree"),T=i([0]),ye=i(!1),te=()=>{ye.value=!0},le=i(!0),oe=()=>{le.value=!1,Me(()=>{le.value=!0})},G=i(""),P=()=>{ye.value=!1},X=i(!1),Q=L(()=>z.gmCry),x=L(()=>z.showAllPass),F=L(()=>z.showAllPassTime),J=async()=>{X.value=!0},g=()=>{z.updateShowAllPass(!1),ll({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},p=n=>{z.setShowAllPassTime(n.totalMilliseconds)},K=()=>{X.value=!1,z.updateShowAllPass(!1),z.setShowAllPassTime(0),ll({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},ie=i(!1),Oe=()=>{Y.value=!1,ze(ge.value[0]),H.value=""},ge=i(),se=al({secret:null}),H=i(""),Y=i(!1),E=async(n,e)=>{n[0].validate(async u=>{u&&(se.secret===Q.value.key?(H.value=Yl(Q.value.key,Q.value.mode,e),Y.value=!0):(ll({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),Y.value=!1,H.value=""))})},Pe=i(1),Ue=i(10),Ee=i("default"),Ye=i(!1),$=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},Ne=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},N=L(()=>Vl.value.map(n=>n.name)),tl=L(()=>bl.value.map(n=>n.name)),Be=i(!1),Je=async()=>{(await M.$api.bulkDeleteCiModelInstance({instances:yl.value})).status=="200"?(I({type:"success",message:"删除成功"}),Tl.value.clearSelection(),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({type:"error",message:"删除失败"})},cl=async n=>{n?await M.$api.exportCiData({model:h.ciModelId,fields:tl.value,instances:yl.value}):await M.$api.exportCiData({model:h.ciModelId,fields:N.value,instances:yl.value})},ol=async()=>{let n=await M.$api.exportCiData({model:h.ciModelId});console.log(n)},w={multiple:!0,value:"id"},f=i(!1),j=i([]),We=L(()=>h.treeData[0].children[0].id),Ge=async()=>{var u;let n=[];(u=j.value)==null||u.forEach(q=>{n.push(q[q.length-1])});let e=await M.$api.setCiDataToTree({instances:yl.value,groups:n});e.status=="201"?(I({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),Kl(),fe("getTree")):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}),j.value=[],f.value=!1},Qe=i(""),Ze=i(!1),R=i({}),Re=(n,e)=>{n?D.updateParams[e]="null":D.updateParams[e]=null},pl=()=>{Ze.value=!0,console.log(D)},Pl=n=>{var e;if(n!==void 0&&((e=je.value[n])==null?void 0:e.field_type)==="string")return n==""||n==null?void 0:[{pattern:new RegExp(je.value[n].rule),message:"不符合正则表达式",trigger:"blur"}]};L(()=>{var e,u;let n={};return(u=(e=Te.value)==null?void 0:e.field_groups)==null||u.forEach(q=>{q.fields.forEach(_=>{var re;_.type==="string"&&_.validation_rule!==""&&_.validation_rule!==null&&(n["updateParams."+_.name]=[{pattern:new RegExp((re=je.value[_.validation_rule])==null?void 0:re.rule),message:"不符合正则表达式",trigger:"blur"}])})}),n});const D=al({updateParams:{}}),Se=i([]),vl=()=>{const n=Object.keys(D.updateParams).length,e=`__temp_param_${n}`;Se.value[n]=e,D.updateParams[e]=""},Nl=(n,e)=>{console.log(e),D.updateParams[e]=void 0,delete D.updateParams[Se.value[n]],Se.value[n]=e},de=(n,e)=>{Se.value.splice(n,1),delete R.value[e],delete D.updateParams[e]},$e=L(()=>{let n=new Object;for(let[e,u]of Object.entries(D.updateParams))u==="null"?n[e]=null:n[e]=u,me.value.password.indexOf(e)!==-1&&(n[e]=Al(Q.value.key,Q.value.mode,u));return n}),Cl=()=>{Qe.value.validate(async n=>{if(n){let e=await M.$api.multipleUpdateCiModelInstance({update_user:A.state.username,instances:yl.value,fields:$e.value});e.status=="200"?(I({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),D.updateParams={},R.value={},Se.value=[],Ze.value=!1):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else I({showClose:!0,message:"请输入正确内容.",type:"error"})})},De=L(()=>{var e,u;let n=new Array;return(u=(e=Te.value)==null?void 0:e.field_groups)==null||u.forEach(q=>{q.fields.forEach(_=>{let re=!1;_.name in D.updateParams&&(re=!0),n.push({value:_.name,label:_.verbose_name,disable:re})})}),n}),fl=()=>{Ze.value=!1,D.updateParams={},R.value={},Se.value=[]},ml=i(!0),_l=n=>{ml.value=n},xl=i(!0),ee=i(!1),Sl=i(!1),ba=()=>{Sl.value=!0},wa=async n=>{_l(!0);let e=await M.$api.updateCiModelInstance({update_user:A.state.username,...n});e.status=="200"?(I({type:"success",message:"更新成功"}),we.value=!1,ze(Xe.value),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},ka=()=>!0,Tl=i(null),ha=n=>n.id,Le=i([]),yl=L(()=>{var e;let n=[];return(e=Le.value)==null||e.forEach(u=>{n.push(u.id)}),n}),Ca=n=>{Le.value=n},Kl=()=>{Le.value=[],Tl.value.clearSelection()},Vl=i([]),Te=i({}),xa=L(()=>{var e,u;let n={};return(u=(e=Te.value)==null?void 0:e.field_groups)==null||u.forEach(q=>{q.fields.forEach(_=>{n[_.id]=_})}),n}),_e=L(()=>{var e,u;let n={};return(u=(e=Te.value)==null?void 0:e.field_groups)==null||u.forEach(q=>{q.fields.forEach(_=>{n[_.name]=_})}),n}),Hl=i(""),Va=()=>{Hl.value.getHasConfigField()},Wl=()=>{xl.value=!1,Me(()=>{xl.value=!0})},je=i({});i({});const Ma=async(n=null)=>{(await M.$api.getValidationRules({...n,page:1,page_size:1e4})).data.results.forEach(u=>{je.value[u.id]=u})},jl=L(()=>{var e,u;let n={};return(u=(e=Te.value)==null?void 0:e.field_groups)==null||u.forEach(q=>{q.fields.forEach(_=>{if(_.type==="enum"){if(_.validation_rule===null)return;let re=JSON.parse(je==null?void 0:je.value[_==null?void 0:_.validation_rule].rule),el=[];Object.keys(re).forEach(ul=>{el.push({value:ul,label:re[ul]})}),n[_.validation_rule]=el}})}),n}),Gl=L(()=>{let n={};return Te.value.field_groups.forEach(e=>{e.fields.forEach(u=>{if(u.type==="enum"){let q=JSON.parse(je.value[u.validation_rule].rule),_={};Object.keys(q).forEach(re=>{_[re]=q[re]}),n[u.name]=_}})}),n}),gl=i({}),Oa=async(n,e)=>{let u=await M.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),q=[];u.data.results.forEach(_=>{q.push({value:_.id,label:_.instance_name})}),gl.value[e.name]=[{value:null,label:"无"},...q]},$a=L(()=>{let n=new Object;for(let[e,u]of Object.entries(gl.value)){let q=new Object;u==null||u.forEach(_=>{q[_.value]=_}),n[e]=q}return n}),Da=n=>{if(!(n==""||n==null))return[{pattern:new RegExp(je.value[n].rule),message:"不符合正则表达式",trigger:"blur"}]},Ua=()=>{Te.value.field_groups.forEach(n=>{n.fields.forEach(e=>{y[e.name]=e.default})})},bl=i([]),Fa=async()=>{var u;let n=await M.$api.getCiModel({},h.ciModelId);Te.value=n.data;let e=[];(u=Te.value.field_groups)==null||u.forEach(q=>{q.fields.forEach(_=>{e.push(_)})}),bl.value=e},me=L(()=>{let n={enum:[],boolean:[],model_ref:[],password:[]};return bl.value.forEach(e=>{e.type==="enum"?n.enum.push(e.name):e.type==="boolean"?n.boolean.push(e.name):e.type==="model_ref"?n.model_ref.push(e.name):e.type==="password"&&n.password.push(e.name)}),n});Fl(()=>me.value.model_ref,n=>{me.value.model_ref.forEach(e=>{Oa(!0,{id:_e.value[e].ref_model,name:e})})},{deep:!0});const Ql=i([]),Zl=i(0),ql=i({}),Xl=n=>{ql.value=n},ea=L(()=>{let n=new Array;for(let[e,u]of Object.entries(ql.value))console.log(),e==="instance_name"?n.push({name:"唯一标识:"+u,field:e}):me.value.model_ref.indexOf(e)!==-1?n.push({name:_e.value[e].verbose_name+":"+$a.value[e][u].label,field:e}):me.value.enum.indexOf(e)!==-1?(console.log(Gl.value),n.push({name:_e.value[e].verbose_name+":"+Gl.value[e][u],field:e})):n.push({name:_e.value[e].verbose_name+":"+u,field:e});return n}),Ia=async(n,e)=>{await G.value.removeFilterParam(n,e),Me(()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})})},Ce=async n=>{var q;_l(!0);let e=new Array,u=await M.$api.getCiModelInstance({...n,page:Pe.value,page_size:Ue.value,...ql.value});Zl.value=u.data.count,(q=u.data.results)==null||q.forEach(_=>{e.push({id:_.id,instance_group:_.instance_group,instance_name:_.instance_name,..._.fields})}),Ql.value=e,_l(!1)};ya(async()=>{xl.value=!0,await Ma(),_l(!1)});const we=i(!1),Pa=()=>{ee.value=!0,we.value=!0,nl.value=!0},Ke=i({}),Ml=i({}),la=(n,e=!1)=>{we.value=!0,nl.value=!1,ee.value=e,Ke.value=n,Me(()=>{Object.keys(n).forEach(u=>{u==="id"||u==="instance_group"||(me.value.model_ref.indexOf(u)!==-1&&n[u]!==null?y[u]=n[u].id:y[u]=n[u])}),Ml.value=JSON.parse(JSON.stringify(y))})},Na=n=>{we.value=!0,nl.value=!0,ee.value=!0,Ke.value=n,Me(()=>{Object.keys(n).forEach(e=>{e==="id"||e==="instance_group"||(me.value.model_ref.indexOf(e)!==-1?n[e]!==null?y[e]=n[e].id:y[e]=n[e]:me.value.enum.indexOf(e)!==-1?y[e]=n[e].value:me.value.password.indexOf(e)!==-1||(y[e]=n[e]))})}),ll({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},Xe=i(),y=al({instance_name:null}),aa=L(()=>{let n=Object.assign({},y);delete n.instance_name;for(let[e,u]of Object.entries(n))u!==null&&me.value.password.indexOf(e)!==-1&&(n[e]=Al(Q.value.key,Q.value.mode,u));return n}),ta=L(()=>{let n=Object.assign({},sl.value);delete n.instance_name,console.log(me.value);for(let[e,u]of Object.entries(sl.value))u!==null&&me.value.password.indexOf(e)!==-1&&(n[e]=Al(Q.value.key,Q.value.mode,u));return n}),nl=i(!0),sl=i({}),oa=async(n,e=null)=>{n&&await n.validate(async(u,q)=>{if(u)if(nl.value){console.log(aa.value);let _=await M.$api.addCiModelInstance({model:h.ciModelId,create_user:A.state.username,update_user:A.state.username,fields:aa.value,instance_name:y.instance_name,instance_group:[h.currentNodeId]});_.status=="201"?(I({type:"success",message:"添加成功"}),we.value=!1,ze(n),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),fe("getTree")):I({showClose:!0,message:"添加失败:"+JSON.stringify(_.data),type:"error"})}else{if(console.log(JSON.stringify(Ml.value)),console.log(JSON.stringify(y)),JSON.stringify(Ml.value)===JSON.stringify(y)){ee.value=!1,we.value=!1,ze(n),I({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}else{const el=Object.entries(Ml.value),ul=Object.entries(y),B=el.concat(ul).map(Fe=>JSON.stringify(Fe)),Ol=Array.from(new Set(B)).map(Fe=>JSON.parse(Fe));Ol.splice(0,el.length);const ne=Object.fromEntries(Ol);let $l={};if(Object.keys(ne).forEach(Fe=>{$l[Fe]=ne[Fe]}),sl.value=$l,Object.keys(sl.value).length===0){ee.value=!1,we.value=!1,ze(n),I({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let _={id:Ke.value.id,model:h.ciModelId,update_user:A.state.username};Object.keys(sl.value).indexOf("instance_name")===-1||(_.instance_name=sl.value.instance_name),_.fields=ta.value,console.log(me.value),console.log(_),console.log();let re=await M.$api.updateCiModelInstance(_);re.status=="200"?(I({type:"success",message:"更新成功"}),we.value=!1,ee.value=!1,ze(n),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({showClose:!0,message:"更新失败:"+JSON.stringify(re.data),type:"error"})}else console.log("error submit!",q),ll({title:"表单校验",message:"表单填写异常",type:"error"})})},Sa=n=>{if(ee.value==!1&&nl.value==!1){we.value=!1;return}Jl.confirm("是否确认关闭?").then(()=>{n(),ze(Xe.value),we.value=!1,ee.value=!1}).catch(()=>{})},Ta=n=>{ze(n),we.value=!1,ee.value=!1},na=(n=null)=>{Jl.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await M.$api.deleteCiModelInstance(Ke.value.id)).status==204?(I({type:"success",message:"删除成功"}),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),ze(Xe.value),we.value=!1,ee.value=!1,fe("getTree")):I({type:"error",message:"删除失败"})}).catch(()=>{I({type:"info",message:"取消删除"})})},ze=n=>{n&&(n.resetFields(),Ke.value={})};return ve({getHasConfigField:Va,getCiData:Ce,initCiDataForm:Ua,getModelField:Fa,setLoading:_l,closeFilter:P,clearMultipleSelect:Kl,updateFilterParam:Xl,reloadCiDataFilter:oe}),(n,e)=>{var ia,ca,pa;const u=c("el-button"),q=c("arrow-down"),_=c("el-icon"),re=c("el-dropdown-item"),el=c("el-dropdown-menu"),ul=c("el-dropdown"),B=c("el-tooltip"),Ol=c("vue-countdown"),ne=c("el-text"),$l=c("el-tag"),Fe=c("el-table-column"),Ae=c("el-switch"),ja=c("a-qrcode"),sa=c("el-popover"),qa=c("el-table"),Ea=c("el-pagination"),xe=c("el-space"),qe=c("el-input"),be=c("el-form-item"),Ra=c("InfoFilled"),El=c("el-input-number"),Rl=c("el-col"),ua=c("el-row"),Ll=c("el-form"),Dl=c("el-date-picker"),wl=c("el-option"),kl=c("el-select"),La=c("el-collapse-item"),za=c("el-collapse"),Aa=c("el-drawer"),da=c("el-dialog"),Ya=c("el-cascader"),ke=dl("permission"),Ba=dl("loading"),Ja=dl("copy"),ra=dl("throttle");return t(),r(ue,null,[xl.value?(t(),r("div",At,[C("div",Yt,[C("div",Bt,[S.value?(t(),d(u,{key:0,icon:b(Wa),onClick:e[0]||(e[0]=s=>S.value=!1),size:"default"},null,8,["icon"])):(t(),d(u,{key:1,icon:b(Ga),onClick:e[1]||(e[1]=s=>S.value=!0),size:"default"},null,8,["icon"])),Z((t(),d(u,{type:"primary",onClick:Pa},{default:l(()=>e[30]||(e[30]=[v("添加")])),_:1})),[[ke,`${(ia=b(k).name)==null?void 0:ia.replace("_info","")}:add`]]),Z((t(),d(u,{disabled:!(Le.value.length>>>0),onClick:e[2]||(e[2]=s=>f.value=!0)},{default:l(()=>e[31]||(e[31]=[v("转移")])),_:1},8,["disabled"])),[[ke,`${(ca=b(k).name)==null?void 0:ca.replace("_info","")}:edit`]]),Z((t(),d(u,{disabled:!(Le.value.length>>>0),onClick:pl},{default:l(()=>e[32]||(e[32]=[v("批量更新")])),_:1},8,["disabled"])),[[ke,`${(pa=b(k).name)==null?void 0:pa.replace("_info","")}:edit`]]),a(ul,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(el,null,{default:l(()=>{var s,ae;return[Z((t(),r("div",null,[a(re,{disabled:!(Le.value.length>>>0),onClick:e[3]||(e[3]=o=>Je())},{default:l(()=>e[34]||(e[34]=[v("批量删除")])),_:1},8,["disabled"])])),[[ke,`${(s=b(k).name)==null?void 0:s.replace("_info","")}:delete`]]),Z((t(),r("div",null,[a(re,{disabled:!(Le.value.length>>>0),onClick:e[4]||(e[4]=o=>cl(!1))},{default:l(()=>e[35]||(e[35]=[v("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(re,{disabled:!(Le.value.length>>>0),onClick:e[5]||(e[5]=o=>cl(!0))},{default:l(()=>e[36]||(e[36]=[v("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(re,{onClick:e[6]||(e[6]=o=>ol())},{default:l(()=>e[37]||(e[37]=[v("导出所有")])),_:1})])),[[ke,`${(ae=b(k).name)==null?void 0:ae.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(u,{type:"primary"},{default:l(()=>[e[33]||(e[33]=v(" 更多操作")),a(_,{class:"el-icon--right"},{default:l(()=>[a(q)]),_:1})]),_:1})]),_:1})]),C("div",Jt,[a(B,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(u,{icon:b(Qa),circle:"",onClick:Wl},null,8,["icon"])]),_:1}),x.value?O("",!0):(t(),d(B,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var s;return[Z(a(u,{icon:b(zl),circle:"",onClick:J},null,8,["icon"]),[[ke,`${(s=b(k).name)==null?void 0:s.replace("_info","")}:showPassword`]])]}),_:1})),x.value?(t(),d(B,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[38]||(e[38]=[C("span",null,[v("倒计时结束后自动隐藏密码"),C("br"),v("手动点击可立马隐藏")],-1)])),default:l(()=>[a(u,{circle:"",onClick:K},{default:l(()=>[a(Ol,{time:F.value,onEnd:g,onProgress:p},{default:l(({totalSeconds:s})=>[v(V(s),1)]),_:1},8,["time"])]),_:1})]),_:1})):O("",!0),a(B,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(u,{icon:b(Za),circle:"",onClick:ba},null,8,["icon"])]),_:1}),a(B,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var s;return[Z(a(u,{icon:b(Xa),circle:"",onClick:e[7]||(e[7]=ae=>Be.value=!0)},null,8,["icon"]),[[ke,`${(s=b(k).name)==null?void 0:s.replace("_info","")}:import`]])]}),_:1}),a(B,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(u,{icon:b(et),circle:"",onClick:te},null,8,["icon"])]),_:1})])]),Z(C("div",Kt,[a(ne,{tag:"b"},{default:l(()=>e[39]||(e[39]=[v("过滤器")])),_:1}),(t(!0),r(ue,null,ce(ea.value,(s,ae)=>(t(),d($l,{key:s.name,closable:"",type:"primary",onClose:o=>Ia(s.field,ae)},{default:l(()=>[C("span",null,V(s.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Bl,ea.value.length>>>0]]),Z((t(),d(qa,{ref_key:"ciDataTableRef",ref:Tl,data:Ql.value,onSelectionChange:Ca,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":ha},{default:l(()=>[a(Fe,{type:"selection",selectable:ka,width:"55","reserve-selection":!0}),a(Fe,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(ue,null,ce(Vl.value,(s,ae)=>(t(),d(Fe,{property:s.name,label:s.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120"},lt({_:2},[me.value.boolean.indexOf(s.name)!=-1?{name:"default",fn:l(o=>{var m;return[Z(a(Ae,{modelValue:o.row[s.name],"onUpdate:modelValue":U=>o.row[s.name]=U,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:U=>wa({id:o.row.id,fields:{[s.name]:o.row[s.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[ke,{id:`${(m=b(k).name)==null?void 0:m.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,me.value.enum.indexOf(s.name)!=-1?{name:"default",fn:l(o=>{var m;return[C("div",Ht,V((m=o.row[s.name])==null?void 0:m.label),1)]}),key:"1"}:void 0,me.value.password.indexOf(s.name)!=-1?{name:"default",fn:l(o=>[x.value?(t(),r("div",Wt,V(b(Yl)(Q.value.key,Q.value.mode,o.row[s.name])),1)):(t(),r("div",Gt,"******"))]),key:"2"}:void 0,me.value.model_ref.indexOf(s.name)!=-1?{name:"default",fn:l(o=>{var m;return[C("div",Qt,V((m=o.row[s.name])==null?void 0:m.instance_name),1)]}),key:"3"}:void 0]),1032,["property","label"]))),256)),a(Fe,{fixed:"right",width:"150",label:"操作"},{default:l(s=>[a(B,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(u,{link:"",type:"primary",icon:b(zl),onClick:ae=>la(s.row)},null,8,["icon","onClick"])]),_:2},1024),a(B,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var ae;return[Z(a(u,{link:"",type:"primary",icon:b(at),onClick:o=>la(s.row,!0)},null,8,["icon","onClick"]),[[ke,`${(ae=b(k).name)==null?void 0:ae.replace("_info","")}:edit`]])]}),_:2},1024),a(B,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var ae;return[Z(a(u,{link:"",type:"primary",icon:b(va),onClick:o=>Na(s.row)},null,8,["icon","onClick"]),[[ke,`${(ae=b(k).name)==null?void 0:ae.replace("_info","")}:edit`]])]}),_:2},1024),a(B,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>[C("span",Zt,[a(sa,{placement:"bottom",title:"实例二维码",width:250,trigger:"click"},{reference:l(()=>[a(u,{link:"",type:"primary",icon:b(tt)},null,8,["icon"])]),default:l(()=>[a(ja,{value:JSON.stringify(s.row),size:200},null,8,["value"])]),_:2},1024)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ba,ml.value]]),a(Ea,{"current-page":Pe.value,"onUpdate:currentPage":e[8]||(e[8]=s=>Pe.value=s),"page-size":Ue.value,"onUpdate:pageSize":e[9]||(e[9]=s=>Ue.value=s),"page-sizes":[10,20,50,100,200],size:Ee.value,disabled:Ye.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:Zl.value,onSizeChange:$,onCurrentChange:Ne,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[a(ne,null,{default:l(()=>[v("已选择 "+V(Le.value.length)+" 条",1)]),_:1})]),_:1},8,["current-page","page-size","size","disabled","total"])])):O("",!0),a(Aa,{modelValue:we.value,"onUpdate:modelValue":e[19]||(e[19]=s=>we.value=s),class:"edit-drawer",direction:"rtl",size:"40%","before-close":Sa},{header:l(()=>[a(ne,{tag:"b"},{default:l(()=>e[40]||(e[40]=[v("实例信息")])),_:1})]),default:l(()=>[a(Ll,{ref_key:"ciDataFormRef",ref:Xe,style:{"max-width":"100%"},model:y,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[a(be,{prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>e[41]||(e[41]=[v("唯一标识")])),_:1}),a(B,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:1})]),_:1})]),default:l(()=>[ee.value?(t(),d(qe,{key:0,modelValue:y.instance_name,"onUpdate:modelValue":e[10]||(e[10]=s=>y.instance_name=s),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",Xt,V(y.instance_name),1))]),_:1}),a(za,{modelValue:T.value,"onUpdate:modelValue":e[14]||(e[14]=s=>T.value=s)},{default:l(()=>[(t(!0),r(ue,null,ce(Te.value.field_groups,(s,ae)=>(t(),d(La,{name:ae,key:ae},{title:l(()=>[a(ne,{tag:"b",size:"large"},{default:l(()=>[v(V(s.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(ua,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(ue,null,ce(s.fields,(o,m)=>(t(),d(Rl,{span:12},{default:l(()=>[o.type==="string"?(t(),d(be,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:Da(o.validation_rule)},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(qe,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",eo,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text-class",{requiredClass:o.required}])},V(y[o.name]),3)):(t(),r("span",lo,"--"))]))]),_:2},1032,["label","prop","required","rules"])):O("",!0),o.type==="json"?(t(),d(be,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),a(B,{placement:"right",effect:"dark"},{content:l(()=>e[42]||(e[42]=[v(" json类型字段"),C("br",null,null,-1),v("请输入json格式数据! ")])),default:l(()=>[a(_,null,{default:l(()=>[a(Ra)]),_:1})]),_:1}),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(qe,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ao,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text-class",{requiredClass:o.required}])},V(y[o.name]),3)):(t(),r("span",to,"--"))]))]),_:2},1032,["label","prop","required"])):O("",!0),["text"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(qe,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",oo,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text-class",{requiredClass:o.required}])},V(y[o.name]),3)):(t(),r("span",no,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),d(be,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[a(Ae,{modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!ee.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):O("",!0),["float"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(ne,{key:0,tag:"b"},{default:l(()=>[v(V(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(ne,{key:1,tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(B,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(El,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",so,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text-class",{requiredClass:o.required}])},V(y[o.name]),3)):(t(),r("span",uo,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>{var U;return[ee.value?(t(),d(qe,{key:1,modelValue:y[o.name],"onUpdate:modelValue":he=>y[o.name]=he,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ro,[y[o.name]!=null?(t(),r("div",io,[x.value?(t(),r("span",co,V(b(Yl)(Q.value.key,Q.value.mode,y[o.name])),1)):(t(),r("span",{key:1,class:Ie({requiredClass:o.required}),onMouseenter:e[12]||(e[12]=he=>ie.value=!0),onMouseleave:e[13]||(e[13]=he=>ie.value=!1)},[e[44]||(e[44]=v("******** ")),Z((t(),d(sa,{width:380,trigger:"click",onAfterLeave:Oe},{reference:l(()=>[a(_,null,{default:l(()=>[Z(a(b(zl),null,null,512),[[Bl,ie.value&&!x.value]])]),_:1})]),default:l(()=>[a(Ll,{ref_for:!0,ref_key:"passFormRef",ref:ge,inline:!0,model:se,"require-asterisk-position":"right"},{default:l(()=>[a(ua,{align:"middle"},{default:l(()=>[a(Rl,{span:20},{default:l(()=>[a(be,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(qe,{type:"password",modelValue:se.secret,"onUpdate:modelValue":e[11]||(e[11]=he=>se.secret=he),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(Rl,{span:2},{default:l(()=>[a(be,null,{default:l(()=>[a(u,{type:"primary",size:"small",onClick:he=>E(ge.value,y[o.name])},{default:l(()=>e[43]||(e[43]=[v("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),Y.value?(t(),d(ne,{key:0,tag:"b"},{default:l(()=>[v("密码: "+V(H.value)+" ",1),a(B,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(_,null,{default:l(()=>[Z(a(b(va),null,null,512),[[Ja,H.value]])]),_:1})]),_:1})]),_:1})):O("",!0)]),_:2},1024)),[[ke,`${(U=b(k).name)==null?void 0:U.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",po,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(ne,{key:0,tag:"b"},{default:l(()=>[v(V(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(ne,{key:1,tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(B,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(El,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",vo,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text-class",{requiredClass:o.required}])},V(y[o.name]),3)):(t(),r("span",fo,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(Dl,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",mo,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},V(y[o.name]),3)):(t(),r("span",_o,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(Dl,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",yo,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},V(y[o.name]),3)):(t(),r("span",go,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>{var U;return[ee.value?(t(),d(kl,{key:1,modelValue:y[o.name],"onUpdate:modelValue":he=>y[o.name]=he,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(ue,null,ce(jl.value[o.validation_rule],he=>(t(),d(wl,{key:he.value,label:he.label,value:he.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",bo,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},V((U=Ke.value[o.name])==null?void 0:U.label),3)):(t(),r("span",wo,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?O("",!0):(t(),d(be,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ne,{tag:"b"},{default:l(()=>[v(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(B,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(_,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):O("",!0)]),_:2},1024)]),default:l(()=>[ee.value?(t(),d(kl,{key:1,modelValue:y[o.name],"onUpdate:modelValue":U=>y[o.name]=U,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(ue,null,ce(gl.value[o.name],(U,he)=>(t(),d(wl,{key:he,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",ko,[y[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text-class",{requiredClass:o.required}])},V(Ke.value[o.name].name),3)):(t(),r("span",ho,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),footer:l(()=>{var s,ae,o,m;return[C("div",Co,[a(u,{onClick:e[15]||(e[15]=U=>Ta(Xe.value))},{default:l(()=>e[45]||(e[45]=[v("取消")])),_:1}),nl.value?(t(),r("div",xo,[a(u,{type:"primary",onClick:e[16]||(e[16]=U=>oa(Xe.value))},{default:l(()=>e[46]||(e[46]=[v("添加")])),_:1})])):(t(),r("div",Vo,[ee.value?(t(),r("div",Mo,[((s=Ke.value.instance_group)==null?void 0:s.indexOf(We.value))!==-1?Z((t(),d(u,{key:0,type:"danger",onClick:na},{default:l(()=>e[47]||(e[47]=[v("删除")])),_:1})),[[ke,`${(ae=b(k).name)==null?void 0:ae.replace("_info","")}:delete`]]):Z((t(),d(B,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(u,{type:"danger",onClick:na,disabled:""},{default:l(()=>e[48]||(e[48]=[v("删除")])),_:1})]),_:1})),[[ke,`${(o=b(k).name)==null?void 0:o.replace("_info","")}:delete`]]),Z((t(),d(u,{type:"primary",onClick:e[17]||(e[17]=U=>oa(Xe.value))},{default:l(()=>e[49]||(e[49]=[v("保存")])),_:1})),[[ra]])])):(t(),r("div",Oo,[Z((t(),d(u,{type:"primary",onClick:e[18]||(e[18]=U=>ee.value=!0)},{default:l(()=>e[50]||(e[50]=[v("编辑")])),_:1})),[[ke,`${(m=b(k).name)==null?void 0:m.replace("_info","")}:edit`]])]))]))])]}),_:1},8,["modelValue"]),a(da,{modelValue:Ze.value,"onUpdate:modelValue":e[21]||(e[21]=s=>Ze.value=s),title:"批量更新",width:"500","before-close":fl},{footer:l(()=>[C("div",Eo,[a(u,{onClick:fl},{default:l(()=>e[51]||(e[51]=[v("取消")])),_:1}),a(u,{onClick:e[20]||(e[20]=hl(s=>vl(),["prevent"]))},{default:l(()=>e[52]||(e[52]=[v("新增字段")])),_:1}),Z((t(),d(u,{type:"primary",onClick:Cl,disabled:!(Se.value.length>0)},{default:l(()=>e[53]||(e[53]=[v("保存")])),_:1},8,["disabled"])),[[ra]])])]),default:l(()=>[a(Ll,{ref_key:"multipleFormRef",ref:Qe,style:{"max-width":"1000px"},model:D,"label-width":"auto"},{default:l(()=>[(t(!0),r(ue,null,ce(Se.value,(s,ae)=>{var o;return t(),d(be,{key:`param-${s}`,label:"字段"+(ae+1),prop:`updateParams.${s}`,rules:Pl((o=_e.value[s])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(xe,null,{default:l(()=>[a(kl,{"model-value":s.startsWith("__temp")?void 0:s,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:m=>Nl(ae,m)},{default:l(()=>[(t(!0),r(ue,null,ce(De.value,m=>(t(),d(wl,{key:m.value,label:m.label,value:m.value,disabled:m.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),s&&!s.startsWith("__temp")?(t(),r("div",$o,[["text","json"].indexOf(_e.value[s].type)>>>-1?["string"].indexOf(_e.value[s].type)>>>-1?["enum"].indexOf(_e.value[s].type)>>>-1?["model_ref"].indexOf(_e.value[s].type)>>>-1?["boolean"].indexOf(_e.value[s].type)>>>-1?["integer"].indexOf(_e.value[s].type)>>>-1?["float"].indexOf(_e.value[s].type)>>>-1?["date"].indexOf(_e.value[s].type)>>>-1?["datetime"].indexOf(_e.value[s].type)>>>-1?(t(),r("div",qo,[a(qe,{modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",jo,[a(Ae,{modelValue:R.value[s],"onUpdate:modelValue":m=>R.value[s]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Re(R.value[s],s)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[s]?O("",!0):(t(),d(Dl,{key:0,modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",To,[a(Ae,{modelValue:R.value[s],"onUpdate:modelValue":m=>R.value[s]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Re(R.value[s],s)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[s]?O("",!0):(t(),d(Dl,{key:0,modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",So,[a(Ae,{modelValue:R.value[s],"onUpdate:modelValue":m=>R.value[s]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Re(R.value[s],s)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[s]?O("",!0):(t(),d(El,{key:0,modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",No,[a(Ae,{modelValue:R.value[s],"onUpdate:modelValue":m=>R.value[s]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Re(R.value[s],s)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[s]?O("",!0):(t(),d(qe,{key:0,modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Po,[a(Ae,{modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Io,[a(kl,{modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(ue,null,ce(gl.value[s],(m,U)=>(t(),d(wl,{key:U,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Fo,[a(kl,{modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ue,null,ce(jl.value[_e.value[s].validation_rule],m=>(t(),d(wl,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Uo,[a(Ae,{modelValue:R.value[s],"onUpdate:modelValue":m=>R.value[s]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Re(R.value[s],s)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[s]?O("",!0):(t(),d(qe,{key:0,modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Do,[a(Ae,{modelValue:R.value[s],"onUpdate:modelValue":m=>R.value[s]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Re(R.value[s],s)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[s]?O("",!0):(t(),d(qe,{key:0,modelValue:D.updateParams[s],"onUpdate:modelValue":m=>D.updateParams[s]=m,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):O("",!0),a(u,{class:"mt-2",icon:b(ot),circle:"",onClick:hl(m=>de(ae,s),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(da,{modelValue:f.value,"onUpdate:modelValue":e[24]||(e[24]=s=>f.value=s),title:"实例组编辑",width:"500"},{footer:l(()=>[C("div",Ro,[a(u,{onClick:e[23]||(e[23]=s=>f.value=!1)},{default:l(()=>e[54]||(e[54]=[v("取消")])),_:1}),a(u,{type:"primary",onClick:Ge},{default:l(()=>e[55]||(e[55]=[v(" 提交更新 ")])),_:1})])]),default:l(()=>[a(Ya,{options:h.treeData,props:w,clearable:"",modelValue:j.value,"onUpdate:modelValue":e[22]||(e[22]=s=>j.value=s),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),le.value?(t(),d(ft,{key:1,isShowUpload:Be.value,"onUpdate:isShowUpload":e[25]||(e[25]=s=>Be.value=s),ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,onGetCiData:Ce},null,8,["isShowUpload","ciModelId","currentNodeId"])):O("",!0),le.value?(t(),d(zt,{key:2,ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,allModelFieldByNameObj:_e.value,enumOptionObj:jl.value,validationRulesObj:je.value,allModelField:bl.value,modelRefOptions:gl.value,showFilter:ye.value,"onUpdate:showFilter":e[26]||(e[26]=s=>ye.value=s),onUpdateFilterParam:Xl,onGetCiData:Ce,ref_key:"ciDataFilterRef",ref:G},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):O("",!0),a(Ct,{ciModelId:h.ciModelId,allModelField:bl.value,allModelFieldInfo:xa.value,isShowTableCol:Sl.value,"onUpdate:isShowTableCol":e[27]||(e[27]=s=>Sl.value=s),hasConfigField:Vl.value,"onUpdate:hasConfigField":e[28]||(e[28]=s=>Vl.value=s),onReloadTable:Wl,ref_key:"ciDataTableColRef",ref:Hl},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(Vt,{showAllPassDia:X.value,"onUpdate:showAllPassDia":e[29]||(e[29]=s=>X.value=s)},null,8,["showAllPassDia"])],64)}}}),zo=Il(Lo,[["__scopeId","data-v-ac4f220c"]]),Ao=nt("ci",()=>{const pe=i([]),ve=al({filterParams:[]});i([]);const W=i([]);return i({}),{setFilterList:A=>{console.log(A),W.value=A,console.log(W.value)},saveFilterParams:A=>{console.log(A),ve.filterParams=A},setModelList:A=>{pe.value=A}}},{persist:!0}),Yo={class:"card ci_data_tree"},Bo={class:"custom-tree-node"},Jo={class:"table-box"},Ko=il({__name:"cidataView",setup(pe){const ve=_a(),{proxy:W}=Ul(),M=i(!0),z=Ao(),k=i(""),A=i(!1);i(""),i(!1);const fe=i(),h=i([]),S=i("");Fl(S,w=>{x.value.filter(w)});const T=(w,f)=>w?f.label.toLowerCase().includes(w.toLowerCase()):!0,ye=w=>!(w.level>Je.value-1||w.label==="空闲池"),te=async()=>{A.value=!0;let w=await W.$api.getCiModelTree({model:oe.value});console.log(w),h.value=[w.data],Me(()=>{J.value===1&&(x.value.setCurrentKey(w.data.id),J.value=x.value.getCurrentKey())}),A.value=!1},le=i([]),oe=i(""),G=async()=>{let w=await W.$api.getCiModel();le.value=w.data.results,z.setModelList(le.value),k.value=le.value.find(f=>f.name==="hosts"),oe.value=le.value.find(f=>f.name==="hosts").id};L(()=>{let w={};return le.value.forEach(f=>{w[f.id]=f}),w});const P=i(""),X=async()=>{J.value=1,await te(),await P.value.closeFilter(),await P.value.updateFilterParam({}),await P.value.clearMultipleSelect(),P.value.reloadCiDataFilter(),await P.value.setLoading(!0),await P.value.getModelField(),await P.value.getHasConfigField(),await P.value.setLoading(!1),await P.value.initCiDataForm(),await P.value.getCiData({model:oe.value,model_instance_group:J.value})};ya(async()=>{console.log(123),await G(),await te(),P.value.setLoading(!0),await P.value.getModelField(),await P.value.getHasConfigField(),await P.value.setLoading(!1),await P.value.initCiDataForm(),await P.value.getCiData({model:oe.value,model_instance_group:x.value.getCurrentKey()})});const Q=w=>w.built_in?!1:w.children?!(w.children.length>>>0):!0,x=i(),F=i(),J=i(1),g=i(!1),p=i(100),K=(w,f)=>{Y.value=!1;let j=p.value++;x.value.append({id:j,label:"新建子目录",level:f.level+1,parent:f.id,model:k.value.id},w),x.value.setCurrentKey(j),se.value=j,Me(()=>{F.value.focus()})},ie=(w,f)=>{let j=p.value++;Y.value=!1,x.value.insertAfter({id:j,label:"新建目录",level:f.level,parent:w.parent.data.id,model:k.value.id},w),x.value.setCurrentKey(j),se.value=j,Me(()=>{F.value.focus()})},Oe=()=>{J.value=x.value.getCurrentKey(),P.value.clearMultipleSelect(),P.value.setLoading(!0),P.value.getCiData({model:oe.value,model_instance_group:x.value.getCurrentKey()}),P.value.setLoading(!0)},ge=w=>{g.value=!g.value,w.isShowEdit=g.value},se=i(99999),H=i(""),Y=i(!0),E=w=>{Y.value=!0,console.log(w),H.value=w.label,se.value=w.id,Me(()=>{F.value.focus()})},Pe=async(w,f)=>{if(se.value=99999,!H.value)I.warning("名称不可为空"),x.value.remove(f);else if(Y.value){if(H.value==f.label)return!1;{let j=await W.$api.updateCiModelTree({id:f.id,label:H.value});j.status=="200"?(I({type:"success",message:"更新成功"}),f.label=H.value,te(),H.value=""):I({showClose:!0,message:"更新失败:"+JSON.stringify(j.data),type:"error"}),console.log(f)}}else{f.label=H.value,console.log(f);let j=await W.$api.addCiModelTree(f);j.status=="201"?(I({type:"success",message:"添加成功"}),te(),H.value=""):(I({showClose:!0,message:"添加失败:"+JSON.stringify(j.data),type:"error"}),x.value.remove(f))}},Ue=w=>{w&&Jl.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await W.$api.deleteCiModelTree(w.data.id)).status==200?(I({type:"success",message:"删除成功"}),await te()):I({type:"error",message:"删除失败"})}).catch(()=>{})},Ee=i(""),Ye=(w,f)=>{Ee.value=w,console.log(Ee.value)},$=(w,f,j)=>{},Ne=(w,f,j)=>{},N=(w,f,j)=>{},tl=async(w,f,j,We)=>{if(f.data.id===w.data.id)return;let Ge={};j==="inner"?Ge={id:w.data.id,parent:f.data.id}:Ge={id:w.data.id,parent:f.parent.data.id};let Qe=await W.$api.updateCiModelTree(Ge);Qe.status=="200"?(I({type:"success",message:"更新成功"}),te()):I({showClose:!0,message:"更新失败:"+JSON.stringify(Qe.data),type:"error"})},Be=(w,f,j,We)=>{},Je=i(5),cl=(w,f,j)=>f.data.built_in?!1:Je.value-w.data.level+f.data.level>=Je.value?j!=="inner":!0,ol=w=>!w.data.built_in;return(w,f)=>{const j=c("el-text"),We=c("el-col"),Ge=c("el-option"),Qe=c("el-select"),Ze=c("el-row"),R=c("el-divider"),Re=c("el-input"),pl=c("a-menu-item"),Pl=c("a-menu"),D=c("a-dropdown"),Se=c("el-space"),vl=dl("permission"),Nl=dl("loading");return t(),r(ue,null,[Z(C("div",Yo,[a(Ze,{align:"middle",justify:"start"},{default:l(()=>[a(We,{span:8},{default:l(()=>[a(j,{tag:"b"},{default:l(()=>f[7]||(f[7]=[v("实例树")])),_:1})]),_:1}),a(We,{span:14},{default:l(()=>[a(Qe,{modelValue:oe.value,"onUpdate:modelValue":f[0]||(f[0]=de=>oe.value=de),placeholder:"Select",onChange:f[1]||(f[1]=de=>X())},{default:l(()=>[(t(!0),r(ue,null,ce(le.value,de=>(t(),d(Ge,{key:de.id,label:de.verbose_name,value:de.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(R),a(Re,{modelValue:S.value,"onUpdate:modelValue":f[2]||(f[2]=de=>S.value=de),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),Z((t(),d(b(rt),{style:{"max-width":"280px",height:"auto"},"allow-drop":cl,"allow-drag":ol,data:h.value,draggable:!1,"default-expand-all":"","node-key":"id",onNodeDragStart:Ye,onNodeDragEnter:$,onNodeDragLeave:Ne,onNodeDragOver:N,onNodeDragEnd:tl,onNodeDrop:Be,"highlight-current":!0,"current-node-key":J.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:x,onNodeClick:Oe,"filter-node-method":T},{default:l(({node:de,data:$e})=>{var Cl;return[C("div",Bo,[se.value===$e.id?(t(),d(Re,{key:0,modelValue:H.value,"onUpdate:modelValue":f[3]||(f[3]=De=>H.value=De),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:F,onBlur:De=>Pe(De,$e),onKeyup:f[4]||(f[4]=st(De=>De.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),d(j,{key:1,size:"default"},{default:l(()=>[v(V(de.label),1),a(j,{size:"small"},{default:l(()=>[v("("+V($e.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),Z((t(),r("div",{class:Ie(["actionClass",{is_show_action:de.isShowEdit}])},[a(Se,null,{default:l(()=>[$e.built_in?O("",!0):(t(),d(b(ut),{key:0,onClick:hl(De=>E($e),["stop"])},null,8,["onClick"])),a(D,{trigger:["click"],ref_key:"aDropdownRef",ref:fe,onOpenChange:De=>ge(de)},{overlay:l(()=>[a(Pl,null,{default:l(()=>{var De,fl;return[Z((t(),r("div",null,[$e.level!==1?(t(),d(pl,{key:"0",onClick:ml=>ie(de,$e)},{default:l(()=>f[8]||(f[8]=[v(" 添加同级节点 ")])),_:2},1032,["onClick"])):O("",!0),ye($e)?(t(),d(pl,{key:"1",onClick:ml=>K(de,$e)},{default:l(()=>f[9]||(f[9]=[v(" 添加子节点 ")])),_:2},1032,["onClick"])):O("",!0)])),[[vl,`${(De=b(ve).name)==null?void 0:De.replace("_info","")}:add`]]),Z((t(),r("div",null,[Q($e)?(t(),d(pl,{key:"2",onClick:ml=>Ue(de)},{default:l(()=>f[10]||(f[10]=[v(" 删除节点 ")])),_:2},1032,["onClick"])):O("",!0)])),[[vl,`${(fl=b(ve).name)==null?void 0:fl.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(b(dt),{onClick:f[5]||(f[5]=hl(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[vl,`${(Cl=b(ve).name)==null?void 0:Cl.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[Nl,A.value]])],512),[[Bl,M.value]]),C("div",Jo,[a(zo,{ciModelId:oe.value,treeData:h.value,currentNodeId:J.value,ref_key:"ciDataShowRef",ref:P,onGetTree:te,showTree:M.value,"onUpdate:showTree":f[6]||(f[6]=de=>M.value=de)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),Zo=Il(Ko,[["__scopeId","data-v-e713289c"]]);export{Zo as default};
