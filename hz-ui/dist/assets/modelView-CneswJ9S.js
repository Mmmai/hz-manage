import{d as Me,j as Ge,x as ze,g as Se,r as m,v as oe,a as D,z as Ne,h as a,bc as Ue,c as x,o as r,b as v,f as l,w as t,bV as M,B as _,q as f,m as G,F as O,i as J,t as z,C as qe,b_ as p,c4 as P,cp as Be,_ as he}from"./index-BSX4TNZE.js";import{i as Ie}from"./iconSelectCom-KzLoVSPK.js";import{m as Re}from"./model-Ds6Q2RXn.js";const De={class:"card"},Oe={class:"groupCountClass"},Le={class:"number"},Te={class:"operation_show groupCountClass"},Ae={style:{display:"flex","flex-direction":"column",gap:"10px","align-items":"center"}},Ee={class:"dialog-footer"},Je={class:"dialog-footer"},Pe=Me({name:"model",__name:"modelView",setup(je){const le=Ge(),b=ze(),te=Re(),{proxy:C}=Se(),S=m(!1),L=m(!1),T=oe(()=>{let o={};return A.value.forEach(e=>{o[e.model_group]?o[e.model_group]+=1:o[e.model_group]=1}),N.value.forEach(e=>{o.hasOwnProperty(e.id)||(o[e.id]=0)}),o}),se=oe(()=>{let o={};return A.value.forEach(e=>{o[e.model_group]?o[e.model_group].push(e):o[e.model_group]=[e]}),o}),y=m(!1),ae=()=>{y.value=!1,q.value.resetFields()},N=m([]),U=async()=>{let o=await C.$api.getCiModelGroup();N.value=o.data.results},A=m([]),j=async()=>{let o=await C.$api.getCiModel();A.value=o.data.results,te.updateAllModels(o.data.results)},u=D({name:"",verbose_name:"",model_group:"",icon:"clarity:block-line",built_in:!1,create_user:"admin",update_user:"admin"}),q=m(),ne=D({name:[{required:!0,message:"请输入模型标识",trigger:"blur"},{pattern:/^[a-z][a-z_]{3,20}$/,trigger:"blur",message:"以英文字符开头,只能使用英文和下划线,长度3-20 ",required:!0}],verbose_name:[{required:!0,message:"请输入模型名称",trigger:"blur"}],model_group:[{required:!0,message:"请选择分组",trigger:"blur"}]}),re=async o=>{o&&await o.validate(async(e,d)=>{if(e)if(L.value){let i=await C.$api.addCiModel(u);i.status=="201"?(p({type:"success",message:"添加成功"}),y.value=!1,h(o),j()):p({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else console.log("不在这里更新");else console.log("error submit!",d)})},ue=o=>{P.confirm("是否确认关闭?").then(()=>{o(),h(q.value)}).catch(()=>{})},c=D({name:"",verbose_name:"",built_in:!1,create_user:"admin",update_user:"admin"}),de=D({name:[{required:!0,message:"请输入唯一标识",trigger:"blur"},{pattern:/^[a-z][\w\d]{4,20}$/,trigger:"blur",message:"以英文字符开头,可以使用英文,数字,下划线,长度4-20 ",required:!0}],verbose_name:[{required:!0,message:"请输入组名称",trigger:"blur"}]}),B=m(),g=m(!1),ie=()=>{g.value=!1,B.value.resetFields()},H=m(""),me=async o=>{o&&await o.validate(async(e,d)=>{if(e)if(S.value){let i=await C.$api.addCiModelGroup(c);i.status=="201"?(p({type:"success",message:"添加成功"}),g.value=!1,h(o),U()):p({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else{let i=await C.$api.updateCiModelGroup({id:H.value,...c});i.status=="200"?(p({type:"success",message:"更新成功"}),g.value=!1,h(o),U()):p({showClose:!0,message:"更新失败:"+JSON.stringify(i.data),type:"error"})}else console.log("error submit!",d)})},pe=o=>{P.confirm("是否确认关闭?").then(()=>{o(),B.value.resetFields()}).catch(()=>{})},h=o=>{o&&o.resetFields()},ce=o=>{u.model_group=o,y.value=!0,L.value=!0},_e=o=>{g.value=!0,S.value=!1,c.name=o.name,c.verbose_name=o.verbose_name,H.value=o.id},fe=o=>{P.confirm("是否确认删除?","删除组",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{if(console.log(o),console.log(T.value[o]),T.value[o]>>>0){p({type:"error",message:"请先删除模型组内的模型后再删除组！"});return}let e=await C.$api.deleteCiModelGroup(o);e.status==204||e.status==200?p({type:"success",message:"删除成功"}):p({type:"error",message:"删除失败"}),U()}).catch(()=>{p({type:"info",message:"取消删除"})})},E=m(!1),ve=()=>{E.value=!0},ge=o=>{const e=Be.service({lock:!0,text:"正在跳转...",background:"rgba(0, 0, 0, 0.7)"});le.push({path:b.path+"/"+o.id}).finally(()=>{e.close()})};return Ne(()=>{U(),j()}),(o,e)=>{const d=a("el-button"),i=a("el-col"),K=a("el-row"),be=a("CirclePlusFilled"),w=a("el-icon"),Q=a("el-tooltip"),Ce=a("Edit"),ye=a("DeleteFilled"),I=a("el-space"),we=a("InfoFilled"),W=qe,ke=a("el-tag"),X=a("el-text"),Ve=a("el-card"),$e=a("el-scrollbar"),k=a("el-form-item"),R=a("el-input"),Fe=a("el-option"),xe=a("el-select"),Y=a("el-form"),Z=a("el-dialog"),$=Ue("permission");return r(),x(O,null,[v("div",De,[l($e,null,{default:t(()=>[l(K,{gutter:10},{default:t(()=>[l(i,{span:6},{default:t(()=>{var s,V;return[M((r(),_(d,{type:"primary",onClick:e[0]||(e[0]=n=>{y.value=!0,L.value=!0})},{default:t(()=>[...e[15]||(e[15]=[f("新增模型",-1)])]),_:1})),[[$,`${(s=G(b).name)==null?void 0:s.replace("_info","")}:add`]]),M((r(),_(d,{type:"default",onClick:e[1]||(e[1]=n=>{g.value=!0,S.value=!0})},{default:t(()=>[...e[16]||(e[16]=[f("新增分组",-1)])]),_:1})),[[$,`${(V=G(b).name)==null?void 0:V.replace("_info","")}:add`]])]}),_:1})]),_:1}),(r(!0),x(O,null,J(N.value,(s,V)=>(r(),x("div",{key:V,class:"groupClass"},[l(K,null,{default:t(()=>[v("h2",null,z(s.verbose_name),1),v("div",Oe,[v("span",Le,z(T.value[s.id]),1),v("div",Te,[l(Q,{effect:"dark",content:"添加模型",placement:"right"},{default:t(()=>{var n;return[M((r(),_(w,{size:20,onClick:F=>ce(s.id)},{default:t(()=>[l(be)]),_:1},8,["onClick"])),[[$,`${(n=G(b).name)==null?void 0:n.replace("_info","")}:add`]])]}),_:2},1024),s.built_in?(r(),_(Q,{key:1,effect:"dark",content:"内置分组无法修改",placement:"right"},{default:t(()=>[l(w,{size:20},{default:t(()=>[l(we)]),_:1})]),_:1})):(r(),_(I,{key:0},{default:t(()=>{var n,F;return[M((r(),_(w,{size:20,onClick:ee=>_e(s)},{default:t(()=>[l(Ce)]),_:1},8,["onClick"])),[[$,`${(n=G(b).name)==null?void 0:n.replace("_info","")}:edit`]]),M((r(),_(w,{size:20,onClick:ee=>fe(s.id)},{default:t(()=>[l(ye)]),_:1},8,["onClick"])),[[$,`${(F=G(b).name)==null?void 0:F.replace("_info","")}:delete`]])]}),_:2},1024))])])]),_:2},1024),l(I,{wrap:"",size:30,alignment:"flex-start"},{default:t(()=>[(r(!0),x(O,null,J(se.value[s.id],(n,F)=>(r(),_(Ve,{shadow:"hover",key:F,class:"modelCard",onClick:ee=>ge(n)},{default:t(()=>[l(I,{size:"large"},{default:t(()=>[v("div",Ae,[l(w,{size:30},{default:t(()=>[l(W,{icon:n.icon},null,8,["icon"])]),_:2},1024),l(ke,{round:"",size:"small",type:n.instance_count>>>0?"success":"info"},{default:t(()=>[f(z(n.instance_count),1)]),_:2},1032,["type"])]),l(I,{direction:"vertical",size:"small"},{default:t(()=>[l(X,null,{default:t(()=>[f(z(n.verbose_name),1)]),_:2},1024),l(X,{tag:"b"},{default:t(()=>[f(z(n.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]))),128))]),_:1})]),l(Z,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=s=>y.value=s),title:"新增模型",width:"500","before-close":ue},{footer:t(()=>[v("div",Ee,[l(d,{onClick:e[7]||(e[7]=s=>ae())},{default:t(()=>[...e[17]||(e[17]=[f("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:e[8]||(e[8]=s=>re(q.value))},{default:t(()=>[...e[18]||(e[18]=[f(" 确认 ",-1)])]),_:1})])]),default:t(()=>[l(Y,{ref_key:"modelFormRef",ref:q,style:{"max-width":"600px"},model:u,rules:ne,"label-width":"auto",class:"demo-modelForm","status-icon":""},{default:t(()=>[l(k,{label:"模型图标",prop:"icon"},{default:t(()=>[l(d,{onClick:ve},{default:t(()=>[l(w,null,{default:t(()=>[l(W,{icon:u.icon},null,8,["icon"])]),_:1})]),_:1}),l(Ie,{isShow:E.value,"onUpdate:isShow":e[2]||(e[2]=s=>E.value=s),iconName:u.icon,"onUpdate:iconName":e[3]||(e[3]=s=>u.icon=s)},null,8,["isShow","iconName"])]),_:1}),l(k,{label:"唯一标识",prop:"name"},{default:t(()=>[l(R,{modelValue:u.name,"onUpdate:modelValue":e[4]||(e[4]=s=>u.name=s),placeholder:"请输入模型的唯一标识"},null,8,["modelValue"])]),_:1}),l(k,{label:"模型名称",prop:"verbose_name"},{default:t(()=>[l(R,{modelValue:u.verbose_name,"onUpdate:modelValue":e[5]||(e[5]=s=>u.verbose_name=s)},null,8,["modelValue"])]),_:1}),l(k,{label:"所属分组",prop:"model_group"},{default:t(()=>[l(xe,{modelValue:u.model_group,"onUpdate:modelValue":e[6]||(e[6]=s=>u.model_group=s),placeholder:"选择分组"},{default:t(()=>[(r(!0),x(O,null,J(N.value,(s,V)=>(r(),_(Fe,{label:s.verbose_name,value:s.id,key:V},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(Z,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=s=>g.value=s),title:"新增模型组",width:"500","before-close":pe},{footer:t(()=>[v("div",Je,[l(d,{onClick:e[12]||(e[12]=s=>ie())},{default:t(()=>[...e[19]||(e[19]=[f("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:e[13]||(e[13]=s=>me(B.value))},{default:t(()=>[...e[20]||(e[20]=[f(" 确认 ",-1)])]),_:1})])]),default:t(()=>[l(Y,{ref_key:"modelGroupFormRef",ref:B,style:{"max-width":"600px"},model:c,rules:de,"label-width":"auto",class:"demo-modelForm","status-icon":""},{default:t(()=>[l(k,{label:"模型组标识",prop:"name"},{default:t(()=>[l(R,{modelValue:c.name,"onUpdate:modelValue":e[10]||(e[10]=s=>c.name=s),disabled:!S.value},null,8,["modelValue","disabled"])]),_:1}),l(k,{label:"分组名称",prop:"verbose_name"},{default:t(()=>[l(R,{modelValue:c.verbose_name,"onUpdate:modelValue":e[11]||(e[11]=s=>c.verbose_name=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),We=he(Pe,[["__scopeId","data-v-16d5d5db"]]);export{We as default};
