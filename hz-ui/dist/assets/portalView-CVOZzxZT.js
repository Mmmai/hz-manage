import{h as Ie,u as Re,g as We,r as i,a as P,A as pe,z as Ge,q as Ye,e as p,ag as He,c as Q,o as f,i as k,b as l,aa as $,v as w,D as v,w as t,k as u,a7 as X,a8 as me,az as Ke,t as Qe,ah as Xe,ai as Ze,al as n,I}from"./index-Gch8CQn_.js";const el={class:"card"},ll={class:"user-header"},tl={class:"user-header"},sl={__name:"portalView",setup(al){const _=Ie(),O=Re(),{proxy:r}=We(),B=i({search:null}),E=i([]);i([]);const R=i(!1),D=i(!1),j=i("add");i(!0);const b=P({group:"",owner:O.state.userinfo.user_id});i(0),P({owner:O.state.userinfo.user_id});const fe=()=>{R.value=!0},ge=i([]),ce=a=>{ge.value=a},c=i([]),ye=a=>{c.value=a,console.log(c.value)};pe(()=>{let a=[];for(let e in c.value)a.push(c.value[e].id);return a});const Z=()=>{I.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let a=[];for(let s in c.value)a.push(c.value[s].id);(await r.$api.portalMuldel({pks:a})).status==204?n({type:"success",message:"删除成功"}):n({type:"error",message:"删除失败"}),z()}).catch(()=>{n({type:"info",message:"Delete canceled"})})},we=()=>{D.value=!0,j.value="add"},ve=a=>{D.value=!0,j.value="edit",r.$nextTick(()=>{Object.assign(b,a)})},_e=pe(()=>{let a={};return E.value.forEach(e=>{a[e.id]=e.group}),a}),z=async()=>{let a=await r.$api.pgroupGet({page:1,page_size:1e3});E.value=a.data.results},be=a=>{I.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await r.$api.pgroupDel(a.id)).status==204?(n({type:"success",message:"删除成功"}),z()):n({type:"error",message:"删除失败"})}).catch(()=>{n({type:"info",message:"Delete canceled"})})},Ce=()=>{r.$refs.pgroupForm.validate(async a=>{if(console.log(b),a)if(j.value=="add"){let e=await r.$api.pgroupAdd(b);e.status==201?(D.value=!1,n({type:"success",message:"添加成功"}),r.$refs.pgroupForm.resetFields(),z()):n({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await r.$api.pgroupUpdate({group:b.group,id:b.id});e.status==200?(D.value=!1,n({type:"success",message:"更新成功"}),r.$refs.pgroupForm.resetFields(),z()):n({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else n({showClose:!0,message:"请输入正确内容.",type:"error"})})},h=i(!1),d=P({name:"",url:"",target:!0,group:"",status:!0,username:"",password:"",describe:"",owner:O.state.userinfo.user_id}),N=P({page:1,page_size:10});Ge(()=>N,a=>{F(a)},{deep:!0});const Ve=i([{prop:"name",label:"名称"},{prop:"url",label:"链接地址"},{prop:"target",label:"跳转方式"},{prop:"status",label:"状态"},{prop:"group",label:"分组"},{prop:"username",label:"登录用户名"},{prop:"password",label:"密码"},{prop:"describe",label:"描述"}]),A=i("add"),W=i([]),ee=i(0),M=P({page:1,page_size:2e3,owner:O.state.userinfo.user_id}),xe=i([]),F=async a=>{let e=await r.$api.portalGet(a);W.value=e.data.results,ee.value=e.data.count},ke=()=>{h.value=!0,A.value="add"},$e=()=>{h.value=!1,r.$refs.portalForm.resetFields()},De=()=>{r.$refs.portalForm.validate(async a=>{if(a)if(A.value=="add"){let e=await r.$api.portalAdd(d);e.status==201?(n({type:"success",message:"添加成功"}),r.$refs.portalForm.resetFields(),F(M),h.value=!1):n({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await r.$api.portalUpdate(d);e.status==200?(n({type:"success",message:"更新成功"}),r.$refs.portalForm.resetFields(),F(M),h.value=!1):n({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else n({showClose:!0,message:"请输入正确内容.",type:"error"})})},ze=a=>{h.value=!0,A.value="edit",r.$nextTick(()=>{Object.assign(d,a)})},he=a=>{I.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await r.$api.portalDel(a.id)).status==204?(n({type:"success",message:"删除成功"}),F(M)):n({type:"error",message:"删除失败"})}).catch(()=>{n({type:"info",message:"Delete canceled"})})},le=()=>{I.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let a=[];for(let s in c.value)a.push(c.value[s].id);(await r.$api.portalMuldel({pks:a})).status==204?n({type:"success",message:"删除成功"}):n({type:"error",message:"删除失败"}),F(M)}).catch(()=>{n({type:"info",message:"Delete canceled"})})};Ye(async()=>{await z(),await F(M)});const Ue=async()=>{let a=await r.$api.portalDataExport();console.log(a)},te=async()=>{let a=await r.$api.portalTemplateExport();console.log(a)},Se=()=>{if(B.value.search!=null){var a=new RegExp(B.value.search);let e=[];xe.value.forEach(s=>{a.test(s.name)&&e.push(s),W.value=e})}},Fe=async a=>{console.log(a);let e=await r.$api.portalUpdate({status:a.status,id:a.id});x,e.status==200?(n({type:"success",message:"更新成功"}),z()):n({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},G=i(!1),ae=i([]),Te=i(null),Pe=["xlsx"],Be=i(10),Ne=a=>{let e=a.name;if(a.type!=""||a.type!=null||a.type!=null){const s=a.name.replace(/.+\./,"").toLowerCase();return a.size/1024/1024<5?Pe.includes(s)?ae.value.find(q=>q.name==e&&q.lastModified==a.lastModified)?(n({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(n({message:`不能上传${s}类型的文件`,type:"error",showClose:!0}),!1):(n.error("上传文件大小不能超过 5MB!"),!1)}},oe=P({"Content-Type":"multipart/form-data"}),Me=async a=>{let e=new FormData;e.append("file",a.file);let s=await r.$api.importPortalData(e,oe,2*60*1e3);console.log(s),s.status==200?(n({message:`导入成功: ${JSON.stringify(s.data)}`,type:"success",showClose:!0}),z()):n({message:`导入异常: ${JSON.stringify(s.data)}`,type:"error",showClose:!0})};return(a,e)=>{var re,ue,de,ie;const s=p("el-button"),L=p("el-dropdown-item"),se=p("el-dropdown-menu"),q=p("el-dropdown"),U=p("el-input"),m=p("el-form-item"),Y=p("el-form"),T=p("el-table-column"),Oe=p("el-tag"),H=p("el-switch"),ne=p("el-table"),Ee=p("el-pagination"),S=p("el-row"),J=p("el-dialog"),y=p("el-col"),je=p("el-option"),Ae=p("el-select"),Le=p("upload-filled"),qe=p("el-icon"),Je=p("el-upload"),C=He("permission");return f(),Q(X,null,[k("div",el,[k("div",ll,[k("div",null,[$((f(),v(s,{type:"primary",size:"small",onClick:ke},{default:t(()=>e[19]||(e[19]=[u("新增")])),_:1})),[[C,`${(re=w(_).name)==null?void 0:re.replace("_info","")}:add`]]),$((f(),v(s,{type:"primary",size:"small",onClick:fe},{default:t(()=>e[20]||(e[20]=[u("新增分组")])),_:1})),[[C,`${(ue=w(_).name)==null?void 0:ue.replace("_info","")}:add`]]),c.value.length==0?$((f(),v(s,{key:0,disabled:"",type:"danger",size:"small",onClick:le},{default:t(()=>e[21]||(e[21]=[u("批量删除")])),_:1})),[[C,`${(de=w(_).name)==null?void 0:de.replace("_info","")}:delete`]]):$((f(),v(s,{key:1,type:"danger",size:"small",onClick:le},{default:t(()=>e[22]||(e[22]=[u("批量删除")])),_:1})),[[C,`${(ie=w(_).name)==null?void 0:ie.replace("_info","")}:delete`]]),l(q,{size:"small","split-button":"",type:"primary",style:{"margin-left":"15px","margin-right":"15px"}},{dropdown:t(()=>[l(se,null,{default:t(()=>[l(L,{onClick:Ue},{default:t(()=>e[23]||(e[23]=[u("全部导出")])),_:1}),l(L,{onClick:e[0]||(e[0]=o=>G.value=!0)},{default:t(()=>e[24]||(e[24]=[u("批量导入")])),_:1}),l(L,{onClick:te},{default:t(()=>e[25]||(e[25]=[u("模版下载")])),_:1})]),_:1})]),default:t(()=>[e[26]||(e[26]=u(" 更多操作 "))]),_:1})]),l(Y,{inline:!0,model:B.value,size:"small",class:"demo-form-inline"},{default:t(()=>[l(m,{label:"名称"},{default:t(()=>[l(U,{modelValue:B.value.search,"onUpdate:modelValue":e[1]||(e[1]=o=>B.value.search=o),placeholder:"输入名称",clearable:""},null,8,["modelValue"])]),_:1}),l(m,null,{default:t(()=>[l(s,{type:"primary",size:"small",onClick:Se},{default:t(()=>e[27]||(e[27]=[u("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),l(ne,{border:"",data:W.value,style:{width:"100%",flex:"1"},"max-height":"100%",onSelectionChange:ye},{default:t(()=>[l(T,{type:"selection",width:"55"}),(f(!0),Q(X,null,me(Ve.value,o=>(f(),v(T,{key:o.prop,label:o.label,prop:o.prop},Ke({_:2},[o.prop==="group"?{name:"default",fn:t(g=>[l(Oe,null,{default:t(()=>[u(Qe(_e.value[g.row.group]),1)]),_:2},1024)]),key:"0"}:void 0,o.prop==="status"?{name:"default",fn:t(g=>[l(H,{modelValue:g.row.status,"onUpdate:modelValue":V=>g.row.status=V,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:V=>Fe(g.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),key:"1"}:void 0]),1032,["label","prop"]))),128)),l(T,{fixed:"right",label:"操作",width:"150"},{default:t(o=>{var g,V;return[$((f(),v(s,{type:"primary",size:"small",onClick:K=>ze(o.row)},{default:t(()=>e[28]||(e[28]=[u(" 编辑 ")])),_:2},1032,["onClick"])),[[C,`${(g=w(_).name)==null?void 0:g.replace("_info","")}:edit`]]),$((f(),v(s,{type:"danger",size:"small",onClick:K=>he(o.row)},{default:t(()=>e[29]||(e[29]=[u(" 删除 ")])),_:2},1032,["onClick"])),[[C,`${(V=w(_).name)==null?void 0:V.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data"]),l(Ee,{"current-page":N.page,"onUpdate:currentPage":e[2]||(e[2]=o=>N.page=o),"page-size":N.page_size,"onUpdate:pageSize":e[3]||(e[3]=o=>N.page_size=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:ee.value,style:{"margin-top":"5px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),l(J,{modelValue:R.value,"onUpdate:modelValue":e[7]||(e[7]=o=>R.value=o),title:"编辑分组",width:"30%"},{footer:t(()=>[l(J,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=o=>D.value=o),width:"20%",title:j.value==="add"?"新增分组":"编辑分组","append-to-body":""},{default:t(()=>[l(Y,{inline:!0,model:b,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"pgroupForm","status-icon":""},{default:t(()=>[l(m,{label:"分组名称",prop:"group",rules:[{required:!0}]},{default:t(()=>[l(U,{modelValue:b.group,"onUpdate:modelValue":e[4]||(e[4]=o=>b.group=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1}),l(S,{style:{"justify-content":"space-around"}},{default:t(()=>[l(m,null,{default:t(()=>[l(s,{onClick:e[5]||(e[5]=o=>D.value=!1)},{default:t(()=>e[30]||(e[30]=[u("取消")])),_:1}),l(s,{type:"primary",onClick:Ce},{default:t(()=>e[31]||(e[31]=[u(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),default:t(()=>[k("div",tl,[k("div",null,[l(s,{type:"primary",size:"small",onClick:we},{default:t(()=>e[32]||(e[32]=[u("新增")])),_:1}),c.value.length==0?(f(),v(s,{key:0,disabled:"",type:"danger",size:"small",onClick:Z},{default:t(()=>e[33]||(e[33]=[u("批量删除")])),_:1})):(f(),v(s,{key:1,type:"danger",size:"small",onClick:Z},{default:t(()=>e[34]||(e[34]=[u("批量删除")])),_:1}))])]),l(ne,{data:E.value,"default-sort":{prop:"id",order:"ascending"},onSelectionChange:ce},{default:t(()=>[l(T,{type:"selection",width:"55"}),l(T,{prop:"group",label:"分组名",sortable:""}),l(T,{fixed:"right",label:"操作"},{default:t(o=>{var g,V;return[$(l(s,{type:"primary",size:"small",link:"",icon:w(Xe),onClick:K=>ve(o.row)},null,8,["icon","onClick"]),[[C,`${(g=w(_).name)==null?void 0:g.replace("_info","")}:edit`]]),$(l(s,{type:"danger",link:"",size:"small",icon:w(Ze),onClick:K=>be(o.row)},null,8,["icon","onClick"]),[[C,`${(V=w(_).name)==null?void 0:V.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),l(J,{modelValue:h.value,"onUpdate:modelValue":e[16]||(e[16]=o=>h.value=o),title:A.value=="add"?"新增链接":"编辑链接",width:"50%"},{default:t(()=>[l(Y,{inline:!0,model:d,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"portalForm","status-icon":""},{default:t(()=>[l(S,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[l(m,{label:"名称",prop:"name",rules:[{required:!0}]},{default:t(()=>[l(U,{modelValue:d.name,"onUpdate:modelValue":e[8]||(e[8]=o=>d.name=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:t(()=>[l(m,{label:"链接地址",prop:"url",rules:[{required:!0}],style:{width:"90%"}},{default:t(()=>[l(U,{modelValue:d.url,"onUpdate:modelValue":e[9]||(e[9]=o=>d.url=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(S,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[l(m,{label:"描述",prop:"describe"},{default:t(()=>[l(U,{modelValue:d.describe,"onUpdate:modelValue":e[10]||(e[10]=o=>d.describe=o),placeholder:"",clearable:"",style:{width:"100%"},autosize:{minRows:2,maxRows:4},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:t(()=>[l(m,{label:"分组",prop:"group",rules:[{required:!0}]},{default:t(()=>[l(Ae,{modelValue:d.group,"onUpdate:modelValue":e[11]||(e[11]=o=>d.group=o),filterable:"",placeholder:"Select",style:{width:"120px"}},{default:t(()=>[(f(!0),Q(X,null,me(E.value,o=>(f(),v(je,{key:o.value,label:o.group,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(S,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[l(m,{label:"用户名",prop:"username"},{default:t(()=>[l(U,{modelValue:d.username,"onUpdate:modelValue":e[12]||(e[12]=o=>d.username=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:t(()=>[l(m,{label:"密码",prop:"password"},{default:t(()=>[l(U,{modelValue:d.password,"onUpdate:modelValue":e[13]||(e[13]=o=>d.password=o),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(S,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[l(m,{label:"状态",prop:"status",rules:[{required:!0}]},{default:t(()=>[l(H,{modelValue:d.status,"onUpdate:modelValue":e[14]||(e[14]=o=>d.status=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:t(()=>[l(m,{label:"跳转方式",prop:"target"},{default:t(()=>[l(H,{modelValue:d.target,"onUpdate:modelValue":e[15]||(e[15]=o=>d.target=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(S,{style:{"justify-content":"space-around"}},{default:t(()=>[l(m,null,{default:t(()=>[l(s,{onClick:$e},{default:t(()=>e[35]||(e[35]=[u("取消")])),_:1}),l(s,{type:"primary",onClick:De},{default:t(()=>e[36]||(e[36]=[u(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(J,{modelValue:G.value,"onUpdate:modelValue":e[18]||(e[18]=o=>G.value=o),title:"导入",width:"800"},{default:t(()=>[l(Je,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:Te,headers:oe,"http-request":Me,"file-list":ae.value,"before-upload":Ne,limit:Be.value,"show-file-list":""},{tip:t(()=>[l(S,{justify:"space-between",align:"middle"},{default:t(()=>[l(y,{span:18},{default:t(()=>e[37]||(e[37]=[k("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),l(y,{span:3},{default:t(()=>[l(s,{link:"",type:"primary",onClick:e[17]||(e[17]=o=>te())},{default:t(()=>e[38]||(e[38]=[u("点击下载模板")])),_:1})]),_:1})]),_:1})]),default:t(()=>[l(qe,{class:"el-icon--upload"},{default:t(()=>[l(Le)]),_:1}),e[39]||(e[39]=k("div",{class:"el-upload__text"},[u("拖拽文件到此或者 "),k("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])],64)}}};export{sl as default};
