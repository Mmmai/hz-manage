import{_ as tt,x as at,v as E,g as lt,a as Y,r as y,z as nt,h as w,bc as xe,c as p,o as u,b as h,f as n,w as r,F as V,i as k,B as v,q as f,m as j,ca as rt,bV as oe,t as x,cg as ot,cc as st,cd as ut,k as S,b_ as R,c4 as $e}from"./index-Ch0lsCs7.js";import{Q as it}from"./vue3-json-viewer-DNOlocEX.js";import{m as dt}from"./model-4O14FRGq.js";const ct={class:"divVertical"},_t={class:"card filter-card"},mt={class:"filter-container"},pt={class:"filter-row filter-row-flex"},bt={class:"filter-item"},ft={class:"filter-item"},vt={class:"filter-item"},gt={class:"filter-item"},ht={class:"card table-main",style:{width:"100%"}},Vt=["innerHTML"],yt={class:"drawer-content"},wt={key:3,style:{"font-size":"12px",color:"#999","margin-top":"3px"}},kt={class:"dialog-footer"},xt={class:"flexStart"},$t={key:0},Ct={key:2,class:"relation-instances-table"},Ut={key:3,style:{"font-size":"12px",color:"#999","margin-top":"3px","margin-left":"10px"}},Rt={style:{width:"100%","margin-top":"10px"},class:"flexCenter"},zt={class:"dialog-footer"},Ot={__name:"ciRelationView",setup(Tt){const se=at(),G=dt(),L=E(()=>G.modelOptions),P=E(()=>G.modelObjectById),Z=E(()=>G.validationRulesEnumOptionsObject),{proxy:B}=lt(),U=Y({relationType:"",model:"",instance_name:""}),ue=y([]),F=y(!1),z=Y({currentPage:1,pageSize:10,total:0}),K=y(!1),ie=y({}),H=y(!1),Ce=y(),ee=y(null),d=Y({relation:{},source_instance:{},target_instance:{},source_attributes:{},target_attributes:{},relation_attributes:{}}),J=y(!1),te=y(),Q=y([]),X=y([]),W=y([]),ae=y(!1),le=y(!1),Ue=()=>{s.relations.push({target_instance:null,source_attributes:{},target_attributes:{},relation_attributes:{}})},Re=a=>{s.relations.push({target_instance:null,source_attributes:{...a.source_attributes},target_attributes:{...a.target_attributes},relation_attributes:{...a.relation_attributes}})},ze=a=>{s.relations.splice(a,1)},s=Y({source_model:null,relation:null,source_instance:null,relations:[]}),Oe=E(()=>s.relations.map(a=>a.target_instance)),A=y([]),M=y(null),Te=()=>{var a;M.value!==s.source_model&&(((a=T.value[s.relation])==null?void 0:a.source_model.indexOf(M.value))!==-1?N.value=!0:N.value=!1)},T=E(()=>{const a={};return Q.value.forEach(e=>{a[e.id]=e}),a}),Me=E(()=>{const a={};return Q.value.forEach(e=>{(e.source_model.indexOf(s.source_model)!==-1||e.target_model.indexOf(s.source_model)!==-1)&&(a[e.id]=e)}),a}),N=y(!1),Ie={relation:[{required:!0,message:"请选择关系类型",trigger:"change"}],source_instance:[{required:!0,message:"请选择源实例",trigger:"change"}],target_instances:[{required:!0,message:"请选择目标实例",trigger:"change"}]},de=(a,e)=>{if(!a||!a.attribute_schema||!a.attribute_schema.source)return e;const i=a.attribute_schema.source[e];return i?i.verbose_name:e},Se=(a,e)=>{if(!a||!a.attribute_schema||!a.attribute_schema.relation)return e;const i=a.attribute_schema.relation[e];return i?i.verbose_name:e},ce=(a,e)=>{if(!a||!a.attribute_schema||!a.attribute_schema.target)return e;const i=a.attribute_schema.target[e];return i?i.verbose_name:e},ne=(a,e,i)=>{if(!a||!a.attribute_schema||!a.attribute_schema.relation)return i;const _=a.attribute_schema.relation[e];if(!_)return i;if(_.type==="enum"&&_.validation_rule){const m=Z.value[_.validation_rule];if(m){const b=m.find(g=>g.value===i);if(b)return b.label}}return _.unit?`${i} ${_.unit}`:i},qe=a=>{if(!a)return"";const e=a.source_instance.instance_name,i=a.target_instance.instance_name,_=a.relation.forward_verb,m=P.value[a.source_instance.model].verbose_name,b=P.value[a.target_instance.model].verbose_name;let g,q;g=Object.keys(a.source_attributes).map($=>`${de(a.relation,$)}: ${ne(a.relation,$,a.source_attributes[$])}`).join(", "),q=Object.keys(a.target_attributes).map($=>`${ce(a.relation,$)}: ${ne(a.relation,$,a.target_attributes[$])}`).join(", ");let I=`<span class="source-name">${e}</span>(${m})`;return g&&(I+=`的[${g}]`),I+=` - <span class="relation-name">${_}</span> - <span class="target-name">${i}</span>(${b})`,q&&(I+=`的[${q}]`),I},Ne=E(()=>{var b,g,q,I,$;if(!M.value)return;let a=(b=P.value[s.source_model])==null?void 0:b.verbose_name,e=(g=P.value[M.value])==null?void 0:g.verbose_name,i=(q=fe.value[s.source_instance])==null?void 0:q.instance_name,_=(I=T.value[s.relation])==null?void 0:I.forward_verb,m=($=T.value[s.relation])==null?void 0:$.reverse_verb;return N.value?`源实例: ${i}(${a}) ${m} ${e}`:`源实例: ${i}(${a}) ${_} ${e}`}),_e=a=>{var e;return a?((e=P.value[a])==null?void 0:e.verbose_name)||a:""},re=()=>{z.currentPage=1,D()},De=()=>{U.relationType="",U.model="",z.currentPage=1,D()},Be=a=>{z.pageSize=a,z.currentPage=1,D()},Ee=a=>{z.currentPage=a,D()},je=a=>{ie.value=a,K.value=!0},Ae=()=>{s.source_instance=null,s.relation=null,A.value=[]},Le=a=>{ee.value=a.id,d.relation=a.relation||{},d.source_instance=a.source_instance||{},d.target_instance=a.target_instance||{},d.source_attributes={...a.source_attributes},d.target_attributes={...a.target_attributes},d.relation_attributes={...a.relation_attributes},H.value=!0},me=()=>{ee.value=null,d.relation={},d.source_instance={},d.target_instance={},d.source_attributes={},d.target_attributes={},d.relation_attributes={}},Pe=async()=>{try{const a={id:ee.value,source_attributes:d.source_attributes,target_attributes:d.target_attributes,relation_attributes:d.relation_attributes};(await B.$api.updateModelInstanceRelation(a)).status===200?(R.success("更新成功"),H.value=!1,me(),D()):R.error("更新失败")}catch(a){R.error("更新失败: "+a.message),console.error(a)}},He=async()=>{J.value=!0,X.value=[],W.value=[]},Je=()=>{var i,_;if(s.target_instances=[],W.value=[],!s.relation||!s.source_model)return;let a=(i=T.value[s.relation])==null?void 0:i.source_model,e=(_=T.value[s.relation])==null?void 0:_.target_model;(a==null?void 0:a.indexOf(s.source_model))!==-1?(e==null?void 0:e.indexOf(s.source_model))!==-1?A.value=L.value.filter(m=>e.indexOf(m.value)!==-1||a.indexOf(m.value)!==-1):(A.value=L.value.filter(m=>e.indexOf(m.value)!==-1),N.value=!1):(A.value=L.value.filter(m=>a.indexOf(m.value)!==-1),N.value=!0),M.value=A.value[0].value},pe=()=>{var a;(a=te.value)==null||a.resetFields(),s.source_model=null,s.relation=null,s.source_instance=null,s.target_instances=[],M.value=null,s.relations=[],X.value=[]},be=()=>{$e.confirm("确定关闭添加对话框?","Warning",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{pe(),J.value=!1}).catch(()=>{R({type:"info",message:"取消关闭"})})},fe=y({}),Qe=async a=>{ae.value=!0;try{if(s.source_model){const e=s.source_model,i=await B.$api.getCiModelInstance({model:e,search:a,page_size:20});X.value=i.data.results,i.data.results.forEach(_=>{fe.value[_.id]=_})}}catch(e){R.error("搜索源实例失败"),console.error(e)}finally{ae.value=!1}},We=async a=>{if(!s.relation){W.value=[];return}le.value=!0;try{if(Q.value.find(i=>i.id===s.relation)){const i=await B.$api.getCiModelInstance({model:M.value,instance_name:a,page_size:10});W.value=i.data.results.map(_=>(Oe.value.indexOf(_.id)!==-1&&(console.log("item",_),_.disabled=!0),_))}}catch(e){R.error("搜索目标实例失败"),console.error(e)}finally{le.value=!1}},Ge=async()=>{var a;await((a=te.value)==null?void 0:a.validate(async e=>{if(e)try{const i=[];for(const m of s.relations){const b={relation:s.relation,source_instance:s.source_instance,target_instance:m.target_instance,source_attributes:m.source_attributes||{},target_attributes:m.target_attributes||{},relation_attributes:m.relation_attributes||{}};N.value&&(b.source_instance=m.target_instance,b.target_instance=s.source_instance),i.push(b)}console.log("提交的params",JSON.stringify({relations:i}));const _=await B.$api.bulkAddModelInstanceRelation({relations:i});_.status==201?(R.success("添加关联关系成功"),J.value=!1,pe(),D()):R.error("关联关系添加失败"+JSON.stringify(_.data))}catch(i){R.error("添加关联关系失败: "+i.message),console.error(i)}}))},Xe=async()=>{try{const a=await B.$api.getModelRelationDefine();Q.value=a.data.results}catch(a){R.error("获取关系类型失败"),console.error(a)}},D=async()=>{F.value=!0;try{const a={page:z.currentPage,page_size:z.pageSize};U.relationType&&(a.relation=U.relationType),U.model&&(a.model=U.model),U.instance_name&&(a.instance_name=U.instance_name);const e=await B.$api.getModelInstanceRelation(a);ue.value=e.data.results,z.total=e.data.count}catch(a){R.error("获取关系数据失败"),console.error(a)}finally{F.value=!1}},Ye=a=>{$e.confirm("确定要删除这个关联关系吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{(await B.$api.deleteModelInstanceRelation(a)).status===204?(R.success("删除成功"),D()):R.error("删除失败")}catch(e){R.error("删除失败: "+e.message),console.error(e)}}).catch(()=>{})};return nt(()=>{G.getModel(),Xe(),D()}),(a,e)=>{const i=w("el-option"),_=w("el-select"),m=w("el-input"),b=w("el-button"),g=w("el-table-column"),q=w("el-link"),I=w("el-tag"),$=w("el-text"),ve=w("el-table"),Ze=w("el-pagination"),Fe=w("el-drawer"),C=w("el-form-item"),ge=w("el-input-number"),he=w("el-form"),Ve=w("el-dialog"),Ke=w("el-radio-button"),ye=w("el-radio-group"),we=w("el-radio"),ke=xe("permission"),et=xe("loading");return u(),p("div",ct,[h("div",_t,[h("div",mt,[h("div",pt,[h("div",bt,[e[17]||(e[17]=h("span",{class:"filter-label"},"模型：",-1)),n(_,{modelValue:U.model,"onUpdate:modelValue":e[0]||(e[0]=t=>U.model=t),placeholder:"请选择模型",clearable:"",style:{width:"200px"},onChange:re},{default:r(()=>[(u(!0),p(V,null,k(L.value,t=>(u(),v(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",ft,[e[18]||(e[18]=h("span",{class:"filter-label"},"关系类型：",-1)),n(_,{modelValue:U.relationType,"onUpdate:modelValue":e[1]||(e[1]=t=>U.relationType=t),placeholder:"请选择关系类型",clearable:"",style:{width:"200px"},onChange:re},{default:r(()=>[(u(!0),p(V,null,k(Q.value,t=>(u(),v(i,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",vt,[e[19]||(e[19]=h("span",{class:"filter-label"},"实例名称：",-1)),n(m,{modelValue:U.instance_name,"onUpdate:modelValue":e[2]||(e[2]=t=>U.instance_name=t),placeholder:"请输入实例名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),h("div",gt,[n(b,{type:"primary",icon:j(rt),onClick:re},{default:r(()=>[...e[20]||(e[20]=[f(" 搜索 ",-1)])]),_:1},8,["icon"]),n(b,{onClick:De},{default:r(()=>[...e[21]||(e[21]=[f("重置",-1)])]),_:1})])])]),n(b,{type:"primary",onClick:He},{default:r(()=>[...e[22]||(e[22]=[f("新增关联",-1)])]),_:1})]),h("div",ht,[oe((u(),v(ve,{data:ue.value,stripe:"",style:{width:"100%"},height:"100%"},{default:r(()=>[n(g,{prop:"definition.name",label:"关系类型",width:"150"},{default:r(t=>{var o;return[f(x((o=t.row.relation)==null?void 0:o.name),1)]}),_:1}),n(g,{label:"源实例"},{default:r(t=>{var o;return[h("div",null,[n(q,{href:`/#/cmdb/cidata/${(o=t.row.source_instance)==null?void 0:o.id}`},{default:r(()=>{var l;return[f(x((l=t.row.source_instance)==null?void 0:l.instance_name),1)]}),_:2},1032,["href"]),n(I,{type:"info",size:"small"},{default:r(()=>{var l;return[f(x(_e((l=t.row.source_instance)==null?void 0:l.model)),1)]}),_:2},1024)])]}),_:1}),n(g,{label:"源属性",prop:"source_attributes",width:"200"},{default:r(t=>[(u(!0),p(V,null,k(t.row.source_attributes,(o,l)=>(u(),p("div",{key:l,style:{"font-size":"12px"}},[n($,{tag:"b"},{default:r(()=>[f(x(de(t.row.relation,l))+":",1)]),_:2},1024),f(" "+x(o),1)]))),128))]),_:1}),n(g,{prop:"relation",label:"关联动作",width:"100"},{default:r(t=>[n(I,{type:"success"},{default:r(()=>{var o;return[f(x((o=t.row.relation)==null?void 0:o.forward_verb),1)]}),_:2},1024)]),_:1}),n(g,{label:"目标实例"},{default:r(t=>{var o;return[h("div",null,[n(q,{href:`/#/cmdb/cidata/${(o=t.row.target_instance)==null?void 0:o.id}`},{default:r(()=>{var l;return[f(x((l=t.row.target_instance)==null?void 0:l.instance_name),1)]}),_:2},1032,["href"]),n(I,{type:"info",size:"small"},{default:r(()=>{var l;return[f(x(_e((l=t.row.target_instance)==null?void 0:l.model)),1)]}),_:2},1024)])]}),_:1}),n(g,{label:"目标属性",prop:"target_attributes",width:"200"},{default:r(t=>[(u(!0),p(V,null,k(t.row.target_attributes,(o,l)=>(u(),p("div",{key:l,style:{"font-size":"12px"}},[n($,{tag:"b"},{default:r(()=>[f(x(ce(t.row.relation,l))+":",1)]),_:2},1024),f(" "+x(o),1)]))),128))]),_:1}),n(g,{prop:"relation_attributes",label:"关系属性",width:"250"},{default:r(t=>[(u(!0),p(V,null,k(t.row.relation_attributes,(o,l)=>(u(),p("div",{key:l,style:{"font-size":"12px"}},[n($,{tag:"b"},{default:r(()=>[f(x(Se(t.row.relation,l))+":",1)]),_:2},1024),f(" "+x(ne(t.row.relation,l,o)),1)]))),128))]),_:1}),n(g,{prop:"id",label:"关联动作描述"},{default:r(t=>[h("div",{class:"relation-description",innerHTML:qe(t.row)},null,8,Vt)]),_:1}),n(g,{label:"操作",width:"150",fixed:"right"},{default:r(t=>{var o,l;return[n(b,{onClick:c=>je(t.row),type:"primary",link:"",icon:j(ot)},null,8,["onClick","icon"]),oe(n(b,{onClick:c=>Le(t.row),type:"primary",link:"",icon:j(st)},null,8,["onClick","icon"]),[[ke,`${(o=j(se).name)==null?void 0:o.replace("_info","")}:edit`]]),oe(n(b,{type:"danger",link:"",icon:j(ut),onClick:c=>Ye(t.row.id)},null,8,["icon","onClick"]),[[ke,`${(l=j(se).name)==null?void 0:l.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data"])),[[et,F.value]]),n(Ze,{"current-page":z.currentPage,"onUpdate:currentPage":e[3]||(e[3]=t=>z.currentPage=t),"page-size":z.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>z.pageSize=t),"page-sizes":[10,20,50,100],total:z.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Be,onCurrentChange:Ee,style:{"margin-top":"20px","justify-content":"flex-end",display:"flex"}},null,8,["current-page","page-size","total"])]),n(Fe,{modelValue:K.value,"onUpdate:modelValue":e[5]||(e[5]=t=>K.value=t),title:"关系详情",direction:"rtl",size:"50%"},{default:r(()=>[h("div",yt,[n(j(it),{value:ie.value,"expand-depth":10,copyable:"",boxed:"",sort:"",expanded:""},null,8,["value"])])]),_:1},8,["modelValue"]),n(Ve,{modelValue:H.value,"onUpdate:modelValue":e[10]||(e[10]=t=>H.value=t),title:"编辑关系",width:"600px",onClose:me},{footer:r(()=>[h("div",kt,[n(b,{onClick:e[9]||(e[9]=t=>H.value=!1)},{default:r(()=>[...e[23]||(e[23]=[f("取消",-1)])]),_:1}),n(b,{type:"primary",onClick:Pe},{default:r(()=>[...e[24]||(e[24]=[f("保存",-1)])]),_:1})])]),default:r(()=>[n(he,{ref_key:"editFormRef",ref:Ce,model:d,"label-width":"120px"},{default:r(()=>{var t;return[n(C,{label:"关系类型"},{default:r(()=>[n(m,{modelValue:d.relation.name,"onUpdate:modelValue":e[6]||(e[6]=o=>d.relation.name=o),disabled:""},null,8,["modelValue"])]),_:1}),n(C,{label:"源实例"},{default:r(()=>[n(m,{modelValue:d.source_instance.instance_name,"onUpdate:modelValue":e[7]||(e[7]=o=>d.source_instance.instance_name=o),disabled:""},null,8,["modelValue"])]),_:1}),n(C,{label:"目标实例"},{default:r(()=>[n(m,{modelValue:d.target_instance.instance_name,"onUpdate:modelValue":e[8]||(e[8]=o=>d.target_instance.instance_name=o),disabled:""},null,8,["modelValue"])]),_:1}),(t=d.relation)!=null&&t.attribute_schema?(u(),p(V,{key:0},[(u(!0),p(V,null,k(d.relation.attribute_schema.source,(o,l)=>(u(),v(C,{key:"source_"+l,label:o.verbose_name,prop:"source_attributes."+l},{default:r(()=>[n(m,{modelValue:d.source_attributes[l],"onUpdate:modelValue":c=>d.source_attributes[l]=c,placeholder:"请输入"+o.verbose_name,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128)),(u(!0),p(V,null,k(d.relation.attribute_schema.target,(o,l)=>(u(),v(C,{key:"target_"+l,label:o.verbose_name,prop:"target_attributes."+l},{default:r(()=>[n(m,{modelValue:d.target_attributes[l],"onUpdate:modelValue":c=>d.target_attributes[l]=c,placeholder:"请输入"+o.verbose_name,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128)),(u(!0),p(V,null,k(d.relation.attribute_schema.relation,(o,l)=>(u(),v(C,{key:"relation_"+l,label:o.verbose_name,prop:"relation_attributes."+l},{default:r(()=>[o.type==="enum"?(u(),v(_,{key:0,modelValue:d.relation_attributes[l],"onUpdate:modelValue":c=>d.relation_attributes[l]=c,placeholder:"请选择"+o.verbose_name,style:{width:"100%"}},{default:r(()=>[(u(!0),p(V,null,k(Z.value[o.validation_rule],c=>(u(),v(i,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):["integer","float"].includes(o.type)?(u(),v(ge,{key:1,modelValue:d.relation_attributes[l],"onUpdate:modelValue":c=>d.relation_attributes[l]=c,placeholder:"请输入"+o.verbose_name,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(u(),v(m,{key:2,modelValue:d.relation_attributes[l],"onUpdate:modelValue":c=>d.relation_attributes[l]=c,placeholder:"请输入"+o.verbose_name,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])),o.unit?(u(),p("div",wt," 单位: "+x(o.unit),1)):S("",!0)]),_:2},1032,["label","prop"]))),128))],64)):S("",!0)]}),_:1},8,["model"])]),_:1},8,["modelValue"]),n(Ve,{modelValue:J.value,"onUpdate:modelValue":e[16]||(e[16]=t=>J.value=t),title:"新增关联关系",width:"60%",class:"add-relation-dialog","before-close":be},{footer:r(()=>[h("div",zt,[n(b,{onClick:be},{default:r(()=>[...e[28]||(e[28]=[f("取消",-1)])]),_:1}),n(b,{type:"primary",onClick:Ge},{default:r(()=>[...e[29]||(e[29]=[f("保存",-1)])]),_:1})])]),default:r(()=>[n(he,{ref_key:"addRelationFormRef",ref:te,model:s,rules:Ie,"label-width":"120px"},{default:r(()=>[n(C,{label:"源模型",prop:"source_model"},{default:r(()=>[n(_,{modelValue:s.source_model,"onUpdate:modelValue":e[11]||(e[11]=t=>s.source_model=t),placeholder:"请选择源模型",style:{width:"30%"},filterable:"",onChange:Ae},{default:r(()=>[(u(!0),p(V,null,k(L.value,t=>(u(),v(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(C,{label:"源实例",prop:"source_instance"},{default:r(()=>[n(_,{modelValue:s.source_instance,"onUpdate:modelValue":e[12]||(e[12]=t=>s.source_instance=t),placeholder:"请选择源实例",style:{width:"30%"},filterable:"",remote:"","remote-method":Qe,loading:ae.value},{default:r(()=>[(u(!0),p(V,null,k(X.value,t=>(u(),v(i,{key:t.id,label:t.instance_name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),n(C,{label:"关系类型",prop:"relation"},{default:r(()=>[n(_,{modelValue:s.relation,"onUpdate:modelValue":e[13]||(e[13]=t=>s.relation=t),placeholder:"请选择关系类型",style:{width:"30%"},onChange:Je},{default:r(()=>[(u(!0),p(V,null,k(Me.value,t=>(u(),v(i,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s.relation?(u(),v(C,{key:0,label:"目标模型",prop:"target_instance"},{default:r(()=>[n(ye,{modelValue:M.value,"onUpdate:modelValue":e[14]||(e[14]=t=>M.value=t),size:"default",onChange:Te},{default:r(()=>[(u(!0),p(V,null,k(A.value,(t,o)=>(u(),v(Ke,{label:t.label,value:t.value,key:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):S("",!0),s.source_model!==null&&M.value!==null?(u(),v(C,{key:1,label:"关联动作"},{default:r(()=>{var t,o;return[h("div",xt,[s.source_model===M.value&&((t=T.value[s.relation])==null?void 0:t.forward_verb)!==((o=T.value[s.relation])==null?void 0:o.reverse_verb)?(u(),p("div",$t,[n(ye,{modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=l=>N.value=l)},{default:r(()=>[n(we,{value:!1,size:"large"},{default:r(()=>{var l;return[f(x((l=T.value[s.relation])==null?void 0:l.forward_verb),1)]}),_:1}),n(we,{value:!0,size:"large"},{default:r(()=>{var l;return[f(x((l=T.value[s.relation])==null?void 0:l.reverse_verb),1)]}),_:1})]),_:1},8,["modelValue"])])):S("",!0),n($,null,{default:r(()=>[f(x(Ne.value),1)]),_:1})])]}),_:1})):S("",!0),s.relation?(u(),p("div",Ct,[n(ve,{data:s.relations,style:{width:"100%","margin-top":"15px"},border:""},{default:r(()=>[n(g,{prop:"target_instance",label:"目标实例",width:"300"},{default:r(t=>[n(C,{prop:"relations."+t.$index+".target_instance",required:"","label-position":"left","label-width":"auto"},{default:r(()=>[n(_,{modelValue:t.row.target_instance,"onUpdate:modelValue":o=>t.row.target_instance=o,placeholder:"请选择目标实例",style:{width:"100%"},filterable:"",remote:"","remote-method":We,loading:le.value},{default:r(()=>[(u(!0),p(V,null,k(W.value,o=>(u(),v(i,{key:o.id,label:o.instance_name,value:o.id,disabled:o.disabled},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","loading"])]),_:2},1032,["prop"])]),_:1}),n(g,{prop:"source_attributes",label:"源属性"},{default:r(t=>{var o;return[t.row.source_attributes?(u(!0),p(V,{key:0},k((o=T.value[s.relation])==null?void 0:o.attribute_schema.source,(l,c)=>(u(),v(C,{key:"source_"+t.$index+"."+c,label:l.verbose_name,prop:"relations."+t.$index+".source_attributes."+c,required:l.required,"label-position":"left","label-width":"auto"},{default:r(()=>[n(m,{modelValue:t.row.source_attributes[c],"onUpdate:modelValue":O=>t.row.source_attributes[c]=O,placeholder:"请输入"+l.verbose_name,style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop","required"]))),128)):S("",!0)]}),_:1}),n(g,{prop:"target_attributes",label:"目标属性"},{default:r(t=>{var o;return[t.row.target_attributes?(u(!0),p(V,{key:0},k((o=T.value[s.relation])==null?void 0:o.attribute_schema.target,(l,c)=>(u(),v(C,{key:"source_"+t.$index+"."+c,label:l.verbose_name,prop:"relations."+t.$index+".target_attributes."+c,required:l.required,"label-position":"left","label-width":"auto"},{default:r(()=>[n(m,{modelValue:t.row.target_attributes[c],"onUpdate:modelValue":O=>t.row.target_attributes[c]=O,placeholder:"请输入"+l.verbose_name,style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop","required"]))),128)):S("",!0)]}),_:1}),n(g,{prop:"relation_attributes",label:"关系属性"},{default:r(t=>{var o;return[t.row.relation_attributes?(u(!0),p(V,{key:0},k((o=T.value[s.relation])==null?void 0:o.attribute_schema.relation,(l,c)=>(u(),v(C,{key:"source_"+t.$index+"."+c,label:l.verbose_name,prop:"relations."+t.$index+".relation_attributes."+c,required:l.required,"label-position":"left","label-width":"auto"},{default:r(()=>[l.type==="enum"?(u(),v(_,{key:0,modelValue:t.row.relation_attributes[c],"onUpdate:modelValue":O=>t.row.relation_attributes[c]=O,placeholder:"请选择"+l.verbose_name,style:{width:"80%"}},{default:r(()=>[(u(!0),p(V,null,k(Z.value[l.validation_rule],O=>(u(),v(i,{key:O.value,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):["integer","float"].includes(l.type)?(u(),v(ge,{key:1,modelValue:t.row.relation_attributes[c],"onUpdate:modelValue":O=>t.row.relation_attributes[c]=O,placeholder:"请输入"+l.verbose_name,style:{width:"50%"},"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(u(),v(m,{key:2,modelValue:t.row.relation_attributes[c],"onUpdate:modelValue":O=>t.row.relation_attributes[c]=O,placeholder:"请输入"+l.verbose_name,style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])),l.unit?(u(),p("div",Ut," 单位: "+x(l.unit),1)):S("",!0)]),_:2},1032,["label","prop","required"]))),128)):S("",!0)]}),_:1}),n(g,{label:"操作",width:"120",fixed:"right"},{default:r(t=>[n(b,{type:"primary",link:"",onClick:o=>Re(t.row)},{default:r(()=>[...e[25]||(e[25]=[f(" 复制 ",-1)])]),_:1},8,["onClick"]),n(b,{type:"danger",link:"",onClick:o=>ze(t.$index)},{default:r(()=>[...e[26]||(e[26]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),h("div",Rt,[n(b,{onClick:Ue,type:"primary"},{default:r(()=>[...e[27]||(e[27]=[f("新增",-1)])]),_:1})])])):S("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},qt=tt(Ot,[["__scopeId","data-v-5bab3bd9"]]);export{qt as default};
