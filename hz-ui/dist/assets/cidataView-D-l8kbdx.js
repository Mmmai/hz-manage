import{d as cl,aB as Ke,bu as il,r as i,c as el,e as c,o as t,O as u,w as l,g as a,h as V,j as f,t as C,f as r,bo as b,c5 as Ve,P as x,c2 as ba,c4 as I,k as Nl,M as E,bI as Sl,F as ae,b1 as ie,bS as wa,c6 as at,aD as Me,_ as Tl,c7 as Ze,bQ as hl,b as ka,u as tt,aN as ha,b3 as rl,c8 as ot,c9 as nt,bO as H,b_ as st,ca as Jl,cb as ut,cc as dt,cd as rt,bF as Pl,Y as it,aE as Fe,c0 as ct,ce as ga,cf as pt,c1 as ft,bV as Wl,cg as vt,i as mt,ch as _t,ci as yt,cj as gt}from"./index-C9OpqlOS.js";import{l as bt}from"./vue-draggable-plus-DLU5jYhE.js";import{u as Ca}from"./config-DWBKjSxI.js";import{e as Kl,d as Hl}from"./gmCrypto-D5-05R49.js";const wt={class:"flexJstart gap-1"},kt={key:0,class:"flexJstart gap-1"},ht={key:3,class:"flexJstart gap-1"},Ct=cl({__name:"ciDataUpload",props:Ke(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:Ke(["getCiData"],["update:isShowUpload"]),setup(ce,{emit:pe}){const{proxy:W}=Nl(),M=ce,L=pe,k=il(ce,"isShowUpload"),A=i([]),fe=i(null),h=["xlsx"],se=i(10),O=i({}),ve=i({}),te=el({"Content-Type":"multipart/form-data"}),B=i({}),ue=async()=>{Object.keys(ve.value).length>0?Object.entries(ve.value).forEach(async([U,v])=>{let p=await W.$api.importCiDataStatus(v);O.value[U]=p.data,p.data.status==="completed"&&delete ve.value[U]}):(clearInterval(q),q=null,L("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId}))};let q=null;const P=async U=>{let v=new FormData;v.append("file",U.file),v.append("model",M.ciModelId);let p=await W.$api.importCiData(v,te,2*60*1e3);p.status==200?(ve.value[U.file.uid]=p.data,B.value[U.file.uid]=!0,q===null&&(q=setInterval(ue,2e3))):(B.value[U.file.uid]=!1,I({message:`导入异常: ${JSON.stringify(p.data)}`,type:"error",showClose:!0}))},le=()=>{},G=U=>{let v=U.name;if(U.type!=""||U.type!=null||U.type!=null){const p=U.name.replace(/.+\./,"").toLowerCase();return U.size/1024/1024<5?h.includes(p)?A.value.find(ye=>ye.name==v&&ye.lastModified==U.lastModified)?(I({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(I({message:`不能上传${p}类型的文件`,type:"error",showClose:!0}),!1):(I.error("上传文件大小不能超过 5MB!"),!1)}},Q=async U=>{await W.$api.downloadErrorRecords({error_file_key:U})},Oe=async()=>{await W.$api.downloadImportTemplate({model:M.ciModelId})};return(U,v)=>{const p=c("upload-filled"),R=c("el-icon"),oe=c("el-col"),ye=c("el-button"),ge=c("el-row"),ne=c("Loading"),J=c("CircleCheck"),z=c("el-link"),he=c("el-upload"),Ue=c("el-dialog");return t(),u(Ue,{modelValue:k.value,"onUpdate:modelValue":v[1]||(v[1]=K=>k.value=K),title:"导入",width:"800"},{default:l(()=>[a(he,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:fe,headers:te,"http-request":P,"file-list":A.value,"before-upload":G,limit:se.value,onOnChange:le,"show-file-list":""},{tip:l(()=>[a(ge,{justify:"space-between",align:"middle"},{default:l(()=>[a(oe,{span:18},{default:l(()=>v[2]||(v[2]=[V("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(oe,{span:3},{default:l(()=>[a(ye,{link:"",type:"primary",onClick:v[0]||(v[0]=K=>Oe())},{default:l(()=>v[3]||(v[3]=[f("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:K,index:He})=>{var Be,$,Pe,N,ll,Je,al,We,tl;return[V("div",wt,[V("span",null,C(K.name),1),B.value[K.uid]==!0?(t(),r("div",kt,[((Be=O.value[K.uid])==null?void 0:Be.status)!=="completed"?(t(),u(R,{key:0,class:"is-loading"},{default:l(()=>[a(ne)]),_:1})):(($=O.value[K.uid])==null?void 0:$.failed)>>>0?(t(),u(R,{key:1},{default:l(()=>[a(b(Ve),{color:"var(--el-color-warning)"})]),_:1})):(t(),u(R,{key:2},{default:l(()=>[a(J,{color:"var(--el-color-success)"})]),_:1})),O.value[K.uid]?(t(),r("div",ht,[V("span",null,C(`进度: ${(Pe=O.value[K.uid])==null?void 0:Pe.progress}%`),1),V("span",null,C(`结果: 总条数: ${(N=O.value[K.uid])==null?void 0:N.total},创建: ${(ll=O.value[K.uid])==null?void 0:ll.created},更新: ${(Je=O.value[K.uid])==null?void 0:Je.updated},跳过: ${(al=O.value[K.uid])==null?void 0:al.skipped},失败: ${(We=O.value[K.uid])==null?void 0:We.failed}.`),1),((tl=O.value[K.uid])==null?void 0:tl.failed)>>>0?(t(),u(z,{key:0,type:"danger",onClick:w=>{var _;return Q((_=O.value[K.uid])==null?void 0:_.error_file_key)}},{default:l(()=>v[4]||(v[4]=[f("查看导入失败数据")])),_:2},1032,["onClick"])):x("",!0)])):x("",!0)])):B.value[K.uid]==!1?(t(),u(R,{key:1},{default:l(()=>[a(b(ba),{color:"var(--el-color-error)"})]),_:1})):x("",!0)])]}),default:l(()=>[a(R,{class:"el-icon--upload"},{default:l(()=>[a(p)]),_:1}),v[5]||(v[5]=V("div",{class:"el-upload__text"},[f("拖拽文件到此或者 "),V("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])}}}),xt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Vt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Mt={style:{width:"100%",overflow:"auto"}},Ot={class:"listItem"},$t={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Dt={class:"listItem"},Ft={style:{flex:"auto"}},Ut=cl({__name:"ciDataTableCol",props:Ke(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:Ke(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(ce,{expose:pe,emit:W}){const M=ce,L=il(ce,"isShowTableCol"),k=il(ce,"hasConfigField"),{proxy:A}=Nl(),fe=i(""),h=i(""),se=E(()=>fe.value===""?U.value:U.value.filter(v=>v.verbose_name.includes(fe.value)));function O(){L.value=!1}const ve=v=>{k.value.push(v)},te=v=>{let p=k.value.indexOf(v);k.value.splice(p,1)},B=v=>{console.log("start",v)},ue=v=>{console.log("onEnd",v),console.log(k.value)},q=()=>{console.log("update")},P=i({}),le=async()=>{let v=await A.$api.getCiModelCol({model:M.ciModelId});P.value=v.data;let p=[];v.data.fields_preferred.forEach(R=>{p.push(M.allModelFieldInfo[R])}),k.value=p},G=E(()=>k.value.map(v=>v.id)),Q=W;Sl(()=>k.value,v=>{console.log("更新表格"),Q("reloadTable")},{deep:!0});const Oe=async()=>{let v=await A.$api.updateCiModelCol({id:P.value.id,fields_preferred:G.value});v.status=="200"?(I({type:"success",message:"更新成功"}),Me(()=>{h.value.clear(),L.value=!1})):I({showClose:!0,message:"更新失败:"+JSON.stringify(v.data),type:"error"})},U=E(()=>M.allModelField.filter(v=>!k.value.includes(v)));return pe({getHasConfigField:le}),(v,p)=>{const R=c("el-text"),oe=c("el-divider"),ye=c("el-input"),ge=c("el-icon"),ne=c("el-button"),J=c("el-drawer");return t(),u(J,{modelValue:L.value,"onUpdate:modelValue":p[2]||(p[2]=z=>L.value=z),direction:"rtl",size:"40%"},{header:l(()=>[a(R,{tag:"b"},{default:l(()=>p[3]||(p[3]=[f("表格列显示配置")])),_:1})]),default:l(()=>[V("div",xt,[V("div",Vt,[a(R,{tag:"b"},{default:l(()=>p[4]||(p[4]=[f("模型字段")])),_:1}),a(oe),a(ye,{modelValue:fe.value,"onUpdate:modelValue":p[0]||(p[0]=z=>fe.value=z),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:h},null,8,["modelValue"]),V("div",Mt,[(t(!0),r(ae,null,ie(se.value,(z,he)=>(t(),r("div",{key:he},[V("div",Ot,[V("span",null,C(z.verbose_name),1),a(ge,null,{default:l(()=>[a(b(wa),{onClick:Ue=>ve(z)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),V("div",$t,[a(R,{tag:"b"},{default:l(()=>p[5]||(p[5]=[f("已显示字段")])),_:1}),a(oe),a(b(bt),{"force-fallback":!0,"scroll-sensitivity":200,ref:"el",modelValue:k.value,"onUpdate:modelValue":p[1]||(p[1]=z=>k.value=z),onStart:B,onUpdate:q,onEnd:ue,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(ae,null,ie(k.value,(z,he)=>(t(),r("div",{key:he},[V("div",Dt,[V("span",null,C(z.verbose_name),1),a(ge,null,{default:l(()=>[a(b(at),{onClick:Ue=>te(z)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[V("div",Ft,[a(ne,{onClick:O},{default:l(()=>p[6]||(p[6]=[f("取消")])),_:1}),a(ne,{type:"primary",onClick:Oe},{default:l(()=>p[7]||(p[7]=[f("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),It=Tl(Ut,[["__scopeId","data-v-3859704e"]]),Pt={class:"dialog-footer"},Nt=cl({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(ce){const pe=Ca(),W=il(ce,"showAllPassDia"),M=E(()=>pe.gmCry),L=i(),k=el({secret:null,time:3});i(""),i(!1);const A=async se=>{se.validate(async O=>{O&&(k.secret===M.value.key?(Ze({title:"操作成功",message:"解密成功,"+k.time+"分钟后过期！",type:"success",duration:2e3}),pe.updateShowAllPass(!0),W.value=!1,pe.setShowAllPassTime(k.time*60*1e3),fe(L.value)):Ze({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},fe=se=>{se&&se.resetFields()},h=()=>{W.value=!1,fe(L.value)};return(se,O)=>{const ve=c("el-input"),te=c("el-form-item"),B=c("el-input-number"),ue=c("el-form"),q=c("el-button"),P=c("el-dialog");return t(),u(P,{modelValue:W.value,"onUpdate:modelValue":O[3]||(O[3]=le=>W.value=le),title:"查看密码",width:"400"},{footer:l(()=>[V("div",Pt,[a(q,{onClick:h},{default:l(()=>O[5]||(O[5]=[f("取消")])),_:1}),a(q,{type:"primary",onClick:O[2]||(O[2]=le=>A(L.value))},{default:l(()=>O[6]||(O[6]=[f(" 查看 ")])),_:1})])]),default:l(()=>[a(ue,{ref_key:"allPassFormRef",ref:L,inline:!0,model:k,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(te,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(ve,{type:"password",modelValue:k.secret,"onUpdate:modelValue":O[0]||(O[0]=le=>k.secret=le),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(te,{label:"有效时间",prop:"time"},{default:l(()=>[a(B,{modelValue:k.time,"onUpdate:modelValue":O[1]||(O[1]=le=>k.time=le),min:1,step:1,max:30},{suffix:l(()=>O[4]||(O[4]=[V("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),St={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Tt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},jt={style:{width:"100%",overflow:"auto"}},qt={class:"listItem"},Rt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Et={style:{"margin-right":"5px"}},Lt={style:{float:"left"}},At={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},zt={key:0},Yt={key:1},Bt={key:0},Jt={key:1},Kt={key:2},Ht={key:3},Wt={style:{flex:"auto"}},Gt=cl({__name:"ciDataFilter",props:Ke(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:Ke(["getCiData","updateFilterParam"],["update:showFilter"]),setup(ce,{expose:pe,emit:W}){const M=ce,L=il(ce,"showFilter"),k=i(""),A=i(""),fe=E(()=>k.value===""?te.value:te.value.filter(v=>v.verbose_name.includes(k.value)));function h(){L.value=!1}const se=v=>{le.value.push(v)},O=v=>{let p=q.filterParams.indexOf(v);le.value.splice(p,1)},ve=(v,p)=>{v==="instance_name"?q.instance_name="":le.value.splice(p,1),Me(()=>{B("updateFilterParam",G.value)})},te=E(()=>M.allModelField.filter(v=>!le.value.includes(v)));i({});const B=W,ue=i(""),q=el({filterParams:[],instance_name:""}),P=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"包含",description:"包含以,分隔"},{value:"not:in:",label:"不包含",description:"不包含以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"!null",label:"非空",description:"正则表达式"}]),le=i([]),G=E(()=>{let v=new Object;return q.filterParams.forEach(p=>{if(p.match==="null"||p.match==="!null"){v[p.name]=p.match;return}if(p.value!==""){let R=null;p.value!==null?R=p.value:R="null",p.match==="="?v[p.name]=R:v[p.name]=p.match+R}}),q.instance_name!==""&&(v.instance_name=q.instance_name),v}),Q=()=>{console.log(G.value),B("updateFilterParam",G.value),console.log(G.value),Me(()=>{B("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId})}),L.value=!1},Oe=E(()=>{var v;return(v=q.filterParams)==null?void 0:v.map(p=>p.name)});Sl(()=>le.value,v=>{var R;let p=new Array;(R=le.value)==null||R.forEach((oe,ye)=>{var ge;if(((ge=Oe.value)==null?void 0:ge.indexOf(oe.name))>>>-1)p.push({name:oe.name,value:"",match:"=",label:oe.verbose_name});else{let ne=q.filterParams.findIndex(J=>J.name===oe.name);p.push(q.filterParams[ne])}}),q.filterParams=p},{deep:!0});const U=v=>{v&&(v.resetFields(),B("updateFilterParam",G.value),Me(()=>{B("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId})}))};return pe({removeFilterParam:ve}),(v,p)=>{const R=c("el-text"),oe=c("el-divider"),ye=c("el-input"),ge=c("el-icon"),ne=c("el-form-item"),J=c("el-button"),z=c("el-option"),he=c("el-select"),Ue=c("el-switch"),K=c("el-space"),He=c("el-form"),Be=c("el-drawer");return t(),u(Be,{modelValue:L.value,"onUpdate:modelValue":p[4]||(p[4]=$=>L.value=$),direction:"rtl",size:"50%","before-close":h},{header:l(()=>[a(R,{tag:"b"},{default:l(()=>p[5]||(p[5]=[f("筛选")])),_:1})]),default:l(()=>[V("div",St,[V("div",Tt,[a(R,{tag:"b"},{default:l(()=>p[6]||(p[6]=[f("模型字段")])),_:1}),a(oe),a(ye,{modelValue:k.value,"onUpdate:modelValue":p[0]||(p[0]=$=>k.value=$),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:A},null,8,["modelValue"]),V("div",jt,[(t(!0),r(ae,null,ie(fe.value,($,Pe)=>(t(),r("div",{key:Pe},[V("div",qt,[V("span",null,C($.verbose_name),1),a(ge,null,{default:l(()=>[a(b(wa),{onClick:N=>se($)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),V("div",Rt,[a(R,{tag:"b"},{default:l(()=>p[7]||(p[7]=[f("过滤器")])),_:1}),a(oe),a(He,{ref_key:"filterFormRef",ref:ue,model:q,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(K,{wrap:""},{default:l(()=>[a(ne,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(ye,{modelValue:q.instance_name,"onUpdate:modelValue":p[1]||(p[1]=$=>q.instance_name=$),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(ae,null,ie(q.filterParams,($,Pe)=>(t(),u(ne,{key:$.index,prop:"filterParams."+Pe+".value"},{label:l(()=>[V("span",Et,C($.label),1),a(J,{icon:b(ba),size:"small",circle:"",onClick:hl(N=>O($),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(K,null,{default:l(()=>[a(he,{modelValue:$.match,"onUpdate:modelValue":N=>$.match=N,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(ae,null,ie(P.value,N=>(t(),u(z,{key:N.value,label:N.label,value:N.value},{default:l(()=>[V("span",Lt,C(N.label),1),V("span",At,C(N.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),$.match==="null"||$.match==="!null"?(t(),r("div",zt)):(t(),r("div",Yt,[["enum"].indexOf(M.allModelFieldByNameObj[$.name].type)>>>-1?["model_ref"].indexOf(M.allModelFieldByNameObj[$.name].type)>>>-1?["boolean"].indexOf(M.allModelFieldByNameObj[$.name].type)>>>-1?(t(),r("div",Ht,[a(ye,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Kt,[a(Ue,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Jt,[a(he,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ae,null,ie(M.modelRefOptions[$.name],N=>(t(),u(z,{key:N.value,label:N.label,value:N.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Bt,[a(he,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ae,null,ie(M.enumOptionObj[M.allModelFieldByNameObj[$.name].validation_rule],N=>(t(),u(z,{key:N.value,label:N.label,value:N.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[V("div",Wt,[a(J,{onClick:p[2]||(p[2]=$=>U(ue.value))},{default:l(()=>p[8]||(p[8]=[f("重置")])),_:1}),a(J,{onClick:p[3]||(p[3]=$=>Q()),type:"primary"},{default:l(()=>p[9]||(p[9]=[f("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),Qt=Tl(Gt,[["__scopeId","data-v-6ac62773"]]),Xt={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},Zt={class:"table-header"},eo={class:"header-button-lf"},lo={class:"header-button-ri"},ao={class:"flexJstart gap-1",style:{overflow:"auto"}},to={class:"text_class"},oo={key:0,class:"text_class"},no={key:1},so={style:{"margin-left":"12px"}},uo={key:1,class:"requiredClass"},ro={key:0},io={key:0},co={key:1},po={key:0},fo={key:1},vo={key:0},mo={key:1},_o={key:0},yo={key:1},go={key:0},bo={key:0},wo={key:0},ko={key:1},ho={key:0},Co={key:1},xo={key:0},Vo={key:1},Mo={key:0},Oo={key:1},$o={key:0},Do={key:1},Fo={key:0},Uo={key:1},Io={style:{flex:"auto"},class:"footerButtonClass"},Po={key:0},No={key:1},So={key:0},To={key:1},jo={key:0},qo={key:0},Ro={key:1},Eo={key:2},Lo={key:3},Ao={key:4},zo={key:5},Yo={key:6},Bo={key:7},Jo={key:8},Ko={key:9},Ho={class:"dialog-footer"},Wo={class:"dialog-footer"},Go=cl({__name:"ciDataShow",props:Ke(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:Ke(["getTree"],["update:showTree"]),setup(ce,{expose:pe,emit:W}){const{proxy:M}=Nl(),L=Ca(),k=ka(),A=tt(),fe=W,h=ce,se=il(ce,"showTree"),O=i([0]),ve=i(!1),te=()=>{ve.value=!0},B=i(!0),ue=()=>{B.value=!1,Me(()=>{B.value=!0})},q=i(""),P=()=>{ve.value=!1},le=i(!1),G=E(()=>L.gmCry),Q=E(()=>L.showAllPass),Oe=E(()=>L.showAllPassTime),U=async()=>{le.value=!0},v=()=>{L.updateShowAllPass(!1),Ze({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},p=s=>{L.setShowAllPassTime(s.totalMilliseconds)},R=()=>{le.value=!1,L.updateShowAllPass(!1),L.setShowAllPassTime(0),Ze({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},oe=i(!1),ye=()=>{z.value=!1,ze(ge.value[0]),J.value=""},ge=i(),ne=el({secret:null}),J=i(""),z=i(!1),he=async(s,e)=>{s[0].validate(async d=>{d&&(ne.secret===G.value.key?(J.value=Hl(G.value.key,G.value.mode,e),z.value=!0):(Ze({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),z.value=!1,J.value=""))})},Ue=i(1),K=i(10),He=i("default"),Be=i(!1),$=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},Pe=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},N=E(()=>Ml.value.map(s=>s.name)),ll=E(()=>bl.value.map(s=>s.name)),Je=i(!1),al=async()=>{(await M.$api.bulkDeleteCiModelInstance({instances:yl.value})).status=="200"?(I({type:"success",message:"删除成功"}),El.value.clearSelection(),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({type:"error",message:"删除失败"})},We=async s=>{s?await M.$api.exportCiData({model:h.ciModelId,fields:ll.value,instances:yl.value}):await M.$api.exportCiData({model:h.ciModelId,fields:N.value,instances:yl.value})},tl=async()=>{let s=await M.$api.exportCiData({model:h.ciModelId});console.log(s)},w={multiple:!0,value:"id"},_=i(!1),S=i([]),ol=E(()=>h.treeData[0].children[0].id),nl=async()=>{var d;let s=[];(d=S.value)==null||d.forEach(T=>{s.push(T[T.length-1])});let e=await M.$api.setCiDataToTree({instances:yl.value,groups:s});e.status=="201"?(I({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),Gl(),fe("getTree")):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}),S.value=[],_.value=!1},Cl=i(""),Ge=i(!1),j=i({}),Le=(s,e)=>{s?F.updateParams[e]="null":F.updateParams[e]=null},pl=()=>{Ge.value=!0,console.log(F)},jl=s=>{var e;if(s!==void 0&&((e=Te.value[s])==null?void 0:e.field_type)==="string")return s==""||s==null?void 0:[{pattern:new RegExp(Te.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]};E(()=>{var e,d;let s={};return(d=(e=Se.value)==null?void 0:e.field_groups)==null||d.forEach(T=>{T.fields.forEach(y=>{var re;y.type==="string"&&y.validation_rule!==""&&y.validation_rule!==null&&(s["updateParams."+y.name]=[{pattern:new RegExp((re=Te.value[y.validation_rule])==null?void 0:re.rule),message:"不符合正则表达式",trigger:"blur"}])})}),s});const F=el({updateParams:{}}),Ne=i([]),fl=()=>{const s=Object.keys(F.updateParams).length,e=`__temp_param_${s}`;Ne.value[s]=e,F.updateParams[e]=""},ql=(s,e)=>{console.log(e),F.updateParams[e]=void 0,delete F.updateParams[Ne.value[s]],Ne.value[s]=e},de=(s,e)=>{Ne.value.splice(s,1),delete j.value[e],delete F.updateParams[e]},$e=E(()=>{let s=new Object;for(let[e,d]of Object.entries(F.updateParams))d==="null"?s[e]=null:s[e]=d,me.value.password.indexOf(e)!==-1&&(s[e]=Kl(G.value.key,G.value.mode,d));return s}),xl=()=>{Cl.value.validate(async s=>{if(s){let e=await M.$api.multipleUpdateCiModelInstance({update_user:A.state.username,instances:yl.value,fields:$e.value});e.status=="200"?(I({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),F.updateParams={},j.value={},Ne.value=[],Ge.value=!1):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else I({showClose:!0,message:"请输入正确内容.",type:"error"})})},De=E(()=>{var e,d;let s=new Array;return(d=(e=Se.value)==null?void 0:e.field_groups)==null||d.forEach(T=>{T.fields.forEach(y=>{let re=!1;y.name in F.updateParams&&(re=!0),s.push({value:y.name,label:y.verbose_name,disable:re})})}),s}),vl=()=>{Ge.value=!1,F.updateParams={},j.value={},Ne.value=[]},ml=i(!0),_l=s=>{ml.value=s},Vl=i(!0),X=i(!1),Rl=i(!1),xa=()=>{Rl.value=!0},Va=async s=>{_l(!0);let e=await M.$api.updateCiModelInstance({update_user:A.state.username,...s});e.status=="200"?(I({type:"success",message:"更新成功"}),we.value=!1,ze(Qe.value),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},Ma=()=>!0,El=i(null),Oa=s=>s.id,Ae=i([]),yl=E(()=>{var e;let s=[];return(e=Ae.value)==null||e.forEach(d=>{s.push(d.id)}),s}),$a=s=>{Ae.value=s},Gl=()=>{Ae.value=[],El.value.clearSelection()},Ml=i([]),Se=i({}),Da=E(()=>{var e,d;let s={};return(d=(e=Se.value)==null?void 0:e.field_groups)==null||d.forEach(T=>{T.fields.forEach(y=>{s[y.id]=y})}),s}),_e=E(()=>{var e,d;let s={};return(d=(e=Se.value)==null?void 0:e.field_groups)==null||d.forEach(T=>{T.fields.forEach(y=>{s[y.name]=y})}),s}),Ql=i(""),Fa=()=>{Ql.value.getHasConfigField()},Xl=()=>{Vl.value=!1,Me(()=>{Vl.value=!0})},Ua=s=>s.map(d=>d.id===ol.value).length>>0,Te=i({});i({});const Ia=async(s=null)=>{(await M.$api.getValidationRules({...s,page:1,page_size:1e4})).data.results.forEach(d=>{Te.value[d.id]=d})},Ll=E(()=>{var e,d;let s={};return(d=(e=Se.value)==null?void 0:e.field_groups)==null||d.forEach(T=>{T.fields.forEach(y=>{if(y.type==="enum"){if(y.validation_rule===null)return;let re=JSON.parse(Te==null?void 0:Te.value[y==null?void 0:y.validation_rule].rule),Xe=[];Object.keys(re).forEach(ul=>{Xe.push({value:ul,label:re[ul]})}),s[y.validation_rule]=Xe}})}),s}),Zl=E(()=>{let s={};return Se.value.field_groups.forEach(e=>{e.fields.forEach(d=>{if(d.type==="enum"){let T=JSON.parse(Te.value[d.validation_rule].rule),y={};Object.keys(T).forEach(re=>{y[re]=T[re]}),s[d.name]=y}})}),s}),gl=i({}),Pa=async(s,e)=>{let d=await M.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),T=[];d.data.results.forEach(y=>{T.push({value:y.id,label:y.instance_name})}),gl.value[e.name]=T},Na=E(()=>{let s=new Object;for(let[e,d]of Object.entries(gl.value)){let T=new Object;d==null||d.forEach(y=>{T[y.value]=y}),s[e]=T}return s}),Sa=s=>{if(!(s==""||s==null))return[{pattern:new RegExp(Te.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]},Ta=()=>{Se.value.field_groups.forEach(s=>{s.fields.forEach(e=>{g[e.name]=e.default})})},bl=i([]),ja=async()=>{var d;let s=await M.$api.getCiModel({},h.ciModelId);Se.value=s.data;let e=[];(d=Se.value.field_groups)==null||d.forEach(T=>{T.fields.forEach(y=>{e.push(y)})}),bl.value=e},me=E(()=>{let s={enum:[],boolean:[],model_ref:[],password:[]};return bl.value.forEach(e=>{e.type==="enum"?s.enum.push(e.name):e.type==="boolean"?s.boolean.push(e.name):e.type==="model_ref"?s.model_ref.push(e.name):e.type==="password"&&s.password.push(e.name)}),s});Sl(()=>me.value.model_ref,s=>{me.value.model_ref.forEach(e=>{Pa(!0,{id:_e.value[e].ref_model,name:e})})},{deep:!0});const ea=i([]),la=i(0),Al=i({}),aa=s=>{Al.value=s},ta=E(()=>{let s=new Array;for(let[e,d]of Object.entries(Al.value))console.log(),e==="instance_name"?s.push({name:"唯一标识:"+d,field:e}):me.value.model_ref.indexOf(e)!==-1?s.push({name:_e.value[e].verbose_name+":"+Na.value[e][d].label,field:e}):me.value.enum.indexOf(e)!==-1?(console.log(Zl.value),s.push({name:_e.value[e].verbose_name+":"+Zl.value[e][d],field:e})):s.push({name:_e.value[e].verbose_name+":"+d,field:e});return s}),qa=async(s,e)=>{await q.value.removeFilterParam(s,e),Me(()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})})},Ce=async s=>{var T;_l(!0);let e=new Array,d=await M.$api.getCiModelInstance({...s,page:Ue.value,page_size:K.value,...Al.value});la.value=d.data.count,(T=d.data.results)==null||T.forEach(y=>{e.push({id:y.id,instance_group:y.instance_group,instance_name:y.instance_name,...y.fields})}),ea.value=e,_l(!1)};ha(async()=>{Vl.value=!0,await Ia(),_l(!1)});const we=i(!1),Ra=()=>{X.value=!0,we.value=!0,qe.value=!0},je=i({}),Ol=i({}),oa=(s,e=!1)=>{we.value=!0,qe.value=!1,X.value=e,je.value=s,Me(()=>{Object.keys(s).forEach(d=>{d==="id"||d==="instance_group"||(me.value.model_ref.indexOf(d)!==-1&&s[d]!==null?g[d]=s[d].id:g[d]=s[d])}),Ol.value=JSON.parse(JSON.stringify(g))})},Ea=s=>{we.value=!0,qe.value=!0,X.value=!0,je.value=s,Me(()=>{Object.keys(s).forEach(e=>{e==="id"||e==="instance_group"||(me.value.model_ref.indexOf(e)!==-1?s[e]!==null?g[e]=s[e].id:g[e]=s[e]:me.value.enum.indexOf(e)!==-1?g[e]=s[e].value:me.value.password.indexOf(e)!==-1||(g[e]=s[e]))})}),Ze({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},Qe=i(),g=el({instance_name:null}),na=E(()=>{let s=Object.assign({},g);delete s.instance_name;for(let[e,d]of Object.entries(s))d!==null&&me.value.password.indexOf(e)!==-1&&(s[e]=Kl(G.value.key,G.value.mode,d));return s}),sa=E(()=>{let s=Object.assign({},sl.value);delete s.instance_name,console.log(me.value);for(let[e,d]of Object.entries(sl.value))d!==null&&me.value.password.indexOf(e)!==-1&&(s[e]=Kl(G.value.key,G.value.mode,d));return s}),qe=i(!0),sl=i({}),ua=async(s,e=null)=>{s&&await s.validate(async(d,T)=>{if(d)if(qe.value){console.log(na.value);let y=await M.$api.addCiModelInstance({model:h.ciModelId,create_user:A.state.username,update_user:A.state.username,fields:na.value,instance_name:g.instance_name,instance_group:[h.currentNodeId]});y.status=="201"?(I({type:"success",message:"添加成功"}),we.value=!1,ze(s),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),fe("getTree")):I({showClose:!0,message:"添加失败:"+JSON.stringify(y.data),type:"error"})}else{if(console.log(JSON.stringify(Ol.value)),console.log(JSON.stringify(g)),JSON.stringify(Ol.value)===JSON.stringify(g)){X.value=!1,we.value=!1,ze(s),I({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}else{const Xe=Object.entries(Ol.value),ul=Object.entries(g),Y=Xe.concat(ul).map(Ie=>JSON.stringify(Ie)),Dl=Array.from(new Set(Y)).map(Ie=>JSON.parse(Ie));Dl.splice(0,Xe.length);const Z=Object.fromEntries(Dl);let Fl={};if(Object.keys(Z).forEach(Ie=>{Fl[Ie]=Z[Ie]}),sl.value=Fl,Object.keys(sl.value).length===0){X.value=!1,we.value=!1,ze(s),I({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let y={id:je.value.id,model:h.ciModelId,update_user:A.state.username};Object.keys(sl.value).indexOf("instance_name")===-1||(y.instance_name=sl.value.instance_name),y.fields=sa.value,console.log(me.value),console.log(y),console.log();let re=await M.$api.updateCiModelInstance(y);re.status=="200"?(I({type:"success",message:"更新成功"}),we.value=!1,X.value=!1,ze(s),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({showClose:!0,message:"更新失败:"+JSON.stringify(re.data),type:"error"})}else console.log("error submit!",T),Ze({title:"表单校验",message:"表单填写异常",type:"error"})})},La=s=>{if(X.value==!1&&qe.value==!1){we.value=!1;return}Wl.confirm("是否确认关闭?").then(()=>{s(),ze(Qe.value),we.value=!1,X.value=!1}).catch(()=>{})},Aa=s=>{ze(s),we.value=!1,X.value=!1},da=(s=null)=>{Wl.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await M.$api.deleteCiModelInstance(je.value.id)).status==204?(I({type:"success",message:"删除成功"}),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),ze(Qe.value),we.value=!1,X.value=!1,fe("getTree")):I({type:"error",message:"删除失败"})}).catch(()=>{I({type:"info",message:"取消删除"})})},ze=s=>{s&&(s.resetFields(),je.value={})},$l=i("modelField"),za=(s,e)=>{console.log($l.value)};return pe({getHasConfigField:Fa,getCiData:Ce,initCiDataForm:Ta,getModelField:ja,setLoading:_l,closeFilter:P,clearMultipleSelect:Gl,updateFilterParam:aa,reloadCiDataFilter:ue}),(s,e)=>{var ma,_a,ya;const d=c("el-button"),T=c("arrow-down"),y=c("el-icon"),re=c("el-dropdown-item"),Xe=c("el-dropdown-menu"),ul=c("el-dropdown"),Y=c("el-tooltip"),Dl=c("vue-countdown"),Z=c("el-text"),Fl=c("el-tag"),Ie=c("el-table-column"),ra=c("el-link"),Ye=c("el-switch"),Ya=c("a-qrcode"),ia=c("el-popover"),Ba=c("el-table"),Ja=c("el-pagination"),ca=c("el-descriptions-item"),Ka=c("el-descriptions"),xe=c("el-space"),Re=c("el-input"),be=c("el-form-item"),Ha=c("InfoFilled"),zl=c("el-input-number"),Yl=c("el-col"),pa=c("el-row"),Bl=c("el-form"),Ul=c("el-date-picker"),wl=c("el-option"),kl=c("el-select"),Wa=c("el-collapse-item"),Ga=c("el-collapse"),Il=c("el-tab-pane"),Qa=c("el-tabs"),Xa=c("el-drawer"),fa=c("el-dialog"),Za=c("el-cascader"),ke=rl("permission"),et=rl("loading"),lt=rl("copy"),va=rl("throttle");return t(),r(ae,null,[Vl.value?(t(),r("div",Xt,[V("div",Zt,[V("div",eo,[se.value?(t(),u(d,{key:0,icon:b(ot),onClick:e[0]||(e[0]=n=>se.value=!1),size:"default"},null,8,["icon"])):(t(),u(d,{key:1,icon:b(nt),onClick:e[1]||(e[1]=n=>se.value=!0),size:"default"},null,8,["icon"])),H((t(),u(d,{type:"primary",onClick:Ra},{default:l(()=>e[31]||(e[31]=[f("添加")])),_:1})),[[ke,`${(ma=b(k).name)==null?void 0:ma.replace("_info","")}:add`]]),H((t(),u(d,{disabled:!(Ae.value.length>>>0),onClick:e[2]||(e[2]=n=>_.value=!0)},{default:l(()=>e[32]||(e[32]=[f("转移")])),_:1},8,["disabled"])),[[ke,`${(_a=b(k).name)==null?void 0:_a.replace("_info","")}:edit`]]),H((t(),u(d,{disabled:!(Ae.value.length>>>0),onClick:pl},{default:l(()=>e[33]||(e[33]=[f("批量更新")])),_:1},8,["disabled"])),[[ke,`${(ya=b(k).name)==null?void 0:ya.replace("_info","")}:edit`]]),a(ul,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(Xe,null,{default:l(()=>{var n,ee;return[H((t(),r("div",null,[a(re,{disabled:!(Ae.value.length>>>0),onClick:e[3]||(e[3]=o=>al())},{default:l(()=>e[35]||(e[35]=[f("批量删除")])),_:1},8,["disabled"])])),[[ke,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:delete`]]),H((t(),r("div",null,[a(re,{disabled:!(Ae.value.length>>>0),onClick:e[4]||(e[4]=o=>We(!1))},{default:l(()=>e[36]||(e[36]=[f("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(re,{disabled:!(Ae.value.length>>>0),onClick:e[5]||(e[5]=o=>We(!0))},{default:l(()=>e[37]||(e[37]=[f("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(re,{onClick:e[6]||(e[6]=o=>tl())},{default:l(()=>e[38]||(e[38]=[f("导出所有")])),_:1})])),[[ke,`${(ee=b(k).name)==null?void 0:ee.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(d,{type:"primary"},{default:l(()=>[e[34]||(e[34]=f(" 更多操作")),a(y,{class:"el-icon--right"},{default:l(()=>[a(T)]),_:1})]),_:1})]),_:1})]),V("div",lo,[a(Y,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(d,{icon:b(st),circle:"",onClick:Xl},null,8,["icon"])]),_:1}),Q.value?x("",!0):(t(),u(Y,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var n;return[H(a(d,{icon:b(Jl),circle:"",onClick:U},null,8,["icon"]),[[ke,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:showPassword`]])]}),_:1})),Q.value?(t(),u(Y,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[39]||(e[39]=[V("span",null,[f("倒计时结束后自动隐藏密码"),V("br"),f("手动点击可立马隐藏")],-1)])),default:l(()=>[a(d,{circle:"",onClick:R},{default:l(()=>[a(Dl,{time:Oe.value,onEnd:v,onProgress:p},{default:l(({totalSeconds:n})=>[f(C(n),1)]),_:1},8,["time"])]),_:1})]),_:1})):x("",!0),a(Y,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(d,{icon:b(ut),circle:"",onClick:xa},null,8,["icon"])]),_:1}),a(Y,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var n;return[H(a(d,{icon:b(dt),circle:"",onClick:e[7]||(e[7]=ee=>Je.value=!0)},null,8,["icon"]),[[ke,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:import`]])]}),_:1}),a(Y,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(d,{icon:b(rt),circle:"",onClick:te},null,8,["icon"])]),_:1})])]),H(V("div",ao,[a(Z,{tag:"b"},{default:l(()=>e[40]||(e[40]=[f("过滤器")])),_:1}),(t(!0),r(ae,null,ie(ta.value,(n,ee)=>(t(),u(Fl,{key:n.name,closable:"",type:"primary",onClose:o=>qa(n.field,ee)},{default:l(()=>[V("span",null,C(n.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Pl,ta.value.length>>>0]]),H((t(),u(Ba,{ref_key:"ciDataTableRef",ref:El,data:ea.value,onSelectionChange:$a,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":Oa},{default:l(()=>[a(Ie,{type:"selection",selectable:Ma,width:"55","reserve-selection":!0}),a(Ie,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(ae,null,ie(Ml.value,(n,ee)=>(t(),u(Ie,{property:n.name,label:n.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120"},it({_:2},[n.name==="mgmt_ip"?{name:"default",fn:l(o=>[a(ra,{href:`https://${o.row[n.name]}`,type:"primary",target:"_blank"},{default:l(()=>[f(C(o.row[n.name]),1)]),_:2},1032,["href"])]),key:"0"}:void 0,me.value.boolean.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[H(a(Ye,{modelValue:o.row[n.name],"onUpdate:modelValue":D=>o.row[n.name]=D,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:D=>Va({id:o.row.id,fields:{[n.name]:o.row[n.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[ke,{id:`${(m=b(k).name)==null?void 0:m.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,me.value.enum.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[V("div",to,C((m=o.row[n.name])==null?void 0:m.label),1)]}),key:"2"}:void 0,me.value.password.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[Q.value?(t(),r("div",oo,C(b(Hl)(G.value.key,G.value.mode,o.row[n.name])),1)):(t(),r("div",no,[((m=o.row[n.name])==null?void 0:m.length)>>0?(t(),u(Z,{key:0},{default:l(()=>e[41]||(e[41]=[f("******")])),_:1})):(t(),u(Z,{key:1}))]))]}),key:"3"}:void 0,me.value.model_ref.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m,D;return[V("div",{class:Fe({text_class:((m=o.row[n.name])==null?void 0:m.instance_name)>>0})},C((D=o.row[n.name])==null?void 0:D.instance_name),3)]}),key:"4"}:void 0]),1032,["property","label"]))),256)),a(Ie,{fixed:"right",width:"150",label:"操作"},{default:l(n=>[a(Y,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(d,{link:"",type:"primary",icon:b(Jl),onClick:ee=>oa(n.row)},null,8,["icon","onClick"])]),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var ee;return[H(a(d,{link:"",type:"primary",icon:b(ct),onClick:o=>oa(n.row,!0)},null,8,["icon","onClick"]),[[ke,`${(ee=b(k).name)==null?void 0:ee.replace("_info","")}:edit`]])]}),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var ee;return[H(a(d,{link:"",type:"primary",icon:b(ga),onClick:o=>Ea(n.row)},null,8,["icon","onClick"]),[[ke,`${(ee=b(k).name)==null?void 0:ee.replace("_info","")}:edit`]])]}),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>[V("span",so,[a(ia,{placement:"bottom",title:"实例二维码",width:250,trigger:"click"},{reference:l(()=>[a(d,{link:"",type:"primary",icon:b(pt)},null,8,["icon"])]),default:l(()=>[a(Ya,{value:JSON.stringify(n.row),size:200},null,8,["value"])]),_:2},1024)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[et,ml.value]]),a(Ja,{"current-page":Ue.value,"onUpdate:currentPage":e[8]||(e[8]=n=>Ue.value=n),"page-size":K.value,"onUpdate:pageSize":e[9]||(e[9]=n=>K.value=n),"page-sizes":[10,20,50,100,200],size:He.value,disabled:Be.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:la.value,onSizeChange:$,onCurrentChange:Pe,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[a(Z,null,{default:l(()=>[f("已选择 "+C(Ae.value.length)+" 条",1)]),_:1})]),_:1},8,["current-page","page-size","size","disabled","total"])])):x("",!0),a(Xa,{modelValue:we.value,"onUpdate:modelValue":e[20]||(e[20]=n=>we.value=n),class:"edit-drawer",direction:"rtl",size:"45%","before-close":La},{header:l(()=>[qe.value?(t(),u(Z,{key:1,tag:"b"},{default:l(()=>e[42]||(e[42]=[f("实例信息 ")])),_:1})):(t(),u(Ka,{key:0,title:"实例信息"},{default:l(()=>[a(ca,{label:"唯一标识"},{default:l(()=>{var n;return[f(C((n=je.value)==null?void 0:n.instance_name),1)]}),_:1}),a(ca,{label:"所属分组"},{default:l(()=>{var n;return[(t(!0),r(ae,null,ie((n=je.value)==null?void 0:n.instance_group,(ee,o)=>(t(),u(Z,{key:o},{default:l(()=>[f(C(ee.group_path),1)]),_:2},1024))),128))]}),_:1})]),_:1}))]),default:l(()=>[a(Qa,{modelValue:$l.value,"onUpdate:modelValue":e[15]||(e[15]=n=>$l.value=n),type:"card",class:"demo-tabs",onTabClick:za},{default:l(()=>[a(Il,{label:"资产信息",name:"modelField"},{default:l(()=>[a(Bl,{ref_key:"ciDataFormRef",ref:Qe,style:{"max-width":"100%"},model:g,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[X.value?(t(),u(be,{key:0,prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>e[43]||(e[43]=[f("唯一标识")])),_:1}),a(Y,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:1})]),_:1})]),default:l(()=>[X.value?(t(),u(Re,{key:0,modelValue:g.instance_name,"onUpdate:modelValue":e[10]||(e[10]=n=>g.instance_name=n),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",uo,C(g.instance_name),1))]),_:1})):x("",!0),a(Ga,{modelValue:O.value,"onUpdate:modelValue":e[14]||(e[14]=n=>O.value=n)},{default:l(()=>[(t(!0),r(ae,null,ie(Se.value.field_groups,(n,ee)=>(t(),u(Wa,{name:ee,key:ee},{title:l(()=>[a(Z,{tag:"b",size:"large"},{default:l(()=>[f(C(n.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(pa,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(ae,null,ie(n.fields,(o,m)=>(t(),u(Yl,{span:12},{default:l(()=>[o.type==="string"?(t(),u(be,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:Sa(o.validation_rule)},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(Re,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ro,[g[o.name]!=null?(t(),r("div",io,[o.name==="mgmt_ip"?(t(),u(ra,{key:0,href:`https://${g[o.name]}`,type:"primary",target:"_blank"},{default:l(()=>[f(C(g[o.name]),1)]),_:2},1032,["href"])):(t(),r("span",{key:1,class:Fe(["text_class",{requiredClass:o.required}])},C(g[o.name]),3))])):(t(),r("span",co,"--"))]))]),_:2},1032,["label","prop","required","rules"])):x("",!0),o.type==="json"?(t(),u(be,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),a(Y,{placement:"right",effect:"dark"},{content:l(()=>e[44]||(e[44]=[f(" json类型字段"),V("br",null,null,-1),f("请输入json格式数据! ")])),default:l(()=>[a(y,null,{default:l(()=>[a(Ha)]),_:1})]),_:1}),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(Re,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",po,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",fo,"--"))]))]),_:2},1032,["label","prop","required"])):x("",!0),["text"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(Re,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",vo,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",mo,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),u(be,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[a(Ye,{modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!X.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):x("",!0),["float"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),u(Z,{key:0,tag:"b"},{default:l(()=>[f(C(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),u(Z,{key:1,tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),u(Y,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(zl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",_o,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",yo,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>{var D,Ee;return[X.value?(t(),u(Re,{key:1,modelValue:g[o.name],"onUpdate:modelValue":dl=>g[o.name]=dl,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",go,[((D=g[o.name])==null?void 0:D.length)>>0?(t(),r("div",bo,[Q.value?(t(),r("span",wo,C(b(Hl)(G.value.key,G.value.mode,g[o.name])),1)):(t(),r("span",{key:1,class:Fe({requiredClass:o.required}),onMouseenter:e[12]||(e[12]=dl=>oe.value=!0),onMouseleave:e[13]||(e[13]=dl=>oe.value=!1)},[e[46]||(e[46]=f("******** ")),H((t(),u(ia,{width:380,trigger:"click",onAfterLeave:ye},{reference:l(()=>[a(y,null,{default:l(()=>[H(a(b(Jl),null,null,512),[[Pl,oe.value&&!Q.value]])]),_:1})]),default:l(()=>[a(Bl,{ref_for:!0,ref_key:"passFormRef",ref:ge,inline:!0,model:ne,"require-asterisk-position":"right"},{default:l(()=>[a(pa,{align:"middle"},{default:l(()=>[a(Yl,{span:20},{default:l(()=>[a(be,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(Re,{type:"password",modelValue:ne.secret,"onUpdate:modelValue":e[11]||(e[11]=dl=>ne.secret=dl),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(Yl,{span:2},{default:l(()=>[a(be,null,{default:l(()=>[a(d,{type:"primary",size:"small",onClick:dl=>he(ge.value,g[o.name])},{default:l(()=>e[45]||(e[45]=[f("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),z.value?(t(),u(Z,{key:0,tag:"b"},{default:l(()=>[f("密码: "+C(J.value)+" ",1),a(Y,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(y,null,{default:l(()=>[H(a(b(ga),null,null,512),[[lt,J.value]])]),_:1})]),_:1})]),_:1})):x("",!0)]),_:2},1024)),[[ke,`${(Ee=b(k).name)==null?void 0:Ee.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",ko,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),u(Z,{key:0,tag:"b"},{default:l(()=>[f(C(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),u(Z,{key:1,tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),u(Y,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(zl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ho,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",Co,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(Ul,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",xo,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},C(g[o.name]),3)):(t(),r("span",Vo,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(Ul,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Mo,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},C(g[o.name]),3)):(t(),r("span",Oo,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>{var D;return[X.value?(t(),u(kl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":Ee=>g[o.name]=Ee,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(ae,null,ie(Ll.value[o.validation_rule],Ee=>(t(),u(wl,{key:Ee.value,label:Ee.label,value:Ee.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",$o,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},C((D=je.value[o.name])==null?void 0:D.label),3)):(t(),r("span",Do,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?x("",!0):(t(),u(be,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(Z,{tag:"b"},{default:l(()=>[f(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):x("",!0)]),_:2},1024)]),default:l(()=>[X.value?(t(),u(kl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(ae,null,ie(gl.value[o.name],(D,Ee)=>(t(),u(wl,{key:Ee,label:D.label,value:D.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",Fo,[g[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},C(je.value[o.name].name),3)):(t(),r("span",Uo,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1}),qe.value?x("",!0):(t(),u(Il,{key:0,label:"监控信息",name:"monitor",disabled:""},{default:l(()=>e[47]||(e[47]=[f("111")])),_:1})),qe.value?x("",!0):(t(),u(Il,{key:1,label:"关联关系",name:"relations",disabled:""},{default:l(()=>e[48]||(e[48]=[f("222")])),_:1})),qe.value?x("",!0):(t(),u(Il,{key:2,label:"变更记录",name:"changelog",disabled:""},{default:l(()=>e[49]||(e[49]=[f("Role")])),_:1}))]),_:1},8,["modelValue"])]),footer:l(()=>{var n,ee,o,m;return[H(V("div",Io,[a(d,{onClick:e[16]||(e[16]=D=>Aa(Qe.value))},{default:l(()=>e[50]||(e[50]=[f("取消")])),_:1}),qe.value?(t(),r("div",Po,[a(d,{type:"primary",onClick:e[17]||(e[17]=D=>ua(Qe.value))},{default:l(()=>e[51]||(e[51]=[f("添加")])),_:1})])):(t(),r("div",No,[X.value?(t(),r("div",So,[Ua((n=je.value)==null?void 0:n.instance_group)?H((t(),u(d,{key:0,type:"danger",onClick:da},{default:l(()=>e[52]||(e[52]=[f("删除")])),_:1})),[[ke,`${(ee=b(k).name)==null?void 0:ee.replace("_info","")}:delete`]]):H((t(),u(Y,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(d,{type:"danger",onClick:da,disabled:""},{default:l(()=>e[53]||(e[53]=[f("删除")])),_:1})]),_:1})),[[ke,`${(o=b(k).name)==null?void 0:o.replace("_info","")}:delete`]]),H((t(),u(d,{type:"primary",onClick:e[18]||(e[18]=D=>ua(Qe.value))},{default:l(()=>e[54]||(e[54]=[f("保存")])),_:1})),[[va]])])):(t(),r("div",To,[H((t(),u(d,{type:"primary",onClick:e[19]||(e[19]=D=>X.value=!0)},{default:l(()=>e[55]||(e[55]=[f("编辑")])),_:1})),[[ke,`${(m=b(k).name)==null?void 0:m.replace("_info","")}:edit`]])]))]))],512),[[Pl,$l.value==="modelField"]])]}),_:1},8,["modelValue"]),a(fa,{modelValue:Ge.value,"onUpdate:modelValue":e[22]||(e[22]=n=>Ge.value=n),title:"批量更新",width:"500","before-close":vl},{footer:l(()=>[V("div",Ho,[a(d,{onClick:vl},{default:l(()=>e[56]||(e[56]=[f("取消")])),_:1}),a(d,{onClick:e[21]||(e[21]=hl(n=>fl(),["prevent"]))},{default:l(()=>e[57]||(e[57]=[f("新增字段")])),_:1}),H((t(),u(d,{type:"primary",onClick:xl,disabled:!(Ne.value.length>0)},{default:l(()=>e[58]||(e[58]=[f("保存")])),_:1},8,["disabled"])),[[va]])])]),default:l(()=>[a(Bl,{ref_key:"multipleFormRef",ref:Cl,style:{"max-width":"1000px"},model:F,"label-width":"auto"},{default:l(()=>[(t(!0),r(ae,null,ie(Ne.value,(n,ee)=>{var o;return t(),u(be,{key:`param-${n}`,label:"字段"+(ee+1),prop:`updateParams.${n}`,rules:jl((o=_e.value[n])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(xe,null,{default:l(()=>[a(kl,{"model-value":n.startsWith("__temp")?void 0:n,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:m=>ql(ee,m)},{default:l(()=>[(t(!0),r(ae,null,ie(De.value,m=>(t(),u(wl,{key:m.value,label:m.label,value:m.value,disabled:m.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),n&&!n.startsWith("__temp")?(t(),r("div",jo,[["text","json"].indexOf(_e.value[n].type)>>>-1?["string"].indexOf(_e.value[n].type)>>>-1?["enum"].indexOf(_e.value[n].type)>>>-1?["model_ref"].indexOf(_e.value[n].type)>>>-1?["boolean"].indexOf(_e.value[n].type)>>>-1?["integer"].indexOf(_e.value[n].type)>>>-1?["float"].indexOf(_e.value[n].type)>>>-1?["date"].indexOf(_e.value[n].type)>>>-1?["datetime"].indexOf(_e.value[n].type)>>>-1?(t(),r("div",Ko,[a(Re,{modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Jo,[a(Ye,{modelValue:j.value[n],"onUpdate:modelValue":m=>j.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Le(j.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),j.value[n]?x("",!0):(t(),u(Ul,{key:0,modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Bo,[a(Ye,{modelValue:j.value[n],"onUpdate:modelValue":m=>j.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Le(j.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),j.value[n]?x("",!0):(t(),u(Ul,{key:0,modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Yo,[a(Ye,{modelValue:j.value[n],"onUpdate:modelValue":m=>j.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Le(j.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),j.value[n]?x("",!0):(t(),u(zl,{key:0,modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",zo,[a(Ye,{modelValue:j.value[n],"onUpdate:modelValue":m=>j.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Le(j.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),j.value[n]?x("",!0):(t(),u(Re,{key:0,modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Ao,[a(Ye,{modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Lo,[a(kl,{modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(ae,null,ie(gl.value[n],(m,D)=>(t(),u(wl,{key:D,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Eo,[a(kl,{modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ae,null,ie(Ll.value[_e.value[n].validation_rule],m=>(t(),u(wl,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Ro,[a(Ye,{modelValue:j.value[n],"onUpdate:modelValue":m=>j.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Le(j.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),j.value[n]?x("",!0):(t(),u(Re,{key:0,modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",qo,[a(Ye,{modelValue:j.value[n],"onUpdate:modelValue":m=>j.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Le(j.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),j.value[n]?x("",!0):(t(),u(Re,{key:0,modelValue:F.updateParams[n],"onUpdate:modelValue":m=>F.updateParams[n]=m,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):x("",!0),a(d,{class:"mt-2",icon:b(ft),circle:"",onClick:hl(m=>de(ee,n),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(fa,{modelValue:_.value,"onUpdate:modelValue":e[25]||(e[25]=n=>_.value=n),title:"实例组编辑",width:"500"},{footer:l(()=>[V("div",Wo,[a(d,{onClick:e[24]||(e[24]=n=>_.value=!1)},{default:l(()=>e[59]||(e[59]=[f("取消")])),_:1}),a(d,{type:"primary",onClick:nl},{default:l(()=>e[60]||(e[60]=[f(" 提交更新 ")])),_:1})])]),default:l(()=>[a(Za,{options:h.treeData,props:w,clearable:"",modelValue:S.value,"onUpdate:modelValue":e[23]||(e[23]=n=>S.value=n),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),B.value?(t(),u(Ct,{key:1,isShowUpload:Je.value,"onUpdate:isShowUpload":e[26]||(e[26]=n=>Je.value=n),ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,onGetCiData:Ce},null,8,["isShowUpload","ciModelId","currentNodeId"])):x("",!0),B.value?(t(),u(Qt,{key:2,ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,allModelFieldByNameObj:_e.value,enumOptionObj:Ll.value,validationRulesObj:Te.value,allModelField:bl.value,modelRefOptions:gl.value,showFilter:ve.value,"onUpdate:showFilter":e[27]||(e[27]=n=>ve.value=n),onUpdateFilterParam:aa,onGetCiData:Ce,ref_key:"ciDataFilterRef",ref:q},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):x("",!0),a(It,{ciModelId:h.ciModelId,allModelField:bl.value,allModelFieldInfo:Da.value,isShowTableCol:Rl.value,"onUpdate:isShowTableCol":e[28]||(e[28]=n=>Rl.value=n),hasConfigField:Ml.value,"onUpdate:hasConfigField":e[29]||(e[29]=n=>Ml.value=n),onReloadTable:Xl,ref_key:"ciDataTableColRef",ref:Ql},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(Nt,{showAllPassDia:le.value,"onUpdate:showAllPassDia":e[30]||(e[30]=n=>le.value=n)},null,8,["showAllPassDia"])],64)}}}),Qo=Tl(Go,[["__scopeId","data-v-336971e4"]]),Xo=vt("ci",()=>{const ce=i([]),pe=el({filterParams:[]});i([]);const W=i([]);return i({}),{setFilterList:A=>{console.log(A),W.value=A,console.log(W.value)},saveFilterParams:A=>{console.log(A),pe.filterParams=A},setModelList:A=>{ce.value=A}}},{persist:!0}),Zo={class:"card ci_data_tree"},en={class:"custom-tree-node"},ln={class:"table-box"},an=cl({__name:"cidataView",setup(ce){const pe=ka(),{proxy:W}=Nl(),M=i(!0),L=Xo(),k=i(""),A=i(!1);i(""),i(!1);const fe=i(),h=i([]),se=i("");Sl(se,w=>{Q.value.filter(w)});const O=(w,_)=>w?_.label.toLowerCase().includes(w.toLowerCase()):!0,ve=w=>!(w.level>al.value-1||w.label==="空闲池"),te=async()=>{A.value=!0;let w=await W.$api.getCiModelTree({model:ue.value});console.log(w),h.value=[w.data],Me(()=>{U.value===1&&(Q.value.setCurrentKey(w.data.id),U.value=Q.value.getCurrentKey())}),A.value=!1},B=i([]),ue=i(""),q=async()=>{let w=await W.$api.getCiModel();B.value=w.data.results,L.setModelList(B.value),k.value=B.value.find(_=>_.name==="hosts"),ue.value=B.value.find(_=>_.name==="hosts").id};E(()=>{let w={};return B.value.forEach(_=>{w[_.id]=_}),w});const P=i(""),le=async()=>{U.value=1,await te(),await P.value.closeFilter(),await P.value.updateFilterParam({}),await P.value.clearMultipleSelect(),P.value.reloadCiDataFilter(),await P.value.setLoading(!0),await P.value.getModelField(),await P.value.getHasConfigField(),await P.value.setLoading(!1),await P.value.initCiDataForm(),await P.value.getCiData({model:ue.value,model_instance_group:U.value})};ha(async()=>{console.log(123),await q(),await te(),P.value.setLoading(!0),await P.value.getModelField(),await P.value.getHasConfigField(),await P.value.setLoading(!1),await P.value.initCiDataForm(),await P.value.getCiData({model:ue.value,model_instance_group:Q.value.getCurrentKey()})});const G=w=>w.built_in?!1:w.children?!(w.children.length>>>0):!0,Q=i(),Oe=i(),U=i(1),v=i(!1),p=i(100),R=(w,_)=>{z.value=!1;let S=p.value++;Q.value.append({id:S,label:"新建子目录",level:_.level+1,parent:_.id,model:k.value.id},w),Q.value.setCurrentKey(S),ne.value=S,Me(()=>{Oe.value.focus()})},oe=(w,_)=>{let S=p.value++;z.value=!1,Q.value.insertAfter({id:S,label:"新建目录",level:_.level,parent:w.parent.data.id,model:k.value.id},w),Q.value.setCurrentKey(S),ne.value=S,Me(()=>{Oe.value.focus()})},ye=()=>{U.value=Q.value.getCurrentKey(),P.value.clearMultipleSelect(),P.value.setLoading(!0),P.value.getCiData({model:ue.value,model_instance_group:Q.value.getCurrentKey()}),P.value.setLoading(!0)},ge=w=>{v.value=!v.value,w.isShowEdit=v.value},ne=i(99999),J=i(""),z=i(!0),he=w=>{z.value=!0,console.log(w),J.value=w.label,ne.value=w.id,Me(()=>{Oe.value.focus()})},Ue=async(w,_)=>{if(ne.value=99999,!J.value)I.warning("名称不可为空"),Q.value.remove(_);else if(z.value){if(J.value==_.label)return!1;{let S=await W.$api.updateCiModelTree({id:_.id,label:J.value});S.status=="200"?(I({type:"success",message:"更新成功"}),_.label=J.value,te(),J.value=""):I({showClose:!0,message:"更新失败:"+JSON.stringify(S.data),type:"error"}),console.log(_)}}else{_.label=J.value,console.log(_);let S=await W.$api.addCiModelTree(_);S.status=="201"?(I({type:"success",message:"添加成功"}),te(),J.value=""):(I({showClose:!0,message:"添加失败:"+JSON.stringify(S.data),type:"error"}),Q.value.remove(_))}},K=w=>{w&&Wl.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await W.$api.deleteCiModelTree(w.data.id)).status==200?(I({type:"success",message:"删除成功"}),await te()):I({type:"error",message:"删除失败"})}).catch(()=>{})},He=i(""),Be=(w,_)=>{He.value=w,console.log(He.value)},$=(w,_,S)=>{},Pe=(w,_,S)=>{},N=(w,_,S)=>{},ll=async(w,_,S,ol)=>{if(_.data.id===w.data.id)return;let nl=await W.$api.updateCiModelTree({id:w.data.id,target_id:_.data.id,position:S});nl.status=="200"?(I({type:"success",message:"更新排序成功"}),te()):I({showClose:!0,message:"更新排序失败:"+JSON.stringify(nl.data),type:"error"})},Je=(w,_,S,ol)=>{},al=i(5),We=(w,_,S)=>_.data.built_in?!1:S!=="inner",tl=w=>!w.data.built_in;return(w,_)=>{const S=c("el-text"),ol=c("el-col"),nl=c("el-option"),Cl=c("el-select"),Ge=c("el-row"),j=c("el-divider"),Le=c("el-input"),pl=c("a-menu-item"),jl=c("a-menu"),F=c("a-dropdown"),Ne=c("el-space"),fl=rl("permission"),ql=rl("loading");return t(),r(ae,null,[H(V("div",Zo,[a(Ge,{align:"middle",justify:"start"},{default:l(()=>[a(ol,{span:8},{default:l(()=>[a(S,{tag:"b"},{default:l(()=>_[7]||(_[7]=[f("实例树")])),_:1})]),_:1}),a(ol,{span:14},{default:l(()=>[a(Cl,{modelValue:ue.value,"onUpdate:modelValue":_[0]||(_[0]=de=>ue.value=de),placeholder:"Select",onChange:_[1]||(_[1]=de=>le())},{default:l(()=>[(t(!0),r(ae,null,ie(B.value,de=>(t(),u(nl,{key:de.id,label:de.verbose_name,value:de.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(j),a(Le,{modelValue:se.value,"onUpdate:modelValue":_[2]||(_[2]=de=>se.value=de),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),H((t(),u(b(gt),{style:{"max-width":"280px",height:"auto"},"allow-drop":We,"allow-drag":tl,data:h.value,draggable:!0,"default-expand-all":"","node-key":"id",onNodeDragStart:Be,onNodeDragEnter:$,onNodeDragLeave:Pe,onNodeDragOver:N,onNodeDragEnd:ll,onNodeDrop:Je,"highlight-current":!0,"current-node-key":U.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:Q,onNodeClick:ye,"filter-node-method":O},{default:l(({node:de,data:$e})=>{var xl;return[V("div",en,[ne.value===$e.id?(t(),u(Le,{key:0,modelValue:J.value,"onUpdate:modelValue":_[3]||(_[3]=De=>J.value=De),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:Oe,onBlur:De=>Ue(De,$e),onKeyup:_[4]||(_[4]=mt(De=>De.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),u(S,{key:1,size:"default"},{default:l(()=>[f(C(de.label),1),a(S,{size:"small"},{default:l(()=>[f("("+C($e.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),H((t(),r("div",{class:Fe(["actionClass",{is_show_action:de.isShowEdit}])},[a(Ne,null,{default:l(()=>[$e.built_in?x("",!0):(t(),u(b(_t),{key:0,onClick:hl(De=>he($e),["stop"])},null,8,["onClick"])),a(F,{trigger:["click"],ref_key:"aDropdownRef",ref:fe,onOpenChange:De=>ge(de)},{overlay:l(()=>[a(jl,null,{default:l(()=>{var De,vl;return[H((t(),r("div",null,[$e.level!==1?(t(),u(pl,{key:"0",onClick:ml=>oe(de,$e)},{default:l(()=>_[8]||(_[8]=[f(" 添加同级节点 ")])),_:2},1032,["onClick"])):x("",!0),ve($e)?(t(),u(pl,{key:"1",onClick:ml=>R(de,$e)},{default:l(()=>_[9]||(_[9]=[f(" 添加子节点 ")])),_:2},1032,["onClick"])):x("",!0)])),[[fl,`${(De=b(pe).name)==null?void 0:De.replace("_info","")}:add`]]),H((t(),r("div",null,[G($e)?(t(),u(pl,{key:"2",onClick:ml=>K(de)},{default:l(()=>_[10]||(_[10]=[f(" 删除节点 ")])),_:2},1032,["onClick"])):x("",!0)])),[[fl,`${(vl=b(pe).name)==null?void 0:vl.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(b(yt),{onClick:_[5]||(_[5]=hl(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[fl,`${(xl=b(pe).name)==null?void 0:xl.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[ql,A.value]])],512),[[Pl,M.value]]),V("div",ln,[a(Qo,{ciModelId:ue.value,treeData:h.value,currentNodeId:U.value,ref_key:"ciDataShowRef",ref:P,onGetTree:te,showTree:M.value,"onUpdate:showTree":_[6]||(_[6]=de=>M.value=de)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),un=Tl(an,[["__scopeId","data-v-405018f6"]]);export{un as default};
