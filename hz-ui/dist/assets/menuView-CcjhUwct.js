import{i as Ee}from"./iconSelectCom-CG0ZrC11.js";import{d as ye,aB as we,bu as Le,b as ge,r as i,c as ue,e as s,b3 as de,o as b,f as Z,g as e,w as t,j as $,t as he,bO as h,O as x,bo as d,bZ as Ve,b_ as ke,h as L,F as ce,aD as Ce,bV as pe,c1 as c,k as xe,_ as $e,u as Te,aN as qe,b1 as be,Y as Ie,cl as Je,P as ie}from"./index-PyXmV4Ip.js";import{I as ve}from"./iconify-D8dB9NOx.js";const je={class:"dialog-footer"},Ae=ye({__name:"menuButtonCom",props:we(["nowMenu"],{showDrawer:{},showDrawerModifiers:{}}),emits:we(["getMenuData"],["update:showDrawer"]),setup(K,{expose:C,emit:w}){const{proxy:S}=xe(),p=K,T=w,M=Le(K,"showDrawer"),q=ge(),B=i(),I=i([]);C({updateMenuButtonList:f=>{I.value=f}});const X=()=>{M.value=!1},v=i(!1),V=()=>{v.value=!1},m=ue({name:"",action:"",menu:""}),y=i(!0),n=()=>{v.value=!0,y.value=!0,m.menu=p.nowMenu.id},D=f=>{v.value=!0,y.value=!1,Ce(()=>{Object.keys(m).forEach(r=>{m[r]=f[r]}),m.id=f.id,m.menu=f.menu})},J=async()=>{let f=await S.$api.getButton({menu:p.nowMenu.id});I.value=f.data.results},ee=f=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await S.$api.deleteButton(f.id)).status==204?(c({type:"success",message:"删除成功"}),await J(),T("getMenuData")):c({type:"error",message:"删除失败"})}).catch(()=>{c({type:"info",message:"取消删除"})})},le=()=>{B.value.validate(async f=>{if(f)if(y.value){let r=await S.$api.addButton(m);r.status==201?(v.value=!1,B.value.resetFields(),J(),T("getMenuData")):c({showClose:!0,message:"添加失败:"+JSON.stringify(r.data),type:"error"})}else{let r=await S.$api.updateButton(m);r.status==200?(v.value=!1,B.value.resetFields(),J(),T("getMenuData")):c({showClose:!0,message:"更新失败:"+JSON.stringify(r.data),type:"error"})}else c({showClose:!0,message:"请输入正确内容.",type:"error"})})};return(f,r)=>{const Y=s("el-text"),G=s("el-col"),U=s("el-button"),te=s("el-row"),oe=s("el-divider"),j=s("el-table-column"),N=s("el-tooltip"),ae=s("el-table"),ne=s("el-drawer"),P=s("el-input"),F=s("el-form-item"),W=s("el-form"),H=s("el-dialog"),A=de("permission");return b(),Z(ce,null,[e(ne,{modelValue:M.value,"onUpdate:modelValue":r[0]||(r[0]=o=>M.value=o),title:"菜单按钮编辑",direction:"rtl","before-close":X,size:"30%"},{default:t(()=>[e(te,{justify:"space-between"},{default:t(()=>[e(G,{span:5},{default:t(()=>[e(Y,{size:"large",tag:"b"},{default:t(()=>[$("菜单："+he(p.nowMenu.label),1)]),_:1})]),_:1}),e(G,{span:2},{default:t(()=>{var o;return[h((b(),x(U,{type:"primary",onClick:n},{default:t(()=>r[5]||(r[5]=[$("添加")])),_:1})),[[A,`${(o=d(q).name)==null?void 0:o.replace("_info","")}:add`]])]}),_:1})]),_:1}),e(oe),e(ae,{border:"",data:I.value,style:{width:"100%"}},{default:t(()=>[e(j,{prop:"name",label:"按钮名称"}),e(j,{prop:"action",label:"按钮标识"}),e(j,{fixed:"right",label:"操作"},{default:t(o=>[e(N,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var l;return[h(e(U,{link:"",type:"primary",icon:d(Ve),onClick:k=>D(o.row)},null,8,["icon","onClick"]),[[A,`${(l=d(q).name)==null?void 0:l.replace("_info","")}:edit`]])]}),_:2},1024),e(N,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var l;return[h(e(U,{link:"",type:"danger",icon:d(ke),onClick:k=>ee(o.row)},null,8,["icon","onClick"]),[[A,`${(l=d(q).name)==null?void 0:l.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(H,{modelValue:v.value,"onUpdate:modelValue":r[4]||(r[4]=o=>v.value=o),title:"按钮配置",width:"400","before-close":V},{footer:t(()=>[L("div",je,[e(U,{onClick:r[3]||(r[3]=o=>v.value=!1)},{default:t(()=>r[6]||(r[6]=[$("取消")])),_:1}),e(U,{type:"primary",onClick:le},{default:t(()=>r[7]||(r[7]=[$(" 提交 ")])),_:1})])]),default:t(()=>[e(W,{inline:!0,model:m,ref_key:"formRef",ref:B,class:"demo-form-inline"},{default:t(()=>[e(F,{label:"按钮名称",required:"",prop:"name"},{default:t(()=>[e(P,{modelValue:m.name,"onUpdate:modelValue":r[1]||(r[1]=o=>m.name=o),placeholder:"中文名",clearable:""},null,8,["modelValue"])]),_:1}),e(F,{label:"按钮标识",placeholder:"英文标识",required:"",prop:"action"},{default:t(()=>[e(P,{modelValue:m.action,"onUpdate:modelValue":r[2]||(r[2]=o=>m.action=o),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ze=$e(Ae,[["__scopeId","data-v-1d81ac8e"]]),Ye={class:"card"},Ge={class:"role-menu"},Pe={style:{width:"100%"}},We={class:"user-header"},He=ye({__name:"menuView",setup(K){const C=ge(),w=Te(),S=i({}),{proxy:p}=xe();ue({search:""});const T=i(!1),M=i([]),q=i([]);i("auto");const B=i([{prop:"label",label:"菜单名称"},{prop:"icon",label:"图标"},{prop:"is_menu",label:"是否菜单"},{prop:"status",label:"启用"},{prop:"sort",label:"序号"},{prop:"path",label:"路由地址"},{prop:"name",label:"菜单编码"},{prop:"description",label:"描述"},{prop:"buttons",label:"权限按钮"}]);i(1);const I=i(10);i(!1),i(!1),i(!1);const Q=i(0),X=i(!1);i({}),qe(async()=>{await V()});const v=o=>(o.forEach(l=>{l.value=l.id,l.disabled=!!l.is_menu,l.children&&v(l.children)}),o),V=async()=>{let o=await p.$api.getMenuList();M.value=o.data.results,q.value=v(o.data.results),Q.value=o.data.count,Q.value<I.value&&(X.value=!0)},m=o=>{S.value=o},y=i(!1),n=ue({label:"",icon:"",sort:0,is_menu:!0,description:"",path:"",name:"",parentid:null,has_info:!1,info_view_name:"",is_iframe:!1,iframe_url:"",status:!0}),D=i("add"),J=()=>{D.value="add",y.value=!0},ee=()=>{y.value=!1,p.$refs.userFrom.resetFields()},le=o=>{pe.confirm("是否确认关闭?").then(()=>{o(),p.$refs.userFrom.resetFields()}).catch(()=>{})},f=()=>{p.$refs.userFrom.validate(async o=>{if(o)if(D.value=="add"){let l=await p.$api.menuAdd(n);l.status==201?(y.value=!1,p.$refs.userFrom.resetFields(),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):c({showClose:!0,message:"添加失败:"+JSON.stringify(l.data),type:"error"})}else{let l=await p.$api.menuUpdate({id:Y.value.id,...n});l.status==200?(y.value=!1,p.$refs.userFrom.resetFields(),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):c({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})}else c({showClose:!0,message:"请输入正确内容.",type:"error"})})},r=i(),Y=i({}),G=o=>{D.value="edit",Y.value=o,y.value=!0,Ce(()=>{Object.keys(n).forEach(l=>{n[l]=o[l]})}),console.log(n)},U=o=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await p.$api.menuDel(o.id)).status==204?(c({type:"success",message:"删除成功"}),await V(),await w.dispatch("getRoleMenu",{role:w.state.role})):c({type:"error",message:"删除失败"})}).catch(()=>{c({type:"info",message:"Delete canceled"})})},te=i([]),oe=(o,l)=>{},j=o=>{te.value=o},N=i(!1),ae=()=>{N.value=!0},ne=async o=>{let l=await p.$api.menuUpdate({status:o.status,id:o.id});l.status==200?(c({type:"success",message:"更新成功"}),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):c({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})},P=async o=>{let l=await p.$api.menuUpdate({is_menu:o.is_menu,id:o.id});l.status==200?(c({type:"success",message:"更新成功"}),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):c({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})},F=i(!1),W=i({}),H=i(null),A=o=>{F.value=!0,W.value=o,H.value.updateMenuButtonList(o.buttons)};return(o,l)=>{var _e;const k=s("el-button"),se=s("el-table-column"),R=s("el-switch"),Me=s("el-icon"),Ue=s("el-tag"),Se=s("el-space"),re=s("el-tooltip"),Be=s("el-table"),O=s("el-input"),_=s("el-form-item"),De=s("el-input-number"),Ne=s("el-tree-select"),me=s("el-col"),fe=s("el-row"),Fe=s("el-form"),Re=s("el-dialog"),E=de("permission"),Oe=de("loading");return b(),Z("div",Ye,[L("div",Ge,[L("div",Pe,[L("div",We,[L("div",null,[h((b(),x(k,{type:"primary",size:"small",onClick:J},{default:t(()=>l[16]||(l[16]=[$("+新增")])),_:1})),[[E,`${(_e=d(C).name)==null?void 0:_e.replace("_info","")}:add`]])])]),L("div",null,[h((b(),x(Be,{border:"",data:M.value,style:{width:"100%"},"max-height":"500px","highlight-current-row":"","row-key":"id","table-layout":"fixed",onSelectionChange:j,onRowClick:m},{default:t(()=>[e(se,{type:"selection",width:"55",selectable:oe}),(b(!0),Z(ce,null,be(B.value,a=>(b(),x(se,{key:a.prop,label:a.label,prop:a.prop},Ie({_:2},[a.prop==="is_menu"?{name:"default",fn:t(u=>{var g;return[h(e(R,{modelValue:u.row.is_menu,"onUpdate:modelValue":z=>u.row.is_menu=z,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:z=>P(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[E,{id:`${(g=d(C).name)==null?void 0:g.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,a.prop==="status"?{name:"default",fn:t(u=>{var g;return[h(e(R,{modelValue:u.row.status,"onUpdate:modelValue":z=>u.row.status=z,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:z=>ne(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[E,{id:`${(g=d(C).name)==null?void 0:g.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,a.prop==="icon"?{name:"default",fn:t(u=>[e(Me,null,{default:t(()=>[e(d(ve),{icon:u.row.icon},null,8,["icon"])]),_:2},1024)]),key:"2"}:void 0,a.prop==="buttons"?{name:"default",fn:t(u=>[e(Se,{wrap:""},{default:t(()=>[(b(!0),Z(ce,null,be(u.row.buttons,g=>(b(),x(Ue,{type:"success",round:"",effect:"plain",key:g.id},{default:t(()=>[$(he(g.name),1)]),_:2},1024))),128))]),_:2},1024)]),key:"3"}:void 0]),1032,["label","prop"]))),128)),e(se,{fixed:"right",label:"操作",width:"150"},{default:t(a=>[a.row.is_menu?(b(),x(re,{key:0,class:"box-item",effect:"dark",content:"编辑按钮",placement:"top"},{default:t(()=>{var u;return[h(e(k,{link:"",type:"primary",icon:d(Je),onClick:g=>A(a.row)},null,8,["icon","onClick"]),[[E,`${(u=d(C).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024)):ie("",!0),e(re,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var u;return[h(e(k,{link:"",type:"primary",icon:d(Ve),onClick:g=>G(a.row)},null,8,["icon","onClick"]),[[E,`${(u=d(C).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),e(re,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var u;return[h(e(k,{link:"",type:"danger",icon:d(ke),onClick:g=>U(a.row)},null,8,["icon","onClick"]),[[E,`${(u=d(C).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Oe,T.value]])])])]),e(Re,{modelValue:y.value,"onUpdate:modelValue":l[14]||(l[14]=a=>y.value=a),title:D.value=="add"?"新增菜单":"编辑菜单",width:"40%","before-close":le},{default:t(()=>[e(Fe,{inline:!0,model:n,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"userFrom","status-icon":""},{default:t(()=>[e(_,{label:"菜单名称",prop:"label",rules:[{required:!0}]},{default:t(()=>[e(O,{modelValue:n.label,"onUpdate:modelValue":l[0]||(l[0]=a=>n.label=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(_,{label:"菜单标识",prop:"name",rules:[{required:!0}]},{default:t(()=>[e(O,{modelValue:n.name,"onUpdate:modelValue":l[1]||(l[1]=a=>n.name=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(_,{label:"路由",prop:"path"},{default:t(()=>[e(O,{modelValue:n.path,"onUpdate:modelValue":l[2]||(l[2]=a=>n.path=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(_,{label:"图标",prop:"icon",rules:[{required:!0}]},{default:t(()=>[e(k,{onClick:ae},{default:t(()=>[e(d(ve),{icon:n.icon},null,8,["icon"])]),_:1}),e(Ee,{isShow:N.value,"onUpdate:isShow":l[3]||(l[3]=a=>N.value=a),iconName:n.icon,"onUpdate:iconName":l[4]||(l[4]=a=>n.icon=a)},null,8,["isShow","iconName"])]),_:1}),e(_,{label:"序号",prop:"sort"},{default:t(()=>[e(De,{modelValue:n.sort,"onUpdate:modelValue":l[5]||(l[5]=a=>n.sort=a),placeholder:"",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),e(_,{label:"父级节点",prop:"parentid"},{default:t(()=>[e(Ne,{modelValue:n.parentid,"onUpdate:modelValue":l[6]||(l[6]=a=>n.parentid=a),ref_key:"elTreeSelectRef",ref:r,data:M.value,clearable:"","check-strictly":"","render-after-expand":!1,"node-key":"id",style:{width:"180px"}},null,8,["modelValue","data"])]),_:1}),e(_,{label:"描述",prop:"description"},{default:t(()=>[e(O,{modelValue:n.description,"onUpdate:modelValue":l[7]||(l[7]=a=>n.description=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(_,{label:"启用",prop:"status",rules:[{required:!0}]},{default:t(()=>[e(R,{modelValue:n.status,"onUpdate:modelValue":l[8]||(l[8]=a=>n.status=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(_,{label:"是否菜单",prop:"is_menu",rules:[{required:!0}]},{default:t(()=>[e(R,{modelValue:n.is_menu,"onUpdate:modelValue":l[9]||(l[9]=a=>n.is_menu=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(_,{label:"详单"},{default:t(()=>[e(R,{modelValue:n.has_info,"onUpdate:modelValue":l[10]||(l[10]=a=>n.has_info=a),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),n.has_info?(b(),x(_,{key:0,label:"视图名"},{default:t(()=>[e(O,{modelValue:n.info_view_name,"onUpdate:modelValue":l[11]||(l[11]=a=>n.info_view_name=a),style:{width:"180px"}},null,8,["modelValue"])]),_:1})):ie("",!0),e(fe,null,{default:t(()=>[e(me,{span:6},{default:t(()=>[e(_,{label:"是否内嵌",prop:"is_iframe",rules:[{required:!0}]},{default:t(()=>[e(R,{modelValue:n.is_iframe,"onUpdate:modelValue":l[12]||(l[12]=a=>n.is_iframe=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),e(me,{span:18},{default:t(()=>[n.is_iframe?(b(),x(_,{key:0,label:"访问地址"},{default:t(()=>[e(O,{modelValue:n.iframe_url,"onUpdate:modelValue":l[13]||(l[13]=a=>n.iframe_url=a),style:{width:"300px"},type:"textarea"},null,8,["modelValue"])]),_:1})):ie("",!0)]),_:1})]),_:1}),e(fe,{style:{"justify-content":"space-around"}},{default:t(()=>[e(_,null,{default:t(()=>[e(k,{onClick:ee},{default:t(()=>l[17]||(l[17]=[$("取消")])),_:1}),e(k,{type:"primary",onClick:f},{default:t(()=>l[18]||(l[18]=[$(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(ze,{ref_key:"menuButtonComRef",ref:H,showDrawer:F.value,"onUpdate:showDrawer":l[15]||(l[15]=a=>F.value=a),nowMenu:W.value,onGetMenuData:V},null,8,["showDrawer","nowMenu"])])}}}),Xe=$e(He,[["__scopeId","data-v-3378911b"]]);export{Xe as default};
