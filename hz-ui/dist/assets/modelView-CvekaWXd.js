import{I as ee}from"./iconify-CL9CWqhW.js";import{i as Me}from"./iconSelectCom-CMqvf3xk.js";import{d as Ge,r as m,M as oe,c as R,a as xe,u as Se,b as ze,aN as Ie,e as a,b3 as Ne,o as n,f as G,h as b,g as l,w as t,bO as x,O as _,j as v,bo as C,F as O,b1 as A,t as D,c1 as p,bV as E,k as qe,_ as Ue}from"./index-IeLxcNDT.js";const he={class:"card"},Be={class:"groupCountClass"},Re={class:"number"},Oe={class:"operation_show groupCountClass"},De={class:"dialog-footer"},Pe={class:"dialog-footer"},Te=Ge({__name:"modelView",setup(Je){const{proxy:y}=qe(),S=m(!1),P=m(!1),T=oe(()=>{let o={};return J.value.forEach(e=>{o[e.model_group]?o[e.model_group]+=1:o[e.model_group]=1}),z.value.forEach(e=>{o.hasOwnProperty(e.id)||(o[e.id]=0)}),o}),le=oe(()=>{let o={};return J.value.forEach(e=>{o[e.model_group]?o[e.model_group].push(e):o[e.model_group]=[e]}),o}),w=m(!1),te=()=>{w.value=!1,N.value.resetFields()},z=m([]),I=async()=>{let o=await y.$api.getCiModelGroup();z.value=o.data.results},J=m([]),j=async()=>{let o=await y.$api.getCiModel();J.value=o.data.results},r=R({name:"",verbose_name:"",model_group:"",icon:"clarity:block-line",built_in:!1,create_user:"admin",update_user:"admin"}),N=m(),se=R({name:[{required:!0,message:"请输入模型标识",trigger:"blur"},{pattern:/^[a-z][a-z_]{3,20}$/,trigger:"blur",message:"以英文字符开头,只能使用英文和下划线,长度3-20 ",required:!0}],verbose_name:[{required:!0,message:"请输入模型名称",trigger:"blur"}],model_group:[{required:!0,message:"请选择分组",trigger:"blur"}]}),ae=async o=>{o&&await o.validate(async(e,d)=>{if(e)if(P.value){let i=await y.$api.addCiModel(r);i.status=="201"?(p({type:"success",message:"添加成功"}),w.value=!1,U(o),j()):p({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else console.log("不在这里更新");else console.log("error submit!",d)})},ne=o=>{E.confirm("是否确认关闭?").then(()=>{o(),U(N.value)}).catch(()=>{})},c=R({name:"",verbose_name:"",built_in:!1,create_user:"admin",update_user:"admin"}),re=R({name:[{required:!0,message:"请输入唯一标识",trigger:"blur"},{pattern:/^[a-z][\w\d]{4,20}$/,trigger:"blur",message:"以英文字符开头,可以使用英文,数字,下划线,长度4-20 ",required:!0}],verbose_name:[{required:!0,message:"请输入组名称",trigger:"blur"}]}),q=m(),g=m(!1),ue=()=>{g.value=!1,q.value.resetFields()},H=m(""),de=async o=>{o&&await o.validate(async(e,d)=>{if(e)if(S.value){let i=await y.$api.addCiModelGroup(c);i.status=="201"?(p({type:"success",message:"添加成功"}),g.value=!1,U(o),I()):p({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else{let i=await y.$api.updateCiModelGroup({id:H.value,...c});i.status=="200"?(p({type:"success",message:"更新成功"}),g.value=!1,U(o),I()):p({showClose:!0,message:"更新失败:"+JSON.stringify(i.data),type:"error"})}else console.log("error submit!",d)})},ie=o=>{E.confirm("是否确认关闭?").then(()=>{o(),q.value.resetFields()}).catch(()=>{})},U=o=>{o&&o.resetFields()},me=o=>{r.model_group=o,w.value=!0,P.value=!0},pe=o=>{g.value=!0,S.value=!1,c.name=o.name,c.verbose_name=o.verbose_name,H.value=o.id},ce=o=>{E.confirm("是否确认删除?","删除组",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{if(console.log(o),console.log(T.value[o]),T.value[o]>>>0){p({type:"error",message:"请先删除模型组内的模型后再删除组！"});return}let e=await y.$api.deleteCiModelGroup(o);e.status==204||e.status==200?p({type:"success",message:"删除成功"}):p({type:"error",message:"删除失败"}),I()}).catch(()=>{p({type:"info",message:"取消删除"})})},L=m(!1),_e=()=>{L.value=!0},fe=xe(),ve=Se(),f=ze(),ge=o=>{console.log(o);let e={name_id:o.id,label:ve.state.currentMenu+"-"+o.verbose_name,name:f.name+"_info",path:f.path+"/"+o.name,is_info:!0,query:{id:o.id}};console.log(e),fe.push({path:f.path+"/"+o.name,query:{id:o.id,verbose_name:o.verbose_name}})};return Ie(()=>{I(),j()}),(o,e)=>{const d=a("el-button"),i=a("el-col"),K=a("el-row"),be=a("CirclePlusFilled"),k=a("el-icon"),Q=a("el-tooltip"),Ce=a("Edit"),ye=a("DeleteFilled"),h=a("el-space"),we=a("InfoFilled"),W=a("el-text"),ke=a("el-card"),Ve=a("el-scrollbar"),V=a("el-form-item"),B=a("el-input"),$e=a("el-option"),Fe=a("el-select"),X=a("el-form"),Y=a("el-dialog"),F=Ne("permission");return n(),G(O,null,[b("div",he,[l(Ve,null,{default:t(()=>[l(K,{gutter:10},{default:t(()=>[l(i,{span:6},{default:t(()=>{var s,$;return[x((n(),_(d,{type:"primary",onClick:e[0]||(e[0]=u=>{w.value=!0,P.value=!0})},{default:t(()=>e[15]||(e[15]=[v("新增模型")])),_:1})),[[F,`${(s=C(f).name)==null?void 0:s.replace("_info","")}:add`]]),x((n(),_(d,{type:"default",onClick:e[1]||(e[1]=u=>{g.value=!0,S.value=!0})},{default:t(()=>e[16]||(e[16]=[v("新增分组")])),_:1})),[[F,`${($=C(f).name)==null?void 0:$.replace("_info","")}:add`]])]}),_:1})]),_:1}),(n(!0),G(O,null,A(z.value,(s,$)=>(n(),G("div",{key:$,class:"groupClass"},[l(K,null,{default:t(()=>[b("h2",null,D(s.verbose_name),1),b("div",Be,[b("span",Re,D(T.value[s.id]),1),b("div",Oe,[l(Q,{effect:"dark",content:"添加模型",placement:"right"},{default:t(()=>{var u;return[x((n(),_(k,{size:20,onClick:M=>me(s.id)},{default:t(()=>[l(be)]),_:2},1032,["onClick"])),[[F,`${(u=C(f).name)==null?void 0:u.replace("_info","")}:add`]])]}),_:2},1024),s.built_in?(n(),_(Q,{key:1,effect:"dark",content:"内置分组无法修改",placement:"right"},{default:t(()=>[l(k,{size:20},{default:t(()=>[l(we)]),_:1})]),_:1})):(n(),_(h,{key:0},{default:t(()=>{var u,M;return[x((n(),_(k,{size:20,onClick:Z=>pe(s)},{default:t(()=>[l(Ce)]),_:2},1032,["onClick"])),[[F,`${(u=C(f).name)==null?void 0:u.replace("_info","")}:edit`]]),x((n(),_(k,{size:20,onClick:Z=>ce(s.id)},{default:t(()=>[l(ye)]),_:2},1032,["onClick"])),[[F,`${(M=C(f).name)==null?void 0:M.replace("_info","")}:delete`]])]}),_:2},1024))])])]),_:2},1024),l(h,{wrap:"",size:30,alignment:"flex-start"},{default:t(()=>[(n(!0),G(O,null,A(le.value[s.id],(u,M)=>(n(),_(ke,{shadow:"hover",key:M,class:"modelCard",onClick:Z=>ge(u)},{default:t(()=>[l(h,{size:"large"},{default:t(()=>[l(k,{size:30},{default:t(()=>[l(C(ee),{icon:u.icon},null,8,["icon"])]),_:2},1024),l(h,{direction:"vertical",size:"small"},{default:t(()=>[l(W,null,{default:t(()=>[v(D(u.verbose_name),1)]),_:2},1024),l(W,{tag:"b"},{default:t(()=>[v(D(u.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]))),128))]),_:1})]),l(Y,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=s=>w.value=s),title:"新增模型",width:"500","before-close":ne},{footer:t(()=>[b("div",De,[l(d,{onClick:e[7]||(e[7]=s=>te())},{default:t(()=>e[17]||(e[17]=[v("取消")])),_:1}),l(d,{type:"primary",onClick:e[8]||(e[8]=s=>ae(N.value))},{default:t(()=>e[18]||(e[18]=[v(" 确认 ")])),_:1})])]),default:t(()=>[l(X,{ref_key:"modelFormRef",ref:N,style:{"max-width":"600px"},model:r,rules:se,"label-width":"auto",class:"demo-modelForm","status-icon":""},{default:t(()=>[l(V,{label:"模型图标",prop:"icon"},{default:t(()=>[l(d,{onClick:_e},{default:t(()=>[l(k,null,{default:t(()=>[l(C(ee),{icon:r.icon},null,8,["icon"])]),_:1})]),_:1}),l(Me,{isShow:L.value,"onUpdate:isShow":e[2]||(e[2]=s=>L.value=s),iconName:r.icon,"onUpdate:iconName":e[3]||(e[3]=s=>r.icon=s)},null,8,["isShow","iconName"])]),_:1}),l(V,{label:"唯一标识",prop:"name"},{default:t(()=>[l(B,{modelValue:r.name,"onUpdate:modelValue":e[4]||(e[4]=s=>r.name=s),placeholder:"请输入模型的唯一标识"},null,8,["modelValue"])]),_:1}),l(V,{label:"模型名称",prop:"verbose_name"},{default:t(()=>[l(B,{modelValue:r.verbose_name,"onUpdate:modelValue":e[5]||(e[5]=s=>r.verbose_name=s)},null,8,["modelValue"])]),_:1}),l(V,{label:"所属分组",prop:"model_group"},{default:t(()=>[l(Fe,{modelValue:r.model_group,"onUpdate:modelValue":e[6]||(e[6]=s=>r.model_group=s),placeholder:"选择分组"},{default:t(()=>[(n(!0),G(O,null,A(z.value,(s,$)=>(n(),_($e,{label:s.verbose_name,value:s.id,key:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(Y,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=s=>g.value=s),title:"新增模型组",width:"500","before-close":ie},{footer:t(()=>[b("div",Pe,[l(d,{onClick:e[12]||(e[12]=s=>ue())},{default:t(()=>e[19]||(e[19]=[v("取消")])),_:1}),l(d,{type:"primary",onClick:e[13]||(e[13]=s=>de(q.value))},{default:t(()=>e[20]||(e[20]=[v(" 确认 ")])),_:1})])]),default:t(()=>[l(X,{ref_key:"modelGroupFormRef",ref:q,style:{"max-width":"600px"},model:c,rules:re,"label-width":"auto",class:"demo-modelForm","status-icon":""},{default:t(()=>[l(V,{label:"模型组标识",prop:"name"},{default:t(()=>[l(B,{modelValue:c.name,"onUpdate:modelValue":e[10]||(e[10]=s=>c.name=s),disabled:!S.value},null,8,["modelValue","disabled"])]),_:1}),l(V,{label:"分组名称",prop:"verbose_name"},{default:t(()=>[l(B,{modelValue:c.verbose_name,"onUpdate:modelValue":e[11]||(e[11]=s=>c.verbose_name=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),je=Ue(Te,[["__scopeId","data-v-7c0ec78d"]]);export{je as default};
