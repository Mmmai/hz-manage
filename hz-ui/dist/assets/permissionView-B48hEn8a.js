<<<<<<<< HEAD:hz-ui/dist/assets/permissionView-B48hEn8a.js
import{d as ue,g as pe,bB as oe,r as f,v as F,B as ie,o as G,b_ as Y,aP as Z,z as be,h as v,bc as ye,c as ne,b as p,f as s,w as n,bV as fe,q as z,t as A,m as J,cA as ve,ca as ce,k as he,cB as we,ch as de,_ as ge,j as ke,x as Ce,aV as Ne,bP as je,n as Oe,C as Te,cC as $e,p as Pe}from"./index-Cm0tF2Sj.js";import{T as xe}from"./treeTransfer-0YCCccR7.js";import{m as Ve}from"./model-BRqCW4T7.js";const Me=ue({__name:"menuPermission",props:{nowNodeObject:{},nowNodeObjectModifiers:{},permissionObject:{},permissionObjectModifiers:{}},emits:["update:nowNodeObject","update:permissionObject"],setup(ee,{expose:Q}){const{proxy:y}=pe(),b=oe(ee,"nowNodeObject"),P=oe(ee,"permissionObject"),M=f([]),g=f([]),h=f([]),W=F(()=>{const i=JSON.parse(JSON.stringify(M.value));if(!h.value||!P.value)return console.log("没有权限数据或没有选中的对象",P.value),i;const d=new Map;h.value.forEach(I=>{d.has(I.button_id)||d.set(I.button_id,[]),d.get(I.button_id).push(I)});const k=I=>I.map(le=>{const T={...le},B=d.get(T.id);if(B&&B.length>0){const E=B.filter(K=>K.source_type!==P.value);if(E.length>0)if(T.disabled=!0,E.length===1){const K=E[0];T.disabledTooltip=`权限来源于${X(K.source_type)}:${K.source_name}，无法在此处修改`}else{const K=E.map(H=>`${X(H.source_type)}:${H.source_name}`).join("、");T.disabledTooltip=`权限同时被【${K}】授权，无法移除`}}return T.children&&T.children.length>0&&(T.children=k(T.children)),T});return k(i)}),X=i=>{switch(i){case"user":return"用户";case"role":return"角色";case"user_group":return"用户组";default:return"未知"}},R=async()=>{let i=await y.$api.getMenuTree();M.value=i.data.results},O=async()=>{let i=await y.$api.getPermissionHas(b.value);h.value=i.data.results,g.value=i.data.results.map(d=>d.button_id)},D=(i,d,k)=>{d=="right"?x(k):se(k)},x=async i=>{const d={...b.value,button_ids:i};let k=await y.$api.addObjectPermissions(d);k.status==200?(Y({type:"success",message:"权限添加成功"}),Z(()=>{O()})):Y({type:"error",message:`权限添加失败: ${JSON.stringify(k.data)}`})},se=async i=>{const d={...b.value,button_ids:i};let k=await y.$api.removeObjectPermissions(d);k.status==200?(Y({type:"success",message:"权限删除成功"}),Z(()=>{O()})):Y({type:"error",message:`权限删除失败: ${JSON.stringify(k.data)}`})};return Q({getPermissionTreeData:R,getPermissionOnRight:O}),(i,d)=>(G(),ie(xe,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=k=>g.value=k),data:W.value,"leaf-only":!0,"hide-fully-assigned-parents":!0,titles:["可选权限","已选权限"],"check-strictly":!1,onChange:D},null,8,["modelValue","data"]))}}),Re={class:"permission-container"},De={class:"permission-content"},Ie={class:"panel-header"},Ke={class:"panel-title"},qe={class:"panel-actions"},Ue={class:"tree-container"},Se={class:"custom-tree-node"},ze={class:"node-label"},Ee={class:"panel-header"},Fe={class:"panel-title"},Ge={class:"panel-actions"},Be={class:"tree-container"},He={class:"custom-tree-node"},Le={class:"node-label"},Ae={key:0,class:"instance-count"},Je={class:"footer-actions"},Qe=ue({__name:"cmdbPermission",props:{nowNodeObject:{},nowNodeObjectModifiers:{},permissionObject:{},permissionObjectModifiers:{}},emits:["update:nowNodeObject","update:permissionObject"],setup(ee,{expose:Q}){const{proxy:y}=pe(),b=Ve(),P=oe(ee,"nowNodeObject");oe(ee,"permissionObject");const M=f("");f("");const g=f(),h=f(),W=F(()=>b.allModels),X=F(()=>b.allModelCiDataObj),R=f([]),O=f([]),D=f([]),x=f([]),se={label:"verbose_name",children:"children"},i={modelgroups:"模型分组",models:"模型",modelfieldgroups:"字段组",modelfields:"字段",modelinstancegroup:"实例树",modelinstance:"实例"},d={modelgroups:"primary",models:"success",modelfieldgroups:"warning",modelfields:"info",modelinstancegroup:"warning",modelinstance:"info"},k=F(()=>{const l=R.value.length!==D.value.length||R.value.some(c=>!D.value.includes(c))||D.value.some(c=>!R.value.includes(c)),e=O.value.length!==x.value.length||O.value.some(c=>!x.value.includes(c))||x.value.some(c=>!O.value.includes(c));return l||e}),I=(l,e)=>{const c=new Map;e.results.forEach(r=>{c.has(r.target)||c.set(r.target,[]),c.get(r.target).push({owner_type:r.owner_type,owner_name:r.owner_name,owner_id:r.owner_id})});const m=(r,u=!1,C="")=>{const w={...r},N=c.get(r.id);let U=u,j=C;if(N&&!u){const a=N.filter(S=>S.owner_id!==Object.values(P.value)[0]);a.length>0&&(j=a.map(S=>{switch(S.owner_type){case"user":return`来自用户: ${S.owner_name}`;case"user_group":return`来自用户组: ${S.owner_name}`;case"role":return`来自角色: ${S.owner_name}`}}).join(`
========
import{d as ue,g as pe,bB as oe,r as f,v as F,B as ie,o as G,b_ as Y,aP as Z,z as be,h as v,bc as ye,c as ne,b as p,f as s,w as n,bV as fe,q as z,t as A,m as J,cA as ve,ca as ce,k as he,cB as we,ch as de,_ as ge,j as ke,x as Ce,aV as Ne,bP as je,n as Oe,C as Te,cC as $e,p as Pe}from"./index-D37lWo2y.js";import{T as xe}from"./treeTransfer-DY_GUiGZ.js";import{m as Ve}from"./model-q4opNTTD.js";const Me=ue({__name:"menuPermission",props:{nowNodeObject:{},nowNodeObjectModifiers:{},permissionObject:{},permissionObjectModifiers:{}},emits:["update:nowNodeObject","update:permissionObject"],setup(ee,{expose:Q}){const{proxy:y}=pe(),b=oe(ee,"nowNodeObject"),P=oe(ee,"permissionObject"),M=f([]),g=f([]),h=f([]),W=F(()=>{const i=JSON.parse(JSON.stringify(M.value));if(!h.value||!P.value)return console.log("没有权限数据或没有选中的对象",P.value),i;const d=new Map;h.value.forEach(I=>{d.has(I.button_id)||d.set(I.button_id,[]),d.get(I.button_id).push(I)});const k=I=>I.map(le=>{const T={...le},B=d.get(T.id);if(B&&B.length>0){const E=B.filter(K=>K.source_type!==P.value);if(E.length>0)if(T.disabled=!0,E.length===1){const K=E[0];T.disabledTooltip=`权限来源于${X(K.source_type)}:${K.source_name}，无法在此处修改`}else{const K=E.map(H=>`${X(H.source_type)}:${H.source_name}`).join("、");T.disabledTooltip=`权限同时被【${K}】授权，无法移除`}}return T.children&&T.children.length>0&&(T.children=k(T.children)),T});return k(i)}),X=i=>{switch(i){case"user":return"用户";case"role":return"角色";case"user_group":return"用户组";default:return"未知"}},R=async()=>{let i=await y.$api.getMenuTree();M.value=i.data.results},O=async()=>{let i=await y.$api.getPermissionHas(b.value);h.value=i.data.results,g.value=i.data.results.map(d=>d.button_id)},D=(i,d,k)=>{d=="right"?x(k):se(k)},x=async i=>{const d={...b.value,button_ids:i};let k=await y.$api.addObjectPermissions(d);k.status==200?(Y({type:"success",message:"权限添加成功"}),Z(()=>{O()})):Y({type:"error",message:`权限添加失败: ${JSON.stringify(k.data)}`})},se=async i=>{const d={...b.value,button_ids:i};let k=await y.$api.removeObjectPermissions(d);k.status==200?(Y({type:"success",message:"权限删除成功"}),Z(()=>{O()})):Y({type:"error",message:`权限删除失败: ${JSON.stringify(k.data)}`})};return Q({getPermissionTreeData:R,getPermissionOnRight:O}),(i,d)=>(G(),ie(xe,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=k=>g.value=k),data:W.value,"leaf-only":!0,"hide-fully-assigned-parents":!0,titles:["可选权限","已选权限"],"check-strictly":!1,onChange:D},null,8,["modelValue","data"]))}}),Re={class:"permission-container"},De={class:"permission-content"},Ie={class:"panel-header"},Ke={class:"panel-title"},qe={class:"panel-actions"},Ue={class:"tree-container"},Se={class:"custom-tree-node"},ze={class:"node-label"},Ee={class:"panel-header"},Fe={class:"panel-title"},Ge={class:"panel-actions"},Be={class:"tree-container"},He={class:"custom-tree-node"},Le={class:"node-label"},Ae={key:0,class:"instance-count"},Je={class:"footer-actions"},Qe=ue({__name:"cmdbPermission",props:{nowNodeObject:{},nowNodeObjectModifiers:{},permissionObject:{},permissionObjectModifiers:{}},emits:["update:nowNodeObject","update:permissionObject"],setup(ee,{expose:Q}){const{proxy:y}=pe(),b=Ve(),P=oe(ee,"nowNodeObject");oe(ee,"permissionObject");const M=f("");f("");const g=f(),h=f(),W=F(()=>b.allModels),X=F(()=>b.allModelCiDataObj),R=f([]),O=f([]),D=f([]),x=f([]),se={label:"verbose_name",children:"children"},i={modelgroups:"模型分组",models:"模型",modelfieldgroups:"字段组",modelfields:"字段",modelinstancegroup:"实例树",modelinstance:"实例"},d={modelgroups:"primary",models:"success",modelfieldgroups:"warning",modelfields:"info",modelinstancegroup:"warning",modelinstance:"info"},k=F(()=>{const l=R.value.length!==D.value.length||R.value.some(c=>!D.value.includes(c))||D.value.some(c=>!R.value.includes(c)),e=O.value.length!==x.value.length||O.value.some(c=>!x.value.includes(c))||x.value.some(c=>!O.value.includes(c));return l||e}),I=(l,e)=>{const c=new Map;e.results.forEach(r=>{c.has(r.target)||c.set(r.target,[]),c.get(r.target).push({owner_type:r.owner_type,owner_name:r.owner_name,owner_id:r.owner_id})});const m=(r,u=!1,C="")=>{const w={...r},N=c.get(r.id);let U=u,j=C;if(N&&!u){const a=N.filter(S=>S.owner_id!==Object.values(P.value)[0]);a.length>0&&(j=a.map(S=>{switch(S.owner_type){case"user":return`来自用户: ${S.owner_name}`;case"user_group":return`来自用户组: ${S.owner_name}`;case"role":return`来自角色: ${S.owner_name}`}}).join(`
>>>>>>>> hz-manager/cmdb_permission:hz-ui/dist/assets/permissionView-CjhX2_Y8.js
`),U=!0)}return U&&(w.disabled=!0,w.tooltip=j),w.children&&w.children.length>0&&(w.children=w.children.map(a=>m(a,U,j))),w};return Array.isArray(l)?l.map(r=>m(r)):m(l)},le=F(()=>{const l=H.value.map(e=>({id:e.id,name:e.name,verbose_name:e.verbose_name,description:e.description,type:"modelgroups",parent_id:null,children:[]}));if(W.value.forEach(e=>{const c=l.find(m=>m.id===e.model_group);if(c){const m={id:e.id,name:e.name,verbose_name:e.verbose_name,description:e.description,type:"models",parent_id:c.id,children:[]};e.field_groups&&e.field_groups.length>0&&(m.children=e.field_groups.map(r=>{const u={id:r.id,name:r.name,verbose_name:r.verbose_name,description:r.description,type:"modelfieldgroups",parent_id:m.id,children:[]};return r.fields&&r.fields.length>0&&(u.children=r.fields.map(C=>({id:C.id,name:C.name,verbose_name:C.verbose_name,description:C.description,type:"modelfields",parent_id:u.id}))),u})),c.children.push(m)}}),L.value){console.log("permissionData:",L.value);let e=I(l,L.value);return console.log("treeDataFinal:",e),e}return l}),T=F(()=>{const l=H.value.map(e=>({id:e.id,name:e.name,verbose_name:e.verbose_name,description:e.description,type:"modelgroups",parent_id:null,children:[]}));return W.value.forEach(e=>{const c=l.find(m=>m.id===e.model_group);if(c){const m={id:e.id,name:e.name,verbose_name:e.verbose_name,description:e.description,type:"models",parent_id:c.id,children:[]};if(X.value[e.id]){const r=(u,C)=>{const w={id:u.id,name:u.label,verbose_name:u.label,instance_count:u.instances?u.instances.length:0,built_in:u.built_in,level:u.level,type:"modelinstancegroup",parent_id:C,children:[]};return u.children&&u.children.length>0&&(w.children=u.children.map(N=>r(N,w.id))),u.instances&&u.instances.length>0&&u.instances.forEach(N=>{w.children.push({id:N.id,name:N.instance_name,verbose_name:N.instance_name,type:"modelinstance",parent_id:w.id})}),w};m.children.push(r(X.value[e.id],m.id))}c.children.push(m)}}),L.value?I(l,L.value):l}),B=()=>{var l,e;D.value=((l=g.value)==null?void 0:l.getCheckedKeys())||[],x.value=((e=h.value)==null?void 0:e.getCheckedKeys())||[]},E=l=>{g.value.filter(l)},K=(l,e)=>e.verbose_name.includes(l),H=f([]),re=async()=>{let l=await de.getCiModelGroup();H.value=l.data.results},o=async()=>{b.getAllModelTreeInstances(!0)},t=()=>{var a,S,me,_e;let l=[];const e=(a=g.value)==null?void 0:a.getCheckedNodes(!1),m=((S=g.value)==null?void 0:S.getHalfCheckedNodes()).filter(_=>_.type==="modelfieldgroups").map(_=>_.id),r=e.filter(_=>_.type==="modelfieldgroups").map(_=>_.id),u=e.filter(_=>m.includes(_.parent_id)).map(_=>_.id);r.length>0&&l.push({app_label:"cmdb",model:"modelfieldgroups",object_ids:r}),u.length>0&&l.push({app_label:"cmdb",model:"modelfields",object_ids:u});const C=(me=h.value)==null?void 0:me.getCheckedNodes(!1),N=((_e=h.value)==null?void 0:_e.getHalfCheckedNodes()).filter(_=>_.type==="modelinstancegroup").map(_=>_.id),U=C.filter(_=>_.type==="modelinstancegroup"?!!(h.value.getNode(_.parent_id).data.type==="models"||N.includes(_.parent_id)):!1).map(_=>_.id),j=C.filter(_=>N.includes(_.parent_id)&&_.type==="modelinstance").map(_=>_.id);return U.length>0&&l.push({app_label:"cmdb",model:"modelinstancegroup",object_ids:U}),j.length>0&&l.push({app_label:"cmdb",model:"modelinstance",object_ids:j}),l},V=async()=>{if(!k.value){Y.info("权限设置未发生变化，无需保存");return}let l=t();console.log(l);let e=await de.setDataScope({scope_type:"filter",app_label:"cmdb",targets:l,...P.value});e.status=="201"?(Y.success("权限更新成功!"),ae()):Y.error("保存失败,"+JSON.stringify(e.data)),R.value=[...D.value],O.value=[...x.value]},$=f([]),q=f([]),te=f(!0),L=f(null),ae=async()=>{try{te.value=!0;let l=await de.getDataScopeAll({...P.value,app_label:"cmdb"});L.value=l.data,$.value=[],q.value=[],l.data.results.forEach(e=>{e.scope_type=="filter"&&(["modelfields","modelfieldgroups"].indexOf(e.model)!==-1?$.value.push(e.target):["modelinstance","modelinstancegroup"].indexOf(e.model)!==-1&&q.value.push(e.target))}),Z(()=>{g.value.setCheckedKeys($.value),g.value.setExpandedKeys($.value),h.value.setCheckedKeys(q.value),h.value.setExpandedKeys(q.value),R.value=[...$.value],O.value=[...q.value],D.value=[...$.value],x.value=[...q.value]})}catch(l){console.error("获取数据范围失败:",l),$.value=[],q.value=[],g.value.setCheckedKeys([]),h.value.setCheckedKeys([]),L.value=null,R.value=[],O.value=[],D.value=[],x.value=[]}finally{setTimeout(()=>{te.value=!1},500)}};return be(async()=>{await b.getModel(),await b.getAllModelTreeInstances(),await re(),await ae()}),Q({getDataScope:ae}),(l,e)=>{const c=v("el-icon"),m=v("el-tooltip"),r=v("el-input"),u=v("el-tag"),C=v("el-tree-v2"),w=v("el-card"),N=v("el-button"),U=ye("loading");return G(),ne("div",Re,[p("div",De,[s(w,{class:"permission-panel"},{header:n(()=>[p("div",Ie,[p("span",Ke,[e[3]||(e[3]=z("字段授权 ",-1)),s(m,{placement:"top"},{content:n(()=>[...e[2]||(e[2]=[z(" 如果勾选一个模型内字段组的所有字段，则添加的是此分组权限，后续此组有新增字段，也会有权限 ",-1)])]),default:n(()=>[s(c,null,{default:n(()=>[s(J(ve))]),_:1})]),_:1})]),p("div",qe,[s(r,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=j=>M.value=j),placeholder:"输入关键字检索",clearable:"",class:"search-input",onInput:E},{prefix:n(()=>[s(c,null,{default:n(()=>[s(J(ce))]),_:1})]),_:1},8,["modelValue"])])])]),default:n(()=>[p("div",Ue,[fe((G(),ie(C,{data:le.value,props:se,"node-key":"id","show-checkbox":"",ref_key:"fieldTreeRef",ref:g,"filter-method":K,height:850,class:"permission-tree",onCheck:B},{default:n(({node:j,data:a})=>[s(m,{content:a.tooltip,disabled:!a.disabled||!a.tooltip,placement:"top"},{default:n(()=>[p("div",Se,[s(u,{size:"small",type:d[a.type]?d[a.type]:"info",class:"node-tag"},{default:n(()=>[z(A(i[a.type]),1)]),_:2},1032,["type"]),p("span",ze,A(j.label),1)])]),_:2},1032,["content","disabled"])]),_:1},8,["data"])),[[U,te.value]])])]),_:1}),s(w,{class:"permission-panel"},{header:n(()=>[p("div",Ee,[p("span",Fe,[e[5]||(e[5]=z("实例授权 ",-1)),s(m,{placement:"top"},{content:n(()=>[...e[4]||(e[4]=[z(" 如果勾选一个实例树内的所有实例，则添加的是此实例树权限，后续此组有新增实例，也会有权限 ",-1)])]),default:n(()=>[s(c,null,{default:n(()=>[s(J(ve))]),_:1})]),_:1})]),p("div",Ge,[s(r,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=j=>M.value=j),placeholder:"输入关键字检索",clearable:"",class:"search-input",onInput:E},{prefix:n(()=>[s(c,null,{default:n(()=>[s(J(ce))]),_:1})]),_:1},8,["modelValue"]),s(m,{content:"刷新实例",placement:"top"},{default:n(()=>[s(N,{link:"",icon:J(we),onClick:o,class:"refresh-btn"},null,8,["icon"])]),_:1})])])]),default:n(()=>[p("div",Be,[fe((G(),ie(C,{data:T.value,props:se,"node-key":"id","show-checkbox":"",ref_key:"instanceTreeRef",ref:h,height:850,class:"permission-tree",onCheck:B},{default:n(({node:j,data:a})=>[s(m,{content:a.tooltip,disabled:!a.disabled||!a.tooltip,placement:"top"},{default:n(()=>[p("div",He,[s(u,{size:"small",type:d[a.type]?d[a.type]:"info",class:"node-tag"},{default:n(()=>[z(A(i[a.type]),1)]),_:2},1032,["type"]),p("span",Le,A(j.label),1),a.instance_count!==void 0?(G(),ne("span",Ae," ("+A(a.instance_count)+") ",1)):he("",!0)])]),_:2},1032,["content","disabled"])]),_:1},8,["data"])),[[U,te.value]])])]),_:1})]),p("div",Je,[s(N,{type:"primary",size:"large",onClick:V,disabled:!k.value},{default:n(()=>[...e[6]||(e[6]=[z(" 保存 ",-1)])]),_:1},8,["disabled"])])])}}}),We=ge(Qe,[["__scopeId","data-v-a9ce050d"]]),Xe={class:"permission-container"},Ye={class:"left-panel"},Ze={class:"panel-header"},es={class:"tree-container"},ss={class:"custom-tree-node"},ts={class:"right-panel"},ns={key:0,class:"empty-placeholder"},ls={key:1,class:"protected-object"},as={key:2,class:"permission-config"},os={class:"config-header"},is={class:"header-info"},rs={class:"header-text"},ds={class:"object-name"},cs={class:"object-type"},us=ue({__name:"permissionView",setup(ee){const{proxy:Q}=pe();ke();const y=Ce(),b=f("user"),P=f([]),M=f(""),g=f(),h=f(),W=f(),X={children:"children",label:"label",disabled:"disabled"};F(()=>window.innerHeight-200+"px");const R=()=>{};Ne(()=>{window.removeEventListener("resize",R)}),je(M,o=>{g.value.filter(o)});const O=o=>{switch(b.value){case"user":return{user:o};case"user_group":return{user_group:o};case"role":return{role:o}}},D=(o,t)=>o?t.label.includes(o):!0,x=f("menu"),se=(o,t)=>{},i=f(""),d=f({}),k=F(()=>["admin","sysadmin","系统管理组"].includes(i.value)),I=F(()=>({user:"用户",user_group:"用户组",role:"角色"})[b.value]||"未知"),le=F(()=>({user:"primary",user_group:"success",role:"warning"})[b.value]||"info"),T=o=>{i.value=o.label,d.value=O(o.id),!k.value&&Z(()=>{h.value.getPermissionTreeData(),h.value.getPermissionOnRight(),W.value.getDataScope()})},B=async()=>{const o=await Q.$api.user();P.value=o.data.results.map(t=>({id:t.id,label:t.username,disabled:t.username==="admin"}))},E=async()=>{const o=await Q.$api.getUserGroup();P.value=o.data.results.map(t=>({id:t.id,label:t.group_name,disabled:t.group_name==="系统管理组"}))},K=async()=>{const o=await Q.$api.getRole();P.value=o.data.results.map(t=>({id:t.id,label:t.role,disabled:t.role==="sysadmin"}))},H=o=>{switch(console.log(111),o){case"user":B(),i.value="";break;case"user_group":E(),i.value="";break;case"role":K(),i.value="";break}},re=async()=>{if(Object.keys(y.query).length>0){if(console.log("Route query:",y.query),y.query.role){b.value="role",await K(),g.value.setCurrentKey(y.query.role);const o=g.value.getNode(y.query.role);o&&(i.value=o.data.label,d.value=O(y.query.role),Z(()=>{var t,V;(t=h.value)==null||t.getPermissionTreeData(),(V=h.value)==null||V.getPermissionOnRight()}))}else if(y.query.user){b.value="user",await B(),g.value.setCurrentKey(y.query.user);const o=g.value.getNode(y.query.user);o&&(i.value=o.data.label,d.value=O(y.query.user),Z(()=>{var t,V;(t=h.value)==null||t.getPermissionTreeData(),(V=h.value)==null||V.getPermissionOnRight()}))}else if(y.query.user_group){b.value="user_group",await E(),g.value.setCurrentKey(y.query.user_group);const o=g.value.getNode(y.query.user_group);o&&(i.value=o.data.label,d.value=O(y.query.user_group),Z(()=>{var t,V;(t=h.value)==null||t.getPermissionTreeData(),(V=h.value)==null||V.getPermissionOnRight()}))}}else H("user")};return be(()=>{window.addEventListener("resize",R),re()}),(o,t)=>{const V=v("el-text"),$=v("el-icon"),q=v("el-radio-button"),te=Te,L=v("el-radio-group"),ae=v("el-input"),l=v("el-tag"),e=v("el-tree"),c=v("el-scrollbar"),m=v("el-splitter-panel"),r=v("el-empty"),u=v("el-result"),C=v("el-avatar"),w=v("el-tab-pane"),N=v("el-tabs"),U=v("el-splitter"),j=v("el-card");return G(),ne("div",Xe,[s(j,{class:"permission-card"},{default:n(()=>[s(U,{class:"main-splitter"},{default:n(()=>[s(m,{min:250,size:250},{default:n(()=>[p("div",Ye,[p("div",Ze,[s(V,{class:"panel-title"},{default:n(()=>[...t[7]||(t[7]=[z("授权对象",-1)])]),_:1}),s(L,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),size:"small",onChange:H},{default:n(()=>[s(q,{label:"user"},{default:n(()=>[s($,null,{default:n(()=>[s(J(Oe))]),_:1}),t[8]||(t[8]=p("span",null,"用户",-1))]),_:1}),s(q,{label:"user_group"},{default:n(()=>[s($,null,{default:n(()=>[s(te,{icon:"material-symbols:group-outline"})]),_:1}),t[9]||(t[9]=p("span",null,"用户组",-1))]),_:1}),s(q,{label:"role"},{default:n(()=>[s($,null,{default:n(()=>[s(J($e))]),_:1}),t[10]||(t[10]=p("span",null,"角色",-1))]),_:1})]),_:1},8,["modelValue"])]),p("div",es,[s(ae,{modelValue:M.value,"onUpdate:modelValue":t[1]||(t[1]=a=>M.value=a),placeholder:"搜索对象...",clearable:"",class:"search-input"},{prefix:n(()=>[s($,null,{default:n(()=>[s(J(ce))]),_:1})]),_:1},8,["modelValue"]),s(c,{class:"tree-scrollbar"},{default:n(()=>[s(e,{ref_key:"treeRef",ref:g,class:"object-tree",data:P.value,props:X,"default-expand-all":"","node-key":"id","highlight-current":"","filter-node-method":D,onNodeClick:T},{default:n(({node:a,data:S})=>[p("div",ss,[p("span",null,A(a.label),1),S.disabled?(G(),ie(l,{key:0,type:"warning",size:"small",effect:"plain"},{default:n(()=>[...t[11]||(t[11]=[z(" 内置对象 ",-1)])]),_:1})):he("",!0)])]),_:1},8,["data"])]),_:1})])])]),_:1}),s(m,{"min-size":30},{default:n(()=>[p("div",ts,[i.value?k.value?(G(),ne("div",ls,[s(u,{icon:"info",title:"受保护对象","sub-title":"此对象为系统内置对象，无需配置权限"},{icon:n(()=>[s($,{class:"protected-icon"},{default:n(()=>[s(J(Pe))]),_:1})]),_:1})])):(G(),ne("div",as,[p("div",os,[p("div",is,[s(C,{size:40},{default:n(()=>[z(A(i.value.charAt(0).toUpperCase()),1)]),_:1}),p("div",rs,[p("div",ds,A(i.value),1),p("div",cs,[s(l,{type:le.value,effect:"plain"},{default:n(()=>[z(A(I.value),1)]),_:1},8,["type"])])])])]),s(N,{modelValue:x.value,"onUpdate:modelValue":t[6]||(t[6]=a=>x.value=a),type:"border-card",class:"permission-tabs",onTabClick:se},{default:n(()=>[s(w,{label:"菜单授权",name:"menu"},{default:n(()=>[s(Me,{ref_key:"menuPermissionRef",ref:h,nowNodeObject:d.value,"onUpdate:nowNodeObject":t[2]||(t[2]=a=>d.value=a),permissionObject:b.value,"onUpdate:permissionObject":t[3]||(t[3]=a=>b.value=a)},null,8,["nowNodeObject","permissionObject"])]),_:1}),s(w,{label:"资产授权",name:"cmdb"},{default:n(()=>[s(We,{ref_key:"cmdbPermissionRef",ref:W,nowNodeObject:d.value,"onUpdate:nowNodeObject":t[4]||(t[4]=a=>d.value=a),permissionObject:b.value,"onUpdate:permissionObject":t[5]||(t[5]=a=>b.value=a)},null,8,["nowNodeObject","permissionObject"])]),_:1})]),_:1},8,["modelValue"])])):(G(),ne("div",ns,[s(r,{description:"请选择左侧授权对象"})]))])]),_:1})]),_:1})]),_:1})])}}}),vs=ge(us,[["__scopeId","data-v-e38c0a91"]]);export{vs as default};
