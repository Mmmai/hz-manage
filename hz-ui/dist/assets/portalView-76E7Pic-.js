import{b as Je,u as Le,r as i,c as S,M as q,aN as Re,e as p,b3 as We,o as m,f as Q,h as w,bO as U,bo as T,O as f,w as t,j as u,g as l,F as Z,b1 as ge,Y as Ye,t as Ge,k as Xe,bV as R,c1 as n}from"./index-IeLxcNDT.js";const He={class:"card"},Ke={class:"user-header"},Qe={style:{display:"flex","justify-content":"center","margin-top":"10px"}},Ze={class:"user-header"},el={style:{display:"flex","justify-content":"center","margin-top":"10px"}},al={__name:"portalView",setup(ll){const h=Je(),B=Le(),{proxy:s}=Xe(),O=i({search:null}),I=i([]),ee=i([]),W=i(!1),_=i(!1),J=i("add"),le=i(!0),v=S({group:"",id:"",owner:B.state.userinfo.user_id}),Y=i(0),C=S({page:1,size:5,owner:B.state.userinfo.user_id}),z=S({owner:B.state.userinfo.user_id}),fe=()=>{W.value=!0},ce=o=>{C.page=o},ye=i([]),ve=o=>{ye.value=o},c=i([]),be=o=>{c.value=o,console.log(c.value)},te=q(()=>{let o=[];for(let e in c.value)o.push(c.value[e].id);return o}),ae=()=>{R.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let o=[];for(let r in c.value)o.push(c.value[r].id);(await s.$api.portalMuldel({pks:o})).status==204?n({type:"success",message:"删除成功"}):n({type:"error",message:"删除失败"}),D(z)}).catch(()=>{n({type:"info",message:"Delete canceled"})})},we=()=>{_.value=!0,J.value="add"},_e=o=>{_.value=!0,J.value="edit",s.$nextTick(()=>{Object.assign(v,o)})},Ce=q(()=>{let o={};return I.value.forEach(e=>{o[e.id]=e.group}),o}),D=async o=>{let e=await s.$api.pgroupGet(o);I.value=e.data.results,console.log(I.value),Y.value=e.data.count,le.value=Y.value<=C.size,ee.value=s.$commonFunc.pageFunc(e.data,C)},Ve=o=>{R.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await s.$api.pgroupDel(o.id)).status==204?(n({type:"success",message:"删除成功"}),D(z)):n({type:"error",message:"删除失败"})}).catch(()=>{n({type:"info",message:"Delete canceled"})})},ke=()=>{s.$refs.pgroupForm.validate(async o=>{if(console.log(v),o)if(J.value=="add"){let e=await s.$api.pgroupAdd(v);e.status==201?(_.value=!1,n({type:"success",message:"添加成功"}),s.$refs.pgroupForm.resetFields(),D(z)):n({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await s.$api.pgroupUpdate({group:v.group,id:v.id});e.status==200?(_.value=!1,n({type:"success",message:"更新成功"}),s.$refs.pgroupForm.resetFields(),D(z)):n({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else n({showClose:!0,message:"请输入正确内容.",type:"error"})})},V=i(!1),d=S({name:"",url:"",target:!0,group:"",status:!0,username:"",password:"",describe:"",owner:B.state.userinfo.user_id}),k=S({page:1,size:10}),xe=i([{prop:"name",label:"名称"},{prop:"url",label:"链接地址"},{prop:"describe",label:"描述"},{prop:"target",label:"跳转方式"},{prop:"status",label:"状态"},{prop:"group",label:"分组"},{prop:"username",label:"登录用户名"},{prop:"password",label:"密码"}]),L=i("add"),N=i([]),$e=q(()=>s.$commonFunc.pageFunc(N.value,k)),he=q(()=>N.value.length),ze=q(()=>N.value.length<=k.size),j=S({owner:B.state.userinfo.user_id}),oe=i([]),A=async o=>{let e=await s.$api.portalGet(o);N.value=e.data.results,oe.value=e.data.results},De=()=>{V.value=!0,L.value="add"},Fe=()=>{V.value=!1,s.$refs.portalForm.resetFields()},Pe=o=>{k.page=o},Se=()=>{s.$refs.portalForm.validate(async o=>{if(o)if(L.value=="add"){let e=await s.$api.portalAdd(d);e.status==201?(n({type:"success",message:"添加成功"}),s.$refs.portalForm.resetFields(),A(j),V.value=!1):n({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await s.$api.portalUpdate(d);e.status==200?(n({type:"success",message:"更新成功"}),s.$refs.portalForm.resetFields(),A(j),V.value=!1):n({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else n({showClose:!0,message:"请输入正确内容.",type:"error"})})},Ue=o=>{V.value=!0,L.value="edit",s.$nextTick(()=>{Object.assign(d,o)})},Te=o=>{R.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await s.$api.portalDel(o.id)).status==204?(n({type:"success",message:"删除成功"}),A(j)):n({type:"error",message:"删除失败"})}).catch(()=>{n({type:"info",message:"Delete canceled"})})},se=()=>{R.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let o=[];for(let r in c.value)o.push(c.value[r].id);(await s.$api.portalMuldel({pks:o})).status==204?n({type:"success",message:"删除成功"}):n({type:"error",message:"删除失败"}),A(j)}).catch(()=>{n({type:"info",message:"Delete canceled"})})};Re(async()=>{await D(z),await A(j)});const G=async(o=null)=>{let e=await s.$api.exportXls(o);console.log(e),s.$commonFunc.downloadFunc(e)},ne=()=>{console.log(te.value),G({rowid:te.value})},Be=()=>{G({template:111})},Oe=()=>{if(O.value.search!=null){var o=new RegExp(O.value.search);let e=[];oe.value.forEach(r=>{o.test(r.name)&&e.push(r),N.value=e})}},Ne=async o=>{console.log(o);let e=await s.$api.portalUpdate({status:o.status,id:o.id});e.status==200?(n({type:"success",message:"更新成功"}),D(z)):n({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})};return(o,e)=>{var de,pe,ie,me;const r=p("el-button"),E=p("el-dropdown-item"),je=p("el-dropdown-menu"),Ae=p("el-dropdown"),x=p("el-input"),g=p("el-form-item"),X=p("el-form"),$=p("el-table-column"),Ee=p("el-tag"),H=p("el-switch"),re=p("el-table"),ue=p("el-pagination"),F=p("el-row"),K=p("el-dialog"),b=p("el-col"),Me=p("el-option"),qe=p("el-select"),P=We("permission");return m(),Q(Z,null,[w("div",He,[w("div",Ke,[w("div",null,[U((m(),f(r,{type:"primary",size:"small",onClick:De},{default:t(()=>e[18]||(e[18]=[u("新增")])),_:1})),[[P,`${(de=T(h).name)==null?void 0:de.replace("_info","")}:add`]]),U((m(),f(r,{type:"primary",size:"small",onClick:fe},{default:t(()=>e[19]||(e[19]=[u("新增分组")])),_:1})),[[P,`${(pe=T(h).name)==null?void 0:pe.replace("_info","")}:add`]]),c.value.length==0?U((m(),f(r,{key:0,disabled:"",type:"danger",size:"small",onClick:se},{default:t(()=>e[20]||(e[20]=[u("批量删除")])),_:1})),[[P,`${(ie=T(h).name)==null?void 0:ie.replace("_info","")}:delete`]]):U((m(),f(r,{key:1,type:"danger",size:"small",onClick:se},{default:t(()=>e[21]||(e[21]=[u("批量删除")])),_:1})),[[P,`${(me=T(h).name)==null?void 0:me.replace("_info","")}:delete`]]),l(Ae,{size:"small","split-button":"",type:"primary",style:{"margin-left":"15px","margin-right":"15px"}},{dropdown:t(()=>[l(je,null,{default:t(()=>[l(E,{onClick:G},{default:t(()=>e[22]||(e[22]=[u("全部导出")])),_:1}),c.value.length===0?(m(),f(E,{key:0,onClick:ne,disabled:""},{default:t(()=>e[23]||(e[23]=[u("批量导出")])),_:1})):(m(),f(E,{key:1,onClick:ne},{default:t(()=>e[24]||(e[24]=[u("批量导出")])),_:1})),l(E,null,{default:t(()=>e[25]||(e[25]=[u("批量导入")])),_:1}),l(E,{onClick:Be},{default:t(()=>e[26]||(e[26]=[u("模版下载")])),_:1})]),_:1})]),default:t(()=>[e[27]||(e[27]=u(" 更多操作 "))]),_:1})]),l(X,{inline:!0,model:O.value,size:"small",class:"demo-form-inline"},{default:t(()=>[l(g,{label:"名称"},{default:t(()=>[l(x,{modelValue:O.value.search,"onUpdate:modelValue":e[0]||(e[0]=a=>O.value.search=a),placeholder:"输入名称",clearable:""},null,8,["modelValue"])]),_:1}),l(g,null,{default:t(()=>[l(r,{type:"primary",size:"small",onClick:Oe},{default:t(()=>e[28]||(e[28]=[u("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),w("div",null,[l(re,{border:"",data:$e.value,style:{width:"100%"},"max-height":"100%",onSelectionChange:be},{default:t(()=>[l($,{type:"selection",width:"55"}),(m(!0),Q(Z,null,ge(xe.value,a=>(m(),f($,{key:a.prop,label:a.label,prop:a.prop},Ye({_:2},[a.prop==="group"?{name:"default",fn:t(y=>[l(Ee,null,{default:t(()=>[u(Ge(Ce.value[y.row.group]),1)]),_:2},1024)]),key:"0"}:void 0,a.prop==="status"?{name:"default",fn:t(y=>[l(H,{modelValue:y.row.status,"onUpdate:modelValue":M=>y.row.status=M,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:M=>Ne(y.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),key:"1"}:void 0]),1032,["label","prop"]))),128)),l($,{fixed:"right",label:"操作",width:"150"},{default:t(a=>{var y,M;return[U((m(),f(r,{type:"primary",size:"small",onClick:Ie=>Ue(a.row)},{default:t(()=>e[29]||(e[29]=[u(" 编辑 ")])),_:2},1032,["onClick"])),[[P,`${(y=T(h).name)==null?void 0:y.replace("_info","")}:edit`]]),U((m(),f(r,{type:"danger",size:"small",onClick:Ie=>Te(a.row)},{default:t(()=>e[30]||(e[30]=[u(" 删除 ")])),_:2},1032,["onClick"])),[[P,`${(M=T(h).name)==null?void 0:M.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data"]),w("div",Qe,[l(ue,{"current-page":k.page,"onUpdate:currentPage":e[1]||(e[1]=a=>k.page=a),"page-size":k.size,"onUpdate:pageSize":e[2]||(e[2]=a=>k.size=a),small:"",background:"",layout:"prev, pager, next",total:he.value,"hide-on-single-page":ze.value,onCurrentChange:Pe},null,8,["current-page","page-size","total","hide-on-single-page"])])])]),l(K,{modelValue:W.value,"onUpdate:modelValue":e[8]||(e[8]=a=>W.value=a),title:"编辑分组",width:"30%"},{footer:t(()=>[l(K,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=a=>_.value=a),width:"20%",title:J.value==="add"?"新增分组":"编辑分组","append-to-body":""},{default:t(()=>[l(X,{inline:!0,model:v,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"pgroupForm","status-icon":""},{default:t(()=>[l(g,{label:"分组名称",prop:"group",rules:[{required:!0}]},{default:t(()=>[l(x,{modelValue:v.group,"onUpdate:modelValue":e[3]||(e[3]=a=>v.group=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1}),l(F,{style:{"justify-content":"space-around"}},{default:t(()=>[l(g,null,{default:t(()=>[l(r,{onClick:e[4]||(e[4]=a=>_.value=!1)},{default:t(()=>e[31]||(e[31]=[u("取消")])),_:1}),l(r,{type:"primary",onClick:ke},{default:t(()=>e[32]||(e[32]=[u(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),default:t(()=>[w("div",Ze,[w("div",null,[l(r,{type:"primary",size:"small",onClick:we},{default:t(()=>e[33]||(e[33]=[u("新增")])),_:1}),c.value.length==0?(m(),f(r,{key:0,disabled:"",type:"danger",size:"small",onClick:ae},{default:t(()=>e[34]||(e[34]=[u("批量删除")])),_:1})):(m(),f(r,{key:1,type:"danger",size:"small",onClick:ae},{default:t(()=>e[35]||(e[35]=[u("批量删除")])),_:1}))])]),l(re,{data:ee.value,"default-sort":{prop:"id",order:"ascending"},onSelectionChange:ve},{default:t(()=>[l($,{type:"selection",width:"55"}),l($,{prop:"id",label:"id",sortable:""}),l($,{prop:"group",label:"group",sortable:""}),l($,{fixed:"right",label:"Operations"},{default:t(a=>[l(r,{type:"primary",size:"small",onClick:y=>_e(a.row)},{default:t(()=>e[36]||(e[36]=[u(" 编辑 ")])),_:2},1032,["onClick"]),l(r,{type:"danger",size:"small",onClick:y=>Ve(a.row)},{default:t(()=>e[37]||(e[37]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),w("div",el,[l(ue,{"current-page":C.page,"onUpdate:currentPage":e[6]||(e[6]=a=>C.page=a),"page-size":C.size,"onUpdate:pageSize":e[7]||(e[7]=a=>C.size=a),small:"",background:"",layout:"prev, pager, next",total:Y.value,"hide-on-single-page":le.value,onCurrentChange:ce},null,8,["current-page","page-size","total","hide-on-single-page"])])]),_:1},8,["modelValue"]),l(K,{modelValue:V.value,"onUpdate:modelValue":e[17]||(e[17]=a=>V.value=a),title:L.value=="add"?"新增链接":"编辑链接",width:"50%"},{default:t(()=>[l(X,{inline:!0,model:d,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"portalForm","status-icon":""},{default:t(()=>[l(F,null,{default:t(()=>[l(b,{span:12},{default:t(()=>[l(g,{label:"名称",prop:"name",rules:[{required:!0}]},{default:t(()=>[l(x,{modelValue:d.name,"onUpdate:modelValue":e[9]||(e[9]=a=>d.name=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(g,{label:"链接地址",prop:"url",rules:[{required:!0}],style:{width:"90%"}},{default:t(()=>[l(x,{modelValue:d.url,"onUpdate:modelValue":e[10]||(e[10]=a=>d.url=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:t(()=>[l(b,{span:12},{default:t(()=>[l(g,{label:"描述",prop:"describe"},{default:t(()=>[l(x,{modelValue:d.describe,"onUpdate:modelValue":e[11]||(e[11]=a=>d.describe=a),placeholder:"",clearable:"",style:{width:"100%"},autosize:{minRows:2,maxRows:4},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(g,{label:"分组",prop:"group",rules:[{required:!0}]},{default:t(()=>[l(qe,{modelValue:d.group,"onUpdate:modelValue":e[12]||(e[12]=a=>d.group=a),filterable:"",placeholder:"Select",style:{width:"120px"}},{default:t(()=>[(m(!0),Q(Z,null,ge(I.value,a=>(m(),f(Me,{key:a.value,label:a.group,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:t(()=>[l(b,{span:12},{default:t(()=>[l(g,{label:"用户名",prop:"username"},{default:t(()=>[l(x,{modelValue:d.username,"onUpdate:modelValue":e[13]||(e[13]=a=>d.username=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(g,{label:"密码",prop:"password"},{default:t(()=>[l(x,{modelValue:d.password,"onUpdate:modelValue":e[14]||(e[14]=a=>d.password=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:t(()=>[l(b,{span:12},{default:t(()=>[l(g,{label:"状态",prop:"status",rules:[{required:!0}]},{default:t(()=>[l(H,{modelValue:d.status,"onUpdate:modelValue":e[15]||(e[15]=a=>d.status=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(g,{label:"跳转方式",prop:"target"},{default:t(()=>[l(H,{modelValue:d.target,"onUpdate:modelValue":e[16]||(e[16]=a=>d.target=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,{style:{"justify-content":"space-around"}},{default:t(()=>[l(g,null,{default:t(()=>[l(r,{onClick:Fe},{default:t(()=>e[38]||(e[38]=[u("取消")])),_:1}),l(r,{type:"primary",onClick:Se},{default:t(()=>e[39]||(e[39]=[u(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}};export{al as default};
