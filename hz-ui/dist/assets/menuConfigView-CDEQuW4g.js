import{d as ye,aN as ve,g as ge,bB as Ee,x as Ve,r,a as ue,h as s,bc as de,c as Q,o as y,F as ce,f as e,w as t,q as M,t as he,bV as h,B as U,m,cc as ke,cd as Ce,b as O,aP as xe,c4 as pe,b_ as d,_ as $e,y as Le,z as Oe,i as be,aa as Te,C as Ie,k as re,cw as Je}from"./index-Cm0tF2Sj.js";import{i as ze}from"./iconSelectCom-C-NEJWCR.js";const Ae={class:"dialog-footer"},je=ye({__name:"menuButtonCom",props:ve(["nowMenu"],{showDrawer:{},showDrawerModifiers:{}}),emits:ve(["getMenuData"],["update:showDrawer"]),setup(X,{expose:k,emit:v}){const{proxy:N}=ge(),c=X,T=v,B=Ee(X,"showDrawer"),I=Ve(),F=r(),J=r([]);k({updateMenuButtonList:_=>{J.value=_}});const ee=()=>{B.value=!1},g=r(!1),C=()=>{g.value=!1},f=ue({name:"",action:"",menu:""}),V=r(!0),n=()=>{g.value=!0,V.value=!0,f.menu=c.nowMenu.id},R=_=>{g.value=!0,V.value=!1,xe(()=>{Object.keys(f).forEach(i=>{f[i]=_[i]}),f.id=_.id,f.menu=_.menu})},z=async()=>{let _=await N.$api.getButton({menu:c.nowMenu.id});J.value=_.data.results},le=_=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await N.$api.deleteButton(_.id)).status==204?(d({type:"success",message:"删除成功"}),await z(),T("getMenuData")):d({type:"error",message:"删除失败"})}).catch(()=>{d({type:"info",message:"取消删除"})})},te=()=>{F.value.validate(async _=>{if(_)if(V.value){let i=await N.$api.addButton(f);i.status==201?(g.value=!1,F.value.resetFields(),z(),T("getMenuData")):d({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else{let i=await N.$api.updateButton(f);i.status==200?(g.value=!1,F.value.resetFields(),z(),T("getMenuData")):d({showClose:!0,message:"更新失败:"+JSON.stringify(i.data),type:"error"})}else d({showClose:!0,message:"请输入正确内容.",type:"error"})})};return(_,i)=>{const Y=s("el-text"),G=s("el-col"),S=s("el-button"),oe=s("el-row"),ae=s("el-divider"),A=s("el-table-column"),q=s("el-tooltip"),ne=s("el-table"),P=s("el-drawer"),W=s("el-input"),E=s("el-form-item"),H=s("el-form"),K=s("el-dialog"),j=de("permission");return y(),Q(ce,null,[e(P,{modelValue:B.value,"onUpdate:modelValue":i[0]||(i[0]=a=>B.value=a),title:"菜单按钮编辑",direction:"rtl","before-close":ee,size:"30%"},{default:t(()=>[e(oe,{justify:"space-between"},{default:t(()=>[e(G,{span:5},{default:t(()=>[e(Y,{size:"large",tag:"b"},{default:t(()=>[M("菜单："+he(c.nowMenu.label),1)]),_:1})]),_:1}),e(G,{span:2},{default:t(()=>{var a;return[h((y(),U(S,{type:"primary",onClick:n},{default:t(()=>[...i[5]||(i[5]=[M("添加",-1)])]),_:1})),[[j,`${(a=m(I).name)==null?void 0:a.replace("_info","")}:add`]])]}),_:1})]),_:1}),e(ae),e(ne,{border:"",data:J.value,style:{width:"100%"}},{default:t(()=>[e(A,{prop:"name",label:"按钮名称"}),e(A,{prop:"action",label:"按钮标识"}),e(A,{fixed:"right",label:"操作"},{default:t(a=>[e(q,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var l;return[h(e(S,{link:"",type:"primary",icon:m(ke),onClick:b=>R(a.row)},null,8,["icon","onClick"]),[[j,`${(l=m(I).name)==null?void 0:l.replace("_info","")}:edit`]])]}),_:2},1024),e(q,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var l;return[h(e(S,{link:"",type:"danger",icon:m(Ce),onClick:b=>le(a.row)},null,8,["icon","onClick"]),[[j,`${(l=m(I).name)==null?void 0:l.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(K,{modelValue:g.value,"onUpdate:modelValue":i[4]||(i[4]=a=>g.value=a),title:"按钮配置",width:"400","before-close":C},{footer:t(()=>[O("div",Ae,[e(S,{onClick:i[3]||(i[3]=a=>g.value=!1)},{default:t(()=>[...i[6]||(i[6]=[M("取消",-1)])]),_:1}),e(S,{type:"primary",onClick:te},{default:t(()=>[...i[7]||(i[7]=[M(" 提交 ",-1)])]),_:1})])]),default:t(()=>[e(H,{inline:!0,model:f,ref_key:"formRef",ref:F,class:"demo-form-inline"},{default:t(()=>[e(E,{label:"按钮名称",required:"",prop:"name"},{default:t(()=>[e(W,{modelValue:f.name,"onUpdate:modelValue":i[1]||(i[1]=a=>f.name=a),placeholder:"中文名",clearable:""},null,8,["modelValue"])]),_:1}),e(E,{label:"按钮标识",placeholder:"英文标识",required:"",prop:"action"},{default:t(()=>[e(W,{modelValue:f.action,"onUpdate:modelValue":i[2]||(i[2]=a=>f.action=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ye=$e(je,[["__scopeId","data-v-1d81ac8e"]]),Ge={class:"card"},Pe={class:"role-menu"},We={style:{width:"100%"}},He={class:"user-header"},Ke=ye({name:"menuConfig",__name:"menuConfigView",setup(X){const k=Ve(),v=Le(),N=r({}),{proxy:c}=ge();ue({search:""});const T=r(!1),B=r([]),I=r([]);r("auto");const F=r([{prop:"label",label:"菜单名称"},{prop:"icon",label:"图标"},{prop:"is_menu",label:"是否菜单"},{prop:"status",label:"启用"},{prop:"keepalive",label:"缓存"},{prop:"sort",label:"序号"},{prop:"path",label:"路由地址"},{prop:"name",label:"菜单编码"},{prop:"description",label:"描述"},{prop:"buttons",label:"权限按钮"}]);r(1);const J=r(10);r(!1),r(!1),r(!1);const Z=r(0),ee=r(!1);r({}),Oe(async()=>{await C()});const g=a=>(a.forEach(l=>{l.value=l.id,l.disabled=!!l.is_menu,l.children&&g(l.children)}),a),C=async()=>{let a=await c.$api.getMenuList();B.value=a.data.results,I.value=g(a.data.results),Z.value=a.data.count,Z.value<J.value&&(ee.value=!0)},f=a=>{N.value=a},V=r(!1),n=ue({label:"",icon:"",sort:0,is_menu:!0,description:"",path:"",name:"",parentid:null,has_info:!1,info_view_name:"",is_iframe:!1,iframe_url:"",status:!0,keepalive:!0}),R=r("add"),z=()=>{R.value="add",V.value=!0},le=()=>{V.value=!1,c.$refs.userFrom.resetFields()},te=a=>{pe.confirm("是否确认关闭?").then(()=>{a(),c.$refs.userFrom.resetFields()}).catch(()=>{})},_=()=>{c.$refs.userFrom.validate(async a=>{if(a)if(R.value=="add"){let l=await c.$api.menuAdd(n);l.status==201?(V.value=!1,c.$refs.userFrom.resetFields(),C(),await v.dispatch("",{role:v.state.role})):d({showClose:!0,message:"添加失败:"+JSON.stringify(l.data),type:"error"})}else{let l=await c.$api.menuUpdate({id:Y.value.id,...n});l.status==200?(V.value=!1,c.$refs.userFrom.resetFields(),C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})}else d({showClose:!0,message:"请输入正确内容.",type:"error"})})},i=r(),Y=r({}),G=a=>{R.value="edit",Y.value=a,V.value=!0,xe(()=>{Object.keys(n).forEach(l=>{n[l]=a[l]})}),console.log(n)},S=a=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await c.$api.menuDel(a.id)).status==204?(d({type:"success",message:"删除成功"}),await C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({type:"error",message:"删除失败"})}).catch(()=>{d({type:"info",message:"Delete canceled"})})},oe=r([]),ae=(a,l)=>{},A=a=>{oe.value=a},q=r(!1),ne=()=>{q.value=!0},P=async(a,l)=>{let b=await c.$api.menuUpdate({[l]:a[l],id:a.id});b.status==200?(d({type:"success",message:"更新成功"}),C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(b.data),type:"error"})},W=async a=>{let l=await c.$api.menuUpdate({is_menu:a.is_menu,id:a.id});l.status==200?(d({type:"success",message:"更新成功"}),C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})},E=r(!1),H=r({}),K=r(null),j=a=>{E.value=!0,H.value=a,K.value.updateMenuButtonList(a.buttons)};return(a,l)=>{var we;const b=s("el-button"),se=s("el-table-column"),x=s("el-switch"),me=Ie,Ue=s("el-icon"),Me=s("el-tag"),Be=s("el-space"),ie=s("el-tooltip"),Se=s("el-table"),L=s("el-input"),p=s("el-form-item"),De=s("el-input-number"),Ne=s("el-tree-select"),fe=s("el-col"),_e=s("el-row"),Fe=s("el-form"),Re=s("el-dialog"),D=de("permission"),qe=de("loading");return y(),Q("div",Ge,[O("div",Pe,[O("div",We,[O("div",He,[O("div",null,[h((y(),U(b,{type:"primary",size:"small",onClick:z},{default:t(()=>[...l[17]||(l[17]=[M("+新增",-1)])]),_:1})),[[D,`${(we=m(k).name)==null?void 0:we.replace("_info","")}:add`]])])]),O("div",null,[h((y(),U(Se,{border:"",data:B.value,style:{width:"100%"},"max-height":"100%","highlight-current-row":"","row-key":"id","table-layout":"fixed",onSelectionChange:A,onRowClick:f},{default:t(()=>[e(se,{type:"selection",width:"55",selectable:ae}),(y(!0),Q(ce,null,be(F.value,o=>(y(),U(se,{key:o.prop,label:o.label,prop:o.prop},Te({_:2},[o.prop==="is_menu"?{name:"default",fn:t(u=>{var w;return[h(e(x,{modelValue:u.row.is_menu,"onUpdate:modelValue":$=>u.row.is_menu=$,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:$=>W(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[D,{id:`${(w=m(k).name)==null?void 0:w.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,o.prop==="status"?{name:"default",fn:t(u=>{var w;return[h(e(x,{modelValue:u.row.status,"onUpdate:modelValue":$=>u.row.status=$,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:$=>P(u.row,"status")},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[D,{id:`${(w=m(k).name)==null?void 0:w.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,o.prop==="keepalive"?{name:"default",fn:t(u=>{var w;return[h(e(x,{modelValue:u.row.keepalive,"onUpdate:modelValue":$=>u.row.keepalive=$,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:$=>P(u.row,"keepalive")},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[D,{id:`${(w=m(k).name)==null?void 0:w.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"2"}:void 0,o.prop==="icon"?{name:"default",fn:t(u=>[e(Ue,null,{default:t(()=>[e(me,{icon:u.row.icon},null,8,["icon"])]),_:2},1024)]),key:"3"}:void 0,o.prop==="buttons"?{name:"default",fn:t(u=>[e(Be,{wrap:""},{default:t(()=>[(y(!0),Q(ce,null,be(u.row.buttons,w=>(y(),U(Me,{type:"success",round:"",effect:"plain",key:w.id},{default:t(()=>[M(he(w.name),1)]),_:2},1024))),128))]),_:2},1024)]),key:"4"}:void 0]),1032,["label","prop"]))),128)),e(se,{fixed:"right",label:"操作",width:"150"},{default:t(o=>[o.row.is_menu?(y(),U(ie,{key:0,class:"box-item",effect:"dark",content:"编辑按钮",placement:"top"},{default:t(()=>{var u;return[h(e(b,{link:"",type:"primary",icon:m(Je),onClick:w=>j(o.row)},null,8,["icon","onClick"]),[[D,`${(u=m(k).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024)):re("",!0),e(ie,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var u;return[h(e(b,{link:"",type:"primary",icon:m(ke),onClick:w=>G(o.row)},null,8,["icon","onClick"]),[[D,`${(u=m(k).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),e(ie,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var u;return[h(e(b,{link:"",type:"danger",icon:m(Ce),onClick:w=>S(o.row)},null,8,["icon","onClick"]),[[D,`${(u=m(k).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[qe,T.value]])])])]),e(Re,{modelValue:V.value,"onUpdate:modelValue":l[15]||(l[15]=o=>V.value=o),title:R.value=="add"?"新增菜单":"编辑菜单",width:"40%","before-close":te},{default:t(()=>[e(Fe,{inline:!0,model:n,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"userFrom","status-icon":""},{default:t(()=>[e(p,{label:"菜单名称",prop:"label",rules:[{required:!0}]},{default:t(()=>[e(L,{modelValue:n.label,"onUpdate:modelValue":l[0]||(l[0]=o=>n.label=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"菜单标识",prop:"name",rules:[{required:!0}]},{default:t(()=>[e(L,{modelValue:n.name,"onUpdate:modelValue":l[1]||(l[1]=o=>n.name=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"路由",prop:"path"},{default:t(()=>[e(L,{modelValue:n.path,"onUpdate:modelValue":l[2]||(l[2]=o=>n.path=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"图标",prop:"icon",rules:[{required:!0}]},{default:t(()=>[e(b,{onClick:ne},{default:t(()=>[e(me,{icon:n.icon},null,8,["icon"])]),_:1}),e(ze,{isShow:q.value,"onUpdate:isShow":l[3]||(l[3]=o=>q.value=o),iconName:n.icon,"onUpdate:iconName":l[4]||(l[4]=o=>n.icon=o)},null,8,["isShow","iconName"])]),_:1}),e(p,{label:"序号",prop:"sort"},{default:t(()=>[e(De,{modelValue:n.sort,"onUpdate:modelValue":l[5]||(l[5]=o=>n.sort=o),placeholder:"",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"父级节点",prop:"parentid"},{default:t(()=>[e(Ne,{modelValue:n.parentid,"onUpdate:modelValue":l[6]||(l[6]=o=>n.parentid=o),ref_key:"elTreeSelectRef",ref:i,data:B.value,clearable:"","check-strictly":"","render-after-expand":!1,"node-key":"id",style:{width:"180px"}},null,8,["modelValue","data"])]),_:1}),e(p,{label:"描述",prop:"description"},{default:t(()=>[e(L,{modelValue:n.description,"onUpdate:modelValue":l[7]||(l[7]=o=>n.description=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"启用",prop:"status",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.status,"onUpdate:modelValue":l[8]||(l[8]=o=>n.status=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(p,{label:"缓存",prop:"keepalive",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.keepalive,"onUpdate:modelValue":l[9]||(l[9]=o=>n.keepalive=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(p,{label:"是否菜单",prop:"is_menu",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.is_menu,"onUpdate:modelValue":l[10]||(l[10]=o=>n.is_menu=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(p,{label:"详单"},{default:t(()=>[e(x,{modelValue:n.has_info,"onUpdate:modelValue":l[11]||(l[11]=o=>n.has_info=o),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),n.has_info?(y(),U(p,{key:0,label:"视图名"},{default:t(()=>[e(L,{modelValue:n.info_view_name,"onUpdate:modelValue":l[12]||(l[12]=o=>n.info_view_name=o),style:{width:"180px"}},null,8,["modelValue"])]),_:1})):re("",!0),e(_e,null,{default:t(()=>[e(fe,{span:6},{default:t(()=>[e(p,{label:"是否内嵌",prop:"is_iframe",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.is_iframe,"onUpdate:modelValue":l[13]||(l[13]=o=>n.is_iframe=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),e(fe,{span:18},{default:t(()=>[n.is_iframe?(y(),U(p,{key:0,label:"访问地址"},{default:t(()=>[e(L,{modelValue:n.iframe_url,"onUpdate:modelValue":l[14]||(l[14]=o=>n.iframe_url=o),style:{width:"300px"},type:"textarea"},null,8,["modelValue"])]),_:1})):re("",!0)]),_:1})]),_:1}),e(_e,{style:{"justify-content":"space-around"}},{default:t(()=>[e(p,null,{default:t(()=>[e(b,{onClick:le},{default:t(()=>[...l[18]||(l[18]=[M("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:_},{default:t(()=>[...l[19]||(l[19]=[M(" 确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Ye,{ref_key:"menuButtonComRef",ref:K,showDrawer:E.value,"onUpdate:showDrawer":l[16]||(l[16]=o=>E.value=o),nowMenu:H.value,onGetMenuData:C},null,8,["showDrawer","nowMenu"])])}}}),Ze=$e(Ke,[["__scopeId","data-v-c63fa8be"]]);export{Ze as default};
