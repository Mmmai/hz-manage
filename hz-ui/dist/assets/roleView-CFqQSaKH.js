import{d as pe,r as s,g as me,j as _e,x as fe,a as q,z as ge,v as ve,bP as ye,h as r,bc as A,c as $,o as u,b as F,f as o,bV as y,m,B as b,w as a,q as h,F as B,i as N,t as I,cc as be,cD as he,cd as we,c4 as L,b_ as c,aP as M,_ as Ce}from"./index-CWdEKdsq.js";const ke={class:"card"},xe={class:"user-header"},Ve=pe({__name:"roleView",setup($e){const J=s({}),{proxy:i}=me(),E=_e(),g=fe();q({search:""});const U=s(!1),v=s([]),K=s("auto"),z=s([{prop:"role",label:"角色名"},{prop:"role_name",label:"角色名称"}]),W=s({});ge(async()=>{await w()});const w=async()=>{let l=await i.$api.getRole();v.value=l.data.results;for(let e in v.value){let d=v.value[e].role,p=v.value[e].id;W.value[p]=d}},G=l=>{J.value=l},_=s(!1),n=q({role:"",role_name:"",rolePermission:[]}),R=s("add"),H=()=>{E.push({path:g.path+"/new"})},Q=()=>{_.value=!1,i.$refs.userFrom.resetFields()},X=l=>{L.confirm("是否确认关闭?").then(()=>{i.$refs.userFrom.resetFields(),l()}).catch(()=>{})},Y=ve(()=>{let l=new Array;return S.value.getCheckedNodes().forEach(e=>{e.tree_type==="button"&&l.push(e.id)}),l}),Z=()=>{n.rolePermission=Y.value,console.log(JSON.stringify(n)),i.$refs.userFrom.validate(async l=>{if(l)if(R.value=="add"){let e=await i.$api.roleadd(n);e.status==201?(_.value=!1,c({type:"success",message:"添加成功"}),i.$refs.userFrom.resetFields(),w(),console.log(S.value.getCheckedKeys())):c({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await i.$api.roleupdate({id:C.value.id,...n});console.log(e),e.status==200?(_.value=!1,i.$refs.userFrom.resetFields(),console.log(S.value.getCheckedKeys()),w(),c({type:"success",message:"更新成功"})):c({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else c({showClose:!0,message:"请输入正确内容.",type:"error"})})},C=s({}),ee=l=>{R.value="edit",C.value=l,_.value=!0,M(()=>{Object.keys(n).forEach(e=>{n[e]=l[e]})})},le=l=>{L.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await i.$api.roledel(l.id)).status==204?(c({type:"success",message:"删除成功"}),M(()=>{w()})):c({type:"error",message:"删除失败"})}).catch(()=>{c({type:"info",message:"取消删除"})})},te=s([]),oe=(l,e)=>l.role!="sysadmin",ae=l=>{te.value=l},S=s();s([]);const T=s(!1);ye(()=>n.role,l=>{l=="sysadmin"?T.value=!0:T.value=!1});const se=l=>{E.push({name:"permission",query:{role:l.id}})};return(l,e)=>{var j;const d=r("el-button"),p=r("el-table-column"),O=r("el-tag"),ne=r("el-tooltip"),re=r("el-table"),P=r("el-input"),D=r("el-form-item"),ie=r("el-row"),ue=r("el-form"),de=r("el-dialog"),k=A("permission"),ce=A("loading");return u(),$(B,null,[F("div",ke,[F("div",xe,[F("div",null,[y((u(),b(d,{type:"primary",onClick:H},{default:a(()=>[...e[3]||(e[3]=[h("新增",-1)])]),_:1})),[[k,`${(j=m(g).name)==null?void 0:j.replace("_info","")}:add`]])])]),F("div",null,[y((u(),b(re,{border:"",data:v.value,style:{width:"100%"},"max-height":"500px","highlight-current-row":"","table-layout":K.value,onSelectionChange:ae,onRowClick:G},{default:a(()=>[o(p,{type:"selection",width:"55",selectable:oe}),(u(!0),$(B,null,N(z.value,t=>(u(),b(p,{key:t.prop,label:t.label,prop:t.prop,width:"150"},null,8,["label","prop"]))),128)),o(p,{label:"关联用户组"},{default:a(t=>[(u(!0),$(B,null,N(t.row.associated_user_groups,(f,x)=>(u(),b(O,null,{default:a(()=>[h(I(f.group_name),1)]),_:2},1024))),256))]),_:1}),o(p,{label:"关联用户"},{default:a(t=>[(u(!0),$(B,null,N(t.row.associated_users,(f,x)=>(u(),b(O,null,{default:a(()=>[h(I(f.username),1)]),_:2},1024))),256))]),_:1}),o(p,{fixed:"right",label:"操作",width:"150"},{default:a(t=>{var f,x;return[y(o(d,{link:"",type:"primary",icon:m(be),onClick:V=>ee(t.row)},null,8,["icon","onClick"]),[[k,`${(f=m(g).name)==null?void 0:f.replace("_info","")}:edit`]]),o(ne,{content:"权限配置",placement:"top"},{default:a(()=>{var V;return[y(o(d,{link:"",type:"primary",icon:m(he),onClick:Fe=>se(t.row)},null,8,["icon","onClick"]),[[k,`${(V=m(g).name)==null?void 0:V.replace("_info","")}:edit`]])]}),_:2},1024),y(o(d,{disabled:t.row.built_in,"icon-position":"right",link:"",type:"danger",icon:m(we),onClick:V=>le(t.row)},null,8,["disabled","icon","onClick"]),[[k,`${(x=m(g).name)==null?void 0:x.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data","table-layout"])),[[ce,U.value]])])]),o(de,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),title:R.value=="add"?"新增角色":"编辑角色",width:"30%","before-close":X},{default:a(()=>[o(ue,{model:n,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"userFrom","status-icon":""},{default:a(()=>[o(D,{label:"角色",prop:"role",rules:[{required:!0}]},{default:a(()=>[o(P,{modelValue:n.role,"onUpdate:modelValue":e[0]||(e[0]=t=>n.role=t),placeholder:"请输入英文",clearable:"",style:{width:"30%"},disabled:C.value.built_in},null,8,["modelValue","disabled"])]),_:1}),o(D,{label:"角色名称",prop:"role_name",rules:[{required:!0}]},{default:a(()=>[o(P,{modelValue:n.role_name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.role_name=t),placeholder:"中文名称",style:{width:"30%"},clearable:"",disabled:C.value.built_in},null,8,["modelValue","disabled"])]),_:1}),o(ie,{style:{"justify-content":"space-around"}},{default:a(()=>[o(D,null,{default:a(()=>[o(d,{onClick:Q},{default:a(()=>[...e[4]||(e[4]=[h("取消",-1)])]),_:1}),o(d,{type:"primary",onClick:Z},{default:a(()=>[...e[5]||(e[5]=[h(" 确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}}),Re=Ce(Ve,[["__scopeId","data-v-92a7e2ef"]]);export{Re as default};
