import{d as M,aJ as O,g as q,bw as D,r as w,bK as U,e as y,q as d,o as f,w as o,b as i,k as s,i as c,aL as H,aK as W,_ as G}from"./index-BuQNgUX_.js";const Q={class:"my-header"},j=["id"],z=["innerHTML"],J={class:"dialog-footer"},P=M({__name:"nearLogCom",props:O(["url","highlightKey"],{isShow:{},isShowModifiers:{}}),emits:["update:isShow"],setup(x,{expose:T}){const{proxy:u}=q(),N=(t,e)=>{if(e){const l=new RegExp(e,"gi");return t.replace(l,'<span style="background-color: #ff9b2d;">$&</span>')}else return t},b=D(x,"isShow"),h=x,R=w(10),_=w(10),$=async()=>{R.value+=10,await k(m.value),v(u.$refs.nearLogRef,0)},C=async()=>{_.value+=10,await k(m.value),v(u.$refs.nearLogRef,p.value.length)},A=()=>{R.value=10,_.value=10,L.value=0},p=w([]),m=w(""),k=async t=>{let l=(await u.$api.lokiNearQuery({url:h.url,targetLog:t,limit:R.value,direction:"backward"})).data.queryResult,n=(await u.$api.lokiNearQuery({url:h.url,targetLog:t,limit:_.value,direction:"forward"})).data.queryResult;p.value=[...l,...n]},S=async t=>{m.value=t,b.value=!0,await k(t),W(()=>{v(u.$refs.nearLogRef,L.value)})};function v(t,e,l=!0){const a=t.$el.querySelectorAll(".el-table__body tbody .el-table__row");let n=0;for(let g=0;g<a.length&&g!==e;g++)if(n+=a[g].offsetHeight,!l){n*=e-2;break}t.scrollTo(0,n)}const L=w(0);U(()=>p.value,t=>{L.value=t.findIndex(e=>e.lokiTime===m.value.lokiTime)});const F=()=>{v(u.$refs.nearLogRef,L.value)},B=({row:t})=>{if(t.lokiTime==m.value.lokiTime)return"highlight-class"},I=t=>{let e=[];t.forEach(a=>{e.push(`${a.logTime},${a.level},${a.logLine}
`)});let l=u.$commonFunc.getCurrentTimeString("-","-","_",":",":");console.log(l),u.$commonFunc.downloadArray(`export-log-${l}`,e)};return T({showNearLog:S}),(t,e)=>{const l=y("el-button"),a=y("el-table-column"),n=y("el-tag"),g=y("el-table"),V=y("el-dialog");return f(),d(V,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=r=>b.value=r),title:"日志上下文",width:"95%",top:"9vh",onClose:A},{header:o(({close:r,titleId:E,titleClass:K})=>[c("div",Q,[c("div",{id:E,class:H(K),style:{display:"flex","justify-content":"space-between"}},[e[3]||(e[3]=c("span",null,"日志上下文",-1)),i(l,{type:"primary",onClick:e[0]||(e[0]=X=>I(p.value)),style:{"margin-right":"20px"}},{default:o(()=>[...e[2]||(e[2]=[s(" 下载日志 ",-1)])]),_:1})],10,j)])]),footer:o(()=>[c("div",J,[i(l,{type:"primary",onClick:$},{default:o(()=>[...e[10]||(e[10]=[s("往前翻",-1)])]),_:1}),i(l,{type:"primary",onClick:C},{default:o(()=>[...e[11]||(e[11]=[s("往后翻",-1)])]),_:1}),i(l,{type:"primary",onClick:F},{default:o(()=>[...e[12]||(e[12]=[s("跳转到分析行",-1)])]),_:1})])]),default:o(()=>[i(g,{data:p.value,ref:"nearLogRef",style:{width:"100%"},height:"600","row-class-name":B},{default:o(()=>[i(a,{type:"index",width:"50"}),i(a,{label:"日志时间",prop:"logTime",width:"200px"}),i(a,{label:"日志等级",prop:"level",width:"100px"},{default:o(r=>[r.row.level=="DEBUG"?(f(),d(n,{key:0,type:"primary",effect:"light"},{default:o(()=>[...e[4]||(e[4]=[s("DEBUG",-1)])]),_:1})):r.row.level=="INFO"?(f(),d(n,{key:1,type:"success",effect:"light"},{default:o(()=>[...e[5]||(e[5]=[s("INFO",-1)])]),_:1})):r.row.level=="WARN"?(f(),d(n,{key:2,type:"warning",effect:"light"},{default:o(()=>[...e[6]||(e[6]=[s("WARN",-1)])]),_:1})):r.row.level=="ERROR"?(f(),d(n,{key:3,type:"danger",effect:"light"},{default:o(()=>[...e[7]||(e[7]=[s("ERROR",-1)])]),_:1})):r.row.level=="FATAL"?(f(),d(n,{key:4,type:"danger",effect:"light"},{default:o(()=>[...e[8]||(e[8]=[s("FATAL",-1)])]),_:1})):(f(),d(n,{key:5,type:"info",effect:"light"},{default:o(()=>[...e[9]||(e[9]=[s("UNKNOWN",-1)])]),_:1}))]),_:1}),i(a,{label:"日志内容"},{default:o(({row:r})=>[c("span",{innerHTML:N(r.logLine,h.highlightKey)},null,8,z)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}}),Z=G(P,[["__scopeId","data-v-d830aa43"]]);export{Z as n};
