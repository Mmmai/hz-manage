import{i as ol}from"./iconSelectCom-am8MHlDs.js";import{d as qe,u as he,b as Se,bu as al,r,M as ce,c as fe,e as n,b3 as Ne,o as g,f as D,h as S,g as e,w as t,F as Q,b1 as ae,O as B,j as V,t as se,bO as C,bQ as ze,bo as x,c0 as Ae,c1 as Je,P as De,aE as sl,bF as pe,c4 as p,bV as ve,aD as $e,k as je,_ as Ee,a as nl,aN as dl,aS as ul,aI as il}from"./index-_vkwOwvB.js";import{u as rl}from"./tabs-CtIzyNYh.js";import{l as ml}from"./vue-draggable-plus-DcZAH-MI.js";import{I as pl}from"./iconify-BS6TKW9u.js";const cl={class:"operation_show"},fl={class:"dialog-footer"},vl={class:"demo-drawer__content"},_l={style:{float:"left"}},bl={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},gl={class:"demo-drawer__footer"},yl=qe({__name:"ciModelField",props:{ciModelInfo:{},ciModelInfoModifiers:{}},emits:["update:ciModelInfo"],setup(ye,{expose:A}){const{proxy:F}=je(),h=he(),w=Se(),E=al(ye,"ciModelInfo"),R=r([]),Y=r([]),_e=r([]),k=ce(()=>{let o=[];return R.value.forEach(l=>{l.fields.forEach(i=>{i.type==="model_ref"&&o.push(i.ref_model)})}),o}),M=ce(()=>{var l;let o=[];return(l=_e.value)==null||l.forEach(i=>{i.id!==E.value.id&&(k.value.indexOf(i.id)===-1?o.push({value:i.id,label:i.verbose_name,disabled:!1}):o.push({value:i.id,label:i.verbose_name,disabled:!0}))}),o}),J=()=>{s.default="",s.validation_rule="",s.type=="boolean"?s.default=!0:s.type=="enum"?N.value=!0:s.type=="string"&&(N.value=!1)},K=r([]),Z=o=>{let l=JSON.parse(ie.value[o].rule),i=[];Object.keys(l).forEach(v=>{i.push({value:v,label:l[v]})}),K.value=i},G=o=>{let l=JSON.parse(ie.value[o].rule),i=[];Object.keys(l).forEach(v=>{i.push({value:v,label:l[v]})}),K.value=i,s.default!=K.value[0].value&&(s.default=K.value[0].value)},N=r(!1),W=ce(()=>s.type==="fromModel"),y=r([]),ne=async(o=null)=>{let l=await F.$api.getValidationRules({page:1,page_size:1e4,...o});y.value=l.data.results,l.data.results.forEach(i=>{ie.value[i.id]=i})},ie=r({}),X=ce(()=>{let o=[];return y.value.forEach(l=>{l.field_type==s.type&&o.push({value:l.id,label:l.verbose_name})}),o}),U=async()=>{let o=await F.$api.getCiModel(w.query,w.query.id);E.value=o.data.model,R.value=o.data.field_groups,Y.value=o.data.field_groups.map(l=>l.verbose_name)},b=r([]),d=r([]);A({getModelField:U,getCiModelList:async()=>{let o=await F.$api.getCiModel();_e.value=o.data.results},getRules:ne,getModelFieldType:async()=>{let o=await F.$api.getCiModelFieldType(),l=o.data.field_types;Object.keys(l).forEach(i=>{b.value.push({value:i,label:l[i]})}),d.value=o.data.limit_fields}});const $=fe({name:"",verbose_name:""}),be=(o,l,i)=>{console.log(l),d.value.includes(l)?i(new Error(`${d.value.join(",")}不能用!`)):i()},m=fe({name:[{required:!0,message:"请输入唯一标识",trigger:"blur"},{pattern:/^[a-z][\w\d]{4,20}$/,trigger:"blur",message:"以英文字符开头,可以使用英文,数字,下划线,长度4-20 "}],verbose_name:[{required:!0,message:"请输入组名称",trigger:"blur"}]}),u=r(),I=r(!1),j=o=>{I.value=!1,oe(o)},ee=r(!1),le=r(""),we=async o=>{o&&await o.validate(async(l,i)=>{if(l)if(ee.value){console.log($);let v=await F.$api.addCiModelFieldGroup({model:E.value.id,create_user:h.state.username,update_user:h.state.username,...$});console.log(v),v.status=="201"?(p({type:"success",message:"添加成功"}),I.value=!1,oe(o),U()):p({showClose:!0,message:"添加失败:"+JSON.stringify(v.data),type:"error"})}else{let v=await F.$api.updateCiModelFieldGroup({id:le.value,update_user:h.state.username,...$});console.log(v),v.status=="200"?(p({type:"success",message:"更新成功"}),I.value=!1,oe(o),U()):p({showClose:!0,message:"更新失败:"+JSON.stringify(v.data),type:"error"})}else console.log("error submit!",i)})},de=o=>{ve.confirm("是否确认关闭?").then(()=>{o(),oe(u.value)}).catch(()=>{})},c=r("新增"),T=o=>{c.value="新增",$e(()=>{}),I.value=!0,ee.value=!0},P=o=>{c.value="修改",I.value=!0,$e(()=>{ee.value=!1,$.name=o.name,$.verbose_name=o.verbose_name,le.value=o.id})},xe=o=>{ve.confirm("是否确认删除?","删除组",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let l=await F.$api.deleteCiModelFieldGroup(o);l.status==204||l.status==200?(p({type:"success",message:"删除成功"}),await U()):p({type:"error",message:"删除失败"})}).catch(()=>{p({type:"info",message:"取消删除"})})},H=r(!1),s=fe({name:"",verbose_name:"",type:"string",required:!1,editable:!0,validation_rule:"",ref_model:"",description:"",default:"",unit:""}),Ue=fe({name:[{required:!0,message:"请输入唯一标识",trigger:"blur"},{pattern:/^[a-z][\w\d]{1,20}$/,trigger:"blur",message:"以英文字符开头,可以使用英文,数字,下划线,长度2-20 ",required:!0},{validator:be,trigger:"blur"}],verbose_name:[{required:!0,message:"请输入字段显示名称",trigger:"blur"}],type:[{required:!0,message:"字段类型",trigger:"blur"}],model_name:[{required:W,message:"请选择模型",trigger:"blur"}],validation_rule:[{required:N,message:"选择校验规则",trigger:""}]}),re=r();r(!1);const te=r(!1),f=r({}),ue=r(!0),Oe=o=>{H.value=!0,c.value="修改",te.value=!0,f.value=o,ue.value=!1,$e(()=>{Object.keys(o).forEach(l=>{s.hasOwnProperty(l)&&(s[l]=o[l])}),s.validation_rule===null?N.value=!1:N.value=!0})},Ge=o=>{oe(o),console.log(s),H.value=!1},Pe=o=>{c.value="新增",f.value={},H.value=!0,ue.value=!0,te.value=!1,N.value=!1,$e(()=>{le.value=o.id})},He=async o=>{o&&await o.validate(async(l,i)=>{if(l)if(ue.value){let v=await F.$api.addCiModelField({model:E.value.id,model_field_group:le.value,create_user:h.state.username,update_user:h.state.username,...s});console.log(v),v.status=="201"?(p({type:"success",message:"添加成功"}),H.value=!1,oe(o),U()):p({showClose:!0,message:"添加失败:"+JSON.stringify(v.data),type:"error"})}else{N.value||(s.validation_rule="");let v=await F.$api.updateCiModelField({id:f.value.id,update_user:h.state.username,...s});console.log(v),v.status=="200"?(p({type:"success",message:"更新成功"}),H.value=!1,oe(o),U()):p({showClose:!0,message:"更新失败:"+JSON.stringify(v.data),type:"error"})}else console.log("error submit!",i)})},Qe=o=>{ve.confirm("是否确认关闭?").then(()=>{o(),oe(re.value),H.value=!1}).catch(()=>{})},Ke=o=>{ve.confirm("是否确认删除?","删除组",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await F.$api.deleteCiModelField(f.value.id)).status==204?(p({type:"success",message:"删除成功"}),await U(),oe(re.value),H.value=!1):p({type:"error",message:"删除失败"})}).catch(()=>{p({type:"info",message:"取消删除"})})},oe=o=>{o&&o.resetFields()},We=async(o,l)=>{if(o.oldIndex==o.newIndex)return;if(o.pullMode){console.log("跨组移动，在onAdd中触发");return}let i=await F.$api.updateCiModelField({id:o.data.id,order:o.newIndex+1});i.status=="200"?p({type:"success",message:"更新排序成功"}):p({showClose:!0,message:"更新排序失败:"+JSON.stringify(i.data),type:"error"}),U()},Xe=async(o,l)=>{let i=await F.$api.updateCiModelField({id:o.data.id,order:o.newIndex+1,model_field_group:l.id});i.status=="200"?p({type:"success",message:"更新排序成功"}):p({showClose:!0,message:"更新排序失败:"+JSON.stringify(i.data),type:"error"}),U()};return(o,l)=>{const i=n("el-text"),v=n("el-button"),Ve=n("el-tooltip"),Ye=n("el-space"),Ie=n("el-col"),Te=n("el-row"),Le=n("el-card"),Ze=n("el-collapse-item"),el=n("el-collapse"),ge=n("el-input"),L=n("el-form-item"),Be=n("el-form"),ll=n("el-dialog"),ke=n("el-switch"),Ce=n("el-option"),Fe=n("el-select"),tl=n("el-drawer"),me=Ne("permission");return g(),D(Q,null,[S("div",null,[e(el,{modelValue:Y.value,"onUpdate:modelValue":l[0]||(l[0]=_=>Y.value=_)},{default:t(()=>[(g(!0),D(Q,null,ae(R.value,(_,Me)=>(g(),B(Ze,{name:_.verbose_name,key:Me},{title:t(()=>[e(i,{tag:"b",size:"large"},{default:t(()=>[V(se(_.verbose_name),1)]),_:2},1024),S("div",cl,[_.built_in?De("",!0):(g(),B(Ye,{key:0},{default:t(()=>{var a;return[C((g(),B(Ve,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:t(()=>{var q;return[C(e(v,{size:"small",onClick:ze(Re=>P(_),["stop"]),icon:x(Ae),circle:""},null,8,["onClick","icon"]),[[me,`${(q=x(w).name)==null?void 0:q.replace("_info","")}:edit`]])]}),_:2},1024)),[[me,`${(a=x(w).name)==null?void 0:a.replace("_info","")}:edit`]]),e(Ve,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var q;return[C(e(v,{size:"small",onClick:ze(Re=>xe(_.id),["stop"]),icon:x(Je),circle:""},null,8,["onClick","icon"]),[[me,`${(q=x(w).name)==null?void 0:q.replace("_info","")}:delete`]])]}),_:2},1024)]}),_:2},1024))])]),default:t(()=>[S("div",null,[e(x(ml),{ref_for:!0,ref:"el",group:"modelField",modelValue:_.fields,"onUpdate:modelValue":a=>_.fields=a,onEnd:a=>We(a,_),onAdd:a=>Xe(a,_),style:{width:"100%","flex-wrap":"wrap",display:"flex",gap:"10px","justify-items":"flex-start"}},{default:t(()=>{var a;return[(g(!0),D(Q,null,ae(_.fields,(q,Re)=>(g(),D("div",{key:Re},[e(Ve,{effect:"light",content:"点击编辑字段",placement:"top"},{default:t(()=>[e(Le,{shadow:"hover",class:sl(["modelFieldCard",q.built_in?"isBuiltClass":""]),onClick:Ol=>Oe(q)},{default:t(()=>[e(i,{tag:"b"},{default:t(()=>[V(se(q.verbose_name),1)]),_:2},1024),e(Te,{justify:"space-between"},{default:t(()=>[e(Ve,{class:"box-item",effect:"light",content:q.name,placement:"bottom"},{default:t(()=>[e(Ie,{span:13,class:"describe-class"},{default:t(()=>[e(i,null,{default:t(()=>[V(se(q.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"]),e(Ve,{class:"box-item",effect:"light",content:q.type,placement:"bottom"},{default:t(()=>[e(Ie,{span:10,class:"describe-class"},{default:t(()=>[e(i,null,{default:t(()=>[V(se(q.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024)]))),128)),S("div",null,[C((g(),B(Le,{class:"modelFieldCard",style:{"align-items":"center","justify-content":"center"},onClick:q=>Pe(_)},{default:t(()=>[e(i,{type:"primary"},{default:t(()=>l[26]||(l[26]=[V("+ 添加字段")])),_:1})]),_:2},1032,["onClick"])),[[me,`${(a=x(w).name)==null?void 0:a.replace("_info","")}:add`]])])]}),_:2},1032,["modelValue","onUpdate:modelValue","onEnd","onAdd"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),e(Te,{style:{"margin-top":"10px"}},{default:t(()=>[e(Ie,null,{default:t(()=>{var _;return[C((g(),B(v,{bg:"",text:"",onClick:l[1]||(l[1]=Me=>T(E.value))},{default:t(()=>l[27]||(l[27]=[V("添加分组")])),_:1})),[[me,`${(_=x(w).name)==null?void 0:_.replace("_info","")}:add`]])]}),_:1})]),_:1})]),e(ll,{modelValue:I.value,"onUpdate:modelValue":l[6]||(l[6]=_=>I.value=_),title:c.value+"字段分组",width:"500","before-close":de},{footer:t(()=>[S("div",fl,[e(v,{onClick:l[4]||(l[4]=_=>j(u.value))},{default:t(()=>l[28]||(l[28]=[V("取消")])),_:1}),e(v,{type:"primary",onClick:l[5]||(l[5]=_=>we(u.value))},{default:t(()=>l[29]||(l[29]=[V(" 确认 ")])),_:1})])]),default:t(()=>[e(Be,{ref_key:"groupFormRef",ref:u,style:{"max-width":"600px"},model:$,rules:m,"label-width":"auto",class:"demo-modelForm","status-icon":""},{default:t(()=>[e(L,{label:"字段组标识",prop:"name"},{default:t(()=>[e(ge,{modelValue:$.name,"onUpdate:modelValue":l[2]||(l[2]=_=>$.name=_),disabled:!ee.value},null,8,["modelValue","disabled"])]),_:1}),e(L,{label:"字段分组名称",prop:"verbose_name"},{default:t(()=>[e(ge,{modelValue:$.verbose_name,"onUpdate:modelValue":l[3]||(l[3]=_=>$.verbose_name=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(tl,{modelValue:H.value,"onUpdate:modelValue":l[25]||(l[25]=_=>H.value=_),title:"模型字段","before-close":Qe,direction:"rtl",class:"demo-drawer"},{default:t(()=>{var _,Me;return[S("div",vl,[e(Be,{model:s,ref_key:"modelFieldFormRef",ref:re,"label-width":"auto","label-position":"right",rules:Ue},{default:t(()=>[e(L,{label:"唯一标识",prop:"name"},{default:t(()=>[e(ge,{modelValue:s.name,"onUpdate:modelValue":l[7]||(l[7]=a=>s.name=a),autocomplete:"off",disabled:!!(f.value.built_in||te.value)},null,8,["modelValue","disabled"])]),_:1}),e(L,{label:"显示名称",prop:"verbose_name"},{default:t(()=>[e(ge,{modelValue:s.verbose_name,"onUpdate:modelValue":l[8]||(l[8]=a=>s.verbose_name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(L,{label:"可编辑",prop:"editable"},{default:t(()=>[e(ke,{modelValue:s.editable,"onUpdate:modelValue":l[9]||(l[9]=a=>s.editable=a),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:f.value.built_in},null,8,["modelValue","disabled"])]),_:1}),e(L,{label:"必填",prop:"required"},{default:t(()=>[e(ke,{modelValue:s.required,"onUpdate:modelValue":l[10]||(l[10]=a=>s.required=a),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),e(L,{label:"字段类型",prop:"type"},{default:t(()=>[e(Fe,{modelValue:s.type,"onUpdate:modelValue":l[11]||(l[11]=a=>s.type=a),placeholder:"Select",style:{width:"240px"},onChange:J,disabled:!!(f.value.built_in||te.value)},{default:t(()=>[(g(!0),D(Q,null,ae(b.value,a=>(g(),B(Ce,{key:a.value,label:a.label,value:a.value},{default:t(()=>[S("span",_l,se(a.label),1),S("span",bl,se(a.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),C(e(L,{label:"校验规则",prop:"validation_rule"},{default:t(()=>[e(ke,{modelValue:N.value,"onUpdate:modelValue":l[12]||(l[12]=a=>N.value=a),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"}},null,8,["modelValue"]),C(e(Fe,{modelValue:s.validation_rule,"onUpdate:modelValue":l[13]||(l[13]=a=>s.validation_rule=a),placeholder:"选择校验规则",style:{width:"240px"}},{default:t(()=>[(g(!0),D(Q,null,ae(X.value,a=>(g(),B(Ce,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),[[pe,N.value]])]),_:1},512),[[pe,s.type==="string"]]),C(e(L,{label:"枚举值",prop:"validation_rule"},{default:t(()=>[e(Fe,{modelValue:s.validation_rule,"onUpdate:modelValue":l[14]||(l[14]=a=>s.validation_rule=a),placeholder:"选择校验规则",style:{width:"240px"},onChange:l[15]||(l[15]=a=>G(s.validation_rule))},{default:t(()=>[(g(!0),D(Q,null,ae(X.value,a=>(g(),B(Ce,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},512),[[pe,s.type==="enum"]]),C(e(L,{label:"默认值",prop:"default"},{default:t(()=>[e(Fe,{modelValue:s.default,"onUpdate:modelValue":l[16]||(l[16]=a=>s.default=a),placeholder:"选择默认值",size:"large",onVisibleChange:l[17]||(l[17]=a=>Z(s.validation_rule))},{default:t(()=>[(g(!0),D(Q,null,ae(K.value,(a,q)=>(g(),B(Ce,{key:q,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},512),[[pe,s.type==="enum"]]),C(e(L,{label:"模型引用",prop:"ref_model"},{default:t(()=>[e(Fe,{modelValue:s.ref_model,"onUpdate:modelValue":l[18]||(l[18]=a=>s.ref_model=a),placeholder:"选择CI模型",disabled:!!(f.value.built_in||te.value)},{default:t(()=>[(g(!0),D(Q,null,ae(M.value,a=>(g(),B(Ce,{key:a.value,label:a.label,disabled:a.disabled,value:a.value},null,8,["label","disabled","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},512),[[pe,s.type==="model_ref"]]),C(e(L,{label:"默认值",prop:"default"},{default:t(()=>[e(ke,{modelValue:s.default,"onUpdate:modelValue":l[19]||(l[19]=a=>s.default=a),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1},512),[[pe,s.type==="boolean"]]),C(e(L,{label:"单位",prop:"unit"},{default:t(()=>[e(ge,{modelValue:s.unit,"onUpdate:modelValue":l[20]||(l[20]=a=>s.unit=a),style:{width:"120px"}},null,8,["modelValue"])]),_:1},512),[[pe,s.type==="integer"||s.type==="float"]]),e(L,{label:"描述",prop:"description"},{default:t(()=>[e(ge,{modelValue:s.description,"onUpdate:modelValue":l[21]||(l[21]=a=>s.description=a),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),S("div",gl,[e(v,{onClick:l[22]||(l[22]=a=>Ge(re.value))},{default:t(()=>l[30]||(l[30]=[V("取消")])),_:1}),te.value&&!f.value.built_in?C((g(),B(v,{key:0,type:"danger",onClick:l[23]||(l[23]=a=>Ke())},{default:t(()=>l[31]||(l[31]=[V("删除")])),_:1})),[[me,`${(_=x(w).name)==null?void 0:_.replace("_info","")}:delete`]]):De("",!0),C((g(),B(v,{type:"primary",onClick:l[24]||(l[24]=a=>He(re.value))},{default:t(()=>l[32]||(l[32]=[V(" 确定 ")])),_:1})),[[me,`${(Me=x(w).name)==null?void 0:Me.replace("_info","")}:edit`]])])])]}),_:1},8,["modelValue"])],64)}}}),wl=Ee(yl,[["__scopeId","data-v-e3af39e0"]]),Vl={style:{width:"100%"}},Cl={class:"table-header"},Fl={class:"header-button-lf"},Ml={class:"dialog-footer"},$l=qe({__name:"ciModelUnique",props:["modelId","modelFieldLists"],setup(ye,{expose:A}){const F=Se(),{proxy:h}=je(),w=he(),E=r([]),R=ye,Y=()=>{console.log(R.modelFieldLists),J.value=!0,Z.value=!0},_e=ce(()=>{let b={};return R.modelFieldLists.forEach(d=>{b[d.name]=d.verbose_name}),b}),k=r(""),M=fe({fields:[],validate_null:!1,description:null}),J=r(!1),K=()=>{J.value=!1,W(k.value),console.log(M)},Z=r(!0),G=r({}),N=b=>{G.value=b,J.value=!0,Z.value=!1,$e(()=>{Object.keys(b).forEach(d=>{d!=="id"&&Object.keys(M).indexOf(d)!==-1&&(M[d]=b[d])})})},W=b=>{b&&(console.log(M),b.resetFields(),G.value={},console.log(M))},y=async b=>{await b.validate(async(d,z)=>{if(d)if(Z.value){let O=await h.$api.addCiModelUnique({create_user:w.state.username,update_user:w.state.username,...M,model:R.modelId});O.status=="201"?(p({type:"success",message:"添加成功"}),J.value=!1,W(b),U({model:R.modelId})):p({showClose:!0,message:"添加失败:"+JSON.stringify(O.data),type:"error"})}else{let O=await h.$api.updateCiModelUnique({id:G.value.id,update_user:w.state.username,...M});console.log(O),O.status=="200"?(p({type:"success",message:"更新成功"}),J.value=!1,W(b),U({model:R.modelId})):p({showClose:!0,message:"更新失败:"+JSON.stringify(O.data),type:"error"})}})},ne=async b=>{let d=await h.$api.updateCiModelUnique({update_user:w.state.username,...b});d.status=="200"?(p({type:"success",message:"更新成功"}),W(k.value),U({model:R.modelId})):p({showClose:!0,message:"更新失败:"+JSON.stringify(d.data),type:"error"})},ie=b=>{ve.confirm("是否确认删除?","删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await h.$api.deleteCiModelUnique(b)).status==204?(p({type:"success",message:"删除成功"}),U({model:R.modelId}),W(k.value),J.value=!1):p({type:"error",message:"删除失败"})}).catch(()=>{p({type:"info",message:"取消删除"})})},X=ce(()=>{let b={};return E.value.forEach(d=>{var O;let z=d.fields.map($=>_e.value[$]);b[(O=d.fields)==null?void 0:O.join("+")]=z.join("+")}),b}),U=async b=>{let d=await h.$api.getCiModelUnique(b);E.value=d.data.results};return A({getTableData:U}),(b,d)=>{const z=n("el-button"),O=n("el-table-column"),$=n("el-switch"),be=n("el-tooltip"),m=n("el-table"),u=n("el-option"),I=n("el-select"),j=n("el-form-item"),ee=n("el-input"),le=n("el-form"),we=n("el-dialog"),de=Ne("permission");return g(),D("div",Vl,[S("div",Cl,[S("div",Fl,[e(z,{type:"primary",onClick:Y},{default:t(()=>d[5]||(d[5]=[V("添加")])),_:1})])]),e(m,{ref:"multipleTableRef",data:E.value,style:{width:"100%"},border:""},{default:t(()=>[e(O,{prop:"fields",label:"校验规则"},{default:t(c=>[S("span",null,se(X.value[c.row.fields.join("+")]),1)]),_:1}),e(O,{prop:"validate_null",label:"空值校验"},{default:t(c=>{var T;return[C(e($,{modelValue:c.row.validate_null,"onUpdate:modelValue":P=>c.row.validate_null=P,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:P=>ne({id:c.row.id,validate_null:c.row.validate_null}),disabled:c.row.built_in},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),[[de,{id:`${(T=x(F).name)==null?void 0:T.replace("_info","")}:edit`,action:"disabled"}]])]}),_:1}),e(O,{prop:"description",label:"描述"}),e(O,{fixed:"right",width:"100",label:"操作"},{default:t(c=>[e(be,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:t(()=>{var T;return[C(e(z,{link:"",type:"primary",icon:x(Ae),onClick:P=>N(c.row)},null,8,["icon","onClick"]),[[de,`${(T=x(F).name)==null?void 0:T.replace("_info","")}:edit`]])]}),_:2},1024),e(be,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var T;return[C(e(z,{link:"",type:"danger",icon:x(Je),disabled:c.row.built_in,onClick:P=>ie(c.row.id)},null,8,["icon","disabled","onClick"]),[[de,`${(T=x(F).name)==null?void 0:T.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"]),e(we,{modelValue:J.value,"onUpdate:modelValue":d[4]||(d[4]=c=>J.value=c),title:"唯一校验配置",width:"500","before-close":K},{footer:t(()=>[S("div",Ml,[e(z,{onClick:K},{default:t(()=>d[6]||(d[6]=[V("取消")])),_:1}),e(z,{type:"primary",onClick:d[3]||(d[3]=c=>y(k.value))},{default:t(()=>d[7]||(d[7]=[V(" 提交 ")])),_:1})])]),default:t(()=>[e(le,{inline:!0,"label-position":"right",model:M,"label-width":"auto",ref_key:"formRef",ref:k},{default:t(()=>[e(j,{label:"唯一校验组合",prop:"fields"},{default:t(()=>[e(I,{modelValue:M.fields,"onUpdate:modelValue":d[0]||(d[0]=c=>M.fields=c),fields:"选择字段组合",multiple:"","multiple-limit":5,clearable:"",filterable:"",style:{width:"240px"},disabled:!!(G.value.built_in||!Z.value)},{default:t(()=>[(g(!0),D(Q,null,ae(ye.modelFieldLists,(c,T)=>(g(),B(u,{label:c.verbose_name,value:c.name,key:T},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),e(j,{label:"空置校验",prop:"validate_null"},{default:t(()=>[e($,{modelValue:M.validate_null,"onUpdate:modelValue":d[1]||(d[1]=c=>M.validate_null=c),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:G.value.built_in},null,8,["modelValue","disabled"])]),_:1}),e(j,{label:"描述",prop:"description"},{default:t(()=>[e(ee,{modelValue:M.description,"onUpdate:modelValue":d[2]||(d[2]=c=>M.description=c),style:{width:"240px"},autosize:{minRows:2,maxRows:4},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),xl={class:"card"},kl={class:"dialog-footer"},Ul=qe({__name:"modelinfoView",setup(ye){const A=Se(),F=rl(),h=r(""),w=r("");nl();const E=he(),{proxy:R}=je();r("");const Y=r([]),_e=async()=>{let m=await R.$api.getCiModelGroup();console.log(m),Y.value=m.data.results,console.log(Y.value)},k=r({}),M=async()=>{let m=await R.$api.getCiModel(A.query,A.query.id);k.value=m.data.model},J=r([]),K=(m,u)=>{m.props.name==="verification"?h.value.getTableData({model:W.value}):m.props.name},Z=r("field");console.log(A);const G=r(!1),N=()=>{G.value=!0};r("ElemeFilled");const W=ce(()=>{var m;return(m=k.value)==null?void 0:m.id}),y=fe({name:"",verbose_name:"",model_group:"",icon:"ElemeFilled",built_in:!1,update_user:"admin"}),ne=r(),ie=fe({name:[{required:!0,message:"请输入模型标识",trigger:"blur"},{pattern:/^[a-z][a-z_]{3,20}$/,trigger:"blur",message:"以英文字符开头,可以使用英文,下划线,长度3-20 ",required:!0}],verbose_name:[{required:!0,message:"请输入模型名称",trigger:"blur"}],model_group:[{required:!0,message:"请选择分组",trigger:"blur"}]});r(!1);const X=r(!1),U=m=>{X.value=!1,z(m)},b=async m=>{m&&await m.validate(async(u,I)=>{if(u){let j=await R.$api.updateCiModel({id:$.value,...y});console.log(j),j.status=="200"?(p({type:"success",message:"更新成功"}),X.value=!1,z(m),getCiModelInfo(A.query,A.query.id)):p({showClose:!0,message:"添加失败:"+JSON.stringify(j.data),type:"error"})}})},d=m=>{ve.confirm("是否确认关闭?").then(()=>{m(),z(ne.value)}).catch(()=>{})},z=m=>{m&&m.resetFields()},O=m=>{ve.confirm("是否确认删除?","删除组",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await R.$api.deleteCiModel(m)).status==204?(p({type:"success",message:"删除成功"}),F.removeTabs(A.path,!0)):p({type:"error",message:"删除失败"})}).catch(()=>{p({type:"info",message:"取消删除"})})},$=r(""),be=m=>{console.log(m),y.icon=m.icon,y.verbose_name=m.verbose_name,y.name=m.name,y.model_group=m.model_group,y.update_user=E.state.username,console.log(y),X.value=!0,$.value=m.id,_e()};return dl(async()=>{console.log("onMount"),await M(),await w.value.getModelField(),await w.value.getCiModelList(),await w.value.getRules(),await w.value.getModelFieldType()}),ul(()=>{console.log("onUnmounted")}),il(()=>{console.log("onBeforeMount")}),(m,u)=>{const I=n("el-button"),j=n("el-text"),ee=n("el-space"),le=n("el-col"),we=n("el-row"),de=n("el-tab-pane"),c=n("el-tabs"),T=n("el-scrollbar"),P=n("el-form-item"),xe=n("el-input"),H=n("el-option"),s=n("el-select"),Ue=n("el-form"),re=n("el-dialog"),te=Ne("permission");return g(),D(Q,null,[S("div",xl,[e(T,null,{default:t(()=>[e(we,{class:"cimodelinfo",justify:"space-between"},{default:t(()=>[e(le,{span:20},{default:t(()=>[e(ee,{size:30,style:{width:"40%"}},{default:t(()=>[e(I,{size:"large",circle:"",disabled:"",style:{margin:"10px"}},{default:t(()=>[e(x(pl),{icon:k.value.icon},null,8,["icon"])]),_:1}),e(j,null,{default:t(()=>[u[11]||(u[11]=V("唯一标识:   ")),e(j,{tag:"b"},{default:t(()=>[V(se(k.value.name),1)]),_:1})]),_:1}),e(j,null,{default:t(()=>[u[12]||(u[12]=V("名称:   ")),e(j,{tag:"b"},{default:t(()=>[V(se(k.value.verbose_name),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(le,{span:2,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:t(()=>[e(ee,{alignment:"flex-end"},{default:t(()=>{var f,ue;return[C(e(I,{disabled:k.value.built_in,icon:"Delete",onClick:u[0]||(u[0]=Oe=>O(k.value.id)),circle:""},null,8,["disabled"]),[[te,`${(f=x(A).name)==null?void 0:f.replace("_info","")}:delete`]]),C(e(I,{disabled:k.value.built_in,icon:"Edit",onClick:u[1]||(u[1]=Oe=>be(k.value)),circle:""},null,8,["disabled"]),[[te,`${(ue=x(A).name)==null?void 0:ue.replace("_info","")}:edit`]])]}),_:1})]),_:1})]),_:1}),e(c,{modelValue:Z.value,"onUpdate:modelValue":u[2]||(u[2]=f=>Z.value=f),type:"card",class:"demo-tabs",onTabClick:K},{default:t(()=>[e(de,{label:"模型字段",name:"field"},{default:t(()=>[e(wl,{ref_key:"ciModelFieldRef",ref:w},null,512)]),_:1}),e(de,{label:"唯一校验",name:"verification"},{default:t(()=>[e($l,{modelId:W.value,modelFieldLists:J.value,ref_key:"ciModelUniqueRef",ref:h},null,8,["modelId","modelFieldLists"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),e(re,{modelValue:X.value,"onUpdate:modelValue":u[10]||(u[10]=f=>X.value=f),title:"编辑模型",width:"500","before-close":d},{footer:t(()=>[S("div",kl,[e(I,{onClick:u[8]||(u[8]=f=>U(ne.value))},{default:t(()=>u[13]||(u[13]=[V("取消")])),_:1}),e(I,{type:"primary",onClick:u[9]||(u[9]=f=>b(ne.value))},{default:t(()=>u[14]||(u[14]=[V(" 确认 ")])),_:1})])]),default:t(()=>[e(Ue,{ref_key:"modelFormRef",ref:ne,style:{"max-width":"600px"},model:y,rules:ie,"label-width":"auto",class:"demo-modelForm","status-icon":""},{default:t(()=>[e(P,{label:"模型图标",prop:"icon"},{default:t(()=>[e(I,{onClick:N,icon:y.icon},null,8,["icon"]),e(ol,{isShow:G.value,"onUpdate:isShow":u[3]||(u[3]=f=>G.value=f),iconName:y.icon,"onUpdate:iconName":u[4]||(u[4]=f=>y.icon=f)},null,8,["isShow","iconName"])]),_:1}),e(P,{label:"唯一标识",prop:"name"},{default:t(()=>[e(xe,{modelValue:y.name,"onUpdate:modelValue":u[5]||(u[5]=f=>y.name=f),placeholder:"请输入模型的唯一标识",disabled:""},null,8,["modelValue"])]),_:1}),e(P,{label:"模型名称",prop:"verbose_name"},{default:t(()=>[e(xe,{modelValue:y.verbose_name,"onUpdate:modelValue":u[6]||(u[6]=f=>y.verbose_name=f)},null,8,["modelValue"])]),_:1}),e(P,{label:"所属分组",prop:"model_group"},{default:t(()=>[e(s,{modelValue:y.model_group,"onUpdate:modelValue":u[7]||(u[7]=f=>y.model_group=f),placeholder:"选择分组"},{default:t(()=>[(g(!0),D(Q,null,ae(Y.value,(f,ue)=>(g(),B(H,{label:f.verbose_name,value:f.id,key:ue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),Nl=Ee(Ul,[["__scopeId","data-v-c4866189"]]);export{Nl as default};
