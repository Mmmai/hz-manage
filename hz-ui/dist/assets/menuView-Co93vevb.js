import{i as Re}from"./iconSelectCom-CMqvf3xk.js";import{d as ve,aB as _e,bu as Oe,b as ye,r,c as re,e as s,b3 as ue,o as v,f as W,g as l,w as t,j as $,t as ge,bO as V,O as x,bo as c,bZ as he,b_ as Ve,h as L,F as de,aD as Te,bV as ce,c1 as p,k as Ce,_ as ke,u as Le,aN as qe,b1 as we,Y as Ee,cl as Ie,P as ie}from"./index-IeLxcNDT.js";import{I as be}from"./iconify-CL9CWqhW.js";const Je={class:"dialog-footer"},je=ve({__name:"menuButtonCom",props:_e(["nowMenu"],{showDrawer:{},showDrawerModifiers:{}}),emits:_e(["getMenuData"],["update:showDrawer"]),setup(H,{expose:k,emit:b}){const{proxy:B}=Ce(),d=H,q=b,M=Oe(H,"showDrawer"),E=ye(),D=r(),I=r([]);k({updateMenuButtonList:f=>{I.value=f}});const K=()=>{M.value=!1},y=r(!1),C=()=>{y.value=!1},m=re({name:"",action:"",menu:""}),g=r(!0),a=()=>{y.value=!0,g.value=!0,m.menu=d.nowMenu.id},N=f=>{y.value=!0,g.value=!1,Te(()=>{Object.keys(m).forEach(i=>{m[i]=f[i]}),m.id=f.id,m.menu=f.menu})},J=async()=>{let f=await B.$api.getButton({menu:d.nowMenu.id});I.value=f.data.results},Q=f=>{ce.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await B.$api.deleteButton(f.id)).status==204?(p({type:"success",message:"删除成功"}),await J(),q("getMenuData")):p({type:"error",message:"删除失败"})}).catch(()=>{p({type:"info",message:"取消删除"})})},X=()=>{D.value.validate(async f=>{if(f)if(g.value){let i=await B.$api.addButton(m);i.status==201?(y.value=!1,D.value.resetFields(),J(),q("getMenuData")):p({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else{let i=await B.$api.updateButton(m);i.status==200?(y.value=!1,D.value.resetFields(),J(),q("getMenuData")):p({showClose:!0,message:"更新失败:"+JSON.stringify(i.data),type:"error"})}else p({showClose:!0,message:"请输入正确内容.",type:"error"})})};return(f,i)=>{const ee=s("el-text"),Y=s("el-col"),U=s("el-button"),le=s("el-row"),te=s("el-divider"),S=s("el-table-column"),G=s("el-tooltip"),oe=s("el-table"),ae=s("el-drawer"),F=s("el-input"),j=s("el-form-item"),P=s("el-form"),ne=s("el-dialog"),n=ue("permission");return v(),W(de,null,[l(ae,{modelValue:M.value,"onUpdate:modelValue":i[0]||(i[0]=e=>M.value=e),title:"菜单按钮编辑",direction:"rtl","before-close":K,size:"30%"},{default:t(()=>[l(le,{justify:"space-between"},{default:t(()=>[l(Y,{span:5},{default:t(()=>[l(ee,{size:"large",tag:"b"},{default:t(()=>[$("菜单："+ge(d.nowMenu.label),1)]),_:1})]),_:1}),l(Y,{span:2},{default:t(()=>{var e;return[V((v(),x(U,{type:"primary",onClick:a},{default:t(()=>i[5]||(i[5]=[$("添加")])),_:1})),[[n,`${(e=c(E).name)==null?void 0:e.replace("_info","")}:add`]])]}),_:1})]),_:1}),l(te),l(oe,{border:"",data:I.value,style:{width:"100%"}},{default:t(()=>[l(S,{prop:"name",label:"按钮名称"}),l(S,{prop:"action",label:"按钮标识"}),l(S,{fixed:"right",label:"操作"},{default:t(e=>[l(G,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var w;return[V(l(U,{link:"",type:"primary",icon:c(he),onClick:A=>N(e.row)},null,8,["icon","onClick"]),[[n,`${(w=c(E).name)==null?void 0:w.replace("_info","")}:edit`]])]}),_:2},1024),l(G,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var w;return[V(l(U,{link:"",type:"danger",icon:c(Ve),onClick:A=>Q(e.row)},null,8,["icon","onClick"]),[[n,`${(w=c(E).name)==null?void 0:w.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),l(ne,{modelValue:y.value,"onUpdate:modelValue":i[4]||(i[4]=e=>y.value=e),title:"按钮配置",width:"400","before-close":C},{footer:t(()=>[L("div",Je,[l(U,{onClick:i[3]||(i[3]=e=>y.value=!1)},{default:t(()=>i[6]||(i[6]=[$("取消")])),_:1}),l(U,{type:"primary",onClick:X},{default:t(()=>i[7]||(i[7]=[$(" 提交 ")])),_:1})])]),default:t(()=>[l(P,{inline:!0,model:m,ref_key:"formRef",ref:D,class:"demo-form-inline"},{default:t(()=>[l(j,{label:"按钮名称",required:"",prop:"name"},{default:t(()=>[l(F,{modelValue:m.name,"onUpdate:modelValue":i[1]||(i[1]=e=>m.name=e),placeholder:"中文名",clearable:""},null,8,["modelValue"])]),_:1}),l(j,{label:"按钮标识",placeholder:"英文标识",required:"",prop:"action"},{default:t(()=>[l(F,{modelValue:m.action,"onUpdate:modelValue":i[2]||(i[2]=e=>m.action=e),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ae=ke(je,[["__scopeId","data-v-1d81ac8e"]]),ze={class:"card"},Ye={class:"role-menu"},Ge={style:{width:"100%"}},Pe={class:"user-header"},We=ve({__name:"menuView",setup(H){const k=ye(),b=Le(),B=r({}),{proxy:d}=Ce();re({search:""});const q=r(!1),M=r([]),E=r([]);r("auto");const D=r([{prop:"label",label:"菜单名称"},{prop:"icon",label:"图标"},{prop:"is_menu",label:"是否菜单"},{prop:"status",label:"启用"},{prop:"sort",label:"序号"},{prop:"path",label:"路由地址"},{prop:"name",label:"菜单编码"},{prop:"description",label:"描述"},{prop:"buttons",label:"权限按钮"}]);r(1);const I=r(10);r(!1),r(!1),r(!1);const Z=r(0),K=r(!1);r({}),qe(async()=>{await C()});const y=n=>(n.forEach(e=>{e.value=e.id,e.disabled=!!e.is_menu,e.children&&y(e.children)}),n),C=async()=>{let n=await d.$api.getMenuList();M.value=n.data.results,E.value=y(n.data.results),Z.value=n.data.count,Z.value<I.value&&(K.value=!0)},m=n=>{B.value=n},g=r(!1),a=re({label:"",icon:"",sort:0,is_menu:!0,description:"",path:"",name:"",parentid:"",parentid_id:"",has_info:!1,info_view_name:"",is_iframe:!1,iframe_url:"",status:!0}),N=r("add"),J=()=>{N.value="add",g.value=!0},Q=()=>{g.value=!1,d.$refs.userFrom.resetFields()},X=n=>{ce.confirm("是否确认关闭?").then(()=>{n(),d.$refs.userFrom.resetFields()}).catch(()=>{})},f=()=>{d.$refs.userFrom.validate(async n=>{if(n)if(a.parentid=a.parentid_id,N.value=="add"){let e=await d.$api.menuAdd(a);console.log(e),e.status==201?(g.value=!1,d.$refs.userFrom.resetFields(),C(),await b.dispatch("getRoleMenu",{role:b.state.role})):p({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await d.$api.menuUpdate(a);console.log(e),e.status==200?(g.value=!1,d.$refs.userFrom.resetFields(),C(),await b.dispatch("getRoleMenu",{role:b.state.role})):p({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else p({showClose:!0,message:"请输入正确内容.",type:"error"})})},i=r(),ee=n=>{N.value="edit",g.value=!0,d.$nextTick(()=>{Object.assign(a,n)})},Y=n=>{ce.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await d.$api.menuDel(n.id)).status==204?(p({type:"success",message:"删除成功"}),await C(pageConfig),await b.dispatch("getRoleMenu",{role:b.state.role})):p({type:"error",message:"删除失败"})}).catch(()=>{p({type:"info",message:"Delete canceled"})})},U=r([]),le=(n,e)=>{},te=n=>{U.value=n},S=r(!1),G=()=>{console.log(a.icon),S.value=!0},oe=async n=>{let e=await d.$api.menuUpdate({status:n.status,id:n.id});e.status==200?(p({type:"success",message:"更新成功"}),C(pageConfig),await b.dispatch("getRoleMenu",{role:b.state.role})):p({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},ae=async n=>{let e=await d.$api.menuUpdate({is_menu:n.is_menu,id:n.id});e.status==200?(p({type:"success",message:"更新成功"}),C(pageConfig),await b.dispatch("getRoleMenu",{role:b.state.role})):p({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},F=r(!1),j=r({}),P=r(null),ne=n=>{F.value=!0,j.value=n,P.value.updateMenuButtonList(n.buttons)};return(n,e)=>{var fe;const w=s("el-button"),A=s("el-table-column"),R=s("el-switch"),xe=s("el-icon"),$e=s("el-tag"),Me=s("el-space"),se=s("el-tooltip"),Ue=s("el-table"),O=s("el-input"),_=s("el-form-item"),Se=s("el-input-number"),Be=s("el-tree-select"),pe=s("el-col"),me=s("el-row"),De=s("el-form"),Ne=s("el-dialog"),T=ue("permission"),Fe=ue("loading");return v(),W("div",ze,[L("div",Ye,[L("div",Ge,[L("div",Pe,[L("div",null,[V((v(),x(w,{type:"primary",size:"small",onClick:J},{default:t(()=>e[16]||(e[16]=[$("+新增")])),_:1})),[[T,`${(fe=c(k).name)==null?void 0:fe.replace("_info","")}:add`]])])]),L("div",null,[V((v(),x(Ue,{border:"",data:M.value,style:{width:"100%"},"max-height":"500px","highlight-current-row":"","row-key":"id","table-layout":"fixed",onSelectionChange:te,onRowClick:m},{default:t(()=>[l(A,{type:"selection",width:"55",selectable:le}),(v(!0),W(de,null,we(D.value,o=>(v(),x(A,{key:o.prop,label:o.label,prop:o.prop},Ee({_:2},[o.prop==="is_menu"?{name:"default",fn:t(u=>{var h;return[V(l(R,{modelValue:u.row.is_menu,"onUpdate:modelValue":z=>u.row.is_menu=z,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:z=>ae(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[T,{id:`${(h=c(k).name)==null?void 0:h.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,o.prop==="status"?{name:"default",fn:t(u=>{var h;return[V(l(R,{modelValue:u.row.status,"onUpdate:modelValue":z=>u.row.status=z,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:z=>oe(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[T,{id:`${(h=c(k).name)==null?void 0:h.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,o.prop==="icon"?{name:"default",fn:t(u=>[l(xe,null,{default:t(()=>[l(c(be),{icon:u.row.icon},null,8,["icon"])]),_:2},1024)]),key:"2"}:void 0,o.prop==="buttons"?{name:"default",fn:t(u=>[l(Me,{wrap:""},{default:t(()=>[(v(!0),W(de,null,we(u.row.buttons,h=>(v(),x($e,{type:"success",round:"",effect:"plain",key:h.id},{default:t(()=>[$(ge(h.name),1)]),_:2},1024))),128))]),_:2},1024)]),key:"3"}:void 0]),1032,["label","prop"]))),128)),l(A,{fixed:"right",label:"操作",width:"150"},{default:t(o=>[o.row.is_menu?(v(),x(se,{key:0,class:"box-item",effect:"dark",content:"编辑按钮",placement:"top"},{default:t(()=>{var u;return[V(l(w,{link:"",type:"primary",icon:c(Ie),onClick:h=>ne(o.row)},null,8,["icon","onClick"]),[[T,`${(u=c(k).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024)):ie("",!0),l(se,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var u;return[V(l(w,{link:"",type:"primary",icon:c(he),onClick:h=>ee(o.row)},null,8,["icon","onClick"]),[[T,`${(u=c(k).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),l(se,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var u;return[V(l(w,{link:"",type:"danger",icon:c(Ve),onClick:h=>Y(o.row)},null,8,["icon","onClick"]),[[T,`${(u=c(k).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Fe,q.value]])])])]),l(Ne,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=o=>g.value=o),title:N.value=="add"?"新增菜单":"编辑菜单",width:"40%","before-close":X},{default:t(()=>[l(De,{inline:!0,model:a,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"userFrom","status-icon":""},{default:t(()=>[l(_,{label:"菜单名称",prop:"label",rules:[{required:!0}]},{default:t(()=>[l(O,{modelValue:a.label,"onUpdate:modelValue":e[0]||(e[0]=o=>a.label=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(_,{label:"菜单标识",prop:"name",rules:[{required:!0}]},{default:t(()=>[l(O,{modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.name=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(_,{label:"路由",prop:"path"},{default:t(()=>[l(O,{modelValue:a.path,"onUpdate:modelValue":e[2]||(e[2]=o=>a.path=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(_,{label:"图标",prop:"icon",rules:[{required:!0}]},{default:t(()=>[l(w,{onClick:G},{default:t(()=>[l(c(be),{icon:a.icon},null,8,["icon"])]),_:1}),l(Re,{isShow:S.value,"onUpdate:isShow":e[3]||(e[3]=o=>S.value=o),iconName:a.icon,"onUpdate:iconName":e[4]||(e[4]=o=>a.icon=o)},null,8,["isShow","iconName"])]),_:1}),l(_,{label:"序号",prop:"sort"},{default:t(()=>[l(Se,{modelValue:a.sort,"onUpdate:modelValue":e[5]||(e[5]=o=>a.sort=o),placeholder:"",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),l(_,{label:"父级节点",prop:"parentid_id"},{default:t(()=>[l(Be,{modelValue:a.parentid_id,"onUpdate:modelValue":e[6]||(e[6]=o=>a.parentid_id=o),ref_key:"elTreeSelectRef",ref:i,data:M.value,clearable:"","check-strictly":"","render-after-expand":!1,"node-key":"id",style:{width:"180px"}},null,8,["modelValue","data"])]),_:1}),l(_,{label:"描述",prop:"description"},{default:t(()=>[l(O,{modelValue:a.description,"onUpdate:modelValue":e[7]||(e[7]=o=>a.description=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(_,{label:"启用",prop:"status",rules:[{required:!0}]},{default:t(()=>[l(R,{modelValue:a.status,"onUpdate:modelValue":e[8]||(e[8]=o=>a.status=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),l(_,{label:"是否菜单",prop:"is_menu",rules:[{required:!0}]},{default:t(()=>[l(R,{modelValue:a.is_menu,"onUpdate:modelValue":e[9]||(e[9]=o=>a.is_menu=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),l(_,{label:"详单"},{default:t(()=>[l(R,{modelValue:a.has_info,"onUpdate:modelValue":e[10]||(e[10]=o=>a.has_info=o),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),a.has_info?(v(),x(_,{key:0,label:"视图名"},{default:t(()=>[l(O,{modelValue:a.info_view_name,"onUpdate:modelValue":e[11]||(e[11]=o=>a.info_view_name=o),style:{width:"180px"}},null,8,["modelValue"])]),_:1})):ie("",!0),l(me,null,{default:t(()=>[l(pe,{span:6},{default:t(()=>[l(_,{label:"是否内嵌",prop:"is_iframe",rules:[{required:!0}]},{default:t(()=>[l(R,{modelValue:a.is_iframe,"onUpdate:modelValue":e[12]||(e[12]=o=>a.is_iframe=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),l(pe,{span:18},{default:t(()=>[a.is_iframe?(v(),x(_,{key:0,label:"访问地址"},{default:t(()=>[l(O,{modelValue:a.iframe_url,"onUpdate:modelValue":e[13]||(e[13]=o=>a.iframe_url=o),style:{width:"300px"},type:"textarea"},null,8,["modelValue"])]),_:1})):ie("",!0)]),_:1})]),_:1}),l(me,{style:{"justify-content":"space-around"}},{default:t(()=>[l(_,null,{default:t(()=>[l(w,{onClick:Q},{default:t(()=>e[17]||(e[17]=[$("取消")])),_:1}),l(w,{type:"primary",onClick:f},{default:t(()=>e[18]||(e[18]=[$(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Ae,{ref_key:"menuButtonComRef",ref:P,showDrawer:F.value,"onUpdate:showDrawer":e[15]||(e[15]=o=>F.value=o),nowMenu:j.value,onGetMenuData:C},null,8,["showDrawer","nowMenu"])])}}}),Qe=ke(We,[["__scopeId","data-v-b44d4c4a"]]);export{Qe as default};
