import{d as F,j,x as Z,g as G,r as m,a as H,v as K,z as L,h as o,c as Q,o as P,b as g,f as a,w as s,m as W,cM as X,q as C,t as N,B as Y,k as ee,b_ as i,aP as R,_ as te}from"./index-CWdEKdsq.js";import{T as ae}from"./treeTransfer-BMiMq2EK.js";const se={class:"divVertical"},le={class:"card flexJstart gap-5",style:{height:"50px",flex:"none"}},oe={class:"card",style:{flex:"none"}},ne={class:"card"},re={style:{"text-align":"center"}},ie=F({__name:"roleInfoView",setup(de){const T=j(),B=Z(),{proxy:d}=G(),u=m(!1),I=m(!1),c=m(null),y=m("menuPermission"),S=()=>{},b=()=>{T.push({path:"/settings/role"})},l=H({role:"",role_name:""}),J={role:[{required:!0,message:"请输入角色英文名",trigger:"blur"},{validator:(t,e,r)=>{/^[a-zA-Z]+$/.test(e)?r():r(new Error("请输入纯英文"))}}],role_name:[{required:!0,message:"请输入角色中文名称",trigger:"blur"}]},p=K(()=>l.role==="sysadmin"),V=m([]),_=m([]),f=async()=>{let t=await d.$api.getRoleInfo(c.value);t.status==200&&(l.role=t.data.role,l.role_name=t.data.role_name,_.value=t.data.rolePermission.map(e=>e))},v=async()=>{let t=await d.$api.getPermissionToRole();V.value=t.data.results},z=async()=>{if(u){let t=await d.$api.roleadd({...l,rolePermission:_.value});t.status==201?(i({type:"success",message:"创建成功"}),b()):i({type:"error",message:`更新失败: ${JSON.stringify(t.data)}`})}else{let t=await d.$api.roleupdate({id:c.value,...l});t.status==200?(i({type:"success",message:"更新成功"}),f()):i({type:"error",message:`更新失败: ${JSON.stringify(t.data)}`})}},A=(t,e,r)=>{p.value||u.value||(e=="right"?D(r):M(r))},D=async t=>{let e=await d.$api.addRolePermissions(c.value,{button_ids:t});e.status==200?(i({type:"success",message:"权限添加成功"}),R(()=>{f(),v()})):i({type:"error",message:`权限添加失败: ${JSON.stringify(e.data)}`})},M=async t=>{let e=await d.$api.removeRolePermissions(c.value,{button_ids:t});e.status==200?(i({type:"success",message:"权限删除成功"}),R(()=>{f(),v()})):i({type:"error",message:`权限删除失败: ${JSON.stringify(e.data)}`})};return L(async()=>{c.value=B.path.split("/").at(-1),c.value.includes("new")?(u.value=!0,I.value=!0):await f(),await v()}),(t,e)=>{const r=o("el-button"),O=o("el-tooltip"),U=o("el-text"),w=o("el-input"),x=o("el-form-item"),$=o("el-col"),k=o("el-row"),q=o("el-form"),h=o("el-tab-pane"),E=o("el-tabs");return P(),Q("div",se,[g("div",le,[a(O,{class:"box-item",effect:"dark",content:"返回角色列表",placement:"top"},{default:s(()=>[a(r,{onClick:e[0]||(e[0]=n=>b()),icon:W(X),plain:"",size:"small"},null,8,["icon"])]),_:1}),a(U,{tag:"b",size:"large"},{default:s(()=>[C(N(u.value?"创建新角色":`角色详情【${l.role_name}】`),1)]),_:1})]),g("div",oe,[a(q,{ref:"roleFormRef",model:l,rules:J,"label-width":"100px",style:{width:"100%","margin-top":"10px"}},{default:s(()=>[a(k,{gutter:20},{default:s(()=>[a($,{span:8},{default:s(()=>[a(x,{label:"角色",prop:"role"},{default:s(()=>[a(w,{modelValue:l.role,"onUpdate:modelValue":e[1]||(e[1]=n=>l.role=n),placeholder:"请输入角色英文名",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a($,{span:8},{default:s(()=>[a(x,{label:"角色名称",prop:"role_name"},{default:s(()=>[a(w,{modelValue:l.role_name,"onUpdate:modelValue":e[2]||(e[2]=n=>l.role_name=n),placeholder:"请输入角色中文名称",disabled:p.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),a(k,{justify:"center"},{default:s(()=>[p.value?ee("",!0):(P(),Y(r,{key:0,type:"primary",onClick:e[3]||(e[3]=n=>z())},{default:s(()=>[C(N(u.value?"添加":"更新"),1)]),_:1}))]),_:1})]),g("div",ne,[a(E,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=n=>y.value=n),type:"card",class:"demo-tabs",onTabClick:S},{default:s(()=>[a(h,{label:"菜单权限",name:"menuPermission"},{default:s(()=>[g("div",re,[a(ae,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=n=>_.value=n),data:V.value,"leaf-only":!0,"hide-fully-assigned-parents":!0,titles:["可选权限","已选权限"],"check-strictly":!1,onChange:A,disabled:p.value},null,8,["modelValue","data","disabled"])])]),_:1}),a(h,{label:"资产权限",name:"cmdbPermission"})]),_:1},8,["modelValue"])])])}}}),me=te(ie,[["__scopeId","data-v-cbedba22"]]);export{me as default};
