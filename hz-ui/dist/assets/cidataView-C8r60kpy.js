import{d as pl,aB as Ke,bu as cl,r as i,c as tl,e as p,o as t,O as d,w as l,g as a,h as x,j as v,t as C,f as r,bo as b,c5 as Ve,P as M,c2 as _a,c4 as I,k as Fl,M as R,bI as Il,F as ne,b1 as ie,bS as ya,c6 as Wa,aD as Me,_ as Pl,c7 as al,bQ as Cl,b as ga,u as Ga,aN as ba,b3 as il,c8 as Qa,c9 as Xa,bO as Q,b_ as Za,ca as Al,cb as et,cc as lt,cd as at,bF as Jl,Y as tt,aE as Ue,c0 as ot,ce as ma,cf as nt,c1 as st,bV as Kl,cg as ut,i as dt,ch as rt,ci as it,cj as ct}from"./index-_vkwOwvB.js";import{l as pt}from"./vue-draggable-plus-DcZAH-MI.js";import{u as wa}from"./config-emeQQSvK.js";import{e as Yl,d as Bl}from"./gmCrypto-BBM-NmBR.js";const ft={class:"flexJstart gap-1"},vt={key:0,class:"flexJstart gap-1"},mt={key:3,class:"flexJstart gap-1"},_t=pl({__name:"ciDataUpload",props:Ke(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:Ke(["getCiData"],["update:isShowUpload"]),setup(ce,{emit:pe}){const{proxy:H}=Fl(),V=ce,L=pe,k=cl(ce,"isShowUpload"),z=i([]),fe=i(null),h=["xlsx"],se=i(10),O=i({}),ve=i({}),ae=tl({"Content-Type":"multipart/form-data"}),B=i({}),ue=async()=>{Object.keys(ve.value).length>0?Object.entries(ve.value).forEach(async([F,f])=>{let c=await H.$api.importCiDataStatus(f);O.value[F]=c.data,c.data.status==="completed"&&delete ve.value[F]}):(clearInterval(q),q=null,L("getCiData",{model:V.ciModelId,model_instance_group:V.currentNodeId}))};let q=null;const P=async F=>{let f=new FormData;f.append("file",F.file),f.append("model",V.ciModelId);let c=await H.$api.importCiData(f,ae,2*60*1e3);c.status==200?(ve.value[F.file.uid]=c.data,B.value[F.file.uid]=!0,q===null&&(q=setInterval(ue,2e3))):(B.value[F.file.uid]=!1,I({message:`导入异常: ${JSON.stringify(c.data)}`,type:"error",showClose:!0}))},X=()=>{},W=F=>{let f=F.name;if(F.type!=""||F.type!=null||F.type!=null){const c=F.name.replace(/.+\./,"").toLowerCase();return F.size/1024/1024<5?h.includes(c)?z.value.find(ye=>ye.name==f&&ye.lastModified==F.lastModified)?(I({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(I({message:`不能上传${c}类型的文件`,type:"error",showClose:!0}),!1):(I.error("上传文件大小不能超过 5MB!"),!1)}},G=async F=>{await H.$api.downloadErrorRecords({error_file_key:F})},Oe=async()=>{await H.$api.downloadImportTemplate({model:V.ciModelId})};return(F,f)=>{const c=p("upload-filled"),E=p("el-icon"),te=p("el-col"),ye=p("el-button"),ge=p("el-row"),oe=p("Loading"),J=p("CircleCheck"),A=p("el-link"),he=p("el-upload"),Fe=p("el-dialog");return t(),d(Fe,{modelValue:k.value,"onUpdate:modelValue":f[1]||(f[1]=K=>k.value=K),title:"导入",width:"800"},{default:l(()=>[a(he,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:fe,headers:ae,"http-request":P,"file-list":z.value,"before-upload":W,limit:se.value,onOnChange:X,"show-file-list":""},{tip:l(()=>[a(ge,{justify:"space-between",align:"middle"},{default:l(()=>[a(te,{span:18},{default:l(()=>f[2]||(f[2]=[x("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(te,{span:3},{default:l(()=>[a(ye,{link:"",type:"primary",onClick:f[0]||(f[0]=K=>Oe())},{default:l(()=>f[3]||(f[3]=[v("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:K,index:He})=>{var Ae,$,Pe,N,ol,Ye,Be,We,nl;return[x("div",ft,[x("span",null,C(K.name),1),B.value[K.uid]==!0?(t(),r("div",vt,[((Ae=O.value[K.uid])==null?void 0:Ae.status)!=="completed"?(t(),d(E,{key:0,class:"is-loading"},{default:l(()=>[a(oe)]),_:1})):(($=O.value[K.uid])==null?void 0:$.failed)>>>0?(t(),d(E,{key:1},{default:l(()=>[a(b(Ve),{color:"var(--el-color-warning)"})]),_:1})):(t(),d(E,{key:2},{default:l(()=>[a(J,{color:"var(--el-color-success)"})]),_:1})),O.value[K.uid]?(t(),r("div",mt,[x("span",null,C(`进度: ${(Pe=O.value[K.uid])==null?void 0:Pe.progress}%`),1),x("span",null,C(`结果: 总条数: ${(N=O.value[K.uid])==null?void 0:N.total},创建: ${(ol=O.value[K.uid])==null?void 0:ol.created},更新: ${(Ye=O.value[K.uid])==null?void 0:Ye.updated},跳过: ${(Be=O.value[K.uid])==null?void 0:Be.skipped},失败: ${(We=O.value[K.uid])==null?void 0:We.failed}.`),1),((nl=O.value[K.uid])==null?void 0:nl.failed)>>>0?(t(),d(A,{key:0,type:"danger",onClick:w=>{var m;return G((m=O.value[K.uid])==null?void 0:m.error_file_key)}},{default:l(()=>f[4]||(f[4]=[v("查看导入失败数据")])),_:2},1032,["onClick"])):M("",!0)])):M("",!0)])):B.value[K.uid]==!1?(t(),d(E,{key:1},{default:l(()=>[a(b(_a),{color:"var(--el-color-error)"})]),_:1})):M("",!0)])]}),default:l(()=>[a(E,{class:"el-icon--upload"},{default:l(()=>[a(c)]),_:1}),f[5]||(f[5]=x("div",{class:"el-upload__text"},[v("拖拽文件到此或者 "),x("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])}}}),yt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},gt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},bt={style:{width:"100%",overflow:"auto"}},wt={class:"listItem"},kt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},ht={class:"listItem"},Ct={style:{flex:"auto"}},xt=pl({__name:"ciDataTableCol",props:Ke(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:Ke(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(ce,{expose:pe,emit:H}){const V=ce,L=cl(ce,"isShowTableCol"),k=cl(ce,"hasConfigField"),{proxy:z}=Fl(),fe=i(""),h=i(""),se=R(()=>fe.value===""?F.value:F.value.filter(f=>f.verbose_name.includes(fe.value)));function O(){L.value=!1}const ve=f=>{k.value.push(f)},ae=f=>{let c=k.value.indexOf(f);k.value.splice(c,1)},B=f=>{console.log("start",f)},ue=f=>{console.log("onEnd",f),console.log(k.value)},q=()=>{console.log("update")},P=i({}),X=async()=>{let f=await z.$api.getCiModelCol({model:V.ciModelId});P.value=f.data;let c=[];f.data.fields_preferred.forEach(E=>{c.push(V.allModelFieldInfo[E])}),k.value=c},W=R(()=>k.value.map(f=>f.id)),G=H;Il(()=>k.value,f=>{console.log("更新表格"),G("reloadTable")},{deep:!0});const Oe=async()=>{let f=await z.$api.updateCiModelCol({id:P.value.id,fields_preferred:W.value});f.status=="200"?(I({type:"success",message:"更新成功"}),Me(()=>{h.value.clear(),L.value=!1})):I({showClose:!0,message:"更新失败:"+JSON.stringify(f.data),type:"error"})},F=R(()=>V.allModelField.filter(f=>!k.value.includes(f)));return pe({getHasConfigField:X}),(f,c)=>{const E=p("el-text"),te=p("el-divider"),ye=p("el-input"),ge=p("el-icon"),oe=p("el-button"),J=p("el-drawer");return t(),d(J,{modelValue:L.value,"onUpdate:modelValue":c[2]||(c[2]=A=>L.value=A),direction:"rtl",size:"40%"},{header:l(()=>[a(E,{tag:"b"},{default:l(()=>c[3]||(c[3]=[v("表格列显示配置")])),_:1})]),default:l(()=>[x("div",yt,[x("div",gt,[a(E,{tag:"b"},{default:l(()=>c[4]||(c[4]=[v("模型字段")])),_:1}),a(te),a(ye,{modelValue:fe.value,"onUpdate:modelValue":c[0]||(c[0]=A=>fe.value=A),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:h},null,8,["modelValue"]),x("div",bt,[(t(!0),r(ne,null,ie(se.value,(A,he)=>(t(),r("div",{key:he},[x("div",wt,[x("span",null,C(A.verbose_name),1),a(ge,null,{default:l(()=>[a(b(ya),{onClick:Fe=>ve(A)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),x("div",kt,[a(E,{tag:"b"},{default:l(()=>c[5]||(c[5]=[v("已显示字段")])),_:1}),a(te),a(b(pt),{ref:"el",modelValue:k.value,"onUpdate:modelValue":c[1]||(c[1]=A=>k.value=A),onStart:B,onUpdate:q,onEnd:ue,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(ne,null,ie(k.value,(A,he)=>(t(),r("div",{key:he},[x("div",ht,[x("span",null,C(A.verbose_name),1),a(ge,null,{default:l(()=>[a(b(Wa),{onClick:Fe=>ae(A)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[x("div",Ct,[a(oe,{onClick:O},{default:l(()=>c[6]||(c[6]=[v("取消")])),_:1}),a(oe,{type:"primary",onClick:Oe},{default:l(()=>c[7]||(c[7]=[v("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),Vt=Pl(xt,[["__scopeId","data-v-fc40893b"]]),Mt={class:"dialog-footer"},Ot=pl({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(ce){const pe=wa(),H=cl(ce,"showAllPassDia"),V=R(()=>pe.gmCry),L=i(),k=tl({secret:null,time:3});i(""),i(!1);const z=async se=>{se.validate(async O=>{O&&(k.secret===V.value.key?(al({title:"操作成功",message:"解密成功,"+k.time+"分钟后过期！",type:"success",duration:2e3}),pe.updateShowAllPass(!0),H.value=!1,pe.setShowAllPassTime(k.time*60*1e3),fe(L.value)):al({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},fe=se=>{se&&se.resetFields()},h=()=>{H.value=!1,fe(L.value)};return(se,O)=>{const ve=p("el-input"),ae=p("el-form-item"),B=p("el-input-number"),ue=p("el-form"),q=p("el-button"),P=p("el-dialog");return t(),d(P,{modelValue:H.value,"onUpdate:modelValue":O[3]||(O[3]=X=>H.value=X),title:"查看密码",width:"400"},{footer:l(()=>[x("div",Mt,[a(q,{onClick:h},{default:l(()=>O[5]||(O[5]=[v("取消")])),_:1}),a(q,{type:"primary",onClick:O[2]||(O[2]=X=>z(L.value))},{default:l(()=>O[6]||(O[6]=[v(" 查看 ")])),_:1})])]),default:l(()=>[a(ue,{ref_key:"allPassFormRef",ref:L,inline:!0,model:k,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(ae,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(ve,{type:"password",modelValue:k.secret,"onUpdate:modelValue":O[0]||(O[0]=X=>k.secret=X),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(ae,{label:"有效时间",prop:"time"},{default:l(()=>[a(B,{modelValue:k.time,"onUpdate:modelValue":O[1]||(O[1]=X=>k.time=X),min:1,step:1,max:30},{suffix:l(()=>O[4]||(O[4]=[x("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),$t={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Dt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Ut={style:{width:"100%",overflow:"auto"}},Ft={class:"listItem"},It={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Pt={style:{"margin-right":"5px"}},Nt={style:{float:"left"}},St={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},jt={key:0},Tt={key:1},qt={key:0},Et={key:1},Rt={key:2},Lt={key:3},zt={style:{flex:"auto"}},At=pl({__name:"ciDataFilter",props:Ke(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:Ke(["getCiData","updateFilterParam"],["update:showFilter"]),setup(ce,{expose:pe,emit:H}){const V=ce,L=cl(ce,"showFilter"),k=i(""),z=i(""),fe=R(()=>k.value===""?ae.value:ae.value.filter(f=>f.verbose_name.includes(k.value)));function h(){L.value=!1}const se=f=>{X.value.push(f)},O=f=>{let c=q.filterParams.indexOf(f);X.value.splice(c,1)},ve=(f,c)=>{f==="instance_name"?q.instance_name="":X.value.splice(c,1),Me(()=>{B("updateFilterParam",W.value)})},ae=R(()=>V.allModelField.filter(f=>!X.value.includes(f)));i({});const B=H,ue=i(""),q=tl({filterParams:[],instance_name:""}),P=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"包含",description:"包含以,分隔"},{value:"not:in:",label:"不包含",description:"不包含以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"!null",label:"非空",description:"正则表达式"}]),X=i([]),W=R(()=>{let f=new Object;return q.filterParams.forEach(c=>{if(c.match==="null"||c.match==="!null"){f[c.name]=c.match;return}if(c.value!==""){let E=null;c.value!==null?E=c.value:E="null",c.match==="="?f[c.name]=E:f[c.name]=c.match+E}}),q.instance_name!==""&&(f.instance_name=q.instance_name),f}),G=()=>{console.log(W.value),B("updateFilterParam",W.value),console.log(W.value),Me(()=>{B("getCiData",{model:V.ciModelId,model_instance_group:V.currentNodeId})}),L.value=!1},Oe=R(()=>{var f;return(f=q.filterParams)==null?void 0:f.map(c=>c.name)});Il(()=>X.value,f=>{var E;let c=new Array;(E=X.value)==null||E.forEach((te,ye)=>{var ge;if(((ge=Oe.value)==null?void 0:ge.indexOf(te.name))>>>-1)c.push({name:te.name,value:"",match:"=",label:te.verbose_name});else{let oe=q.filterParams.findIndex(J=>J.name===te.name);c.push(q.filterParams[oe])}}),q.filterParams=c},{deep:!0});const F=f=>{f&&(f.resetFields(),B("updateFilterParam",W.value),Me(()=>{B("getCiData",{model:V.ciModelId,model_instance_group:V.currentNodeId})}))};return pe({removeFilterParam:ve}),(f,c)=>{const E=p("el-text"),te=p("el-divider"),ye=p("el-input"),ge=p("el-icon"),oe=p("el-form-item"),J=p("el-button"),A=p("el-option"),he=p("el-select"),Fe=p("el-switch"),K=p("el-space"),He=p("el-form"),Ae=p("el-drawer");return t(),d(Ae,{modelValue:L.value,"onUpdate:modelValue":c[4]||(c[4]=$=>L.value=$),direction:"rtl",size:"50%","before-close":h},{header:l(()=>[a(E,{tag:"b"},{default:l(()=>c[5]||(c[5]=[v("筛选")])),_:1})]),default:l(()=>[x("div",$t,[x("div",Dt,[a(E,{tag:"b"},{default:l(()=>c[6]||(c[6]=[v("模型字段")])),_:1}),a(te),a(ye,{modelValue:k.value,"onUpdate:modelValue":c[0]||(c[0]=$=>k.value=$),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:z},null,8,["modelValue"]),x("div",Ut,[(t(!0),r(ne,null,ie(fe.value,($,Pe)=>(t(),r("div",{key:Pe},[x("div",Ft,[x("span",null,C($.verbose_name),1),a(ge,null,{default:l(()=>[a(b(ya),{onClick:N=>se($)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),x("div",It,[a(E,{tag:"b"},{default:l(()=>c[7]||(c[7]=[v("过滤器")])),_:1}),a(te),a(He,{ref_key:"filterFormRef",ref:ue,model:q,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(K,{wrap:""},{default:l(()=>[a(oe,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(ye,{modelValue:q.instance_name,"onUpdate:modelValue":c[1]||(c[1]=$=>q.instance_name=$),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(ne,null,ie(q.filterParams,($,Pe)=>(t(),d(oe,{key:$.index,prop:"filterParams."+Pe+".value"},{label:l(()=>[x("span",Pt,C($.label),1),a(J,{icon:b(_a),size:"small",circle:"",onClick:Cl(N=>O($),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(K,null,{default:l(()=>[a(he,{modelValue:$.match,"onUpdate:modelValue":N=>$.match=N,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(ne,null,ie(P.value,N=>(t(),d(A,{key:N.value,label:N.label,value:N.value},{default:l(()=>[x("span",Nt,C(N.label),1),x("span",St,C(N.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),$.match==="null"||$.match==="!null"?(t(),r("div",jt)):(t(),r("div",Tt,[["enum"].indexOf(V.allModelFieldByNameObj[$.name].type)>>>-1?["model_ref"].indexOf(V.allModelFieldByNameObj[$.name].type)>>>-1?["boolean"].indexOf(V.allModelFieldByNameObj[$.name].type)>>>-1?(t(),r("div",Lt,[a(ye,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Rt,[a(Fe,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Et,[a(he,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ne,null,ie(V.modelRefOptions[$.name],N=>(t(),d(A,{key:N.value,label:N.label,value:N.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",qt,[a(he,{modelValue:$.value,"onUpdate:modelValue":N=>$.value=N,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ne,null,ie(V.enumOptionObj[V.allModelFieldByNameObj[$.name].validation_rule],N=>(t(),d(A,{key:N.value,label:N.label,value:N.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[x("div",zt,[a(J,{onClick:c[2]||(c[2]=$=>F(ue.value))},{default:l(()=>c[8]||(c[8]=[v("重置")])),_:1}),a(J,{onClick:c[3]||(c[3]=$=>G()),type:"primary"},{default:l(()=>c[9]||(c[9]=[v("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),Yt=Pl(At,[["__scopeId","data-v-6ac62773"]]),Bt={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},Jt={class:"table-header"},Kt={class:"header-button-lf"},Ht={class:"header-button-ri"},Wt={class:"flexJstart gap-1",style:{overflow:"auto"}},Gt={class:"text_class"},Qt={key:0,class:"text_class"},Xt={key:1},Zt={style:{"margin-left":"12px"}},eo={key:1,class:"requiredClass"},lo={key:0},ao={key:0},to={key:1},oo={key:0},no={key:1},so={key:0},uo={key:1},ro={key:0},io={key:1},co={key:0},po={key:0},fo={key:0},vo={key:1},mo={key:0},_o={key:1},yo={key:0},go={key:1},bo={key:0},wo={key:1},ko={key:0},ho={key:1},Co={key:0},xo={key:1},Vo={style:{flex:"auto"},class:"footerButtonClass"},Mo={key:0},Oo={key:1},$o={key:0},Do={key:1},Uo={key:0},Fo={key:0},Io={key:1},Po={key:2},No={key:3},So={key:4},jo={key:5},To={key:6},qo={key:7},Eo={key:8},Ro={key:9},Lo={class:"dialog-footer"},zo={class:"dialog-footer"},Ao=pl({__name:"ciDataShow",props:Ke(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:Ke(["getTree"],["update:showTree"]),setup(ce,{expose:pe,emit:H}){const{proxy:V}=Fl(),L=wa(),k=ga(),z=Ga(),fe=H,h=ce,se=cl(ce,"showTree"),O=i([0]),ve=i(!1),ae=()=>{ve.value=!0},B=i(!0),ue=()=>{B.value=!1,Me(()=>{B.value=!0})},q=i(""),P=()=>{ve.value=!1},X=i(!1),W=R(()=>L.gmCry),G=R(()=>L.showAllPass),Oe=R(()=>L.showAllPassTime),F=async()=>{X.value=!0},f=()=>{L.updateShowAllPass(!1),al({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},c=s=>{L.setShowAllPassTime(s.totalMilliseconds)},E=()=>{X.value=!1,L.updateShowAllPass(!1),L.setShowAllPassTime(0),al({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},te=i(!1),ye=()=>{A.value=!1,Le(ge.value[0]),J.value=""},ge=i(),oe=tl({secret:null}),J=i(""),A=i(!1),he=async(s,e)=>{s[0].validate(async u=>{u&&(oe.secret===W.value.key?(J.value=Bl(W.value.key,W.value.mode,e),A.value=!0):(al({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),A.value=!1,J.value=""))})},Fe=i(1),K=i(10),He=i("default"),Ae=i(!1),$=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},Pe=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},N=R(()=>Ml.value.map(s=>s.name)),ol=R(()=>wl.value.map(s=>s.name)),Ye=i(!1),Be=async()=>{(await V.$api.bulkDeleteCiModelInstance({instances:gl.value})).status=="200"?(I({type:"success",message:"删除成功"}),Tl.value.clearSelection(),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({type:"error",message:"删除失败"})},We=async s=>{s?await V.$api.exportCiData({model:h.ciModelId,fields:ol.value,instances:gl.value}):await V.$api.exportCiData({model:h.ciModelId,fields:N.value,instances:gl.value})},nl=async()=>{let s=await V.$api.exportCiData({model:h.ciModelId});console.log(s)},w={multiple:!0,value:"id"},m=i(!1),S=i([]),Ge=R(()=>h.treeData[0].children[0].id),Qe=async()=>{var u;let s=[];(u=S.value)==null||u.forEach(j=>{s.push(j[j.length-1])});let e=await V.$api.setCiDataToTree({instances:gl.value,groups:s});e.status=="201"?(I({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),Hl(),fe("getTree")):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}),S.value=[],m.value=!1},Xe=i(""),Ze=i(!1),T=i({}),Ee=(s,e)=>{s?U.updateParams[e]="null":U.updateParams[e]=null},fl=()=>{Ze.value=!0,console.log(U)},Nl=s=>{var e;if(s!==void 0&&((e=je.value[s])==null?void 0:e.field_type)==="string")return s==""||s==null?void 0:[{pattern:new RegExp(je.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]};R(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(j=>{j.fields.forEach(y=>{var re;y.type==="string"&&y.validation_rule!==""&&y.validation_rule!==null&&(s["updateParams."+y.name]=[{pattern:new RegExp((re=je.value[y.validation_rule])==null?void 0:re.rule),message:"不符合正则表达式",trigger:"blur"}])})}),s});const U=tl({updateParams:{}}),Ne=i([]),vl=()=>{const s=Object.keys(U.updateParams).length,e=`__temp_param_${s}`;Ne.value[s]=e,U.updateParams[e]=""},Sl=(s,e)=>{console.log(e),U.updateParams[e]=void 0,delete U.updateParams[Ne.value[s]],Ne.value[s]=e},de=(s,e)=>{Ne.value.splice(s,1),delete T.value[e],delete U.updateParams[e]},$e=R(()=>{let s=new Object;for(let[e,u]of Object.entries(U.updateParams))u==="null"?s[e]=null:s[e]=u,me.value.password.indexOf(e)!==-1&&(s[e]=Yl(W.value.key,W.value.mode,u));return s}),xl=()=>{Xe.value.validate(async s=>{if(s){let e=await V.$api.multipleUpdateCiModelInstance({update_user:z.state.username,instances:gl.value,fields:$e.value});e.status=="200"?(I({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),U.updateParams={},T.value={},Ne.value=[],Ze.value=!1):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else I({showClose:!0,message:"请输入正确内容.",type:"error"})})},De=R(()=>{var e,u;let s=new Array;return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(j=>{j.fields.forEach(y=>{let re=!1;y.name in U.updateParams&&(re=!0),s.push({value:y.name,label:y.verbose_name,disable:re})})}),s}),ml=()=>{Ze.value=!1,U.updateParams={},T.value={},Ne.value=[]},_l=i(!0),yl=s=>{_l.value=s},Vl=i(!0),Z=i(!1),jl=i(!1),ka=()=>{jl.value=!0},ha=async s=>{yl(!0);let e=await V.$api.updateCiModelInstance({update_user:z.state.username,...s});e.status=="200"?(I({type:"success",message:"更新成功"}),we.value=!1,Le(el.value),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},Ca=()=>!0,Tl=i(null),xa=s=>s.id,Re=i([]),gl=R(()=>{var e;let s=[];return(e=Re.value)==null||e.forEach(u=>{s.push(u.id)}),s}),Va=s=>{Re.value=s},Hl=()=>{Re.value=[],Tl.value.clearSelection()},Ml=i([]),Se=i({}),Ma=R(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(j=>{j.fields.forEach(y=>{s[y.id]=y})}),s}),_e=R(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(j=>{j.fields.forEach(y=>{s[y.name]=y})}),s}),Wl=i(""),Oa=()=>{Wl.value.getHasConfigField()},Gl=()=>{Vl.value=!1,Me(()=>{Vl.value=!0})},je=i({});i({});const $a=async(s=null)=>{(await V.$api.getValidationRules({...s,page:1,page_size:1e4})).data.results.forEach(u=>{je.value[u.id]=u})},ql=R(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(j=>{j.fields.forEach(y=>{if(y.type==="enum"){if(y.validation_rule===null)return;let re=JSON.parse(je==null?void 0:je.value[y==null?void 0:y.validation_rule].rule),ll=[];Object.keys(re).forEach(dl=>{ll.push({value:dl,label:re[dl]})}),s[y.validation_rule]=ll}})}),s}),Ql=R(()=>{let s={};return Se.value.field_groups.forEach(e=>{e.fields.forEach(u=>{if(u.type==="enum"){let j=JSON.parse(je.value[u.validation_rule].rule),y={};Object.keys(j).forEach(re=>{y[re]=j[re]}),s[u.name]=y}})}),s}),bl=i({}),Da=async(s,e)=>{let u=await V.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),j=[];u.data.results.forEach(y=>{j.push({value:y.id,label:y.instance_name})}),bl.value[e.name]=j},Ua=R(()=>{let s=new Object;for(let[e,u]of Object.entries(bl.value)){let j=new Object;u==null||u.forEach(y=>{j[y.value]=y}),s[e]=j}return s}),Fa=s=>{if(!(s==""||s==null))return[{pattern:new RegExp(je.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]},Ia=()=>{Se.value.field_groups.forEach(s=>{s.fields.forEach(e=>{g[e.name]=e.default})})},wl=i([]),Pa=async()=>{var u;let s=await V.$api.getCiModel({},h.ciModelId);Se.value=s.data;let e=[];(u=Se.value.field_groups)==null||u.forEach(j=>{j.fields.forEach(y=>{e.push(y)})}),wl.value=e},me=R(()=>{let s={enum:[],boolean:[],model_ref:[],password:[]};return wl.value.forEach(e=>{e.type==="enum"?s.enum.push(e.name):e.type==="boolean"?s.boolean.push(e.name):e.type==="model_ref"?s.model_ref.push(e.name):e.type==="password"&&s.password.push(e.name)}),s});Il(()=>me.value.model_ref,s=>{me.value.model_ref.forEach(e=>{Da(!0,{id:_e.value[e].ref_model,name:e})})},{deep:!0});const Xl=i([]),Zl=i(0),El=i({}),ea=s=>{El.value=s},la=R(()=>{let s=new Array;for(let[e,u]of Object.entries(El.value))console.log(),e==="instance_name"?s.push({name:"唯一标识:"+u,field:e}):me.value.model_ref.indexOf(e)!==-1?s.push({name:_e.value[e].verbose_name+":"+Ua.value[e][u].label,field:e}):me.value.enum.indexOf(e)!==-1?(console.log(Ql.value),s.push({name:_e.value[e].verbose_name+":"+Ql.value[e][u],field:e})):s.push({name:_e.value[e].verbose_name+":"+u,field:e});return s}),Na=async(s,e)=>{await q.value.removeFilterParam(s,e),Me(()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})})},Ce=async s=>{var j;yl(!0);let e=new Array,u=await V.$api.getCiModelInstance({...s,page:Fe.value,page_size:K.value,...El.value});Zl.value=u.data.count,(j=u.data.results)==null||j.forEach(y=>{e.push({id:y.id,instance_group:y.instance_group,instance_name:y.instance_name,...y.fields})}),Xl.value=e,yl(!1)};ba(async()=>{Vl.value=!0,await $a(),yl(!1)});const we=i(!1),Sa=()=>{Z.value=!0,we.value=!0,sl.value=!0},Je=i({}),Ol=i({}),aa=(s,e=!1)=>{we.value=!0,sl.value=!1,Z.value=e,Je.value=s,Me(()=>{Object.keys(s).forEach(u=>{u==="id"||u==="instance_group"||(me.value.model_ref.indexOf(u)!==-1&&s[u]!==null?g[u]=s[u].id:g[u]=s[u])}),Ol.value=JSON.parse(JSON.stringify(g))})},ja=s=>{we.value=!0,sl.value=!0,Z.value=!0,Je.value=s,Me(()=>{Object.keys(s).forEach(e=>{e==="id"||e==="instance_group"||(me.value.model_ref.indexOf(e)!==-1?s[e]!==null?g[e]=s[e].id:g[e]=s[e]:me.value.enum.indexOf(e)!==-1?g[e]=s[e].value:me.value.password.indexOf(e)!==-1||(g[e]=s[e]))})}),al({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},el=i(),g=tl({instance_name:null}),ta=R(()=>{let s=Object.assign({},g);delete s.instance_name;for(let[e,u]of Object.entries(s))u!==null&&me.value.password.indexOf(e)!==-1&&(s[e]=Yl(W.value.key,W.value.mode,u));return s}),oa=R(()=>{let s=Object.assign({},ul.value);delete s.instance_name,console.log(me.value);for(let[e,u]of Object.entries(ul.value))u!==null&&me.value.password.indexOf(e)!==-1&&(s[e]=Yl(W.value.key,W.value.mode,u));return s}),sl=i(!0),ul=i({}),na=async(s,e=null)=>{s&&await s.validate(async(u,j)=>{if(u)if(sl.value){console.log(ta.value);let y=await V.$api.addCiModelInstance({model:h.ciModelId,create_user:z.state.username,update_user:z.state.username,fields:ta.value,instance_name:g.instance_name,instance_group:[h.currentNodeId]});y.status=="201"?(I({type:"success",message:"添加成功"}),we.value=!1,Le(s),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),fe("getTree")):I({showClose:!0,message:"添加失败:"+JSON.stringify(y.data),type:"error"})}else{if(console.log(JSON.stringify(Ol.value)),console.log(JSON.stringify(g)),JSON.stringify(Ol.value)===JSON.stringify(g)){Z.value=!1,we.value=!1,Le(s),I({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}else{const ll=Object.entries(Ol.value),dl=Object.entries(g),Y=ll.concat(dl).map(Ie=>JSON.stringify(Ie)),$l=Array.from(new Set(Y)).map(Ie=>JSON.parse(Ie));$l.splice(0,ll.length);const ee=Object.fromEntries($l);let Dl={};if(Object.keys(ee).forEach(Ie=>{Dl[Ie]=ee[Ie]}),ul.value=Dl,Object.keys(ul.value).length===0){Z.value=!1,we.value=!1,Le(s),I({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let y={id:Je.value.id,model:h.ciModelId,update_user:z.state.username};Object.keys(ul.value).indexOf("instance_name")===-1||(y.instance_name=ul.value.instance_name),y.fields=oa.value,console.log(me.value),console.log(y),console.log();let re=await V.$api.updateCiModelInstance(y);re.status=="200"?(I({type:"success",message:"更新成功"}),we.value=!1,Z.value=!1,Le(s),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):I({showClose:!0,message:"更新失败:"+JSON.stringify(re.data),type:"error"})}else console.log("error submit!",j),al({title:"表单校验",message:"表单填写异常",type:"error"})})},Ta=s=>{if(Z.value==!1&&sl.value==!1){we.value=!1;return}Kl.confirm("是否确认关闭?").then(()=>{s(),Le(el.value),we.value=!1,Z.value=!1}).catch(()=>{})},qa=s=>{Le(s),we.value=!1,Z.value=!1},sa=(s=null)=>{Kl.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await V.$api.deleteCiModelInstance(Je.value.id)).status==204?(I({type:"success",message:"删除成功"}),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),Le(el.value),we.value=!1,Z.value=!1,fe("getTree")):I({type:"error",message:"删除失败"})}).catch(()=>{I({type:"info",message:"取消删除"})})},Le=s=>{s&&(s.resetFields(),Je.value={})};return pe({getHasConfigField:Oa,getCiData:Ce,initCiDataForm:Ia,getModelField:Pa,setLoading:yl,closeFilter:P,clearMultipleSelect:Hl,updateFilterParam:ea,reloadCiDataFilter:ue}),(s,e)=>{var pa,fa,va;const u=p("el-button"),j=p("arrow-down"),y=p("el-icon"),re=p("el-dropdown-item"),ll=p("el-dropdown-menu"),dl=p("el-dropdown"),Y=p("el-tooltip"),$l=p("vue-countdown"),ee=p("el-text"),Dl=p("el-tag"),Ie=p("el-table-column"),ua=p("el-link"),ze=p("el-switch"),Ea=p("a-qrcode"),da=p("el-popover"),Ra=p("el-table"),La=p("el-pagination"),xe=p("el-space"),Te=p("el-input"),be=p("el-form-item"),za=p("InfoFilled"),Rl=p("el-input-number"),Ll=p("el-col"),ra=p("el-row"),zl=p("el-form"),Ul=p("el-date-picker"),kl=p("el-option"),hl=p("el-select"),Aa=p("el-collapse-item"),Ya=p("el-collapse"),Ba=p("el-drawer"),ia=p("el-dialog"),Ja=p("el-cascader"),ke=il("permission"),Ka=il("loading"),Ha=il("copy"),ca=il("throttle");return t(),r(ne,null,[Vl.value?(t(),r("div",Bt,[x("div",Jt,[x("div",Kt,[se.value?(t(),d(u,{key:0,icon:b(Qa),onClick:e[0]||(e[0]=n=>se.value=!1),size:"default"},null,8,["icon"])):(t(),d(u,{key:1,icon:b(Xa),onClick:e[1]||(e[1]=n=>se.value=!0),size:"default"},null,8,["icon"])),Q((t(),d(u,{type:"primary",onClick:Sa},{default:l(()=>e[30]||(e[30]=[v("添加")])),_:1})),[[ke,`${(pa=b(k).name)==null?void 0:pa.replace("_info","")}:add`]]),Q((t(),d(u,{disabled:!(Re.value.length>>>0),onClick:e[2]||(e[2]=n=>m.value=!0)},{default:l(()=>e[31]||(e[31]=[v("转移")])),_:1},8,["disabled"])),[[ke,`${(fa=b(k).name)==null?void 0:fa.replace("_info","")}:edit`]]),Q((t(),d(u,{disabled:!(Re.value.length>>>0),onClick:fl},{default:l(()=>e[32]||(e[32]=[v("批量更新")])),_:1},8,["disabled"])),[[ke,`${(va=b(k).name)==null?void 0:va.replace("_info","")}:edit`]]),a(dl,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(ll,null,{default:l(()=>{var n,le;return[Q((t(),r("div",null,[a(re,{disabled:!(Re.value.length>>>0),onClick:e[3]||(e[3]=o=>Be())},{default:l(()=>e[34]||(e[34]=[v("批量删除")])),_:1},8,["disabled"])])),[[ke,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:delete`]]),Q((t(),r("div",null,[a(re,{disabled:!(Re.value.length>>>0),onClick:e[4]||(e[4]=o=>We(!1))},{default:l(()=>e[35]||(e[35]=[v("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(re,{disabled:!(Re.value.length>>>0),onClick:e[5]||(e[5]=o=>We(!0))},{default:l(()=>e[36]||(e[36]=[v("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(re,{onClick:e[6]||(e[6]=o=>nl())},{default:l(()=>e[37]||(e[37]=[v("导出所有")])),_:1})])),[[ke,`${(le=b(k).name)==null?void 0:le.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(u,{type:"primary"},{default:l(()=>[e[33]||(e[33]=v(" 更多操作")),a(y,{class:"el-icon--right"},{default:l(()=>[a(j)]),_:1})]),_:1})]),_:1})]),x("div",Ht,[a(Y,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(u,{icon:b(Za),circle:"",onClick:Gl},null,8,["icon"])]),_:1}),G.value?M("",!0):(t(),d(Y,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var n;return[Q(a(u,{icon:b(Al),circle:"",onClick:F},null,8,["icon"]),[[ke,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:showPassword`]])]}),_:1})),G.value?(t(),d(Y,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[38]||(e[38]=[x("span",null,[v("倒计时结束后自动隐藏密码"),x("br"),v("手动点击可立马隐藏")],-1)])),default:l(()=>[a(u,{circle:"",onClick:E},{default:l(()=>[a($l,{time:Oe.value,onEnd:f,onProgress:c},{default:l(({totalSeconds:n})=>[v(C(n),1)]),_:1},8,["time"])]),_:1})]),_:1})):M("",!0),a(Y,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(u,{icon:b(et),circle:"",onClick:ka},null,8,["icon"])]),_:1}),a(Y,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var n;return[Q(a(u,{icon:b(lt),circle:"",onClick:e[7]||(e[7]=le=>Ye.value=!0)},null,8,["icon"]),[[ke,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:import`]])]}),_:1}),a(Y,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(u,{icon:b(at),circle:"",onClick:ae},null,8,["icon"])]),_:1})])]),Q(x("div",Wt,[a(ee,{tag:"b"},{default:l(()=>e[39]||(e[39]=[v("过滤器")])),_:1}),(t(!0),r(ne,null,ie(la.value,(n,le)=>(t(),d(Dl,{key:n.name,closable:"",type:"primary",onClose:o=>Na(n.field,le)},{default:l(()=>[x("span",null,C(n.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Jl,la.value.length>>>0]]),Q((t(),d(Ra,{ref_key:"ciDataTableRef",ref:Tl,data:Xl.value,onSelectionChange:Va,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":xa},{default:l(()=>[a(Ie,{type:"selection",selectable:Ca,width:"55","reserve-selection":!0}),a(Ie,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(ne,null,ie(Ml.value,(n,le)=>(t(),d(Ie,{property:n.name,label:n.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120"},tt({_:2},[n.name==="mgmt_ip"?{name:"default",fn:l(o=>[a(ua,{href:`https://${o.row[n.name]}`,type:"primary",target:"_blank"},{default:l(()=>[v(C(o.row[n.name]),1)]),_:2},1032,["href"])]),key:"0"}:void 0,me.value.boolean.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var _;return[Q(a(ze,{modelValue:o.row[n.name],"onUpdate:modelValue":D=>o.row[n.name]=D,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:D=>ha({id:o.row.id,fields:{[n.name]:o.row[n.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[ke,{id:`${(_=b(k).name)==null?void 0:_.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,me.value.enum.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var _;return[x("div",Gt,C((_=o.row[n.name])==null?void 0:_.label),1)]}),key:"2"}:void 0,me.value.password.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var _;return[G.value?(t(),r("div",Qt,C(b(Bl)(W.value.key,W.value.mode,o.row[n.name])),1)):(t(),r("div",Xt,[((_=o.row[n.name])==null?void 0:_.length)>>0?(t(),d(ee,{key:0},{default:l(()=>e[40]||(e[40]=[v("******")])),_:1})):(t(),d(ee,{key:1}))]))]}),key:"3"}:void 0,me.value.model_ref.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var _,D;return[x("div",{class:Ue({text_class:((_=o.row[n.name])==null?void 0:_.instance_name)>>0})},C((D=o.row[n.name])==null?void 0:D.instance_name),3)]}),key:"4"}:void 0]),1032,["property","label"]))),256)),a(Ie,{fixed:"right",width:"150",label:"操作"},{default:l(n=>[a(Y,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(u,{link:"",type:"primary",icon:b(Al),onClick:le=>aa(n.row)},null,8,["icon","onClick"])]),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var le;return[Q(a(u,{link:"",type:"primary",icon:b(ot),onClick:o=>aa(n.row,!0)},null,8,["icon","onClick"]),[[ke,`${(le=b(k).name)==null?void 0:le.replace("_info","")}:edit`]])]}),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var le;return[Q(a(u,{link:"",type:"primary",icon:b(ma),onClick:o=>ja(n.row)},null,8,["icon","onClick"]),[[ke,`${(le=b(k).name)==null?void 0:le.replace("_info","")}:edit`]])]}),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>[x("span",Zt,[a(da,{placement:"bottom",title:"实例二维码",width:250,trigger:"click"},{reference:l(()=>[a(u,{link:"",type:"primary",icon:b(nt)},null,8,["icon"])]),default:l(()=>[a(Ea,{value:JSON.stringify(n.row),size:200},null,8,["value"])]),_:2},1024)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ka,_l.value]]),a(La,{"current-page":Fe.value,"onUpdate:currentPage":e[8]||(e[8]=n=>Fe.value=n),"page-size":K.value,"onUpdate:pageSize":e[9]||(e[9]=n=>K.value=n),"page-sizes":[10,20,50,100,200],size:He.value,disabled:Ae.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:Zl.value,onSizeChange:$,onCurrentChange:Pe,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[a(ee,null,{default:l(()=>[v("已选择 "+C(Re.value.length)+" 条",1)]),_:1})]),_:1},8,["current-page","page-size","size","disabled","total"])])):M("",!0),a(Ba,{modelValue:we.value,"onUpdate:modelValue":e[19]||(e[19]=n=>we.value=n),class:"edit-drawer",direction:"rtl",size:"40%","before-close":Ta},{header:l(()=>[a(ee,{tag:"b"},{default:l(()=>e[41]||(e[41]=[v("实例信息")])),_:1})]),default:l(()=>[a(zl,{ref_key:"ciDataFormRef",ref:el,style:{"max-width":"100%"},model:g,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[a(be,{prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>e[42]||(e[42]=[v("唯一标识")])),_:1}),a(Y,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:1})]),_:1})]),default:l(()=>[Z.value?(t(),d(Te,{key:0,modelValue:g.instance_name,"onUpdate:modelValue":e[10]||(e[10]=n=>g.instance_name=n),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",eo,C(g.instance_name),1))]),_:1}),a(Ya,{modelValue:O.value,"onUpdate:modelValue":e[14]||(e[14]=n=>O.value=n)},{default:l(()=>[(t(!0),r(ne,null,ie(Se.value.field_groups,(n,le)=>(t(),d(Aa,{name:le,key:le},{title:l(()=>[a(ee,{tag:"b",size:"large"},{default:l(()=>[v(C(n.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(ra,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(ne,null,ie(n.fields,(o,_)=>(t(),d(Ll,{span:12},{default:l(()=>[o.type==="string"?(t(),d(be,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:Fa(o.validation_rule)},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(Te,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",lo,[g[o.name]!=null?(t(),r("div",ao,[o.name==="mgmt_ip"?(t(),d(ua,{key:0,href:`https://${g[o.name]}`,type:"primary",target:"_blank"},{default:l(()=>[v(C(g[o.name]),1)]),_:2},1032,["href"])):(t(),r("span",{key:1,class:Ue(["text_class",{requiredClass:o.required}])},C(g[o.name]),3))])):(t(),r("span",to,"--"))]))]),_:2},1032,["label","prop","required","rules"])):M("",!0),o.type==="json"?(t(),d(be,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),a(Y,{placement:"right",effect:"dark"},{content:l(()=>e[43]||(e[43]=[v(" json类型字段"),x("br",null,null,-1),v("请输入json格式数据! ")])),default:l(()=>[a(y,null,{default:l(()=>[a(za)]),_:1})]),_:1}),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(Te,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",oo,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",no,"--"))]))]),_:2},1032,["label","prop","required"])):M("",!0),["text"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(Te,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",so,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",uo,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),d(be,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[a(ze,{modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!Z.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):M("",!0),["float"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(ee,{key:0,tag:"b"},{default:l(()=>[v(C(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(ee,{key:1,tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(Y,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(Rl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ro,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",io,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>{var D,qe;return[Z.value?(t(),d(Te,{key:1,modelValue:g[o.name],"onUpdate:modelValue":rl=>g[o.name]=rl,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",co,[((D=g[o.name])==null?void 0:D.length)>>0?(t(),r("div",po,[G.value?(t(),r("span",fo,C(b(Bl)(W.value.key,W.value.mode,g[o.name])),1)):(t(),r("span",{key:1,class:Ue({requiredClass:o.required}),onMouseenter:e[12]||(e[12]=rl=>te.value=!0),onMouseleave:e[13]||(e[13]=rl=>te.value=!1)},[e[45]||(e[45]=v("******** ")),Q((t(),d(da,{width:380,trigger:"click",onAfterLeave:ye},{reference:l(()=>[a(y,null,{default:l(()=>[Q(a(b(Al),null,null,512),[[Jl,te.value&&!G.value]])]),_:1})]),default:l(()=>[a(zl,{ref_for:!0,ref_key:"passFormRef",ref:ge,inline:!0,model:oe,"require-asterisk-position":"right"},{default:l(()=>[a(ra,{align:"middle"},{default:l(()=>[a(Ll,{span:20},{default:l(()=>[a(be,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(Te,{type:"password",modelValue:oe.secret,"onUpdate:modelValue":e[11]||(e[11]=rl=>oe.secret=rl),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(Ll,{span:2},{default:l(()=>[a(be,null,{default:l(()=>[a(u,{type:"primary",size:"small",onClick:rl=>he(ge.value,g[o.name])},{default:l(()=>e[44]||(e[44]=[v("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),A.value?(t(),d(ee,{key:0,tag:"b"},{default:l(()=>[v("密码: "+C(J.value)+" ",1),a(Y,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(y,null,{default:l(()=>[Q(a(b(ma),null,null,512),[[Ha,J.value]])]),_:1})]),_:1})]),_:1})):M("",!0)]),_:2},1024)),[[ke,`${(qe=b(k).name)==null?void 0:qe.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",vo,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(ee,{key:0,tag:"b"},{default:l(()=>[v(C(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(ee,{key:1,tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(Y,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(Rl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",mo,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},C(g[o.name]),3)):(t(),r("span",_o,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(Ul,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",yo,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue({requiredClass:o.required})},C(g[o.name]),3)):(t(),r("span",go,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(Ul,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",bo,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue({requiredClass:o.required})},C(g[o.name]),3)):(t(),r("span",wo,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>{var D;return[Z.value?(t(),d(hl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":qe=>g[o.name]=qe,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(ne,null,ie(ql.value[o.validation_rule],qe=>(t(),d(kl,{key:qe.value,label:qe.label,value:qe.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",ko,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue({requiredClass:o.required})},C((D=Je.value[o.name])==null?void 0:D.label),3)):(t(),r("span",ho,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?M("",!0):(t(),d(be,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(ee,{tag:"b"},{default:l(()=>[v(C(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[Z.value?(t(),d(hl,{key:1,modelValue:g[o.name],"onUpdate:modelValue":D=>g[o.name]=D,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(ne,null,ie(bl.value[o.name],(D,qe)=>(t(),d(kl,{key:qe,label:D.label,value:D.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",Co,[g[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},C(Je.value[o.name].name),3)):(t(),r("span",xo,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),footer:l(()=>{var n,le,o,_;return[x("div",Vo,[a(u,{onClick:e[15]||(e[15]=D=>qa(el.value))},{default:l(()=>e[46]||(e[46]=[v("取消")])),_:1}),sl.value?(t(),r("div",Mo,[a(u,{type:"primary",onClick:e[16]||(e[16]=D=>na(el.value))},{default:l(()=>e[47]||(e[47]=[v("添加")])),_:1})])):(t(),r("div",Oo,[Z.value?(t(),r("div",$o,[((n=Je.value.instance_group)==null?void 0:n.indexOf(Ge.value))!==-1?Q((t(),d(u,{key:0,type:"danger",onClick:sa},{default:l(()=>e[48]||(e[48]=[v("删除")])),_:1})),[[ke,`${(le=b(k).name)==null?void 0:le.replace("_info","")}:delete`]]):Q((t(),d(Y,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(u,{type:"danger",onClick:sa,disabled:""},{default:l(()=>e[49]||(e[49]=[v("删除")])),_:1})]),_:1})),[[ke,`${(o=b(k).name)==null?void 0:o.replace("_info","")}:delete`]]),Q((t(),d(u,{type:"primary",onClick:e[17]||(e[17]=D=>na(el.value))},{default:l(()=>e[50]||(e[50]=[v("保存")])),_:1})),[[ca]])])):(t(),r("div",Do,[Q((t(),d(u,{type:"primary",onClick:e[18]||(e[18]=D=>Z.value=!0)},{default:l(()=>e[51]||(e[51]=[v("编辑")])),_:1})),[[ke,`${(_=b(k).name)==null?void 0:_.replace("_info","")}:edit`]])]))]))])]}),_:1},8,["modelValue"]),a(ia,{modelValue:Ze.value,"onUpdate:modelValue":e[21]||(e[21]=n=>Ze.value=n),title:"批量更新",width:"500","before-close":ml},{footer:l(()=>[x("div",Lo,[a(u,{onClick:ml},{default:l(()=>e[52]||(e[52]=[v("取消")])),_:1}),a(u,{onClick:e[20]||(e[20]=Cl(n=>vl(),["prevent"]))},{default:l(()=>e[53]||(e[53]=[v("新增字段")])),_:1}),Q((t(),d(u,{type:"primary",onClick:xl,disabled:!(Ne.value.length>0)},{default:l(()=>e[54]||(e[54]=[v("保存")])),_:1},8,["disabled"])),[[ca]])])]),default:l(()=>[a(zl,{ref_key:"multipleFormRef",ref:Xe,style:{"max-width":"1000px"},model:U,"label-width":"auto"},{default:l(()=>[(t(!0),r(ne,null,ie(Ne.value,(n,le)=>{var o;return t(),d(be,{key:`param-${n}`,label:"字段"+(le+1),prop:`updateParams.${n}`,rules:Nl((o=_e.value[n])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(xe,null,{default:l(()=>[a(hl,{"model-value":n.startsWith("__temp")?void 0:n,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:_=>Sl(le,_)},{default:l(()=>[(t(!0),r(ne,null,ie(De.value,_=>(t(),d(kl,{key:_.value,label:_.label,value:_.value,disabled:_.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),n&&!n.startsWith("__temp")?(t(),r("div",Uo,[["text","json"].indexOf(_e.value[n].type)>>>-1?["string"].indexOf(_e.value[n].type)>>>-1?["enum"].indexOf(_e.value[n].type)>>>-1?["model_ref"].indexOf(_e.value[n].type)>>>-1?["boolean"].indexOf(_e.value[n].type)>>>-1?["integer"].indexOf(_e.value[n].type)>>>-1?["float"].indexOf(_e.value[n].type)>>>-1?["date"].indexOf(_e.value[n].type)>>>-1?["datetime"].indexOf(_e.value[n].type)>>>-1?(t(),r("div",Ro,[a(Te,{modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Eo,[a(ze,{modelValue:T.value[n],"onUpdate:modelValue":_=>T.value[n]=_,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:_=>Ee(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?M("",!0):(t(),d(Ul,{key:0,modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",qo,[a(ze,{modelValue:T.value[n],"onUpdate:modelValue":_=>T.value[n]=_,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:_=>Ee(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?M("",!0):(t(),d(Ul,{key:0,modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",To,[a(ze,{modelValue:T.value[n],"onUpdate:modelValue":_=>T.value[n]=_,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:_=>Ee(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?M("",!0):(t(),d(Rl,{key:0,modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",jo,[a(ze,{modelValue:T.value[n],"onUpdate:modelValue":_=>T.value[n]=_,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:_=>Ee(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?M("",!0):(t(),d(Te,{key:0,modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",So,[a(ze,{modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",No,[a(hl,{modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(ne,null,ie(bl.value[n],(_,D)=>(t(),d(kl,{key:D,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Po,[a(hl,{modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(ne,null,ie(ql.value[_e.value[n].validation_rule],_=>(t(),d(kl,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Io,[a(ze,{modelValue:T.value[n],"onUpdate:modelValue":_=>T.value[n]=_,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:_=>Ee(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?M("",!0):(t(),d(Te,{key:0,modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Fo,[a(ze,{modelValue:T.value[n],"onUpdate:modelValue":_=>T.value[n]=_,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:_=>Ee(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?M("",!0):(t(),d(Te,{key:0,modelValue:U.updateParams[n],"onUpdate:modelValue":_=>U.updateParams[n]=_,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):M("",!0),a(u,{class:"mt-2",icon:b(st),circle:"",onClick:Cl(_=>de(le,n),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(ia,{modelValue:m.value,"onUpdate:modelValue":e[24]||(e[24]=n=>m.value=n),title:"实例组编辑",width:"500"},{footer:l(()=>[x("div",zo,[a(u,{onClick:e[23]||(e[23]=n=>m.value=!1)},{default:l(()=>e[55]||(e[55]=[v("取消")])),_:1}),a(u,{type:"primary",onClick:Qe},{default:l(()=>e[56]||(e[56]=[v(" 提交更新 ")])),_:1})])]),default:l(()=>[a(Ja,{options:h.treeData,props:w,clearable:"",modelValue:S.value,"onUpdate:modelValue":e[22]||(e[22]=n=>S.value=n),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),B.value?(t(),d(_t,{key:1,isShowUpload:Ye.value,"onUpdate:isShowUpload":e[25]||(e[25]=n=>Ye.value=n),ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,onGetCiData:Ce},null,8,["isShowUpload","ciModelId","currentNodeId"])):M("",!0),B.value?(t(),d(Yt,{key:2,ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,allModelFieldByNameObj:_e.value,enumOptionObj:ql.value,validationRulesObj:je.value,allModelField:wl.value,modelRefOptions:bl.value,showFilter:ve.value,"onUpdate:showFilter":e[26]||(e[26]=n=>ve.value=n),onUpdateFilterParam:ea,onGetCiData:Ce,ref_key:"ciDataFilterRef",ref:q},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):M("",!0),a(Vt,{ciModelId:h.ciModelId,allModelField:wl.value,allModelFieldInfo:Ma.value,isShowTableCol:jl.value,"onUpdate:isShowTableCol":e[27]||(e[27]=n=>jl.value=n),hasConfigField:Ml.value,"onUpdate:hasConfigField":e[28]||(e[28]=n=>Ml.value=n),onReloadTable:Gl,ref_key:"ciDataTableColRef",ref:Wl},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(Ot,{showAllPassDia:X.value,"onUpdate:showAllPassDia":e[29]||(e[29]=n=>X.value=n)},null,8,["showAllPassDia"])],64)}}}),Yo=Pl(Ao,[["__scopeId","data-v-75d5df34"]]),Bo=ut("ci",()=>{const ce=i([]),pe=tl({filterParams:[]});i([]);const H=i([]);return i({}),{setFilterList:z=>{console.log(z),H.value=z,console.log(H.value)},saveFilterParams:z=>{console.log(z),pe.filterParams=z},setModelList:z=>{ce.value=z}}},{persist:!0}),Jo={class:"card ci_data_tree"},Ko={class:"custom-tree-node"},Ho={class:"table-box"},Wo=pl({__name:"cidataView",setup(ce){const pe=ga(),{proxy:H}=Fl(),V=i(!0),L=Bo(),k=i(""),z=i(!1);i(""),i(!1);const fe=i(),h=i([]),se=i("");Il(se,w=>{G.value.filter(w)});const O=(w,m)=>w?m.label.toLowerCase().includes(w.toLowerCase()):!0,ve=w=>!(w.level>Be.value-1||w.label==="空闲池"),ae=async()=>{z.value=!0;let w=await H.$api.getCiModelTree({model:ue.value});console.log(w),h.value=[w.data],Me(()=>{F.value===1&&(G.value.setCurrentKey(w.data.id),F.value=G.value.getCurrentKey())}),z.value=!1},B=i([]),ue=i(""),q=async()=>{let w=await H.$api.getCiModel();B.value=w.data.results,L.setModelList(B.value),k.value=B.value.find(m=>m.name==="hosts"),ue.value=B.value.find(m=>m.name==="hosts").id};R(()=>{let w={};return B.value.forEach(m=>{w[m.id]=m}),w});const P=i(""),X=async()=>{F.value=1,await ae(),await P.value.closeFilter(),await P.value.updateFilterParam({}),await P.value.clearMultipleSelect(),P.value.reloadCiDataFilter(),await P.value.setLoading(!0),await P.value.getModelField(),await P.value.getHasConfigField(),await P.value.setLoading(!1),await P.value.initCiDataForm(),await P.value.getCiData({model:ue.value,model_instance_group:F.value})};ba(async()=>{console.log(123),await q(),await ae(),P.value.setLoading(!0),await P.value.getModelField(),await P.value.getHasConfigField(),await P.value.setLoading(!1),await P.value.initCiDataForm(),await P.value.getCiData({model:ue.value,model_instance_group:G.value.getCurrentKey()})});const W=w=>w.built_in?!1:w.children?!(w.children.length>>>0):!0,G=i(),Oe=i(),F=i(1),f=i(!1),c=i(100),E=(w,m)=>{A.value=!1;let S=c.value++;G.value.append({id:S,label:"新建子目录",level:m.level+1,parent:m.id,model:k.value.id},w),G.value.setCurrentKey(S),oe.value=S,Me(()=>{Oe.value.focus()})},te=(w,m)=>{let S=c.value++;A.value=!1,G.value.insertAfter({id:S,label:"新建目录",level:m.level,parent:w.parent.data.id,model:k.value.id},w),G.value.setCurrentKey(S),oe.value=S,Me(()=>{Oe.value.focus()})},ye=()=>{F.value=G.value.getCurrentKey(),P.value.clearMultipleSelect(),P.value.setLoading(!0),P.value.getCiData({model:ue.value,model_instance_group:G.value.getCurrentKey()}),P.value.setLoading(!0)},ge=w=>{f.value=!f.value,w.isShowEdit=f.value},oe=i(99999),J=i(""),A=i(!0),he=w=>{A.value=!0,console.log(w),J.value=w.label,oe.value=w.id,Me(()=>{Oe.value.focus()})},Fe=async(w,m)=>{if(oe.value=99999,!J.value)I.warning("名称不可为空"),G.value.remove(m);else if(A.value){if(J.value==m.label)return!1;{let S=await H.$api.updateCiModelTree({id:m.id,label:J.value});S.status=="200"?(I({type:"success",message:"更新成功"}),m.label=J.value,ae(),J.value=""):I({showClose:!0,message:"更新失败:"+JSON.stringify(S.data),type:"error"}),console.log(m)}}else{m.label=J.value,console.log(m);let S=await H.$api.addCiModelTree(m);S.status=="201"?(I({type:"success",message:"添加成功"}),ae(),J.value=""):(I({showClose:!0,message:"添加失败:"+JSON.stringify(S.data),type:"error"}),G.value.remove(m))}},K=w=>{w&&Kl.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await H.$api.deleteCiModelTree(w.data.id)).status==200?(I({type:"success",message:"删除成功"}),await ae()):I({type:"error",message:"删除失败"})}).catch(()=>{})},He=i(""),Ae=(w,m)=>{He.value=w,console.log(He.value)},$=(w,m,S)=>{},Pe=(w,m,S)=>{},N=(w,m,S)=>{},ol=async(w,m,S,Ge)=>{if(m.data.id===w.data.id)return;let Qe={};S==="inner"?Qe={id:w.data.id,parent:m.data.id}:Qe={id:w.data.id,parent:m.parent.data.id};let Xe=await H.$api.updateCiModelTree(Qe);Xe.status=="200"?(I({type:"success",message:"更新成功"}),ae()):I({showClose:!0,message:"更新失败:"+JSON.stringify(Xe.data),type:"error"})},Ye=(w,m,S,Ge)=>{},Be=i(5),We=(w,m,S)=>m.data.built_in?!1:Be.value-w.data.level+m.data.level>=Be.value?S!=="inner":!0,nl=w=>!w.data.built_in;return(w,m)=>{const S=p("el-text"),Ge=p("el-col"),Qe=p("el-option"),Xe=p("el-select"),Ze=p("el-row"),T=p("el-divider"),Ee=p("el-input"),fl=p("a-menu-item"),Nl=p("a-menu"),U=p("a-dropdown"),Ne=p("el-space"),vl=il("permission"),Sl=il("loading");return t(),r(ne,null,[Q(x("div",Jo,[a(Ze,{align:"middle",justify:"start"},{default:l(()=>[a(Ge,{span:8},{default:l(()=>[a(S,{tag:"b"},{default:l(()=>m[7]||(m[7]=[v("实例树")])),_:1})]),_:1}),a(Ge,{span:14},{default:l(()=>[a(Xe,{modelValue:ue.value,"onUpdate:modelValue":m[0]||(m[0]=de=>ue.value=de),placeholder:"Select",onChange:m[1]||(m[1]=de=>X())},{default:l(()=>[(t(!0),r(ne,null,ie(B.value,de=>(t(),d(Qe,{key:de.id,label:de.verbose_name,value:de.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(T),a(Ee,{modelValue:se.value,"onUpdate:modelValue":m[2]||(m[2]=de=>se.value=de),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),Q((t(),d(b(ct),{style:{"max-width":"280px",height:"auto"},"allow-drop":We,"allow-drag":nl,data:h.value,draggable:!1,"default-expand-all":"","node-key":"id",onNodeDragStart:Ae,onNodeDragEnter:$,onNodeDragLeave:Pe,onNodeDragOver:N,onNodeDragEnd:ol,onNodeDrop:Ye,"highlight-current":!0,"current-node-key":F.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:G,onNodeClick:ye,"filter-node-method":O},{default:l(({node:de,data:$e})=>{var xl;return[x("div",Ko,[oe.value===$e.id?(t(),d(Ee,{key:0,modelValue:J.value,"onUpdate:modelValue":m[3]||(m[3]=De=>J.value=De),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:Oe,onBlur:De=>Fe(De,$e),onKeyup:m[4]||(m[4]=dt(De=>De.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),d(S,{key:1,size:"default"},{default:l(()=>[v(C(de.label),1),a(S,{size:"small"},{default:l(()=>[v("("+C($e.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),Q((t(),r("div",{class:Ue(["actionClass",{is_show_action:de.isShowEdit}])},[a(Ne,null,{default:l(()=>[$e.built_in?M("",!0):(t(),d(b(rt),{key:0,onClick:Cl(De=>he($e),["stop"])},null,8,["onClick"])),a(U,{trigger:["click"],ref_key:"aDropdownRef",ref:fe,onOpenChange:De=>ge(de)},{overlay:l(()=>[a(Nl,null,{default:l(()=>{var De,ml;return[Q((t(),r("div",null,[$e.level!==1?(t(),d(fl,{key:"0",onClick:_l=>te(de,$e)},{default:l(()=>m[8]||(m[8]=[v(" 添加同级节点 ")])),_:2},1032,["onClick"])):M("",!0),ve($e)?(t(),d(fl,{key:"1",onClick:_l=>E(de,$e)},{default:l(()=>m[9]||(m[9]=[v(" 添加子节点 ")])),_:2},1032,["onClick"])):M("",!0)])),[[vl,`${(De=b(pe).name)==null?void 0:De.replace("_info","")}:add`]]),Q((t(),r("div",null,[W($e)?(t(),d(fl,{key:"2",onClick:_l=>K(de)},{default:l(()=>m[10]||(m[10]=[v(" 删除节点 ")])),_:2},1032,["onClick"])):M("",!0)])),[[vl,`${(ml=b(pe).name)==null?void 0:ml.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(b(it),{onClick:m[5]||(m[5]=Cl(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[vl,`${(xl=b(pe).name)==null?void 0:xl.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[Sl,z.value]])],512),[[Jl,V.value]]),x("div",Ho,[a(Yo,{ciModelId:ue.value,treeData:h.value,currentNodeId:F.value,ref_key:"ciDataShowRef",ref:P,onGetTree:ae,showTree:V.value,"onUpdate:showTree":m[6]||(m[6]=de=>V.value=de)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),en=Pl(Wo,[["__scopeId","data-v-e713289c"]]);export{en as default};
