import{b as Be,u as Oe,r as p,c as O,M as re,bI as Ne,aN as je,e as i,b3 as Ee,o as m,f as G,h as N,bO as k,bo as w,O as c,w as t,j as u,g as l,F as X,b1 as ue,Y as Ae,t as Me,c0 as qe,c1 as Je,k as Ie,bV as q,c4 as s}from"./index-C9OpqlOS.js";const Le={class:"card"},Re={class:"user-header"},We={class:"user-header"},Xe={__name:"portalView",setup(Ye){const v=Be(),j=Oe(),{proxy:n}=Ie(),U=p({search:null}),E=p([]);p([]);const J=p(!1),x=p(!1),A=p("add");p(!0);const b=O({group:"",owner:j.state.userinfo.user_id});p(0),O({owner:j.state.userinfo.user_id});const de=()=>{J.value=!0},ie=p([]),pe=o=>{ie.value=o},g=p([]),me=o=>{g.value=o,console.log(g.value)},H=re(()=>{let o=[];for(let e in g.value)o.push(g.value[e].id);return o}),K=()=>{q.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let o=[];for(let r in g.value)o.push(g.value[r].id);(await n.$api.portalMuldel({pks:o})).status==204?s({type:"success",message:"删除成功"}):s({type:"error",message:"删除失败"}),z()}).catch(()=>{s({type:"info",message:"Delete canceled"})})},fe=()=>{x.value=!0,A.value="add"},ce=o=>{x.value=!0,A.value="edit",n.$nextTick(()=>{Object.assign(b,o)})},ge=re(()=>{let o={};return E.value.forEach(e=>{o[e.id]=e.group}),o}),z=async()=>{let o=await n.$api.pgroupGet({page:1,page_size:1e3});E.value=o.data.results},ye=o=>{q.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await n.$api.pgroupDel(o.id)).status==204?(s({type:"success",message:"删除成功"}),z()):s({type:"error",message:"删除失败"})}).catch(()=>{s({type:"info",message:"Delete canceled"})})},we=()=>{n.$refs.pgroupForm.validate(async o=>{if(console.log(b),o)if(A.value=="add"){let e=await n.$api.pgroupAdd(b);e.status==201?(x.value=!1,s({type:"success",message:"添加成功"}),n.$refs.pgroupForm.resetFields(),z()):s({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await n.$api.pgroupUpdate({group:b.group,id:b.id});e.status==200?(x.value=!1,s({type:"success",message:"更新成功"}),n.$refs.pgroupForm.resetFields(),z()):s({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else s({showClose:!0,message:"请输入正确内容.",type:"error"})})},$=p(!1),d=O({name:"",url:"",target:!0,group:"",status:!0,username:"",password:"",describe:"",owner:j.state.userinfo.user_id}),T=O({page:1,page_size:10});Ne(()=>T,o=>{D(o)},{deep:!0});const ve=p([{prop:"name",label:"名称"},{prop:"url",label:"链接地址"},{prop:"describe",label:"描述"},{prop:"target",label:"跳转方式"},{prop:"status",label:"状态"},{prop:"group",label:"分组"},{prop:"username",label:"登录用户名"},{prop:"password",label:"密码"}]),M=p("add"),I=p([]),Q=p(0),P=O({owner:j.state.userinfo.user_id}),be=p([]),D=async o=>{let e=await n.$api.portalGet(o);I.value=e.data.results,Q.value=e.data.count},_e=()=>{$.value=!0,M.value="add"},Ve=()=>{$.value=!1,n.$refs.portalForm.resetFields()},Ce=()=>{n.$refs.portalForm.validate(async o=>{if(o)if(M.value=="add"){let e=await n.$api.portalAdd(d);e.status==201?(s({type:"success",message:"添加成功"}),n.$refs.portalForm.resetFields(),D(P),$.value=!1):s({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{let e=await n.$api.portalUpdate(d);e.status==200?(s({type:"success",message:"更新成功"}),n.$refs.portalForm.resetFields(),D(P),$.value=!1):s({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else s({showClose:!0,message:"请输入正确内容.",type:"error"})})},ke=o=>{$.value=!0,M.value="edit",n.$nextTick(()=>{Object.assign(d,o)})},xe=o=>{q.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await n.$api.portalDel(o.id)).status==204?(s({type:"success",message:"删除成功"}),D(P)):s({type:"error",message:"删除失败"})}).catch(()=>{s({type:"info",message:"Delete canceled"})})},Z=()=>{q.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let o=[];for(let r in g.value)o.push(g.value[r].id);(await n.$api.portalMuldel({pks:o})).status==204?s({type:"success",message:"删除成功"}):s({type:"error",message:"删除失败"}),D(P)}).catch(()=>{s({type:"info",message:"Delete canceled"})})};je(async()=>{await z(),await D(P)});const ee=async(o=null)=>{let e=await n.$api.exportXls(o);console.log(e),n.$commonFunc.downloadFunc(e)},le=()=>{console.log(H.value),ee({rowid:H.value})},$e=async()=>{let o=await n.$api.portalTemplateExport();console.log(o)},he=()=>{if(U.value.search!=null){var o=new RegExp(U.value.search);let e=[];be.value.forEach(r=>{o.test(r.name)&&e.push(r),I.value=e})}},ze=async o=>{console.log(o);let e=await n.$api.portalUpdate({status:o.status,id:o.id});e.status==200?(s({type:"success",message:"更新成功"}),z()):s({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})};return(o,e)=>{var ae,oe,se,ne;const r=i("el-button"),B=i("el-dropdown-item"),De=i("el-dropdown-menu"),Se=i("el-dropdown"),h=i("el-input"),f=i("el-form-item"),L=i("el-form"),S=i("el-table-column"),Fe=i("el-tag"),R=i("el-switch"),te=i("el-table"),Ue=i("el-pagination"),F=i("el-row"),W=i("el-dialog"),_=i("el-col"),Te=i("el-option"),Pe=i("el-select"),V=Ee("permission");return m(),G(X,null,[N("div",Le,[N("div",Re,[N("div",null,[k((m(),c(r,{type:"primary",size:"small",onClick:_e},{default:t(()=>e[16]||(e[16]=[u("新增")])),_:1})),[[V,`${(ae=w(v).name)==null?void 0:ae.replace("_info","")}:add`]]),k((m(),c(r,{type:"primary",size:"small",onClick:de},{default:t(()=>e[17]||(e[17]=[u("新增分组")])),_:1})),[[V,`${(oe=w(v).name)==null?void 0:oe.replace("_info","")}:add`]]),g.value.length==0?k((m(),c(r,{key:0,disabled:"",type:"danger",size:"small",onClick:Z},{default:t(()=>e[18]||(e[18]=[u("批量删除")])),_:1})),[[V,`${(se=w(v).name)==null?void 0:se.replace("_info","")}:delete`]]):k((m(),c(r,{key:1,type:"danger",size:"small",onClick:Z},{default:t(()=>e[19]||(e[19]=[u("批量删除")])),_:1})),[[V,`${(ne=w(v).name)==null?void 0:ne.replace("_info","")}:delete`]]),l(Se,{size:"small","split-button":"",type:"primary",style:{"margin-left":"15px","margin-right":"15px"}},{dropdown:t(()=>[l(De,null,{default:t(()=>[l(B,{onClick:ee},{default:t(()=>e[20]||(e[20]=[u("全部导出")])),_:1}),g.value.length===0?(m(),c(B,{key:0,onClick:le,disabled:""},{default:t(()=>e[21]||(e[21]=[u("批量导出")])),_:1})):(m(),c(B,{key:1,onClick:le},{default:t(()=>e[22]||(e[22]=[u("批量导出")])),_:1})),l(B,null,{default:t(()=>e[23]||(e[23]=[u("批量导入")])),_:1}),l(B,{onClick:$e},{default:t(()=>e[24]||(e[24]=[u("模版下载")])),_:1})]),_:1})]),default:t(()=>[e[25]||(e[25]=u(" 更多操作 "))]),_:1})]),l(L,{inline:!0,model:U.value,size:"small",class:"demo-form-inline"},{default:t(()=>[l(f,{label:"名称"},{default:t(()=>[l(h,{modelValue:U.value.search,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value.search=a),placeholder:"输入名称",clearable:""},null,8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(r,{type:"primary",size:"small",onClick:he},{default:t(()=>e[26]||(e[26]=[u("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),l(te,{border:"",data:I.value,style:{width:"100%",flex:"1"},"max-height":"100%",onSelectionChange:me},{default:t(()=>[l(S,{type:"selection",width:"55"}),(m(!0),G(X,null,ue(ve.value,a=>(m(),c(S,{key:a.prop,label:a.label,prop:a.prop},Ae({_:2},[a.prop==="group"?{name:"default",fn:t(y=>[l(Fe,null,{default:t(()=>[u(Me(ge.value[y.row.group]),1)]),_:2},1024)]),key:"0"}:void 0,a.prop==="status"?{name:"default",fn:t(y=>[l(R,{modelValue:y.row.status,"onUpdate:modelValue":C=>y.row.status=C,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:C=>ze(y.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),key:"1"}:void 0]),1032,["label","prop"]))),128)),l(S,{fixed:"right",label:"操作",width:"150"},{default:t(a=>{var y,C;return[k((m(),c(r,{type:"primary",size:"small",onClick:Y=>ke(a.row)},{default:t(()=>e[27]||(e[27]=[u(" 编辑 ")])),_:2},1032,["onClick"])),[[V,`${(y=w(v).name)==null?void 0:y.replace("_info","")}:edit`]]),k((m(),c(r,{type:"danger",size:"small",onClick:Y=>xe(a.row)},{default:t(()=>e[28]||(e[28]=[u(" 删除 ")])),_:2},1032,["onClick"])),[[V,`${(C=w(v).name)==null?void 0:C.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data"]),l(Ue,{"current-page":T.page,"onUpdate:currentPage":e[1]||(e[1]=a=>T.page=a),"page-size":T.page_size,"onUpdate:pageSize":e[2]||(e[2]=a=>T.page_size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:Q.value,style:{"margin-top":"5px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),l(W,{modelValue:J.value,"onUpdate:modelValue":e[6]||(e[6]=a=>J.value=a),title:"编辑分组",width:"30%"},{footer:t(()=>[l(W,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=a=>x.value=a),width:"20%",title:A.value==="add"?"新增分组":"编辑分组","append-to-body":""},{default:t(()=>[l(L,{inline:!0,model:b,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"pgroupForm","status-icon":""},{default:t(()=>[l(f,{label:"分组名称",prop:"group",rules:[{required:!0}]},{default:t(()=>[l(h,{modelValue:b.group,"onUpdate:modelValue":e[3]||(e[3]=a=>b.group=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1}),l(F,{style:{"justify-content":"space-around"}},{default:t(()=>[l(f,null,{default:t(()=>[l(r,{onClick:e[4]||(e[4]=a=>x.value=!1)},{default:t(()=>e[29]||(e[29]=[u("取消")])),_:1}),l(r,{type:"primary",onClick:we},{default:t(()=>e[30]||(e[30]=[u(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),default:t(()=>[N("div",We,[N("div",null,[l(r,{type:"primary",size:"small",onClick:fe},{default:t(()=>e[31]||(e[31]=[u("新增")])),_:1}),g.value.length==0?(m(),c(r,{key:0,disabled:"",type:"danger",size:"small",onClick:K},{default:t(()=>e[32]||(e[32]=[u("批量删除")])),_:1})):(m(),c(r,{key:1,type:"danger",size:"small",onClick:K},{default:t(()=>e[33]||(e[33]=[u("批量删除")])),_:1}))])]),l(te,{data:E.value,"default-sort":{prop:"id",order:"ascending"},onSelectionChange:pe},{default:t(()=>[l(S,{type:"selection",width:"55"}),l(S,{prop:"group",label:"分组名",sortable:""}),l(S,{fixed:"right",label:"操作"},{default:t(a=>{var y,C;return[k(l(r,{type:"primary",size:"small",link:"",icon:w(qe),onClick:Y=>ce(a.row)},null,8,["icon","onClick"]),[[V,`${(y=w(v).name)==null?void 0:y.replace("_info","")}:edit`]]),k(l(r,{type:"danger",link:"",size:"small",icon:w(Je),onClick:Y=>ye(a.row)},null,8,["icon","onClick"]),[[V,`${(C=w(v).name)==null?void 0:C.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),l(W,{modelValue:$.value,"onUpdate:modelValue":e[15]||(e[15]=a=>$.value=a),title:M.value=="add"?"新增链接":"编辑链接",width:"50%"},{default:t(()=>[l(L,{inline:!0,model:d,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"portalForm","status-icon":""},{default:t(()=>[l(F,null,{default:t(()=>[l(_,{span:12},{default:t(()=>[l(f,{label:"名称",prop:"name",rules:[{required:!0}]},{default:t(()=>[l(h,{modelValue:d.name,"onUpdate:modelValue":e[7]||(e[7]=a=>d.name=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:t(()=>[l(f,{label:"链接地址",prop:"url",rules:[{required:!0}],style:{width:"90%"}},{default:t(()=>[l(h,{modelValue:d.url,"onUpdate:modelValue":e[8]||(e[8]=a=>d.url=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:t(()=>[l(_,{span:12},{default:t(()=>[l(f,{label:"描述",prop:"describe"},{default:t(()=>[l(h,{modelValue:d.describe,"onUpdate:modelValue":e[9]||(e[9]=a=>d.describe=a),placeholder:"",clearable:"",style:{width:"100%"},autosize:{minRows:2,maxRows:4},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:t(()=>[l(f,{label:"分组",prop:"group",rules:[{required:!0}]},{default:t(()=>[l(Pe,{modelValue:d.group,"onUpdate:modelValue":e[10]||(e[10]=a=>d.group=a),filterable:"",placeholder:"Select",style:{width:"120px"}},{default:t(()=>[(m(!0),G(X,null,ue(E.value,a=>(m(),c(Te,{key:a.value,label:a.group,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:t(()=>[l(_,{span:12},{default:t(()=>[l(f,{label:"用户名",prop:"username"},{default:t(()=>[l(h,{modelValue:d.username,"onUpdate:modelValue":e[11]||(e[11]=a=>d.username=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:t(()=>[l(f,{label:"密码",prop:"password"},{default:t(()=>[l(h,{modelValue:d.password,"onUpdate:modelValue":e[12]||(e[12]=a=>d.password=a),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:t(()=>[l(_,{span:12},{default:t(()=>[l(f,{label:"状态",prop:"status",rules:[{required:!0}]},{default:t(()=>[l(R,{modelValue:d.status,"onUpdate:modelValue":e[13]||(e[13]=a=>d.status=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:t(()=>[l(f,{label:"跳转方式",prop:"target"},{default:t(()=>[l(R,{modelValue:d.target,"onUpdate:modelValue":e[14]||(e[14]=a=>d.target=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,{style:{"justify-content":"space-around"}},{default:t(()=>[l(f,null,{default:t(()=>[l(r,{onClick:Ve},{default:t(()=>e[34]||(e[34]=[u("取消")])),_:1}),l(r,{type:"primary",onClick:Ce},{default:t(()=>e[35]||(e[35]=[u(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}};export{Xe as default};
