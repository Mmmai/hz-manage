import{d as w,u as C,M as E,c as $,r as h,aN as I,e as c,b3 as N,o as k,f as x,g as s,w as l,h as R,j as K,t as T,bO as B,bo as j,cq as L,cr as M,c7 as g,k as q}from"./index-CCI8Hn2n.js";import{u as z}from"./config-D6nURTjK.js";const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));function A(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}let f;const G=new Uint8Array(16);function H(){if(!f){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");f=crypto.getRandomValues.bind(crypto)}return f(G)}const O=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),v={randomUUID:O};function F(e,t,r){var a;if(v.randomUUID&&!e)return v.randomUUID();e=e||{};const n=e.random??((a=e.rng)==null?void 0:a.call(e))??H();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,A(n)}const J={class:"card"},P={style:{"margin-right":"20px"}},Q=w({__name:"securityConfig",setup(e){const{proxy:t}=q();C();const r=z(),n=E(()=>r.gmCry),a=$({key:"",region:"",date:""}),i=h({}),p=async()=>{let u=await t.$api.getSysConfig({param_name:"secret_key"});i.value=u.data.results[0]},_=async()=>{let u=F().replace(/-/g,"").slice(0,16);const b=M.service({lock:!0,text:"更新中...",background:"rgba(0, 0, 0, 0.7)"});let m=await t.$api.updateSysConfig({id:i.value.id,param_name:"secret_key",param_value:u});if(m.status=="200"){console.log(`旧密钥：${n.value.key};新密钥：${m.data.param_value}`);let d=await t.$api.reEncrypt({},3e5);d.status=="204"||d.status=="200"?g({title:"Success",message:"数据重新加密成功~",type:"success",duration:3e3}):(g({title:"Error",message:"数据重新加密失败！",type:"error"}),console.log("数据重新加密失败"));let y=await t.$api.getSysConfig({params:"gm"});r.setGmCry(y.data)}else g({title:"Error",message:"密钥更新失败！",type:"error",duration:3e3}),console.log("更新密钥失败");setTimeout(()=>{b.close(),window.location.reload()},2e3)};return I(()=>{p()}),(u,b)=>{const m=c("CopyDocument"),d=c("el-icon"),y=c("el-button"),U=c("el-tooltip"),S=c("el-form-item"),V=c("el-form"),D=N("copy");return k(),x("div",J,[s(V,{model:a,class:"demo-form-inline"},{default:l(()=>[s(S,{label:"密码密钥"},{default:l(()=>[R("span",P,[K(T(n.value.key)+" ",1),s(d,null,{default:l(()=>[B(s(m,null,null,512),[[D,n.value.key]])]),_:1})]),s(U,{class:"box-item",effect:"dark",content:"更新密钥",placement:"top"},{default:l(()=>[s(y,{size:"small",onClick:_,type:"warning",icon:j(L),circle:""},null,8,["icon"])]),_:1})]),_:1})]),_:1},8,["model"])])}}}),W={class:"card"},Z=w({__name:"sysconfigView",setup(e){C();const t=h("security"),r=(n,a)=>{console.log(n,a)};return(n,a)=>{const i=c("el-tab-pane"),p=c("el-tabs");return k(),x("div",W,[s(p,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=_=>t.value=_),class:"demo-tabs",onTabClick:r},{default:l(()=>[s(i,{label:"安全参数",name:"security"},{default:l(()=>[s(Q)]),_:1})]),_:1},8,["modelValue"])])}}});export{Z as default};
