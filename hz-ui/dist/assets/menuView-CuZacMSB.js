import{d as be,ar as ve,g as ge,as as Ee,h as he,r,a as ue,e as s,ak as de,c as Q,o as b,a7 as ce,b as e,w as t,k as U,t as Ve,ab as V,D as M,v as m,al as ke,am as Ce,i as O,s as xe,I as pe,ap as d,_ as $e,u as Le,q as Oe,a8 as ye,aD as Te,a9 as Ie,F as re,aP as Je}from"./index-CuRggFqw.js";import{i as Ae}from"./iconSelectCom-CiI5e2mD.js";const je={class:"dialog-footer"},ze=be({__name:"menuButtonCom",props:ve(["nowMenu"],{showDrawer:{},showDrawerModifiers:{}}),emits:ve(["getMenuData"],["update:showDrawer"]),setup(X,{expose:k,emit:v}){const{proxy:N}=ge(),c=X,T=v,S=Ee(X,"showDrawer"),I=he(),F=r(),J=r([]);k({updateMenuButtonList:_=>{J.value=_}});const ee=()=>{S.value=!1},g=r(!1),C=()=>{g.value=!1},f=ue({name:"",action:"",menu:""}),h=r(!0),n=()=>{g.value=!0,h.value=!0,f.menu=c.nowMenu.id},R=_=>{g.value=!0,h.value=!1,xe(()=>{Object.keys(f).forEach(i=>{f[i]=_[i]}),f.id=_.id,f.menu=_.menu})},A=async()=>{let _=await N.$api.getButton({menu:c.nowMenu.id});J.value=_.data.results},le=_=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await N.$api.deleteButton(_.id)).status==204?(d({type:"success",message:"删除成功"}),await A(),T("getMenuData")):d({type:"error",message:"删除失败"})}).catch(()=>{d({type:"info",message:"取消删除"})})},te=()=>{F.value.validate(async _=>{if(_)if(h.value){let i=await N.$api.addButton(f);i.status==201?(g.value=!1,F.value.resetFields(),A(),T("getMenuData")):d({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else{let i=await N.$api.updateButton(f);i.status==200?(g.value=!1,F.value.resetFields(),A(),T("getMenuData")):d({showClose:!0,message:"更新失败:"+JSON.stringify(i.data),type:"error"})}else d({showClose:!0,message:"请输入正确内容.",type:"error"})})};return(_,i)=>{const Y=s("el-text"),G=s("el-col"),D=s("el-button"),oe=s("el-row"),ae=s("el-divider"),j=s("el-table-column"),q=s("el-tooltip"),ne=s("el-table"),P=s("el-drawer"),W=s("el-input"),E=s("el-form-item"),H=s("el-form"),K=s("el-dialog"),z=de("permission");return b(),Q(ce,null,[e(P,{modelValue:S.value,"onUpdate:modelValue":i[0]||(i[0]=a=>S.value=a),title:"菜单按钮编辑",direction:"rtl","before-close":ee,size:"30%"},{default:t(()=>[e(oe,{justify:"space-between"},{default:t(()=>[e(G,{span:5},{default:t(()=>[e(Y,{size:"large",tag:"b"},{default:t(()=>[U("菜单："+Ve(c.nowMenu.label),1)]),_:1})]),_:1}),e(G,{span:2},{default:t(()=>{var a;return[V((b(),M(D,{type:"primary",onClick:n},{default:t(()=>i[5]||(i[5]=[U("添加")])),_:1})),[[z,`${(a=m(I).name)==null?void 0:a.replace("_info","")}:add`]])]}),_:1})]),_:1}),e(ae),e(ne,{border:"",data:J.value,style:{width:"100%"}},{default:t(()=>[e(j,{prop:"name",label:"按钮名称"}),e(j,{prop:"action",label:"按钮标识"}),e(j,{fixed:"right",label:"操作"},{default:t(a=>[e(q,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var l;return[V(e(D,{link:"",type:"primary",icon:m(ke),onClick:y=>R(a.row)},null,8,["icon","onClick"]),[[z,`${(l=m(I).name)==null?void 0:l.replace("_info","")}:edit`]])]}),_:2},1024),e(q,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var l;return[V(e(D,{link:"",type:"danger",icon:m(Ce),onClick:y=>le(a.row)},null,8,["icon","onClick"]),[[z,`${(l=m(I).name)==null?void 0:l.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(K,{modelValue:g.value,"onUpdate:modelValue":i[4]||(i[4]=a=>g.value=a),title:"按钮配置",width:"400","before-close":C},{footer:t(()=>[O("div",je,[e(D,{onClick:i[3]||(i[3]=a=>g.value=!1)},{default:t(()=>i[6]||(i[6]=[U("取消")])),_:1}),e(D,{type:"primary",onClick:te},{default:t(()=>i[7]||(i[7]=[U(" 提交 ")])),_:1})])]),default:t(()=>[e(H,{inline:!0,model:f,ref_key:"formRef",ref:F,class:"demo-form-inline"},{default:t(()=>[e(E,{label:"按钮名称",required:"",prop:"name"},{default:t(()=>[e(W,{modelValue:f.name,"onUpdate:modelValue":i[1]||(i[1]=a=>f.name=a),placeholder:"中文名",clearable:""},null,8,["modelValue"])]),_:1}),e(E,{label:"按钮标识",placeholder:"英文标识",required:"",prop:"action"},{default:t(()=>[e(W,{modelValue:f.action,"onUpdate:modelValue":i[2]||(i[2]=a=>f.action=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ye=$e(ze,[["__scopeId","data-v-1d81ac8e"]]),Ge={class:"card"},Pe={class:"role-menu"},We={style:{width:"100%"}},He={class:"user-header"},Ke=be({name:"menu",__name:"menuView",setup(X){const k=he(),v=Le(),N=r({}),{proxy:c}=ge();ue({search:""});const T=r(!1),S=r([]),I=r([]);r("auto");const F=r([{prop:"label",label:"菜单名称"},{prop:"icon",label:"图标"},{prop:"is_menu",label:"是否菜单"},{prop:"status",label:"启用"},{prop:"keepalive",label:"缓存"},{prop:"sort",label:"序号"},{prop:"path",label:"路由地址"},{prop:"name",label:"菜单编码"},{prop:"description",label:"描述"},{prop:"buttons",label:"权限按钮"}]);r(1);const J=r(10);r(!1),r(!1),r(!1);const Z=r(0),ee=r(!1);r({}),Oe(async()=>{await C()});const g=a=>(a.forEach(l=>{l.value=l.id,l.disabled=!!l.is_menu,l.children&&g(l.children)}),a),C=async()=>{let a=await c.$api.getMenuList();S.value=a.data.results,I.value=g(a.data.results),Z.value=a.data.count,Z.value<J.value&&(ee.value=!0)},f=a=>{N.value=a},h=r(!1),n=ue({label:"",icon:"",sort:0,is_menu:!0,description:"",path:"",name:"",parentid:null,has_info:!1,info_view_name:"",is_iframe:!1,iframe_url:"",status:!0,keepalive:!0}),R=r("add"),A=()=>{R.value="add",h.value=!0},le=()=>{h.value=!1,c.$refs.userFrom.resetFields()},te=a=>{pe.confirm("是否确认关闭?").then(()=>{a(),c.$refs.userFrom.resetFields()}).catch(()=>{})},_=()=>{c.$refs.userFrom.validate(async a=>{if(a)if(R.value=="add"){let l=await c.$api.menuAdd(n);l.status==201?(h.value=!1,c.$refs.userFrom.resetFields(),C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({showClose:!0,message:"添加失败:"+JSON.stringify(l.data),type:"error"})}else{let l=await c.$api.menuUpdate({id:Y.value.id,...n});l.status==200?(h.value=!1,c.$refs.userFrom.resetFields(),C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})}else d({showClose:!0,message:"请输入正确内容.",type:"error"})})},i=r(),Y=r({}),G=a=>{R.value="edit",Y.value=a,h.value=!0,xe(()=>{Object.keys(n).forEach(l=>{n[l]=a[l]})}),console.log(n)},D=a=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await c.$api.menuDel(a.id)).status==204?(d({type:"success",message:"删除成功"}),await C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({type:"error",message:"删除失败"})}).catch(()=>{d({type:"info",message:"Delete canceled"})})},oe=r([]),ae=(a,l)=>{},j=a=>{oe.value=a},q=r(!1),ne=()=>{q.value=!0},P=async(a,l)=>{let y=await c.$api.menuUpdate({[l]:a[l],id:a.id});y.status==200?(d({type:"success",message:"更新成功"}),C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(y.data),type:"error"})},W=async a=>{let l=await c.$api.menuUpdate({is_menu:a.is_menu,id:a.id});l.status==200?(d({type:"success",message:"更新成功"}),C(),await v.dispatch("getRoleMenu",{role:v.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})},E=r(!1),H=r({}),K=r(null),z=a=>{E.value=!0,H.value=a,K.value.updateMenuButtonList(a.buttons)};return(a,l)=>{var we;const y=s("el-button"),se=s("el-table-column"),x=s("el-switch"),me=Ie,Me=s("el-icon"),Ue=s("el-tag"),Se=s("el-space"),ie=s("el-tooltip"),De=s("el-table"),L=s("el-input"),p=s("el-form-item"),Be=s("el-input-number"),Ne=s("el-tree-select"),fe=s("el-col"),_e=s("el-row"),Fe=s("el-form"),Re=s("el-dialog"),B=de("permission"),qe=de("loading");return b(),Q("div",Ge,[O("div",Pe,[O("div",We,[O("div",He,[O("div",null,[V((b(),M(y,{type:"primary",size:"small",onClick:A},{default:t(()=>l[17]||(l[17]=[U("+新增")])),_:1})),[[B,`${(we=m(k).name)==null?void 0:we.replace("_info","")}:add`]])])]),O("div",null,[V((b(),M(De,{border:"",data:S.value,style:{width:"100%"},"max-height":"100%","highlight-current-row":"","row-key":"id","table-layout":"fixed",onSelectionChange:j,onRowClick:f},{default:t(()=>[e(se,{type:"selection",width:"55",selectable:ae}),(b(!0),Q(ce,null,ye(F.value,o=>(b(),M(se,{key:o.prop,label:o.label,prop:o.prop},Te({_:2},[o.prop==="is_menu"?{name:"default",fn:t(u=>{var w;return[V(e(x,{modelValue:u.row.is_menu,"onUpdate:modelValue":$=>u.row.is_menu=$,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:$=>W(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[B,{id:`${(w=m(k).name)==null?void 0:w.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,o.prop==="status"?{name:"default",fn:t(u=>{var w;return[V(e(x,{modelValue:u.row.status,"onUpdate:modelValue":$=>u.row.status=$,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:$=>P(u.row,"status")},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[B,{id:`${(w=m(k).name)==null?void 0:w.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,o.prop==="keepalive"?{name:"default",fn:t(u=>{var w;return[V(e(x,{modelValue:u.row.keepalive,"onUpdate:modelValue":$=>u.row.keepalive=$,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:$=>P(u.row,"keepalive")},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[B,{id:`${(w=m(k).name)==null?void 0:w.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"2"}:void 0,o.prop==="icon"?{name:"default",fn:t(u=>[e(Me,null,{default:t(()=>[e(me,{icon:u.row.icon},null,8,["icon"])]),_:2},1024)]),key:"3"}:void 0,o.prop==="buttons"?{name:"default",fn:t(u=>[e(Se,{wrap:""},{default:t(()=>[(b(!0),Q(ce,null,ye(u.row.buttons,w=>(b(),M(Ue,{type:"success",round:"",effect:"plain",key:w.id},{default:t(()=>[U(Ve(w.name),1)]),_:2},1024))),128))]),_:2},1024)]),key:"4"}:void 0]),1032,["label","prop"]))),128)),e(se,{fixed:"right",label:"操作",width:"150"},{default:t(o=>[o.row.is_menu?(b(),M(ie,{key:0,class:"box-item",effect:"dark",content:"编辑按钮",placement:"top"},{default:t(()=>{var u;return[V(e(y,{link:"",type:"primary",icon:m(Je),onClick:w=>z(o.row)},null,8,["icon","onClick"]),[[B,`${(u=m(k).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024)):re("",!0),e(ie,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var u;return[V(e(y,{link:"",type:"primary",icon:m(ke),onClick:w=>G(o.row)},null,8,["icon","onClick"]),[[B,`${(u=m(k).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),e(ie,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var u;return[V(e(y,{link:"",type:"danger",icon:m(Ce),onClick:w=>D(o.row)},null,8,["icon","onClick"]),[[B,`${(u=m(k).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[qe,T.value]])])])]),e(Re,{modelValue:h.value,"onUpdate:modelValue":l[15]||(l[15]=o=>h.value=o),title:R.value=="add"?"新增菜单":"编辑菜单",width:"40%","before-close":te},{default:t(()=>[e(Fe,{inline:!0,model:n,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"userFrom","status-icon":""},{default:t(()=>[e(p,{label:"菜单名称",prop:"label",rules:[{required:!0}]},{default:t(()=>[e(L,{modelValue:n.label,"onUpdate:modelValue":l[0]||(l[0]=o=>n.label=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"菜单标识",prop:"name",rules:[{required:!0}]},{default:t(()=>[e(L,{modelValue:n.name,"onUpdate:modelValue":l[1]||(l[1]=o=>n.name=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"路由",prop:"path"},{default:t(()=>[e(L,{modelValue:n.path,"onUpdate:modelValue":l[2]||(l[2]=o=>n.path=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"图标",prop:"icon",rules:[{required:!0}]},{default:t(()=>[e(y,{onClick:ne},{default:t(()=>[e(me,{icon:n.icon},null,8,["icon"])]),_:1}),e(Ae,{isShow:q.value,"onUpdate:isShow":l[3]||(l[3]=o=>q.value=o),iconName:n.icon,"onUpdate:iconName":l[4]||(l[4]=o=>n.icon=o)},null,8,["isShow","iconName"])]),_:1}),e(p,{label:"序号",prop:"sort"},{default:t(()=>[e(Be,{modelValue:n.sort,"onUpdate:modelValue":l[5]||(l[5]=o=>n.sort=o),placeholder:"",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"父级节点",prop:"parentid"},{default:t(()=>[e(Ne,{modelValue:n.parentid,"onUpdate:modelValue":l[6]||(l[6]=o=>n.parentid=o),ref_key:"elTreeSelectRef",ref:i,data:S.value,clearable:"","check-strictly":"","render-after-expand":!1,"node-key":"id",style:{width:"180px"}},null,8,["modelValue","data"])]),_:1}),e(p,{label:"描述",prop:"description"},{default:t(()=>[e(L,{modelValue:n.description,"onUpdate:modelValue":l[7]||(l[7]=o=>n.description=o),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"启用",prop:"status",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.status,"onUpdate:modelValue":l[8]||(l[8]=o=>n.status=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(p,{label:"缓存",prop:"keepalive",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.keepalive,"onUpdate:modelValue":l[9]||(l[9]=o=>n.keepalive=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(p,{label:"是否菜单",prop:"is_menu",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.is_menu,"onUpdate:modelValue":l[10]||(l[10]=o=>n.is_menu=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(p,{label:"详单"},{default:t(()=>[e(x,{modelValue:n.has_info,"onUpdate:modelValue":l[11]||(l[11]=o=>n.has_info=o),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),n.has_info?(b(),M(p,{key:0,label:"视图名"},{default:t(()=>[e(L,{modelValue:n.info_view_name,"onUpdate:modelValue":l[12]||(l[12]=o=>n.info_view_name=o),style:{width:"180px"}},null,8,["modelValue"])]),_:1})):re("",!0),e(_e,null,{default:t(()=>[e(fe,{span:6},{default:t(()=>[e(p,{label:"是否内嵌",prop:"is_iframe",rules:[{required:!0}]},{default:t(()=>[e(x,{modelValue:n.is_iframe,"onUpdate:modelValue":l[13]||(l[13]=o=>n.is_iframe=o),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),e(fe,{span:18},{default:t(()=>[n.is_iframe?(b(),M(p,{key:0,label:"访问地址"},{default:t(()=>[e(L,{modelValue:n.iframe_url,"onUpdate:modelValue":l[14]||(l[14]=o=>n.iframe_url=o),style:{width:"300px"},type:"textarea"},null,8,["modelValue"])]),_:1})):re("",!0)]),_:1})]),_:1}),e(_e,{style:{"justify-content":"space-around"}},{default:t(()=>[e(p,null,{default:t(()=>[e(y,{onClick:le},{default:t(()=>l[18]||(l[18]=[U("取消")])),_:1}),e(y,{type:"primary",onClick:_},{default:t(()=>l[19]||(l[19]=[U(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Ye,{ref_key:"menuButtonComRef",ref:K,showDrawer:E.value,"onUpdate:showDrawer":l[16]||(l[16]=o=>E.value=o),nowMenu:H.value,onGetMenuData:C},null,8,["showDrawer","nowMenu"])])}}}),Ze=$e(Ke,[["__scopeId","data-v-7020dca6"]]);export{Ze as default};
