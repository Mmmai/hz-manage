import{d as il,aB as He,bu as rl,r as i,c as el,e as c,o as t,O as u,w as l,g as a,h as M,j as f,t as x,f as r,bo as b,c5 as xe,P as V,c2 as ba,c4 as N,k as Ul,M as L,bI as Il,F as le,b1 as de,bS as wa,c6 as at,aD as Ve,_ as Pl,c7 as Ze,bQ as gl,b as ka,u as tt,aN as ha,b3 as dl,c8 as ot,c9 as nt,bO as B,b_ as st,ca as Bl,cb as ut,cc as dt,cd as rt,bF as Fl,Y as it,aE as Ue,c0 as ct,ce as ga,cf as pt,c1 as ft,bV as Hl,cg as vt,i as mt,ch as _t,ci as yt,cj as gt}from"./index-CCI8Hn2n.js";import{l as bt}from"./vue-draggable-plus-D46h4PET.js";import{u as Ca}from"./config-D6nURTjK.js";import{e as Jl,d as Kl}from"./gmCrypto-nMsfQ5W9.js";const wt={class:"flexJstart gap-1"},kt={key:0,class:"flexJstart gap-1"},ht={key:3,class:"flexJstart gap-1"},Ct=il({__name:"ciDataUpload",props:He(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:He(["getCiData"],["update:isShowUpload"]),setup(ie,{emit:ce}){const{proxy:J}=Ul(),O=ie,A=ce,k=rl(ie,"isShowUpload"),K=i([]),oe=i(null),C=["xlsx"],pe=i(10),$=i({}),ee=i({}),re=el({"Content-Type":"multipart/form-data"}),j=i({}),Me=async()=>{Object.keys(ee.value).length>0?Object.entries(ee.value).forEach(async([R,v])=>{let p=await J.$api.importCiDataStatus(v);$.value[R]=p.data,p.data.status==="completed"&&delete ee.value[R]}):(clearInterval(h),h=null,A("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId}))};let h=null;const Oe=async R=>{let v=new FormData;v.append("file",R.file),v.append("model",O.ciModelId);let p=await J.$api.importCiData(v,re,2*60*1e3);p.status==200?(ee.value[R.file.uid]=p.data,j.value[R.file.uid]=!0,h===null&&(h=setInterval(Me,2e3))):(j.value[R.file.uid]=!1,N({message:`导入异常: ${JSON.stringify(p.data)}`,type:"error",showClose:!0}))},X=()=>{},U=R=>{let v=R.name;if(R.type!=""||R.type!=null||R.type!=null){const p=R.name.replace(/.+\./,"").toLowerCase();return R.size/1024/1024<5?C.includes(p)?K.value.find(ye=>ye.name==v&&ye.lastModified==R.lastModified)?(N({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(N({message:`不能上传${p}类型的文件`,type:"error",showClose:!0}),!1):(N.error("上传文件大小不能超过 5MB!"),!1)}},ve=async R=>{await J.$api.downloadErrorRecords({error_file_key:R})},_e=async()=>{await J.$api.downloadImportTemplate({model:O.ciModelId})};return(R,v)=>{const p=c("upload-filled"),E=c("el-icon"),ae=c("el-col"),ye=c("el-button"),ne=c("el-row"),H=c("Loading"),te=c("CircleCheck"),Z=c("el-link"),ke=c("el-upload"),Ie=c("el-dialog");return t(),u(Ie,{modelValue:k.value,"onUpdate:modelValue":v[1]||(v[1]=z=>k.value=z),title:"导入",width:"800"},{default:l(()=>[a(ke,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:oe,headers:re,"http-request":Oe,"file-list":K.value,"before-upload":U,limit:pe.value,onOnChange:X,"show-file-list":""},{tip:l(()=>[a(ne,{justify:"space-between",align:"middle"},{default:l(()=>[a(ae,{span:18},{default:l(()=>v[2]||(v[2]=[M("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(ae,{span:3},{default:l(()=>[a(ye,{link:"",type:"primary",onClick:v[0]||(v[0]=z=>_e())},{default:l(()=>v[3]||(v[3]=[f("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:z,index:ll})=>{var Je,D,Ne,S,al,Ke,tl,We,w;return[M("div",wt,[M("span",null,x(z.name),1),j.value[z.uid]==!0?(t(),r("div",kt,[((Je=$.value[z.uid])==null?void 0:Je.status)!=="completed"?(t(),u(E,{key:0,class:"is-loading"},{default:l(()=>[a(H)]),_:1})):((D=$.value[z.uid])==null?void 0:D.failed)>>>0?(t(),u(E,{key:1},{default:l(()=>[a(b(xe),{color:"var(--el-color-warning)"})]),_:1})):(t(),u(E,{key:2},{default:l(()=>[a(te,{color:"var(--el-color-success)"})]),_:1})),$.value[z.uid]?(t(),r("div",ht,[M("span",null,x(`进度: ${(Ne=$.value[z.uid])==null?void 0:Ne.progress}%`),1),M("span",null,x(`结果: 总条数: ${(S=$.value[z.uid])==null?void 0:S.total},创建: ${(al=$.value[z.uid])==null?void 0:al.created},更新: ${(Ke=$.value[z.uid])==null?void 0:Ke.updated},跳过: ${(tl=$.value[z.uid])==null?void 0:tl.skipped},失败: ${(We=$.value[z.uid])==null?void 0:We.failed}.`),1),((w=$.value[z.uid])==null?void 0:w.failed)>>>0?(t(),u(Z,{key:0,type:"danger",onClick:g=>{var P;return ve((P=$.value[z.uid])==null?void 0:P.error_file_key)}},{default:l(()=>v[4]||(v[4]=[f("查看导入失败数据")])),_:2},1032,["onClick"])):V("",!0)])):V("",!0)])):j.value[z.uid]==!1?(t(),u(E,{key:1},{default:l(()=>[a(b(ba),{color:"var(--el-color-error)"})]),_:1})):V("",!0)])]}),default:l(()=>[a(E,{class:"el-icon--upload"},{default:l(()=>[a(p)]),_:1}),v[5]||(v[5]=M("div",{class:"el-upload__text"},[f("拖拽文件到此或者 "),M("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])}}}),xt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Vt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Mt={style:{width:"100%",overflow:"auto"}},Ot={class:"listItem"},$t={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Dt={class:"listItem"},Ft={style:{flex:"auto"}},Ut=il({__name:"ciDataTableCol",props:He(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:He(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(ie,{expose:ce,emit:J}){const O=ie,A=rl(ie,"isShowTableCol"),k=rl(ie,"hasConfigField"),{proxy:K}=Ul(),oe=i(""),C=i(""),pe=L(()=>oe.value===""?R.value:R.value.filter(v=>v.verbose_name.includes(oe.value)));function $(){A.value=!1}const ee=v=>{k.value.push(v)},re=v=>{let p=k.value.indexOf(v);k.value.splice(p,1)},j=v=>{console.log("start",v)},Me=v=>{console.log("onEnd",v),console.log(k.value)},h=()=>{console.log("update")},Oe=i({}),X=async()=>{let v=await K.$api.getCiModelCol({model:O.ciModelId});Oe.value=v.data;let p=[];v.data.fields_preferred.forEach(E=>{p.push(O.allModelFieldInfo[E])}),k.value=p},U=L(()=>k.value.map(v=>v.id)),ve=J;Il(()=>k.value,v=>{console.log("更新表格"),ve("reloadTable")},{deep:!0});const _e=async()=>{let v=await K.$api.updateCiModelCol({id:Oe.value.id,fields_preferred:U.value});v.status=="200"?(N({type:"success",message:"更新成功"}),Ve(()=>{C.value.clear(),A.value=!1})):N({showClose:!0,message:"更新失败:"+JSON.stringify(v.data),type:"error"})},R=L(()=>O.allModelField.filter(v=>!k.value.includes(v)));return ce({getHasConfigField:X}),(v,p)=>{const E=c("el-text"),ae=c("el-divider"),ye=c("el-input"),ne=c("el-icon"),H=c("el-button"),te=c("el-drawer");return t(),u(te,{modelValue:A.value,"onUpdate:modelValue":p[2]||(p[2]=Z=>A.value=Z),direction:"rtl",size:"40%"},{header:l(()=>[a(E,{tag:"b"},{default:l(()=>p[3]||(p[3]=[f("表格列显示配置")])),_:1})]),default:l(()=>[M("div",xt,[M("div",Vt,[a(E,{tag:"b"},{default:l(()=>p[4]||(p[4]=[f("模型字段")])),_:1}),a(ae),a(ye,{modelValue:oe.value,"onUpdate:modelValue":p[0]||(p[0]=Z=>oe.value=Z),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:C},null,8,["modelValue"]),M("div",Mt,[(t(!0),r(le,null,de(pe.value,(Z,ke)=>(t(),r("div",{key:ke},[M("div",Ot,[M("span",null,x(Z.verbose_name),1),a(ne,null,{default:l(()=>[a(b(wa),{onClick:Ie=>ee(Z)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),M("div",$t,[a(E,{tag:"b"},{default:l(()=>p[5]||(p[5]=[f("已显示字段")])),_:1}),a(ae),a(b(bt),{"force-fallback":!0,"scroll-sensitivity":200,ref:"el",modelValue:k.value,"onUpdate:modelValue":p[1]||(p[1]=Z=>k.value=Z),onStart:j,onUpdate:h,onEnd:Me,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(le,null,de(k.value,(Z,ke)=>(t(),r("div",{key:ke},[M("div",Dt,[M("span",null,x(Z.verbose_name),1),a(ne,null,{default:l(()=>[a(b(at),{onClick:Ie=>re(Z)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[M("div",Ft,[a(H,{onClick:$},{default:l(()=>p[6]||(p[6]=[f("取消")])),_:1}),a(H,{type:"primary",onClick:_e},{default:l(()=>p[7]||(p[7]=[f("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),It=Pl(Ut,[["__scopeId","data-v-3859704e"]]),Pt={class:"dialog-footer"},Nt=il({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(ie){const ce=Ca(),J=rl(ie,"showAllPassDia"),O=L(()=>ce.gmCry),A=i(),k=el({secret:null,time:3});i(""),i(!1);const K=async pe=>{pe.validate(async $=>{$&&(k.secret===O.value.key?(Ze({title:"操作成功",message:"解密成功,"+k.time+"分钟后过期！",type:"success",duration:2e3}),ce.updateShowAllPass(!0),J.value=!1,ce.setShowAllPassTime(k.time*60*1e3),oe(A.value)):Ze({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},oe=pe=>{pe&&pe.resetFields()},C=()=>{J.value=!1,oe(A.value)};return(pe,$)=>{const ee=c("el-input"),re=c("el-form-item"),j=c("el-input-number"),Me=c("el-form"),h=c("el-button"),Oe=c("el-dialog");return t(),u(Oe,{modelValue:J.value,"onUpdate:modelValue":$[3]||($[3]=X=>J.value=X),title:"查看密码",width:"400"},{footer:l(()=>[M("div",Pt,[a(h,{onClick:C},{default:l(()=>$[5]||($[5]=[f("取消")])),_:1}),a(h,{type:"primary",onClick:$[2]||($[2]=X=>K(A.value))},{default:l(()=>$[6]||($[6]=[f(" 查看 ")])),_:1})])]),default:l(()=>[a(Me,{ref_key:"allPassFormRef",ref:A,inline:!0,model:k,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(re,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(ee,{type:"password",modelValue:k.secret,"onUpdate:modelValue":$[0]||($[0]=X=>k.secret=X),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(re,{label:"有效时间",prop:"time"},{default:l(()=>[a(j,{modelValue:k.time,"onUpdate:modelValue":$[1]||($[1]=X=>k.time=X),min:1,step:1,max:30},{suffix:l(()=>$[4]||($[4]=[M("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),St={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},jt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Tt={style:{width:"100%",overflow:"auto"}},qt={class:"listItem"},Rt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Et={style:{"margin-right":"5px"}},Lt={style:{float:"left"}},At={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},zt={key:0},Yt={key:1},Bt={key:0},Jt={key:1},Kt={key:2},Ht={key:3},Wt={style:{flex:"auto"}},Gt=il({__name:"ciDataFilter",props:He(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:He(["getCiData","updateFilterParam"],["update:showFilter"]),setup(ie,{expose:ce,emit:J}){const O=ie,A=rl(ie,"showFilter"),k=i(""),K=i(""),oe=L(()=>k.value===""?re.value:re.value.filter(v=>v.verbose_name.includes(k.value)));function C(){A.value=!1}const pe=v=>{X.value.push(v)},$=v=>{let p=h.filterParams.indexOf(v);X.value.splice(p,1)},ee=(v,p)=>{v==="instance_name"?h.instance_name="":X.value.splice(p,1),Ve(()=>{j("updateFilterParam",U.value)})},re=L(()=>O.allModelField.filter(v=>!X.value.includes(v)));i({});const j=J,Me=i(""),h=el({filterParams:[],instance_name:""}),Oe=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"包含",description:"包含以,分隔"},{value:"not:in:",label:"不包含",description:"不包含以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"!null",label:"非空",description:"正则表达式"}]),X=i([]),U=L(()=>{let v=new Object;return h.filterParams.forEach(p=>{if(p.match==="null"||p.match==="!null"){v[p.name]=p.match;return}if(p.value!==""){let E=null;p.value!==null?E=p.value:E="null",p.match==="="?v[p.name]=E:v[p.name]=p.match+E}}),h.instance_name!==""&&(v.instance_name=h.instance_name),v}),ve=()=>{console.log(U.value),j("updateFilterParam",U.value),console.log(U.value),Ve(()=>{j("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId})}),A.value=!1},_e=L(()=>{var v;return(v=h.filterParams)==null?void 0:v.map(p=>p.name)});Il(()=>X.value,v=>{var E;let p=new Array;(E=X.value)==null||E.forEach((ae,ye)=>{var ne;if(((ne=_e.value)==null?void 0:ne.indexOf(ae.name))>>>-1)p.push({name:ae.name,value:"",match:"=",label:ae.verbose_name});else{let H=h.filterParams.findIndex(te=>te.name===ae.name);p.push(h.filterParams[H])}}),h.filterParams=p},{deep:!0});const R=v=>{v&&(v.resetFields(),j("updateFilterParam",U.value),Ve(()=>{j("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId})}))};return ce({removeFilterParam:ee}),(v,p)=>{const E=c("el-text"),ae=c("el-divider"),ye=c("el-input"),ne=c("el-icon"),H=c("el-form-item"),te=c("el-button"),Z=c("el-option"),ke=c("el-select"),Ie=c("el-switch"),z=c("el-space"),ll=c("el-form"),Je=c("el-drawer");return t(),u(Je,{modelValue:A.value,"onUpdate:modelValue":p[4]||(p[4]=D=>A.value=D),direction:"rtl",size:"50%","before-close":C},{header:l(()=>[a(E,{tag:"b"},{default:l(()=>p[5]||(p[5]=[f("筛选")])),_:1})]),default:l(()=>[M("div",St,[M("div",jt,[a(E,{tag:"b"},{default:l(()=>p[6]||(p[6]=[f("模型字段")])),_:1}),a(ae),a(ye,{modelValue:k.value,"onUpdate:modelValue":p[0]||(p[0]=D=>k.value=D),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:K},null,8,["modelValue"]),M("div",Tt,[(t(!0),r(le,null,de(oe.value,(D,Ne)=>(t(),r("div",{key:Ne},[M("div",qt,[M("span",null,x(D.verbose_name),1),a(ne,null,{default:l(()=>[a(b(wa),{onClick:S=>pe(D)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),M("div",Rt,[a(E,{tag:"b"},{default:l(()=>p[7]||(p[7]=[f("过滤器")])),_:1}),a(ae),a(ll,{ref_key:"filterFormRef",ref:Me,model:h,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(z,{wrap:""},{default:l(()=>[a(H,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(ye,{modelValue:h.instance_name,"onUpdate:modelValue":p[1]||(p[1]=D=>h.instance_name=D),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(le,null,de(h.filterParams,(D,Ne)=>(t(),u(H,{key:D.index,prop:"filterParams."+Ne+".value"},{label:l(()=>[M("span",Et,x(D.label),1),a(te,{icon:b(ba),size:"small",circle:"",onClick:gl(S=>$(D),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(z,null,{default:l(()=>[a(ke,{modelValue:D.match,"onUpdate:modelValue":S=>D.match=S,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(le,null,de(Oe.value,S=>(t(),u(Z,{key:S.value,label:S.label,value:S.value},{default:l(()=>[M("span",Lt,x(S.label),1),M("span",At,x(S.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),D.match==="null"||D.match==="!null"?(t(),r("div",zt)):(t(),r("div",Yt,[["enum"].indexOf(O.allModelFieldByNameObj[D.name].type)>>>-1?["model_ref"].indexOf(O.allModelFieldByNameObj[D.name].type)>>>-1?["boolean"].indexOf(O.allModelFieldByNameObj[D.name].type)>>>-1?(t(),r("div",Ht,[a(ye,{modelValue:D.value,"onUpdate:modelValue":S=>D.value=S,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Kt,[a(Ie,{modelValue:D.value,"onUpdate:modelValue":S=>D.value=S,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Jt,[a(ke,{modelValue:D.value,"onUpdate:modelValue":S=>D.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(le,null,de(O.modelRefOptions[D.name],S=>(t(),u(Z,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Bt,[a(ke,{modelValue:D.value,"onUpdate:modelValue":S=>D.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(le,null,de(O.enumOptionObj[O.allModelFieldByNameObj[D.name].validation_rule],S=>(t(),u(Z,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[M("div",Wt,[a(te,{onClick:p[2]||(p[2]=D=>R(Me.value))},{default:l(()=>p[8]||(p[8]=[f("重置")])),_:1}),a(te,{onClick:p[3]||(p[3]=D=>ve()),type:"primary"},{default:l(()=>p[9]||(p[9]=[f("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),Qt=Pl(Gt,[["__scopeId","data-v-6ac62773"]]),Xt={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},Zt={class:"table-header"},eo={class:"header-button-lf"},lo={class:"header-button-ri"},ao={class:"flexJstart gap-1",style:{overflow:"auto"}},to={class:"text_class"},oo={key:0,class:"text_class"},no={key:1},so={style:{"margin-left":"12px"}},uo={key:1,class:"requiredClass"},ro={key:0},io={key:0},co={key:1},po={key:0},fo={key:1},vo={key:0},mo={key:1},_o={key:0},yo={key:1},go={key:0},bo={key:0},wo={key:0},ko={key:1},ho={key:0},Co={key:1},xo={key:0},Vo={key:1},Mo={key:0},Oo={key:1},$o={key:0},Do={key:1},Fo={key:0},Uo={key:1},Io={style:{flex:"auto"},class:"footerButtonClass"},Po={key:0},No={key:1},So={key:0},jo={key:1},To={key:0},qo={key:0},Ro={key:1},Eo={key:2},Lo={key:3},Ao={key:4},zo={key:5},Yo={key:6},Bo={key:7},Jo={key:8},Ko={key:9},Ho={class:"dialog-footer"},Wo={class:"dialog-footer"},Go=il({__name:"ciDataShow",props:He(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:He(["getTree"],["update:showTree"]),setup(ie,{expose:ce,emit:J}){const{proxy:O}=Ul(),A=Ca(),k=ka(),K=tt(),oe=J,C=ie,pe=rl(ie,"showTree"),$=i([0]),ee=i(!1),re=()=>{ee.value=!0},j=i(!0),Me=()=>{j.value=!1,Ve(()=>{j.value=!0})},h=i(""),Oe=()=>{ee.value=!1},X=i(!1),U=L(()=>A.gmCry),ve=L(()=>A.showAllPass),_e=L(()=>A.showAllPassTime),R=async()=>{X.value=!0},v=()=>{A.updateShowAllPass(!1),Ze({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},p=s=>{A.setShowAllPassTime(s.totalMilliseconds)},E=()=>{X.value=!1,A.updateShowAllPass(!1),A.setShowAllPassTime(0),Ze({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},ae=i(!1),ye=()=>{Z.value=!1,Ye(ne.value[0]),te.value=""},ne=i(),H=el({secret:null}),te=i(""),Z=i(!1),ke=async(s,e)=>{s[0].validate(async d=>{d&&(H.secret===U.value.key?(te.value=Kl(U.value.key,U.value.mode,e),Z.value=!0):(Ze({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),Z.value=!1,te.value=""))})},Ie=i(1),z=i(10),ll=i("default"),Je=i(!1),D=()=>{he({model:C.ciModelId,model_instance_group:C.currentNodeId})},Ne=()=>{he({model:C.ciModelId,model_instance_group:C.currentNodeId})},S=L(()=>Cl.value.map(s=>s.name)),al=L(()=>ml.value.map(s=>s.name)),Ke=i(!1),tl=async()=>{(await O.$api.bulkDeleteCiModelInstance({instances:fl.value})).status=="200"?(N({type:"success",message:"删除成功"}),Rl.value.clearSelection(),await he({model:C.ciModelId,model_instance_group:C.currentNodeId})):N({type:"error",message:"删除失败"})},We=async s=>{s?await O.$api.exportCiData({model:C.ciModelId,fields:al.value,instances:fl.value}):await O.$api.exportCiData({model:C.ciModelId,fields:S.value,instances:fl.value})},w=async()=>{let s=await O.$api.exportCiData({model:C.ciModelId});console.log(s)},g={multiple:!0,value:"id"},P=i(!1),Ae=i([]),ol=L(()=>C.treeData[0].children[0].id),Nl=async()=>{var d;let s=[];(d=Ae.value)==null||d.forEach(q=>{s.push(q[q.length-1])});let e=await O.$api.setCiDataToTree({instances:fl.value,groups:s});e.status=="201"?(N({type:"success",message:"更新成功"}),he({model:C.ciModelId,model_instance_group:C.currentNodeId}),Gl(),oe("getTree")):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}),Ae.value=[],P.value=!1},bl=i(""),Ge=i(!1),T=i({}),Se=(s,e)=>{s?I.updateParams[e]="null":I.updateParams[e]=null},Sl=()=>{Ge.value=!0,console.log(I)},jl=s=>{var e;if(s!==void 0&&((e=Te.value[s])==null?void 0:e.field_type)==="string")return s==""||s==null?void 0:[{pattern:new RegExp(Te.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]};L(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(q=>{q.fields.forEach(y=>{var ue;y.type==="string"&&y.validation_rule!==""&&y.validation_rule!==null&&(s["updateParams."+y.name]=[{pattern:new RegExp((ue=Te.value[y.validation_rule])==null?void 0:ue.rule),message:"不符合正则表达式",trigger:"blur"}])})}),s});const I=el({updateParams:{}}),$e=i([]),Tl=()=>{const s=Object.keys(I.updateParams).length,e=`__temp_param_${s}`;$e.value[s]=e,I.updateParams[e]=""},se=(s,e)=>{console.log(e),I.updateParams[e]=void 0,delete I.updateParams[$e.value[s]],$e.value[s]=e},De=(s,e)=>{$e.value.splice(s,1),delete T.value[e],delete I.updateParams[e]},wl=L(()=>{let s=new Object;for(let[e,d]of Object.entries(I.updateParams))d==="null"?s[e]=null:s[e]=d,fe.value.password.indexOf(e)!==-1&&(s[e]=Jl(U.value.key,U.value.mode,d));return s}),Fe=()=>{bl.value.validate(async s=>{if(s){let e=await O.$api.multipleUpdateCiModelInstance({update_user:K.state.username,instances:fl.value,fields:wl.value});e.status=="200"?(N({type:"success",message:"更新成功"}),he({model:C.ciModelId,model_instance_group:C.currentNodeId}),I.updateParams={},T.value={},$e.value=[],Ge.value=!1):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else N({showClose:!0,message:"请输入正确内容.",type:"error"})})},kl=L(()=>{var e,d;let s=new Array;return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(q=>{q.fields.forEach(y=>{let ue=!1;y.name in I.updateParams&&(ue=!0),s.push({value:y.name,label:y.verbose_name,disable:ue})})}),s}),cl=()=>{Ge.value=!1,I.updateParams={},T.value={},$e.value=[]},Wl=i(!0),pl=s=>{Wl.value=s},hl=i(!0),W=i(!1),ql=i(!1),xa=()=>{ql.value=!0},Va=async s=>{pl(!0);let e=await O.$api.updateCiModelInstance({update_user:K.state.username,...s});e.status=="200"?(N({type:"success",message:"更新成功"}),be.value=!1,Ye(Qe.value),await he({model:C.ciModelId,model_instance_group:C.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},Ma=()=>!0,Rl=i(null),Oa=s=>s.id,ze=i([]),fl=L(()=>{var e;let s=[];return(e=ze.value)==null||e.forEach(d=>{s.push(d.id)}),s}),$a=s=>{ze.value=s},Gl=()=>{ze.value=[],Rl.value.clearSelection()},Cl=i([]),je=i({}),Da=L(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(q=>{q.fields.forEach(y=>{s[y.id]=y})}),s}),me=L(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(q=>{q.fields.forEach(y=>{s[y.name]=y})}),s}),Ql=i(""),Fa=()=>{Ql.value.getHasConfigField()},Xl=()=>{hl.value=!1,Ve(()=>{hl.value=!0})},Ua=s=>s.map(d=>d.id===ol.value).length>>0,Te=i({});i({});const Ia=async(s=null)=>{(await O.$api.getValidationRules({...s,page:1,page_size:1e4})).data.results.forEach(d=>{Te.value[d.id]=d})},El=L(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(q=>{q.fields.forEach(y=>{if(y.type==="enum"){if(y.validation_rule===null)return;let ue=JSON.parse(Te==null?void 0:Te.value[y==null?void 0:y.validation_rule].rule),Xe=[];Object.keys(ue).forEach(sl=>{Xe.push({value:sl,label:ue[sl]})}),s[y.validation_rule]=Xe}})}),s}),Zl=L(()=>{let s={};return je.value.field_groups.forEach(e=>{e.fields.forEach(d=>{if(d.type==="enum"){let q=JSON.parse(Te.value[d.validation_rule].rule),y={};Object.keys(q).forEach(ue=>{y[ue]=q[ue]}),s[d.name]=y}})}),s}),vl=i({}),Pa=async(s,e)=>{let d=await O.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),q=[];d.data.results.forEach(y=>{q.push({value:y.id,label:y.instance_name})}),vl.value[e.name]=q},Na=L(()=>{let s=new Object;for(let[e,d]of Object.entries(vl.value)){let q=new Object;d==null||d.forEach(y=>{q[y.value]=y}),s[e]=q}return s}),Sa=s=>{if(!(s==""||s==null))return[{pattern:new RegExp(Te.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]},ja=()=>{for(const[s,e]of Object.entries(_))s!=="instance_name"&&delete _[s];je.value.field_groups.forEach(s=>{s.fields.forEach(e=>{_[e.name]=e.default})}),_.instance_name=null},ml=i([]),Ta=async()=>{var d;let s=await O.$api.getCiModel({},C.ciModelId);je.value=s.data;let e=[];(d=je.value.field_groups)==null||d.forEach(q=>{q.fields.forEach(y=>{e.push(y)})}),ml.value=e},fe=L(()=>{let s={enum:[],boolean:[],model_ref:[],password:[]};return ml.value.forEach(e=>{e.type==="enum"?s.enum.push(e.name):e.type==="boolean"?s.boolean.push(e.name):e.type==="model_ref"?s.model_ref.push(e.name):e.type==="password"&&s.password.push(e.name)}),s});Il(()=>fe.value.model_ref,s=>{fe.value.model_ref.forEach(e=>{Pa(!0,{id:me.value[e].ref_model,name:e})})},{deep:!0});const ea=i([]),la=i(0),Ll=i({}),aa=s=>{Ll.value=s},ta=L(()=>{let s=new Array;for(let[e,d]of Object.entries(Ll.value))console.log(),e==="instance_name"?s.push({name:"唯一标识:"+d,field:e}):fe.value.model_ref.indexOf(e)!==-1?s.push({name:me.value[e].verbose_name+":"+Na.value[e][d].label,field:e}):fe.value.enum.indexOf(e)!==-1?(console.log(Zl.value),s.push({name:me.value[e].verbose_name+":"+Zl.value[e][d],field:e})):s.push({name:me.value[e].verbose_name+":"+d,field:e});return s}),qa=async(s,e)=>{await h.value.removeFilterParam(s,e),Ve(()=>{he({model:C.ciModelId,model_instance_group:C.currentNodeId})})},he=async s=>{var q;pl(!0);let e=new Array,d=await O.$api.getCiModelInstance({...s,page:Ie.value,page_size:z.value,...Ll.value});la.value=d.data.count,(q=d.data.results)==null||q.forEach(y=>{e.push({id:y.id,instance_group:y.instance_group,instance_name:y.instance_name,...y.fields})}),ea.value=e,pl(!1)};ha(async()=>{hl.value=!0,await Ia(),pl(!1)});const be=i(!1),Ra=()=>{W.value=!0,be.value=!0,Re.value=!0},qe=i({}),xl=i({}),oa=(s,e=!1)=>{be.value=!0,Re.value=!1,W.value=e,qe.value=s,Ve(()=>{Object.keys(s).forEach(d=>{d==="id"||d==="instance_group"||(fe.value.model_ref.indexOf(d)!==-1&&s[d]!==null?_[d]=s[d].id:_[d]=s[d])}),xl.value=JSON.parse(JSON.stringify(_))})},Ea=s=>{be.value=!0,Re.value=!0,W.value=!0,qe.value=s,Ve(()=>{Object.keys(s).forEach(e=>{e==="id"||e==="instance_group"||(fe.value.model_ref.indexOf(e)!==-1?s[e]!==null?_[e]=s[e].id:_[e]=s[e]:fe.value.enum.indexOf(e)!==-1?_[e]=s[e].value:fe.value.password.indexOf(e)!==-1||(_[e]=s[e]))})}),Ze({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},Qe=i(),_=el({instance_name:null}),na=L(()=>{let s=Object.assign({},_);delete s.instance_name;for(let[e,d]of Object.entries(s))d!==null&&fe.value.password.indexOf(e)!==-1&&(s[e]=Jl(U.value.key,U.value.mode,d));return s}),sa=L(()=>{let s=Object.assign({},nl.value);delete s.instance_name,console.log(fe.value);for(let[e,d]of Object.entries(nl.value))d!==null&&fe.value.password.indexOf(e)!==-1&&(s[e]=Jl(U.value.key,U.value.mode,d));return s}),Re=i(!0),nl=i({}),ua=async(s,e=null)=>{s&&await s.validate(async(d,q)=>{if(d)if(Re.value){console.log(na.value);let y=await O.$api.addCiModelInstance({model:C.ciModelId,create_user:K.state.username,update_user:K.state.username,fields:na.value,instance_name:_.instance_name,instance_group:[C.currentNodeId]});y.status=="201"?(N({type:"success",message:"添加成功"}),be.value=!1,Ye(s),await he({model:C.ciModelId,model_instance_group:C.currentNodeId}),oe("getTree")):N({showClose:!0,message:"添加失败:"+JSON.stringify(y.data),type:"error"})}else{if(console.log(JSON.stringify(xl.value)),console.log(JSON.stringify(_)),JSON.stringify(xl.value)===JSON.stringify(_)){W.value=!1,be.value=!1,Ye(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}else{const Xe=Object.entries(xl.value),sl=Object.entries(_),Y=Xe.concat(sl).map(Pe=>JSON.stringify(Pe)),Ml=Array.from(new Set(Y)).map(Pe=>JSON.parse(Pe));Ml.splice(0,Xe.length);const G=Object.fromEntries(Ml);let Ol={};if(Object.keys(G).forEach(Pe=>{Ol[Pe]=G[Pe]}),nl.value=Ol,Object.keys(nl.value).length===0){W.value=!1,be.value=!1,Ye(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let y={id:qe.value.id,model:C.ciModelId,update_user:K.state.username};Object.keys(nl.value).indexOf("instance_name")===-1||(y.instance_name=nl.value.instance_name),y.fields=sa.value,console.log(fe.value),console.log(y),console.log();let ue=await O.$api.updateCiModelInstance(y);ue.status=="200"?(N({type:"success",message:"更新成功"}),be.value=!1,W.value=!1,Ye(s),await he({model:C.ciModelId,model_instance_group:C.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(ue.data),type:"error"})}else console.log("error submit!",q),Ze({title:"表单校验",message:"表单填写异常",type:"error"})})},La=s=>{if(W.value==!1&&Re.value==!1){be.value=!1;return}Hl.confirm("是否确认关闭?").then(()=>{s(),Ye(Qe.value),be.value=!1,W.value=!1}).catch(()=>{})},Aa=s=>{Ye(s),be.value=!1,W.value=!1},da=(s=null)=>{Hl.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await O.$api.deleteCiModelInstance(qe.value.id)).status==204?(N({type:"success",message:"删除成功"}),await he({model:C.ciModelId,model_instance_group:C.currentNodeId}),Ye(Qe.value),be.value=!1,W.value=!1,oe("getTree")):N({type:"error",message:"删除失败"})}).catch(()=>{N({type:"info",message:"取消删除"})})},Ye=s=>{s&&(s.resetFields(),qe.value={})},Vl=i("modelField"),za=(s,e)=>{console.log(Vl.value)};return ce({getHasConfigField:Fa,getCiData:he,initCiDataForm:ja,getModelField:Ta,setLoading:pl,closeFilter:Oe,clearMultipleSelect:Gl,updateFilterParam:aa,reloadCiDataFilter:Me}),(s,e)=>{var ma,_a,ya;const d=c("el-button"),q=c("arrow-down"),y=c("el-icon"),ue=c("el-dropdown-item"),Xe=c("el-dropdown-menu"),sl=c("el-dropdown"),Y=c("el-tooltip"),Ml=c("vue-countdown"),G=c("el-text"),Ol=c("el-tag"),Pe=c("el-table-column"),ra=c("el-link"),Be=c("el-switch"),Ya=c("a-qrcode"),ia=c("el-popover"),Ba=c("el-table"),Ja=c("el-pagination"),ca=c("el-descriptions-item"),Ka=c("el-descriptions"),Ce=c("el-space"),Ee=c("el-input"),ge=c("el-form-item"),Ha=c("InfoFilled"),Al=c("el-input-number"),zl=c("el-col"),pa=c("el-row"),Yl=c("el-form"),$l=c("el-date-picker"),_l=c("el-option"),yl=c("el-select"),Wa=c("el-collapse-item"),Ga=c("el-collapse"),Dl=c("el-tab-pane"),Qa=c("el-tabs"),Xa=c("el-drawer"),fa=c("el-dialog"),Za=c("el-cascader"),we=dl("permission"),et=dl("loading"),lt=dl("copy"),va=dl("throttle");return t(),r(le,null,[hl.value?(t(),r("div",Xt,[M("div",Zt,[M("div",eo,[pe.value?(t(),u(d,{key:0,icon:b(ot),onClick:e[0]||(e[0]=n=>pe.value=!1),size:"default"},null,8,["icon"])):(t(),u(d,{key:1,icon:b(nt),onClick:e[1]||(e[1]=n=>pe.value=!0),size:"default"},null,8,["icon"])),B((t(),u(d,{type:"primary",onClick:Ra},{default:l(()=>e[31]||(e[31]=[f("添加")])),_:1})),[[we,`${(ma=b(k).name)==null?void 0:ma.replace("_info","")}:add`]]),B((t(),u(d,{disabled:!(ze.value.length>>>0),onClick:e[2]||(e[2]=n=>P.value=!0)},{default:l(()=>e[32]||(e[32]=[f("转移")])),_:1},8,["disabled"])),[[we,`${(_a=b(k).name)==null?void 0:_a.replace("_info","")}:edit`]]),B((t(),u(d,{disabled:!(ze.value.length>>>0),onClick:Sl},{default:l(()=>e[33]||(e[33]=[f("批量更新")])),_:1},8,["disabled"])),[[we,`${(ya=b(k).name)==null?void 0:ya.replace("_info","")}:edit`]]),a(sl,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(Xe,null,{default:l(()=>{var n,Q;return[B((t(),r("div",null,[a(ue,{disabled:!(ze.value.length>>>0),onClick:e[3]||(e[3]=o=>tl())},{default:l(()=>e[35]||(e[35]=[f("批量删除")])),_:1},8,["disabled"])])),[[we,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:delete`]]),B((t(),r("div",null,[a(ue,{disabled:!(ze.value.length>>>0),onClick:e[4]||(e[4]=o=>We(!1))},{default:l(()=>e[36]||(e[36]=[f("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(ue,{disabled:!(ze.value.length>>>0),onClick:e[5]||(e[5]=o=>We(!0))},{default:l(()=>e[37]||(e[37]=[f("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(ue,{onClick:e[6]||(e[6]=o=>w())},{default:l(()=>e[38]||(e[38]=[f("导出所有")])),_:1})])),[[we,`${(Q=b(k).name)==null?void 0:Q.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(d,{type:"primary"},{default:l(()=>[e[34]||(e[34]=f(" 更多操作")),a(y,{class:"el-icon--right"},{default:l(()=>[a(q)]),_:1})]),_:1})]),_:1})]),M("div",lo,[a(Y,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(d,{icon:b(st),circle:"",onClick:Xl},null,8,["icon"])]),_:1}),ve.value?V("",!0):(t(),u(Y,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var n;return[B(a(d,{icon:b(Bl),circle:"",onClick:R},null,8,["icon"]),[[we,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:showPassword`]])]}),_:1})),ve.value?(t(),u(Y,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[39]||(e[39]=[M("span",null,[f("倒计时结束后自动隐藏密码"),M("br"),f("手动点击可立马隐藏")],-1)])),default:l(()=>[a(d,{circle:"",onClick:E},{default:l(()=>[a(Ml,{time:_e.value,onEnd:v,onProgress:p},{default:l(({totalSeconds:n})=>[f(x(n),1)]),_:1},8,["time"])]),_:1})]),_:1})):V("",!0),a(Y,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(d,{icon:b(ut),circle:"",onClick:xa},null,8,["icon"])]),_:1}),a(Y,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var n;return[B(a(d,{icon:b(dt),circle:"",onClick:e[7]||(e[7]=Q=>Ke.value=!0)},null,8,["icon"]),[[we,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:import`]])]}),_:1}),a(Y,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(d,{icon:b(rt),circle:"",onClick:re},null,8,["icon"])]),_:1})])]),B(M("div",ao,[a(G,{tag:"b"},{default:l(()=>e[40]||(e[40]=[f("过滤器")])),_:1}),(t(!0),r(le,null,de(ta.value,(n,Q)=>(t(),u(Ol,{key:n.name,closable:"",type:"primary",onClose:o=>qa(n.field,Q)},{default:l(()=>[M("span",null,x(n.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Fl,ta.value.length>>>0]]),B((t(),u(Ba,{ref_key:"ciDataTableRef",ref:Rl,data:ea.value,onSelectionChange:$a,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":Oa},{default:l(()=>[a(Pe,{type:"selection",selectable:Ma,width:"55","reserve-selection":!0}),a(Pe,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(le,null,de(Cl.value,(n,Q)=>(t(),u(Pe,{property:n.name,label:n.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120"},it({_:2},[n.name==="mgmt_ip"?{name:"default",fn:l(o=>[a(ra,{href:`https://${o.row[n.name]}`,type:"primary",target:"_blank"},{default:l(()=>[f(x(o.row[n.name]),1)]),_:2},1032,["href"])]),key:"0"}:void 0,fe.value.boolean.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[B(a(Be,{modelValue:o.row[n.name],"onUpdate:modelValue":F=>o.row[n.name]=F,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:F=>Va({id:o.row.id,fields:{[n.name]:o.row[n.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[we,{id:`${(m=b(k).name)==null?void 0:m.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,fe.value.enum.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[M("div",to,x((m=o.row[n.name])==null?void 0:m.label),1)]}),key:"2"}:void 0,fe.value.password.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[ve.value?(t(),r("div",oo,x(b(Kl)(U.value.key,U.value.mode,o.row[n.name])),1)):(t(),r("div",no,[((m=o.row[n.name])==null?void 0:m.length)>>0?(t(),u(G,{key:0},{default:l(()=>e[41]||(e[41]=[f("******")])),_:1})):(t(),u(G,{key:1}))]))]}),key:"3"}:void 0,fe.value.model_ref.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m,F;return[M("div",{class:Ue({text_class:((m=o.row[n.name])==null?void 0:m.instance_name)>>0})},x((F=o.row[n.name])==null?void 0:F.instance_name),3)]}),key:"4"}:void 0]),1032,["property","label"]))),256)),a(Pe,{fixed:"right",width:"150",label:"操作"},{default:l(n=>[a(Y,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(d,{link:"",type:"primary",icon:b(Bl),onClick:Q=>oa(n.row)},null,8,["icon","onClick"])]),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var Q;return[B(a(d,{link:"",type:"primary",icon:b(ct),onClick:o=>oa(n.row,!0)},null,8,["icon","onClick"]),[[we,`${(Q=b(k).name)==null?void 0:Q.replace("_info","")}:edit`]])]}),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var Q;return[B(a(d,{link:"",type:"primary",icon:b(ga),onClick:o=>Ea(n.row)},null,8,["icon","onClick"]),[[we,`${(Q=b(k).name)==null?void 0:Q.replace("_info","")}:edit`]])]}),_:2},1024),a(Y,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>[M("span",so,[a(ia,{placement:"bottom",title:"实例二维码",width:250,trigger:"click"},{reference:l(()=>[a(d,{link:"",type:"primary",icon:b(pt)},null,8,["icon"])]),default:l(()=>[a(Ya,{value:JSON.stringify(n.row),size:200},null,8,["value"])]),_:2},1024)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[et,Wl.value]]),a(Ja,{"current-page":Ie.value,"onUpdate:currentPage":e[8]||(e[8]=n=>Ie.value=n),"page-size":z.value,"onUpdate:pageSize":e[9]||(e[9]=n=>z.value=n),"page-sizes":[10,20,50,100,200],size:ll.value,disabled:Je.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:la.value,onSizeChange:D,onCurrentChange:Ne,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[a(G,null,{default:l(()=>[f("已选择 "+x(ze.value.length)+" 条",1)]),_:1})]),_:1},8,["current-page","page-size","size","disabled","total"])])):V("",!0),a(Xa,{modelValue:be.value,"onUpdate:modelValue":e[20]||(e[20]=n=>be.value=n),class:"edit-drawer",direction:"rtl",size:"45%","before-close":La},{header:l(()=>[Re.value?(t(),u(G,{key:1,tag:"b"},{default:l(()=>e[42]||(e[42]=[f("实例信息 ")])),_:1})):(t(),u(Ka,{key:0,title:"实例信息"},{default:l(()=>[a(ca,{label:"唯一标识"},{default:l(()=>{var n;return[f(x((n=qe.value)==null?void 0:n.instance_name),1)]}),_:1}),a(ca,{label:"所属分组"},{default:l(()=>{var n;return[(t(!0),r(le,null,de((n=qe.value)==null?void 0:n.instance_group,(Q,o)=>(t(),u(G,{key:o},{default:l(()=>[f(x(Q.group_path),1)]),_:2},1024))),128))]}),_:1})]),_:1}))]),default:l(()=>[a(Qa,{modelValue:Vl.value,"onUpdate:modelValue":e[15]||(e[15]=n=>Vl.value=n),type:"card",class:"demo-tabs",onTabClick:za},{default:l(()=>[a(Dl,{label:"资产信息",name:"modelField"},{default:l(()=>[a(Yl,{ref_key:"ciDataFormRef",ref:Qe,style:{"max-width":"100%"},model:_,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[W.value?(t(),u(ge,{key:0,prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>e[43]||(e[43]=[f("唯一标识")])),_:1}),a(Y,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:1})]),_:1})]),default:l(()=>[W.value?(t(),u(Ee,{key:0,modelValue:_.instance_name,"onUpdate:modelValue":e[10]||(e[10]=n=>_.instance_name=n),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",uo,x(_.instance_name),1))]),_:1})):V("",!0),a(Ga,{modelValue:$.value,"onUpdate:modelValue":e[14]||(e[14]=n=>$.value=n)},{default:l(()=>[(t(!0),r(le,null,de(je.value.field_groups,(n,Q)=>(t(),u(Wa,{name:Q,key:Q},{title:l(()=>[a(G,{tag:"b",size:"large"},{default:l(()=>[f(x(n.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(pa,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(le,null,de(n.fields,(o,m)=>(t(),u(zl,{span:12},{default:l(()=>[o.type==="string"?(t(),u(ge,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:Sa(o.validation_rule)},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ro,[_[o.name]!=null?(t(),r("div",io,[o.name==="mgmt_ip"?(t(),u(ra,{key:0,href:`https://${_[o.name]}`,type:"primary",target:"_blank"},{default:l(()=>[f(x(_[o.name]),1)]),_:2},1032,["href"])):(t(),r("span",{key:1,class:Ue(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(_[o.name]),3))])):(t(),r("span",co,"--"))]))]),_:2},1032,["label","prop","required","rules"])):V("",!0),o.type==="json"?(t(),u(ge,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),a(Y,{placement:"right",effect:"dark"},{content:l(()=>e[44]||(e[44]=[f(" json类型字段"),M("br",null,null,-1),f("请输入json格式数据! ")])),default:l(()=>[a(y,null,{default:l(()=>[a(Ha)]),_:1})]),_:1}),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",po,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",fo,"--"))]))]),_:2},1032,["label","prop","required"])):V("",!0),["text"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",vo,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(_[o.name]),3)):(t(),r("span",mo,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),u(ge,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[a(Be,{modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!W.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):V("",!0),["float"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[o.unit!==null?(t(),u(G,{key:0,tag:"b"},{default:l(()=>[f(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),u(G,{key:1,tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),u(Y,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u(Al,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",_o,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",yo,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>{var F,Le;return[W.value?(t(),u(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":ul=>_[o.name]=ul,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",go,[((F=_[o.name])==null?void 0:F.length)>>0?(t(),r("div",bo,[ve.value?(t(),r("span",wo,x(b(Kl)(U.value.key,U.value.mode,_[o.name])),1)):(t(),r("span",{key:1,class:Ue({requiredClass:o.required}),onMouseenter:e[12]||(e[12]=ul=>ae.value=!0),onMouseleave:e[13]||(e[13]=ul=>ae.value=!1)},[e[46]||(e[46]=f("******** ")),B((t(),u(ia,{width:380,trigger:"click",onAfterLeave:ye},{reference:l(()=>[a(y,null,{default:l(()=>[B(a(b(Bl),null,null,512),[[Fl,ae.value&&!ve.value]])]),_:1})]),default:l(()=>[a(Yl,{ref_for:!0,ref_key:"passFormRef",ref:ne,inline:!0,model:H,"require-asterisk-position":"right"},{default:l(()=>[a(pa,{align:"middle"},{default:l(()=>[a(zl,{span:20},{default:l(()=>[a(ge,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(Ee,{type:"password",modelValue:H.secret,"onUpdate:modelValue":e[11]||(e[11]=ul=>H.secret=ul),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(zl,{span:2},{default:l(()=>[a(ge,null,{default:l(()=>[a(d,{type:"primary",size:"small",onClick:ul=>ke(ne.value,_[o.name])},{default:l(()=>e[45]||(e[45]=[f("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),Z.value?(t(),u(G,{key:0,tag:"b"},{default:l(()=>[f("密码: "+x(te.value)+" ",1),a(Y,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(y,null,{default:l(()=>[B(a(b(ga),null,null,512),[[lt,te.value]])]),_:1})]),_:1})]),_:1})):V("",!0)]),_:2},1024)),[[we,`${(Le=b(k).name)==null?void 0:Le.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",ko,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[o.unit!==null?(t(),u(G,{key:0,tag:"b"},{default:l(()=>[f(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),u(G,{key:1,tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),u(Y,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u(Al,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ho,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",Co,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u($l,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",xo,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue({requiredClass:o.required})},x(_[o.name]),3)):(t(),r("span",Vo,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u($l,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Mo,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue({requiredClass:o.required})},x(_[o.name]),3)):(t(),r("span",Oo,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>{var F;return[W.value?(t(),u(yl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":Le=>_[o.name]=Le,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(le,null,de(El.value[o.validation_rule],Le=>(t(),u(_l,{key:Le.value,label:Le.label,value:Le.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",$o,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue({requiredClass:o.required})},x((F=qe.value[o.name])==null?void 0:F.label),3)):(t(),r("span",Do,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?V("",!0):(t(),u(ge,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ce,{size:2},{default:l(()=>[a(G,{tag:"b"},{default:l(()=>[f(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(Y,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(xe))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),u(yl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(le,null,de(vl.value[o.name],(F,Le)=>(t(),u(_l,{key:Le,label:F.label,value:F.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",Fo,[_[o.name]!=null?(t(),r("span",{key:0,class:Ue(["text_class",{requiredClass:o.required}])},x(qe.value[o.name].instance_name),3)):(t(),r("span",Uo,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1}),Re.value?V("",!0):(t(),u(Dl,{key:0,label:"监控信息",name:"monitor",disabled:""},{default:l(()=>e[47]||(e[47]=[f("111")])),_:1})),Re.value?V("",!0):(t(),u(Dl,{key:1,label:"关联关系",name:"relations",disabled:""},{default:l(()=>e[48]||(e[48]=[f("222")])),_:1})),Re.value?V("",!0):(t(),u(Dl,{key:2,label:"变更记录",name:"changelog",disabled:""},{default:l(()=>e[49]||(e[49]=[f("Role")])),_:1}))]),_:1},8,["modelValue"])]),footer:l(()=>{var n,Q,o,m;return[B(M("div",Io,[a(d,{onClick:e[16]||(e[16]=F=>Aa(Qe.value))},{default:l(()=>e[50]||(e[50]=[f("取消")])),_:1}),Re.value?(t(),r("div",Po,[a(d,{type:"primary",onClick:e[17]||(e[17]=F=>ua(Qe.value))},{default:l(()=>e[51]||(e[51]=[f("添加")])),_:1})])):(t(),r("div",No,[W.value?(t(),r("div",So,[Ua((n=qe.value)==null?void 0:n.instance_group)?B((t(),u(d,{key:0,type:"danger",onClick:da},{default:l(()=>e[52]||(e[52]=[f("删除")])),_:1})),[[we,`${(Q=b(k).name)==null?void 0:Q.replace("_info","")}:delete`]]):B((t(),u(Y,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(d,{type:"danger",onClick:da,disabled:""},{default:l(()=>e[53]||(e[53]=[f("删除")])),_:1})]),_:1})),[[we,`${(o=b(k).name)==null?void 0:o.replace("_info","")}:delete`]]),B((t(),u(d,{type:"primary",onClick:e[18]||(e[18]=F=>ua(Qe.value))},{default:l(()=>e[54]||(e[54]=[f("保存")])),_:1})),[[va]])])):(t(),r("div",jo,[B((t(),u(d,{type:"primary",onClick:e[19]||(e[19]=F=>W.value=!0)},{default:l(()=>e[55]||(e[55]=[f("编辑")])),_:1})),[[we,`${(m=b(k).name)==null?void 0:m.replace("_info","")}:edit`]])]))]))],512),[[Fl,Vl.value==="modelField"]])]}),_:1},8,["modelValue"]),a(fa,{modelValue:Ge.value,"onUpdate:modelValue":e[22]||(e[22]=n=>Ge.value=n),title:"批量更新",width:"500","before-close":cl},{footer:l(()=>[M("div",Ho,[a(d,{onClick:cl},{default:l(()=>e[56]||(e[56]=[f("取消")])),_:1}),a(d,{onClick:e[21]||(e[21]=gl(n=>Tl(),["prevent"]))},{default:l(()=>e[57]||(e[57]=[f("新增字段")])),_:1}),B((t(),u(d,{type:"primary",onClick:Fe,disabled:!($e.value.length>0)},{default:l(()=>e[58]||(e[58]=[f("保存")])),_:1},8,["disabled"])),[[va]])])]),default:l(()=>[a(Yl,{ref_key:"multipleFormRef",ref:bl,style:{"max-width":"1000px"},model:I,"label-width":"auto"},{default:l(()=>[(t(!0),r(le,null,de($e.value,(n,Q)=>{var o;return t(),u(ge,{key:`param-${n}`,label:"字段"+(Q+1),prop:`updateParams.${n}`,rules:jl((o=me.value[n])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(Ce,null,{default:l(()=>[a(yl,{"model-value":n.startsWith("__temp")?void 0:n,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:m=>se(Q,m)},{default:l(()=>[(t(!0),r(le,null,de(kl.value,m=>(t(),u(_l,{key:m.value,label:m.label,value:m.value,disabled:m.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),n&&!n.startsWith("__temp")?(t(),r("div",To,[["text","json"].indexOf(me.value[n].type)>>>-1?["string"].indexOf(me.value[n].type)>>>-1?["enum"].indexOf(me.value[n].type)>>>-1?["model_ref"].indexOf(me.value[n].type)>>>-1?["boolean"].indexOf(me.value[n].type)>>>-1?["integer"].indexOf(me.value[n].type)>>>-1?["float"].indexOf(me.value[n].type)>>>-1?["date"].indexOf(me.value[n].type)>>>-1?["datetime"].indexOf(me.value[n].type)>>>-1?(t(),r("div",Ko,[a(Ee,{modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Jo,[a(Be,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),u($l,{key:0,modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Bo,[a(Be,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),u($l,{key:0,modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Yo,[a(Be,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),u(Al,{key:0,modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",zo,[a(Be,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),u(Ee,{key:0,modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Ao,[a(Be,{modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Lo,[a(yl,{modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(le,null,de(vl.value[n],(m,F)=>(t(),u(_l,{key:F,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Eo,[a(yl,{modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(le,null,de(El.value[me.value[n].validation_rule],m=>(t(),u(_l,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Ro,[a(Be,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),u(Ee,{key:0,modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",qo,[a(Be,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),u(Ee,{key:0,modelValue:I.updateParams[n],"onUpdate:modelValue":m=>I.updateParams[n]=m,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):V("",!0),a(d,{class:"mt-2",icon:b(ft),circle:"",onClick:gl(m=>De(Q,n),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(fa,{modelValue:P.value,"onUpdate:modelValue":e[25]||(e[25]=n=>P.value=n),title:"实例组编辑",width:"500"},{footer:l(()=>[M("div",Wo,[a(d,{onClick:e[24]||(e[24]=n=>P.value=!1)},{default:l(()=>e[59]||(e[59]=[f("取消")])),_:1}),a(d,{type:"primary",onClick:Nl},{default:l(()=>e[60]||(e[60]=[f(" 提交更新 ")])),_:1})])]),default:l(()=>[a(Za,{options:C.treeData,props:g,clearable:"",modelValue:Ae.value,"onUpdate:modelValue":e[23]||(e[23]=n=>Ae.value=n),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),j.value?(t(),u(Ct,{key:1,isShowUpload:Ke.value,"onUpdate:isShowUpload":e[26]||(e[26]=n=>Ke.value=n),ciModelId:C.ciModelId,currentNodeId:C.currentNodeId,onGetCiData:he},null,8,["isShowUpload","ciModelId","currentNodeId"])):V("",!0),j.value?(t(),u(Qt,{key:2,ciModelId:C.ciModelId,currentNodeId:C.currentNodeId,allModelFieldByNameObj:me.value,enumOptionObj:El.value,validationRulesObj:Te.value,allModelField:ml.value,modelRefOptions:vl.value,showFilter:ee.value,"onUpdate:showFilter":e[27]||(e[27]=n=>ee.value=n),onUpdateFilterParam:aa,onGetCiData:he,ref_key:"ciDataFilterRef",ref:h},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):V("",!0),a(It,{ciModelId:C.ciModelId,allModelField:ml.value,allModelFieldInfo:Da.value,isShowTableCol:ql.value,"onUpdate:isShowTableCol":e[28]||(e[28]=n=>ql.value=n),hasConfigField:Cl.value,"onUpdate:hasConfigField":e[29]||(e[29]=n=>Cl.value=n),onReloadTable:Xl,ref_key:"ciDataTableColRef",ref:Ql},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(Nt,{showAllPassDia:X.value,"onUpdate:showAllPassDia":e[30]||(e[30]=n=>X.value=n)},null,8,["showAllPassDia"])],64)}}}),Qo=Pl(Go,[["__scopeId","data-v-8f4e1079"]]),Xo=vt("ci",()=>{const ie=i([]),ce=el({filterParams:[]});i([]);const J=i([]);return i({}),{setFilterList:K=>{console.log(K),J.value=K,console.log(J.value)},saveFilterParams:K=>{console.log(K),ce.filterParams=K},setModelList:K=>{ie.value=K}}},{persist:!0}),Zo={class:"card ci_data_tree"},en={class:"custom-tree-node"},ln={class:"table-box"},an=il({__name:"cidataView",setup(ie){const ce=ka(),{proxy:J}=Ul(),O=i(!0),A=Xo(),k=i(!1);i(""),i(!1);const K=i(),oe=i([]),C=i("");Il(C,w=>{U.value.filter(w)});const pe=(w,g)=>w?g.label.toLowerCase().includes(w.toLowerCase()):!0,$=w=>!(w.level>Ke.value-1||w.label==="空闲池"),ee=async()=>{k.value=!0;let w=await J.$api.getCiModelTree({model:j.value});console.log(w),oe.value=[w.data],Ve(()=>{_e.value===1&&(U.value.setCurrentKey(w.data.id),_e.value=U.value.getCurrentKey())}),k.value=!1},re=i([]),j=i(""),Me=async()=>{let w=await J.$api.getCiModel();re.value=w.data.results,A.setModelList(re.value),j.value=re.value.find(g=>g.name==="hosts").id};L(()=>{let w={};return re.value.forEach(g=>{w[g.id]=g}),w});const h=i(""),Oe=async()=>{_e.value=1,console.log(j.value),await ee(),await h.value.closeFilter(),await h.value.updateFilterParam({}),await h.value.clearMultipleSelect(),h.value.reloadCiDataFilter(),await h.value.setLoading(!0),await h.value.getModelField(),await h.value.getHasConfigField(),await h.value.setLoading(!1),await h.value.initCiDataForm(),await h.value.getCiData({model:j.value,model_instance_group:_e.value})};ha(async()=>{console.log(123),await Me(),await ee(),h.value.setLoading(!0),await h.value.getModelField(),await h.value.getHasConfigField(),await h.value.setLoading(!1),await h.value.initCiDataForm(),await h.value.getCiData({model:j.value,model_instance_group:U.value.getCurrentKey()})});const X=w=>w.built_in?!1:w.children?!(w.children.length>>>0):!0,U=i(),ve=i(),_e=i(1),R=i(!1),v=i(100),p=(w,g)=>{te.value=!1;let P=v.value++;U.value.append({id:P,label:"新建子目录",level:g.level+1,parent:g.id,model:j.value},w),U.value.setCurrentKey(P),ne.value=P,Ve(()=>{ve.value.focus()})},E=(w,g)=>{let P=v.value++;te.value=!1,U.value.insertAfter({id:P,label:"新建目录",level:g.level,parent:w.parent.data.id,model:j.value},w),U.value.setCurrentKey(P),ne.value=P,Ve(()=>{ve.value.focus()})},ae=()=>{_e.value=U.value.getCurrentKey(),h.value.clearMultipleSelect(),h.value.setLoading(!0),h.value.getCiData({model:j.value,model_instance_group:U.value.getCurrentKey()}),h.value.setLoading(!0)},ye=w=>{R.value=!R.value,w.isShowEdit=R.value},ne=i(99999),H=i(""),te=i(!0),Z=w=>{te.value=!0,console.log(w),H.value=w.label,ne.value=w.id,Ve(()=>{ve.value.focus()})},ke=async(w,g)=>{if(ne.value=99999,!H.value)N.warning("名称不可为空"),U.value.remove(g);else if(te.value){if(H.value==g.label)return!1;{let P=await J.$api.updateCiModelTree({id:g.id,label:H.value});P.status=="200"?(N({type:"success",message:"更新成功"}),g.label=H.value,ee(),H.value=""):N({showClose:!0,message:"更新失败:"+JSON.stringify(P.data),type:"error"}),console.log(g)}}else{g.label=H.value,console.log(g);let P=await J.$api.addCiModelTree(g);P.status=="201"?(N({type:"success",message:"添加成功"}),ee(),H.value=""):(N({showClose:!0,message:"添加失败:"+JSON.stringify(P.data),type:"error"}),U.value.remove(g))}},Ie=w=>{w&&Hl.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await J.$api.deleteCiModelTree(w.data.id)).status==200?(N({type:"success",message:"删除成功"}),await ee()):N({type:"error",message:"删除失败"})}).catch(()=>{})},z=i(""),ll=(w,g)=>{z.value=w,console.log(z.value)},Je=(w,g,P)=>{},D=(w,g,P)=>{},Ne=(w,g,P)=>{},S=async(w,g,P,Ae)=>{if(g.data.id===w.data.id)return;let ol=await J.$api.updateCiModelTree({id:w.data.id,target_id:g.data.id,position:P});ol.status=="200"?(N({type:"success",message:"更新排序成功"}),ee()):N({showClose:!0,message:"更新排序失败:"+JSON.stringify(ol.data),type:"error"})},al=(w,g,P,Ae)=>{},Ke=i(5),tl=(w,g,P)=>g.data.built_in?!1:P!=="inner",We=w=>!w.data.built_in;return(w,g)=>{const P=c("el-text"),Ae=c("el-col"),ol=c("el-option"),Nl=c("el-select"),bl=c("el-row"),Ge=c("el-divider"),T=c("el-input"),Se=c("a-menu-item"),Sl=c("a-menu"),jl=c("a-dropdown"),I=c("el-space"),$e=dl("permission"),Tl=dl("loading");return t(),r(le,null,[B(M("div",Zo,[a(bl,{align:"middle",justify:"start"},{default:l(()=>[a(Ae,{span:8},{default:l(()=>[a(P,{tag:"b"},{default:l(()=>g[7]||(g[7]=[f("实例树")])),_:1})]),_:1}),a(Ae,{span:14},{default:l(()=>[a(Nl,{modelValue:j.value,"onUpdate:modelValue":g[0]||(g[0]=se=>j.value=se),placeholder:"Select",onChange:g[1]||(g[1]=se=>Oe())},{default:l(()=>[(t(!0),r(le,null,de(re.value,se=>(t(),u(ol,{key:se.id,label:se.verbose_name,value:se.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(Ge),a(T,{modelValue:C.value,"onUpdate:modelValue":g[2]||(g[2]=se=>C.value=se),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),B((t(),u(b(gt),{style:{"max-width":"280px",height:"auto"},"allow-drop":tl,"allow-drag":We,data:oe.value,draggable:!0,"default-expand-all":"","node-key":"id",onNodeDragStart:ll,onNodeDragEnter:Je,onNodeDragLeave:D,onNodeDragOver:Ne,onNodeDragEnd:S,onNodeDrop:al,"highlight-current":!0,"current-node-key":_e.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:U,onNodeClick:ae,"filter-node-method":pe},{default:l(({node:se,data:De})=>{var wl;return[M("div",en,[ne.value===De.id?(t(),u(T,{key:0,modelValue:H.value,"onUpdate:modelValue":g[3]||(g[3]=Fe=>H.value=Fe),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:ve,onBlur:Fe=>ke(Fe,De),onKeyup:g[4]||(g[4]=mt(Fe=>Fe.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),u(P,{key:1,size:"default"},{default:l(()=>[f(x(se.label),1),a(P,{size:"small"},{default:l(()=>[f("("+x(De.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),B((t(),r("div",{class:Ue(["actionClass",{is_show_action:se.isShowEdit}])},[a(I,null,{default:l(()=>[De.built_in?V("",!0):(t(),u(b(_t),{key:0,onClick:gl(Fe=>Z(De),["stop"])},null,8,["onClick"])),a(jl,{trigger:["click"],ref_key:"aDropdownRef",ref:K,onOpenChange:Fe=>ye(se)},{overlay:l(()=>[a(Sl,null,{default:l(()=>{var Fe,kl;return[B((t(),r("div",null,[De.level!==1?(t(),u(Se,{key:"0",onClick:cl=>E(se,De)},{default:l(()=>g[8]||(g[8]=[f(" 添加同级节点 ")])),_:2},1032,["onClick"])):V("",!0),$(De)?(t(),u(Se,{key:"1",onClick:cl=>p(se,De)},{default:l(()=>g[9]||(g[9]=[f(" 添加子节点 ")])),_:2},1032,["onClick"])):V("",!0)])),[[$e,`${(Fe=b(ce).name)==null?void 0:Fe.replace("_info","")}:add`]]),B((t(),r("div",null,[X(De)?(t(),u(Se,{key:"2",onClick:cl=>Ie(se)},{default:l(()=>g[10]||(g[10]=[f(" 删除节点 ")])),_:2},1032,["onClick"])):V("",!0)])),[[$e,`${(kl=b(ce).name)==null?void 0:kl.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(b(yt),{onClick:g[5]||(g[5]=gl(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[$e,`${(wl=b(ce).name)==null?void 0:wl.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[Tl,k.value]])],512),[[Fl,O.value]]),M("div",ln,[a(Qo,{ciModelId:j.value,treeData:oe.value,currentNodeId:_e.value,ref_key:"ciDataShowRef",ref:h,onGetTree:ee,showTree:O.value,"onUpdate:showTree":g[6]||(g[6]=se=>O.value=se)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),un=Pl(an,[["__scopeId","data-v-c3cc4c42"]]);export{un as default};
