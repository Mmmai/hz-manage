import{d as be,aq as ve,g as ge,ar as Ee,h as he,r,a as ue,e as s,aj as de,c as K,o as v,a7 as ce,b as e,w as t,k as $,t as Ve,aa as h,D as x,v as _,ak as ke,al as Ce,i as L,s as xe,I as pe,ao as d,_ as $e,u as Le,q as Oe,a8 as ye,aC as Te,a9 as Ie,F as re,aP as Je}from"./index-iGnbKzkN.js";import{i as je}from"./iconSelectCom-Do0Mix0R.js";const Ae={class:"dialog-footer"},ze=be({__name:"menuButtonCom",props:ve(["nowMenu"],{showDrawer:{},showDrawerModifiers:{}}),emits:ve(["getMenuData"],["update:showDrawer"]),setup(Q,{expose:C,emit:w}){const{proxy:S}=ge(),c=Q,O=w,M=Ee(Q,"showDrawer"),T=he(),B=r(),I=r([]);C({updateMenuButtonList:m=>{I.value=m}});const Z=()=>{M.value=!1},y=r(!1),V=()=>{y.value=!1},p=ue({name:"",action:"",menu:""}),b=r(!0),n=()=>{y.value=!0,b.value=!0,p.menu=c.nowMenu.id},D=m=>{y.value=!0,b.value=!1,xe(()=>{Object.keys(p).forEach(i=>{p[i]=m[i]}),p.id=m.id,p.menu=m.menu})},J=async()=>{let m=await S.$api.getButton({menu:c.nowMenu.id});I.value=m.data.results},ee=m=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await S.$api.deleteButton(m.id)).status==204?(d({type:"success",message:"删除成功"}),await J(),O("getMenuData")):d({type:"error",message:"删除失败"})}).catch(()=>{d({type:"info",message:"取消删除"})})},le=()=>{B.value.validate(async m=>{if(m)if(b.value){let i=await S.$api.addButton(p);i.status==201?(y.value=!1,B.value.resetFields(),J(),O("getMenuData")):d({showClose:!0,message:"添加失败:"+JSON.stringify(i.data),type:"error"})}else{let i=await S.$api.updateButton(p);i.status==200?(y.value=!1,B.value.resetFields(),J(),O("getMenuData")):d({showClose:!0,message:"更新失败:"+JSON.stringify(i.data),type:"error"})}else d({showClose:!0,message:"请输入正确内容.",type:"error"})})};return(m,i)=>{const Y=s("el-text"),G=s("el-col"),U=s("el-button"),te=s("el-row"),oe=s("el-divider"),j=s("el-table-column"),F=s("el-tooltip"),ae=s("el-table"),ne=s("el-drawer"),P=s("el-input"),N=s("el-form-item"),W=s("el-form"),H=s("el-dialog"),A=de("permission");return v(),K(ce,null,[e(ne,{modelValue:M.value,"onUpdate:modelValue":i[0]||(i[0]=o=>M.value=o),title:"菜单按钮编辑",direction:"rtl","before-close":Z,size:"30%"},{default:t(()=>[e(te,{justify:"space-between"},{default:t(()=>[e(G,{span:5},{default:t(()=>[e(Y,{size:"large",tag:"b"},{default:t(()=>[$("菜单："+Ve(c.nowMenu.label),1)]),_:1})]),_:1}),e(G,{span:2},{default:t(()=>{var o;return[h((v(),x(U,{type:"primary",onClick:n},{default:t(()=>i[5]||(i[5]=[$("添加")])),_:1})),[[A,`${(o=_(T).name)==null?void 0:o.replace("_info","")}:add`]])]}),_:1})]),_:1}),e(oe),e(ae,{border:"",data:I.value,style:{width:"100%"}},{default:t(()=>[e(j,{prop:"name",label:"按钮名称"}),e(j,{prop:"action",label:"按钮标识"}),e(j,{fixed:"right",label:"操作"},{default:t(o=>[e(F,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var l;return[h(e(U,{link:"",type:"primary",icon:_(ke),onClick:k=>D(o.row)},null,8,["icon","onClick"]),[[A,`${(l=_(T).name)==null?void 0:l.replace("_info","")}:edit`]])]}),_:2},1024),e(F,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var l;return[h(e(U,{link:"",type:"danger",icon:_(Ce),onClick:k=>ee(o.row)},null,8,["icon","onClick"]),[[A,`${(l=_(T).name)==null?void 0:l.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(H,{modelValue:y.value,"onUpdate:modelValue":i[4]||(i[4]=o=>y.value=o),title:"按钮配置",width:"400","before-close":V},{footer:t(()=>[L("div",Ae,[e(U,{onClick:i[3]||(i[3]=o=>y.value=!1)},{default:t(()=>i[6]||(i[6]=[$("取消")])),_:1}),e(U,{type:"primary",onClick:le},{default:t(()=>i[7]||(i[7]=[$(" 提交 ")])),_:1})])]),default:t(()=>[e(W,{inline:!0,model:p,ref_key:"formRef",ref:B,class:"demo-form-inline"},{default:t(()=>[e(N,{label:"按钮名称",required:"",prop:"name"},{default:t(()=>[e(P,{modelValue:p.name,"onUpdate:modelValue":i[1]||(i[1]=o=>p.name=o),placeholder:"中文名",clearable:""},null,8,["modelValue"])]),_:1}),e(N,{label:"按钮标识",placeholder:"英文标识",required:"",prop:"action"},{default:t(()=>[e(P,{modelValue:p.action,"onUpdate:modelValue":i[2]||(i[2]=o=>p.action=o),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ye=$e(ze,[["__scopeId","data-v-1d81ac8e"]]),Ge={class:"card"},Pe={class:"role-menu"},We={style:{width:"100%"}},He={class:"user-header"},Ke=be({__name:"menuView",setup(Q){const C=he(),w=Le(),S=r({}),{proxy:c}=ge();ue({search:""});const O=r(!1),M=r([]),T=r([]);r("auto");const B=r([{prop:"label",label:"菜单名称"},{prop:"icon",label:"图标"},{prop:"is_menu",label:"是否菜单"},{prop:"status",label:"启用"},{prop:"sort",label:"序号"},{prop:"path",label:"路由地址"},{prop:"name",label:"菜单编码"},{prop:"description",label:"描述"},{prop:"buttons",label:"权限按钮"}]);r(1);const I=r(10);r(!1),r(!1),r(!1);const X=r(0),Z=r(!1);r({}),Oe(async()=>{await V()});const y=o=>(o.forEach(l=>{l.value=l.id,l.disabled=!!l.is_menu,l.children&&y(l.children)}),o),V=async()=>{let o=await c.$api.getMenuList();M.value=o.data.results,T.value=y(o.data.results),X.value=o.data.count,X.value<I.value&&(Z.value=!0)},p=o=>{S.value=o},b=r(!1),n=ue({label:"",icon:"",sort:0,is_menu:!0,description:"",path:"",name:"",parentid:null,has_info:!1,info_view_name:"",is_iframe:!1,iframe_url:"",status:!0}),D=r("add"),J=()=>{D.value="add",b.value=!0},ee=()=>{b.value=!1,c.$refs.userFrom.resetFields()},le=o=>{pe.confirm("是否确认关闭?").then(()=>{o(),c.$refs.userFrom.resetFields()}).catch(()=>{})},m=()=>{c.$refs.userFrom.validate(async o=>{if(o)if(D.value=="add"){let l=await c.$api.menuAdd(n);l.status==201?(b.value=!1,c.$refs.userFrom.resetFields(),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):d({showClose:!0,message:"添加失败:"+JSON.stringify(l.data),type:"error"})}else{let l=await c.$api.menuUpdate({id:Y.value.id,...n});l.status==200?(b.value=!1,c.$refs.userFrom.resetFields(),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})}else d({showClose:!0,message:"请输入正确内容.",type:"error"})})},i=r(),Y=r({}),G=o=>{D.value="edit",Y.value=o,b.value=!0,xe(()=>{Object.keys(n).forEach(l=>{n[l]=o[l]})}),console.log(n)},U=o=>{pe.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await c.$api.menuDel(o.id)).status==204?(d({type:"success",message:"删除成功"}),await V(),await w.dispatch("getRoleMenu",{role:w.state.role})):d({type:"error",message:"删除失败"})}).catch(()=>{d({type:"info",message:"Delete canceled"})})},te=r([]),oe=(o,l)=>{},j=o=>{te.value=o},F=r(!1),ae=()=>{F.value=!0},ne=async o=>{let l=await c.$api.menuUpdate({status:o.status,id:o.id});l.status==200?(d({type:"success",message:"更新成功"}),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})},P=async o=>{let l=await c.$api.menuUpdate({is_menu:o.is_menu,id:o.id});l.status==200?(d({type:"success",message:"更新成功"}),V(),await w.dispatch("getRoleMenu",{role:w.state.role})):d({showClose:!0,message:"更新失败:"+JSON.stringify(l.data),type:"error"})},N=r(!1),W=r({}),H=r(null),A=o=>{N.value=!0,W.value=o,H.value.updateMenuButtonList(o.buttons)};return(o,l)=>{var we;const k=s("el-button"),se=s("el-table-column"),R=s("el-switch"),me=Ie,Me=s("el-icon"),Ue=s("el-tag"),Se=s("el-space"),ie=s("el-tooltip"),Be=s("el-table"),q=s("el-input"),f=s("el-form-item"),De=s("el-input-number"),Fe=s("el-tree-select"),fe=s("el-col"),_e=s("el-row"),Ne=s("el-form"),Re=s("el-dialog"),E=de("permission"),qe=de("loading");return v(),K("div",Ge,[L("div",Pe,[L("div",We,[L("div",He,[L("div",null,[h((v(),x(k,{type:"primary",size:"small",onClick:J},{default:t(()=>l[16]||(l[16]=[$("+新增")])),_:1})),[[E,`${(we=_(C).name)==null?void 0:we.replace("_info","")}:add`]])])]),L("div",null,[h((v(),x(Be,{border:"",data:M.value,style:{width:"100%"},"max-height":"500px","highlight-current-row":"","row-key":"id","table-layout":"fixed",onSelectionChange:j,onRowClick:p},{default:t(()=>[e(se,{type:"selection",width:"55",selectable:oe}),(v(!0),K(ce,null,ye(B.value,a=>(v(),x(se,{key:a.prop,label:a.label,prop:a.prop},Te({_:2},[a.prop==="is_menu"?{name:"default",fn:t(u=>{var g;return[h(e(R,{modelValue:u.row.is_menu,"onUpdate:modelValue":z=>u.row.is_menu=z,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:z=>P(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[E,{id:`${(g=_(C).name)==null?void 0:g.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,a.prop==="status"?{name:"default",fn:t(u=>{var g;return[h(e(R,{modelValue:u.row.status,"onUpdate:modelValue":z=>u.row.status=z,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:z=>ne(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[E,{id:`${(g=_(C).name)==null?void 0:g.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,a.prop==="icon"?{name:"default",fn:t(u=>[e(Me,null,{default:t(()=>[e(me,{icon:u.row.icon},null,8,["icon"])]),_:2},1024)]),key:"2"}:void 0,a.prop==="buttons"?{name:"default",fn:t(u=>[e(Se,{wrap:""},{default:t(()=>[(v(!0),K(ce,null,ye(u.row.buttons,g=>(v(),x(Ue,{type:"success",round:"",effect:"plain",key:g.id},{default:t(()=>[$(Ve(g.name),1)]),_:2},1024))),128))]),_:2},1024)]),key:"3"}:void 0]),1032,["label","prop"]))),128)),e(se,{fixed:"right",label:"操作",width:"150"},{default:t(a=>[a.row.is_menu?(v(),x(ie,{key:0,class:"box-item",effect:"dark",content:"编辑按钮",placement:"top"},{default:t(()=>{var u;return[h(e(k,{link:"",type:"primary",icon:_(Je),onClick:g=>A(a.row)},null,8,["icon","onClick"]),[[E,`${(u=_(C).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024)):re("",!0),e(ie,{class:"box-item",effect:"dark",content:"编辑菜单",placement:"top"},{default:t(()=>{var u;return[h(e(k,{link:"",type:"primary",icon:_(ke),onClick:g=>G(a.row)},null,8,["icon","onClick"]),[[E,`${(u=_(C).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),e(ie,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:t(()=>{var u;return[h(e(k,{link:"",type:"danger",icon:_(Ce),onClick:g=>U(a.row)},null,8,["icon","onClick"]),[[E,`${(u=_(C).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[qe,O.value]])])])]),e(Re,{modelValue:b.value,"onUpdate:modelValue":l[14]||(l[14]=a=>b.value=a),title:D.value=="add"?"新增菜单":"编辑菜单",width:"40%","before-close":le},{default:t(()=>[e(Ne,{inline:!0,model:n,class:"demo-form-inline","label-position":"right","label-width":"80px",ref:"userFrom","status-icon":""},{default:t(()=>[e(f,{label:"菜单名称",prop:"label",rules:[{required:!0}]},{default:t(()=>[e(q,{modelValue:n.label,"onUpdate:modelValue":l[0]||(l[0]=a=>n.label=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"菜单标识",prop:"name",rules:[{required:!0}]},{default:t(()=>[e(q,{modelValue:n.name,"onUpdate:modelValue":l[1]||(l[1]=a=>n.name=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"路由",prop:"path"},{default:t(()=>[e(q,{modelValue:n.path,"onUpdate:modelValue":l[2]||(l[2]=a=>n.path=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"图标",prop:"icon",rules:[{required:!0}]},{default:t(()=>[e(k,{onClick:ae},{default:t(()=>[e(me,{icon:n.icon},null,8,["icon"])]),_:1}),e(je,{isShow:F.value,"onUpdate:isShow":l[3]||(l[3]=a=>F.value=a),iconName:n.icon,"onUpdate:iconName":l[4]||(l[4]=a=>n.icon=a)},null,8,["isShow","iconName"])]),_:1}),e(f,{label:"序号",prop:"sort"},{default:t(()=>[e(De,{modelValue:n.sort,"onUpdate:modelValue":l[5]||(l[5]=a=>n.sort=a),placeholder:"",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"父级节点",prop:"parentid"},{default:t(()=>[e(Fe,{modelValue:n.parentid,"onUpdate:modelValue":l[6]||(l[6]=a=>n.parentid=a),ref_key:"elTreeSelectRef",ref:i,data:M.value,clearable:"","check-strictly":"","render-after-expand":!1,"node-key":"id",style:{width:"180px"}},null,8,["modelValue","data"])]),_:1}),e(f,{label:"描述",prop:"description"},{default:t(()=>[e(q,{modelValue:n.description,"onUpdate:modelValue":l[7]||(l[7]=a=>n.description=a),placeholder:"",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"启用",prop:"status",rules:[{required:!0}]},{default:t(()=>[e(R,{modelValue:n.status,"onUpdate:modelValue":l[8]||(l[8]=a=>n.status=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(f,{label:"是否菜单",prop:"is_menu",rules:[{required:!0}]},{default:t(()=>[e(R,{modelValue:n.is_menu,"onUpdate:modelValue":l[9]||(l[9]=a=>n.is_menu=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1}),e(f,{label:"详单"},{default:t(()=>[e(R,{modelValue:n.has_info,"onUpdate:modelValue":l[10]||(l[10]=a=>n.has_info=a),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),n.has_info?(v(),x(f,{key:0,label:"视图名"},{default:t(()=>[e(q,{modelValue:n.info_view_name,"onUpdate:modelValue":l[11]||(l[11]=a=>n.info_view_name=a),style:{width:"180px"}},null,8,["modelValue"])]),_:1})):re("",!0),e(_e,null,{default:t(()=>[e(fe,{span:6},{default:t(()=>[e(f,{label:"是否内嵌",prop:"is_iframe",rules:[{required:!0}]},{default:t(()=>[e(R,{modelValue:n.is_iframe,"onUpdate:modelValue":l[12]||(l[12]=a=>n.is_iframe=a),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1}),e(fe,{span:18},{default:t(()=>[n.is_iframe?(v(),x(f,{key:0,label:"访问地址"},{default:t(()=>[e(q,{modelValue:n.iframe_url,"onUpdate:modelValue":l[13]||(l[13]=a=>n.iframe_url=a),style:{width:"300px"},type:"textarea"},null,8,["modelValue"])]),_:1})):re("",!0)]),_:1})]),_:1}),e(_e,{style:{"justify-content":"space-around"}},{default:t(()=>[e(f,null,{default:t(()=>[e(k,{onClick:ee},{default:t(()=>l[17]||(l[17]=[$("取消")])),_:1}),e(k,{type:"primary",onClick:m},{default:t(()=>l[18]||(l[18]=[$(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Ye,{ref_key:"menuButtonComRef",ref:H,showDrawer:N.value,"onUpdate:showDrawer":l[15]||(l[15]=a=>N.value=a),nowMenu:W.value,onGetMenuData:V},null,8,["showDrawer","nowMenu"])])}}}),Ze=$e(Ke,[["__scopeId","data-v-1e11f706"]]);export{Ze as default};
