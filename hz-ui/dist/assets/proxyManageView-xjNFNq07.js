import{d as xe,g as Ve,u as we,r,f as $e,h as ke,l as he,a as Ce,m as Ue,bK as ze,n as Pe,aO as Se,e as n,b7 as E,c as B,o as b,i as y,bQ as k,b as t,y as _,q as x,w as o,k as h,F as L,p as Z,j as qe,c6 as Fe,c7 as Be,t as H,aK as J,c3 as m,bY as Re}from"./index-BuQNgUX_.js";const Ae={class:"card"},Me={class:"table-header"},Te={class:"header-button-lf"},De={class:"header-button-ri"},Ne={style:{float:"left"}},Ie={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Ke={class:"dialog-footer"},Ee=xe({name:"ciSyncZabbix",__name:"proxyManageView",setup(Oe){const{proxy:v}=Ve();we();const R=r([]),Q=$e(),V=ke();r("hosts");const C=r("model_instance_name"),U=r(""),A=r(!0),W=r([{value:"model_instance_name",label:"唯一标识",sort:!0,filter:!0,type:"string",required:!0},{value:"ip_address",label:"ip地址",sort:!1,filter:!0,type:"string",required:!0}]),Y=he(()=>{let a=[];return W.value.forEach(e=>{e.filter&&a.push({name:e.label,value:e.value})}),a}),w=r(""),s=Ce({name:"",verbose_name:"",proxy_type:"all",enabled:!0,ip_address:"",port:22,auth_user:"",auth_pass:"",description:""}),G=[{label:"all",value:"all",description:"所有类型,支持zabbix和ansible"},{label:"zabbix",value:"zabbix",description:"zabbix代理"},{label:"ansible",value:"ansible",description:"ansible代理"}],X={name:[{required:!0,message:"请输入代理名称(不支持中文)",trigger:"blur"},{pattern:/^((\d{1,3}\.){1,3}\d{1,3})?[a-zA-Z0-9_-]{1,32}((\d{1,3}\.){1,3}\d{1,3})?$/,message:"请输入正确的代理名称,不支持中文等特殊符号",trigger:"blur"}],proxy_type:[{required:!0,message:"请选择代理类型",trigger:"change"}],ip_address:[{required:!0,message:"请输入代理IP",trigger:"blur"},{pattern:/^(\d{1,3}\.){3}\d{1,3}$/,message:"请输入正确的IP地址格式",trigger:"blur"}],port:[{required:!0,message:"请输入代理端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口号应在1-65535之间",trigger:"blur"}],auth_user:[{required:!0,message:"请输入认证用户",trigger:"blur"}],auth_pass:[{required:!0,message:"请输入用户密码",trigger:"blur"}]},z=r(1),P=r(10),ee=r("default"),le=r(!1),M=r(0),T=()=>{u()},$=r({ordering:"-name"}),te=a=>{a.order==="ascending"?$.value.ordering=a.prop:a.order==="descending"?$.value.ordering="-"+a.prop:$.value={ordering:"-name"},u()},f=r(!1);r({}),r({});const S=a=>{a&&a.resetFields()};r([]),r([]);const u=async(a=null)=>{let e=await v.$api.getProxy({page:z.value,page_size:P.value,...N.value,...$.value,...a});R.value=e.data.results,M.value=e.data.count,A.value=!1},D=r(!0),ae=()=>{D.value=!0,S(w.value),J(()=>{f.value=!0})},oe=async()=>{let a=await v.$api.addProxy(s);a.status==201?(m({type:"success",message:"添加成功"}),f.value=!1,u()):m({type:"error",message:`添加失败: ${a.data}`})},se=async a=>{Re.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{if(a.node_count>0){m({type:"error",message:`已有${a.node_count}个节点关联到代理，无法删除proxy`});return}let e=await v.$api.deleteProxy(a.id);e.status==204?(m({type:"success",message:"删除成功"}),u()):m({type:"error",message:`删除失败: ${JSON.stringify(e.data)}`})})},re=a=>{Q.push({path:V.path+"/"+a.id})},ne=async()=>{let a=await v.$api.updateProxy({id:row.id,...s});a.status==200?(m({type:"success",message:"更新成功"}),f.value=!1,u(),S(w.value)):m({type:"error",message:`更新失败: ${a.data}`})},ue=async(a,e)=>{let i={};i[e]=a[e],(await v.$api.updateProxy({id:a.id,...i})).status==200?(m({type:"success",message:"更新成功"}),u()):m({type:"error",message:"更新失败"})};Ue(()=>{u()});const de=r([]),ie=a=>{de.value=a.map(e=>e.id)},N=r({});ze(U,a=>{N.value={[C.value]:a}});const pe=a=>{console.log(a),J(()=>{u()})},me=()=>{f.value=!1,S(w.value)};return Pe(()=>{}),Se(()=>{u()}),(a,e)=>{var j;const i=n("el-button"),q=n("el-option"),I=n("el-select"),g=n("el-input"),d=n("el-table-column"),K=n("el-switch"),O=n("el-tooltip"),ce=n("el-table"),be=n("el-pagination"),p=n("el-form-item"),ge=n("el-input-number"),fe=n("el-form"),ye=n("el-dialog"),F=E("permission"),ve=E("loading");return b(),B("div",Ae,[y("div",Me,[y("div",Te,[k((b(),x(i,{type:"primary",onClick:e[0]||(e[0]=l=>ae())},{default:o(()=>[...e[22]||(e[22]=[h("添加",-1)])]),_:1})),[[F,`${(j=_(V).name)==null?void 0:j.replace("_info","")}:add`]])]),y("div",De,[t(I,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=l=>C.value=l),placeholder:"Select",style:{width:"120px"}},{default:o(()=>[(b(!0),B(L,null,Z(Y.value,l=>(b(),x(q,{key:l.value,label:l.name,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(g,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=l=>U.value=l),style:{width:"240px"},placeholder:"回车查询",clearable:"",onClear:e[3]||(e[3]=l=>u()),onKeyup:e[4]||(e[4]=qe(l=>u(),["enter","native"]))},null,8,["modelValue"])])]),k((b(),x(ce,{ref:"multipleTableRef",data:R.value,style:{width:"100%"},border:"","row-key":l=>l.id,onSortChange:te,onSelectionChange:ie,onFilterChange:pe},{default:o(()=>[t(d,{property:"name",label:"代理名称",sortable:"custom"}),t(d,{property:"verbose_name",label:"中文名称",sortable:"custom",width:"140"}),t(d,{property:"proxy_type",sortable:"custom",label:"代理类型"}),t(d,{property:"ip_address",sortable:"custom",label:"ip地址"}),t(d,{property:"port",sortable:"custom",label:"端口"}),t(d,{property:"auth_user",sortable:"custom",label:"认证用户"}),t(d,{"column-key":"enabled",property:"enabled",label:"是否启用",sortable:"custom",width:"140"},{default:o(l=>[t(K,{modelValue:l.row.enabled,"onUpdate:modelValue":c=>l.row.enabled=c,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:c=>ue(l.row,"enabled")},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(d,{property:"node_count",sortable:"custom",label:"关联节点数"}),t(d,{property:"description",label:"备注信息",width:"400"}),t(d,{fixed:"right",width:"80",label:"操作"},{default:o(l=>[t(O,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:o(()=>{var c;return[k(t(i,{link:"",type:"primary",icon:_(Fe),onClick:_e=>re(l.row)},null,8,["icon","onClick"]),[[F,`${(c=_(V).name)==null?void 0:c.replace("_info","")}:edit`]])]}),_:2},1024),t(O,{class:"box-item",effect:"dark",content:"代理删除",placement:"top"},{default:o(()=>{var c;return[k(t(i,{link:"",type:"primary",icon:_(Be),onClick:_e=>se({id:l.row.id})},null,8,["icon","onClick"]),[[F,`${(c=_(V).name)==null?void 0:c.replace("_info","")}:edit`]])]}),_:2},1024)]),_:1})]),_:1},8,["data","row-key"])),[[ve,A.value]]),t(be,{"current-page":z.value,"onUpdate:currentPage":[e[5]||(e[5]=l=>z.value=l),e[7]||(e[7]=l=>T())],"page-size":P.value,"onUpdate:pageSize":[e[6]||(e[6]=l=>P.value=l),e[8]||(e[8]=l=>T())],"page-sizes":[10,20,50,100,200],size:ee.value,disabled:le.value,layout:"total, sizes, prev, pager, next, jumper",total:M.value,style:{"margin-top":"5px","justify-content":"flex-end"}},null,8,["current-page","page-size","size","disabled","total"]),t(ye,{modelValue:f.value,"onUpdate:modelValue":e[21]||(e[21]=l=>f.value=l),title:"添加代理",width:"500px"},{footer:o(()=>[y("div",Ke,[t(i,{onClick:e[18]||(e[18]=l=>me())},{default:o(()=>[...e[23]||(e[23]=[h("取消",-1)])]),_:1}),D.value?(b(),x(i,{key:0,type:"primary",onClick:e[19]||(e[19]=l=>oe())},{default:o(()=>[...e[24]||(e[24]=[h("提交",-1)])]),_:1})):(b(),x(i,{key:1,type:"primary",onClick:e[20]||(e[20]=l=>ne())},{default:o(()=>[...e[25]||(e[25]=[h("更新",-1)])]),_:1}))])]),default:o(()=>[t(fe,{ref_key:"proxyFormRef",ref:w,model:s,rules:X,"label-width":"100px"},{default:o(()=>[t(p,{label:"代理名称",prop:"name"},{default:o(()=>[t(g,{modelValue:s.name,"onUpdate:modelValue":e[9]||(e[9]=l=>s.name=l),placeholder:"请输入代理名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"中文名称",prop:"verbose_name"},{default:o(()=>[t(g,{modelValue:s.verbose_name,"onUpdate:modelValue":e[10]||(e[10]=l=>s.verbose_name=l),placeholder:"请输入中文名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"代理类型",prop:"proxy_type"},{default:o(()=>[t(I,{modelValue:s.proxy_type,"onUpdate:modelValue":e[11]||(e[11]=l=>s.proxy_type=l),placeholder:"请选择代理类型"},{default:o(()=>[(b(),B(L,null,Z(G,l=>t(q,{key:l.value,label:l.label,value:l.value},{default:o(()=>[y("span",Ne,H(l.label),1),y("span",Ie,H(l.description),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"是否启用",prop:"enabled"},{default:o(()=>[t(K,{modelValue:s.enabled,"onUpdate:modelValue":e[12]||(e[12]=l=>s.enabled=l)},null,8,["modelValue"])]),_:1}),t(p,{label:"代理ip",prop:"ip_address"},{default:o(()=>[t(g,{modelValue:s.ip_address,"onUpdate:modelValue":e[13]||(e[13]=l=>s.ip_address=l),placeholder:"请输入代理ip"},null,8,["modelValue"])]),_:1}),t(p,{label:"代理端口",prop:"port"},{default:o(()=>[t(ge,{modelValue:s.port,"onUpdate:modelValue":e[14]||(e[14]=l=>s.port=l),placeholder:"请输入代理端口",min:1,max:65535,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(p,{label:"认证用户",prop:"auth_user"},{default:o(()=>[t(g,{modelValue:s.auth_user,"onUpdate:modelValue":e[15]||(e[15]=l=>s.auth_user=l),placeholder:"请输入认证用户"},null,8,["modelValue"])]),_:1}),t(p,{label:"用户密码",prop:"auth_pass"},{default:o(()=>[t(g,{modelValue:s.auth_pass,"onUpdate:modelValue":e[16]||(e[16]=l=>s.auth_pass=l),type:"password",placeholder:"请输入用户密码","show-password":""},null,8,["modelValue"])]),_:1}),t(p,{label:"备注信息",prop:"description"},{default:o(()=>[t(g,{modelValue:s.description,"onUpdate:modelValue":e[17]||(e[17]=l=>s.description=l),placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Ee as default};
