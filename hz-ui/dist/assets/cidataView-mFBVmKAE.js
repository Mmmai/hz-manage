import{d as ll,aB as Je,bu as el,r as i,c as Xe,e as c,o as t,O as u,w as l,g as a,h as M,j as v,t as x,f as r,bo as g,c5 as $e,P as $,c2 as ka,c4 as N,k as Il,M as H,bI as Pl,F as te,b1 as ie,bS as ha,c6 as dt,aD as Me,_ as Nl,c7 as Be,u as Ca,bQ as gl,b as xa,aN as Va,b3 as rl,c8 as rt,c9 as it,bO as E,b_ as ct,ca as Jl,cb as pt,cc as vt,cd as ft,bF as Fl,Y as mt,aE as Fe,c0 as _t,ce as wa,cf as yt,c1 as gt,bV as Hl,cg as bt,i as wt,ch as kt,ci as ht,cj as Ct}from"./index-D4V34ywu.js";import{l as xt}from"./vue-draggable-plus-LmnboCDt.js";import{u as $a}from"./config-9haOJqUD.js";import{e as Kl,d as yl}from"./gmCrypto-Cw1SDwiR.js";const Vt={class:"flexJstart gap-1"},$t={key:0,class:"flexJstart gap-1"},Mt={key:3,class:"flexJstart gap-1"},Ot=ll({__name:"ciDataUpload",props:Je(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:Je(["getCiData"],["update:isShowUpload"]),setup(oe,{emit:ne}){const{proxy:B}=Il(),V=oe,j=ne,w=el(oe,"isShowUpload"),L=i([]),ae=i(null),h=["xlsx"],me=i(10),F=i({}),ee=i({}),ce=Xe({"Content-Type":"multipart/form-data"}),q=i({}),Oe=async()=>{Object.keys(ee.value).length>0?Object.entries(ee.value).forEach(async([A,f])=>{let p=await B.$api.importCiDataStatus(f);F.value[A]=p.data,p.data.status==="completed"&&delete ee.value[A]}):(clearInterval(C),C=null,j("getCiData",{model:V.ciModelId,model_instance_group:V.currentNodeId}))};let C=null;const De=async A=>{let f=new FormData;f.append("file",A.file),f.append("model",V.ciModelId);let p=await B.$api.importCiData(f,ce,2*60*1e3);p.status==200?(ee.value[A.file.uid]=p.data,q.value[A.file.uid]=!0,C===null&&(C=setInterval(Oe,2e3))):(q.value[A.file.uid]=!1,N({message:`导入异常: ${JSON.stringify(p.data)}`,type:"error",showClose:!0}))},Z=()=>{},D=A=>{let f=A.name;if(A.type!=""||A.type!=null||A.type!=null){const p=A.name.replace(/.+\./,"").toLowerCase();return A.size/1024/1024<5?h.includes(p)?L.value.find(be=>be.name==f&&be.lastModified==A.lastModified)?(N({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(N({message:`不能上传${p}类型的文件`,type:"error",showClose:!0}),!1):(N.error("上传文件大小不能超过 5MB!"),!1)}},pe=async A=>{await B.$api.downloadErrorRecords({error_file_key:A})},ge=async()=>{await B.$api.downloadImportTemplate({model:V.ciModelId})};return(A,f)=>{const p=c("upload-filled"),z=c("el-icon"),se=c("el-col"),be=c("el-button"),de=c("el-row"),W=c("Loading"),ue=c("CircleCheck"),X=c("el-link"),he=c("el-upload"),Ie=c("el-dialog");return t(),u(Ie,{modelValue:w.value,"onUpdate:modelValue":f[1]||(f[1]=J=>w.value=J),title:"导入",width:"800"},{default:l(()=>[a(he,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:ae,headers:ce,"http-request":De,"file-list":L.value,"before-upload":D,limit:me.value,onOnChange:Z,"show-file-list":""},{tip:l(()=>[a(de,{justify:"space-between",align:"middle"},{default:l(()=>[a(se,{span:18},{default:l(()=>f[2]||(f[2]=[M("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(se,{span:3},{default:l(()=>[a(be,{link:"",type:"primary",onClick:f[0]||(f[0]=J=>ge())},{default:l(()=>f[3]||(f[3]=[v("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:J,index:al})=>{var Ke,I,Se,S,tl,He,ol,Ge,k;return[M("div",Vt,[M("span",null,x(J.name),1),q.value[J.uid]==!0?(t(),r("div",$t,[((Ke=F.value[J.uid])==null?void 0:Ke.status)!=="completed"?(t(),u(z,{key:0,class:"is-loading"},{default:l(()=>[a(W)]),_:1})):((I=F.value[J.uid])==null?void 0:I.failed)>>>0?(t(),u(z,{key:1},{default:l(()=>[a(g($e),{color:"var(--el-color-warning)"})]),_:1})):(t(),u(z,{key:2},{default:l(()=>[a(ue,{color:"var(--el-color-success)"})]),_:1})),F.value[J.uid]?(t(),r("div",Mt,[M("span",null,x(`进度: ${(Se=F.value[J.uid])==null?void 0:Se.progress}%`),1),M("span",null,x(`结果: 总条数: ${(S=F.value[J.uid])==null?void 0:S.total},创建: ${(tl=F.value[J.uid])==null?void 0:tl.created},更新: ${(He=F.value[J.uid])==null?void 0:He.updated},跳过: ${(ol=F.value[J.uid])==null?void 0:ol.skipped},失败: ${(Ge=F.value[J.uid])==null?void 0:Ge.failed}.`),1),((k=F.value[J.uid])==null?void 0:k.failed)>>>0?(t(),u(X,{key:0,type:"danger",onClick:b=>{var P;return pe((P=F.value[J.uid])==null?void 0:P.error_file_key)}},{default:l(()=>f[4]||(f[4]=[v("查看导入失败数据")])),_:2},1032,["onClick"])):$("",!0)])):$("",!0)])):q.value[J.uid]==!1?(t(),u(z,{key:1},{default:l(()=>[a(g(ka),{color:"var(--el-color-error)"})]),_:1})):$("",!0)])]}),default:l(()=>[a(z,{class:"el-icon--upload"},{default:l(()=>[a(p)]),_:1}),f[5]||(f[5]=M("div",{class:"el-upload__text"},[v("拖拽文件到此或者 "),M("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])}}}),Dt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Ut={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Ft={style:{width:"100%",overflow:"auto"}},It={class:"listItem"},Pt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Nt={class:"listItem"},St={style:{flex:"auto"}},qt=ll({__name:"ciDataTableCol",props:Je(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:Je(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(oe,{expose:ne,emit:B}){const V=oe,j=el(oe,"isShowTableCol"),w=el(oe,"hasConfigField"),{proxy:L}=Il(),ae=i(""),h=i(""),me=H(()=>ae.value===""?A.value:A.value.filter(f=>f.verbose_name.includes(ae.value)));function F(){j.value=!1}const ee=f=>{w.value.push(f)},ce=f=>{let p=w.value.indexOf(f);w.value.splice(p,1)},q=f=>{console.log("start",f)},Oe=f=>{console.log("onEnd",f),console.log(w.value)},C=()=>{console.log("update")},De=i({}),Z=async()=>{let f=await L.$api.getCiModelCol({model:V.ciModelId});De.value=f.data;let p=[];f.data.fields_preferred.forEach(z=>{p.push(V.allModelFieldInfo[z])}),w.value=p},D=H(()=>w.value.map(f=>f.id)),pe=B;Pl(()=>w.value,f=>{console.log("更新表格"),pe("reloadTable")},{deep:!0});const ge=async()=>{let f=await L.$api.updateCiModelCol({id:De.value.id,fields_preferred:D.value});f.status=="200"?(N({type:"success",message:"更新成功"}),Me(()=>{h.value.clear(),j.value=!1})):N({showClose:!0,message:"更新失败:"+JSON.stringify(f.data),type:"error"})},A=H(()=>V.allModelField.filter(f=>!w.value.includes(f)));return ne({getHasConfigField:Z}),(f,p)=>{const z=c("el-text"),se=c("el-divider"),be=c("el-input"),de=c("el-icon"),W=c("el-button"),ue=c("el-drawer");return t(),u(ue,{modelValue:j.value,"onUpdate:modelValue":p[2]||(p[2]=X=>j.value=X),direction:"rtl",size:"40%"},{header:l(()=>[a(z,{tag:"b"},{default:l(()=>p[3]||(p[3]=[v("表格列显示配置")])),_:1})]),default:l(()=>[M("div",Dt,[M("div",Ut,[a(z,{tag:"b"},{default:l(()=>p[4]||(p[4]=[v("模型字段")])),_:1}),a(se),a(be,{modelValue:ae.value,"onUpdate:modelValue":p[0]||(p[0]=X=>ae.value=X),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:h},null,8,["modelValue"]),M("div",Ft,[(t(!0),r(te,null,ie(me.value,(X,he)=>(t(),r("div",{key:he},[M("div",It,[M("span",null,x(X.verbose_name),1),a(de,null,{default:l(()=>[a(g(ha),{onClick:Ie=>ee(X)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),M("div",Pt,[a(z,{tag:"b"},{default:l(()=>p[5]||(p[5]=[v("已显示字段")])),_:1}),a(se),a(g(xt),{"force-fallback":!0,"scroll-sensitivity":200,ref:"el",modelValue:w.value,"onUpdate:modelValue":p[1]||(p[1]=X=>w.value=X),onStart:q,onUpdate:C,onEnd:Oe,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(te,null,ie(w.value,(X,he)=>(t(),r("div",{key:he},[M("div",Nt,[M("span",null,x(X.verbose_name),1),a(de,null,{default:l(()=>[a(g(dt),{onClick:Ie=>ce(X)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[M("div",St,[a(W,{onClick:F},{default:l(()=>p[6]||(p[6]=[v("取消")])),_:1}),a(W,{type:"primary",onClick:ge},{default:l(()=>p[7]||(p[7]=[v("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),jt=Nl(qt,[["__scopeId","data-v-3859704e"]]),Tt={class:"dialog-footer"},Rt=ll({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(oe){const ne=$a(),B=el(oe,"showAllPassDia"),V=H(()=>ne.gmCry),j=i(),w=Xe({secret:null,time:3});i(""),i(!1);const L=async me=>{me.validate(async F=>{F&&(w.secret===V.value.key?(Be({title:"操作成功",message:"解密成功,"+w.time+"分钟后过期！",type:"success",duration:2e3}),ne.updateShowAllPass(!0),B.value=!1,ne.setShowAllPassTime(w.time*60*1e3),ae(j.value)):Be({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},ae=me=>{me&&me.resetFields()},h=()=>{B.value=!1,ae(j.value)};return(me,F)=>{const ee=c("el-input"),ce=c("el-form-item"),q=c("el-input-number"),Oe=c("el-form"),C=c("el-button"),De=c("el-dialog");return t(),u(De,{modelValue:B.value,"onUpdate:modelValue":F[3]||(F[3]=Z=>B.value=Z),title:"查看密码",width:"400"},{footer:l(()=>[M("div",Tt,[a(C,{onClick:h},{default:l(()=>F[5]||(F[5]=[v("取消")])),_:1}),a(C,{type:"primary",onClick:F[2]||(F[2]=Z=>L(j.value))},{default:l(()=>F[6]||(F[6]=[v(" 查看 ")])),_:1})])]),default:l(()=>[a(Oe,{ref_key:"allPassFormRef",ref:j,inline:!0,model:w,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(ce,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(ee,{type:"password",modelValue:w.secret,"onUpdate:modelValue":F[0]||(F[0]=Z=>w.secret=Z),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(ce,{label:"有效时间",prop:"time"},{default:l(()=>[a(q,{modelValue:w.time,"onUpdate:modelValue":F[1]||(F[1]=Z=>w.time=Z),min:1,step:1,max:30},{suffix:l(()=>F[4]||(F[4]=[M("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Et={style:{display:"flex","justify-content":"center"}},At=ll({__name:"ciDataqCode",props:Je(["qCodeContext"],{showqCodeDia:{},showqCodeDiaModifiers:{}}),emits:["update:showqCodeDia"],setup(oe){Ca();const ne=el(oe,"showqCodeDia"),B=oe;return(V,j)=>{const w=c("a-qrcode"),L=c("el-dialog");return t(),u(L,{modelValue:ne.value,"onUpdate:modelValue":j[0]||(j[0]=ae=>ne.value=ae),title:"实例二维码",width:"600"},{default:l(()=>[M("div",Et,[a(w,{value:JSON.stringify(B.qCodeContext),size:500},null,8,["value"])])]),_:1},8,["modelValue"])}}}),Lt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},zt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Yt={style:{width:"100%",overflow:"auto"}},Bt={class:"listItem"},Jt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Kt={style:{"margin-right":"5px"}},Ht={style:{float:"left"}},Wt={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Gt={key:0},Qt={key:1},Zt={key:0},Xt={key:1},eo={key:2},lo={key:3},ao={style:{flex:"auto"}},to=ll({__name:"ciDataFilter",props:Je(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:Je(["getCiData","updateFilterParam"],["update:showFilter"]),setup(oe,{expose:ne,emit:B}){const V=oe,j=el(oe,"showFilter"),w=i(""),L=i(""),ae=H(()=>w.value===""?ce.value:ce.value.filter(f=>f.verbose_name.includes(w.value)));function h(){j.value=!1}const me=f=>{Z.value.push(f)},F=f=>{let p=C.filterParams.indexOf(f);Z.value.splice(p,1)},ee=(f,p)=>{f==="instance_name"?C.instance_name="":Z.value.splice(p,1),Me(()=>{q("updateFilterParam",D.value)})},ce=H(()=>V.allModelField.filter(f=>!Z.value.includes(f)));i({});const q=B,Oe=i(""),C=Xe({filterParams:[],instance_name:""}),De=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"包含",description:"包含以,分隔"},{value:"not:in:",label:"不包含",description:"不包含以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"not:null",label:"非空",description:"正则表达式"}]),Z=i([]),D=H(()=>{let f=new Object;return C.filterParams.forEach(p=>{if(p.match==="null"||p.match==="not:null"){f[p.name]=p.match;return}if(p.value!==""){let z=null;p.value!==null?z=p.value:z="null",p.match==="="?f[p.name]=z:f[p.name]=p.match+z}}),C.instance_name!==""&&(f.instance_name=C.instance_name),f}),pe=()=>{console.log(D.value),q("updateFilterParam",D.value),console.log(D.value),Me(()=>{q("getCiData",{model:V.ciModelId,model_instance_group:V.currentNodeId})}),j.value=!1},ge=H(()=>{var f;return(f=C.filterParams)==null?void 0:f.map(p=>p.name)});Pl(()=>Z.value,f=>{var z;let p=new Array;(z=Z.value)==null||z.forEach((se,be)=>{var de;if(((de=ge.value)==null?void 0:de.indexOf(se.name))>>>-1)p.push({name:se.name,value:"",match:"=",label:se.verbose_name});else{let W=C.filterParams.findIndex(ue=>ue.name===se.name);p.push(C.filterParams[W])}}),C.filterParams=p},{deep:!0});const A=f=>{f&&(f.resetFields(),q("updateFilterParam",D.value),Me(()=>{q("getCiData",{model:V.ciModelId,model_instance_group:V.currentNodeId})}))};return ne({removeFilterParam:ee}),(f,p)=>{const z=c("el-text"),se=c("el-divider"),be=c("el-input"),de=c("el-icon"),W=c("el-form-item"),ue=c("el-button"),X=c("el-option"),he=c("el-select"),Ie=c("el-switch"),J=c("el-space"),al=c("el-form"),Ke=c("el-drawer");return t(),u(Ke,{modelValue:j.value,"onUpdate:modelValue":p[4]||(p[4]=I=>j.value=I),direction:"rtl",size:"50%","before-close":h},{header:l(()=>[a(z,{tag:"b"},{default:l(()=>p[5]||(p[5]=[v("筛选")])),_:1})]),default:l(()=>[M("div",Lt,[M("div",zt,[a(z,{tag:"b"},{default:l(()=>p[6]||(p[6]=[v("模型字段")])),_:1}),a(se),a(be,{modelValue:w.value,"onUpdate:modelValue":p[0]||(p[0]=I=>w.value=I),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:L},null,8,["modelValue"]),M("div",Yt,[(t(!0),r(te,null,ie(ae.value,(I,Se)=>(t(),r("div",{key:Se},[M("div",Bt,[M("span",null,x(I.verbose_name),1),a(de,null,{default:l(()=>[a(g(ha),{onClick:S=>me(I)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),M("div",Jt,[a(z,{tag:"b"},{default:l(()=>p[7]||(p[7]=[v("过滤器")])),_:1}),a(se),a(al,{ref_key:"filterFormRef",ref:Oe,model:C,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(J,{wrap:""},{default:l(()=>[a(W,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(be,{modelValue:C.instance_name,"onUpdate:modelValue":p[1]||(p[1]=I=>C.instance_name=I),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(te,null,ie(C.filterParams,(I,Se)=>(t(),u(W,{key:I.index,prop:"filterParams."+Se+".value"},{label:l(()=>[M("span",Kt,x(I.label),1),a(ue,{icon:g(ka),size:"small",circle:"",onClick:gl(S=>F(I),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(J,null,{default:l(()=>[a(he,{modelValue:I.match,"onUpdate:modelValue":S=>I.match=S,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(te,null,ie(De.value,S=>(t(),u(X,{key:S.value,label:S.label,value:S.value},{default:l(()=>[M("span",Ht,x(S.label),1),M("span",Wt,x(S.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),I.match==="null"||I.match==="not:null"?(t(),r("div",Gt)):(t(),r("div",Qt,[["enum"].indexOf(V.allModelFieldByNameObj[I.name].type)>>>-1?["model_ref"].indexOf(V.allModelFieldByNameObj[I.name].type)>>>-1?["boolean"].indexOf(V.allModelFieldByNameObj[I.name].type)>>>-1?(t(),r("div",lo,[a(be,{modelValue:I.value,"onUpdate:modelValue":S=>I.value=S,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",eo,[a(Ie,{modelValue:I.value,"onUpdate:modelValue":S=>I.value=S,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Xt,[a(he,{modelValue:I.value,"onUpdate:modelValue":S=>I.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ie(V.modelRefOptions[I.name],S=>(t(),u(X,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Zt,[a(he,{modelValue:I.value,"onUpdate:modelValue":S=>I.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ie(V.enumOptionObj[V.allModelFieldByNameObj[I.name].validation_rule],S=>(t(),u(X,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[M("div",ao,[a(ue,{onClick:p[2]||(p[2]=I=>A(Oe.value))},{default:l(()=>p[8]||(p[8]=[v("重置")])),_:1}),a(ue,{onClick:p[3]||(p[3]=I=>pe()),type:"primary"},{default:l(()=>p[9]||(p[9]=[v("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),oo=Nl(to,[["__scopeId","data-v-7192e7fd"]]),no={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},so={class:"table-header"},uo={class:"header-button-lf"},ro={class:"header-button-ri"},io={class:"flexJstart gap-1",style:{overflow:"auto"}},co={class:"text_class"},po={key:0,class:"text_class"},vo={key:1},fo={style:{display:"flex","justify-content":"space-between",width:"100%"}},mo={key:1,class:"requiredClass"},_o={key:0},yo={key:0},go={key:1},bo={key:0},wo={key:1},ko={key:0},ho={key:1},Co={key:0},xo={key:1},Vo={key:0},$o={key:0},Mo={key:0},Oo={key:1},Do={key:0},Uo={key:1},Fo={key:0},Io={key:1},Po={key:0},No={key:1},So={key:0},qo={key:1},jo={key:0},To={key:1},Ro={style:{flex:"auto"},class:"footerButtonClass"},Eo={key:0},Ao={key:1},Lo={key:0},zo={key:1},Yo={key:0},Bo={key:0},Jo={key:1},Ko={key:2},Ho={key:3},Wo={key:4},Go={key:5},Qo={key:6},Zo={key:7},Xo={key:8},en={key:9},ln={class:"dialog-footer"},an={class:"dialog-footer"},tn=ll({__name:"ciDataShow",props:Je(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:Je(["getTree"],["update:showTree"]),setup(oe,{expose:ne,emit:B}){const{proxy:V}=Il(),j=$a(),w=xa(),L=Ca(),ae=B,h=oe,me=el(oe,"showTree"),F=i([0]),ee=i(!1),ce=()=>{ee.value=!0},q=i(!0),Oe=()=>{q.value=!1,Me(()=>{q.value=!0})},C=i(""),De=()=>{ee.value=!1},Z=i(!1),D=H(()=>j.gmCry),pe=H(()=>j.showAllPass),ge=H(()=>j.showAllPassTime),A=async()=>{Z.value=!0},f=()=>{j.updateShowAllPass(!1),Be({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},p=s=>{j.setShowAllPassTime(s.totalMilliseconds)},z=()=>{Z.value=!1,j.updateShowAllPass(!1),j.setShowAllPassTime(0),Be({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},se=i(!1),be=()=>{X.value=!1,ze(de.value[0]),ue.value=""},de=i(),W=Xe({secret:null}),ue=i(""),X=i(!1),he=async(s,e)=>{s[0].validate(async d=>{d&&(W.secret===D.value.key?(ue.value=yl(D.value.key,D.value.mode,e),X.value=!0):(Be({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),X.value=!1,ue.value=""))})},Ie=i(1),J=i(10),al=i("default"),Ke=i(!1),I=()=>{xe({model:h.ciModelId,model_instance_group:h.currentNodeId})},Se=()=>{xe({model:h.ciModelId,model_instance_group:h.currentNodeId})},S=H(()=>Cl.value.map(s=>s.name)),tl=H(()=>fl.value.map(s=>s.name)),He=i(!1),ol=async()=>{(await V.$api.bulkDeleteCiModelInstance({instances:Ce.value})).status=="200"?(N({type:"success",message:"删除成功"}),El.value.clearSelection(),await xe({model:h.ciModelId,model_instance_group:h.currentNodeId})):N({type:"error",message:"删除失败"})},Ge=async s=>{s?await V.$api.exportCiData({model:h.ciModelId,fields:tl.value,instances:Ce.value}):await V.$api.exportCiData({model:h.ciModelId,fields:S.value,instances:Ce.value})},k=async()=>{let s=await V.$api.exportCiData({model:h.ciModelId});console.log(s)},b={multiple:!0,value:"id"},P=i(!1),Le=i([]),nl=H(()=>h.treeData[0].children[0].id),Sl=async()=>{var d;let s=[];(d=Le.value)==null||d.forEach(R=>{s.push(R[R.length-1])});let e=await V.$api.setCiDataToTree({instances:Ce.value,groups:s});e.status=="201"?(N({type:"success",message:"更新成功"}),xe({model:h.ciModelId,model_instance_group:h.currentNodeId}),Zl(),ae("getTree")):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}),Le.value=[],P.value=!1},bl=i(""),We=i(!1),T=i({}),qe=(s,e)=>{s?O.updateParams[e]="null":O.updateParams[e]=null},ql=()=>{il.value=!1,We.value=!0},il=i(!1),jl=()=>{il.value=!0,We.value=!0},cl=async()=>{let s=await V.$api.updateInstanceName();console.log(s),Be({title:"Success",message:"触发唯一标识更新~",type:"success"})},Tl=async()=>{let s=await V.$api.syncHosts();console.log(s),Be({title:"Success",message:"触发主机同步~",type:"success"})},re=s=>{var e;if(s!==void 0&&((e=Te.value[s])==null?void 0:e.field_type)==="string")return s==""||s==null?void 0:[{pattern:new RegExp(Te.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]};H(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(R=>{R.fields.forEach(y=>{var le;y.type==="string"&&y.validation_rule!==""&&y.validation_rule!==null&&(s["updateParams."+y.name]=[{pattern:new RegExp((le=Te.value[y.validation_rule])==null?void 0:le.rule),message:"不符合正则表达式",trigger:"blur"}])})}),s});const O=Xe({updateParams:{}}),Pe=i([]),Ue=()=>{const s=Object.keys(O.updateParams).length,e=`__temp_param_${s}`;Pe.value[s]=e,O.updateParams[e]=""},wl=(s,e)=>{console.log(e),O.updateParams[e]=void 0,delete O.updateParams[Pe.value[s]],Pe.value[s]=e},kl=(s,e)=>{Pe.value.splice(s,1),delete T.value[e],delete O.updateParams[e]},Wl=H(()=>{let s=new Object;for(let[e,d]of Object.entries(O.updateParams))d==="null"?s[e]=null:s[e]=d,ve.value.password.indexOf(e)!==-1&&(s[e]=Kl(D.value.key,D.value.mode,d));return s}),Ma=()=>{bl.value.validate(async s=>{if(s){let e;il.value?e=await V.$api.allUpdateCiModelInstance({update_user:L.state.username,fields:Wl.value,model:h.ciModelId,model_instance_group:h.currentNodeId,conditions:xl.value}):e=await V.$api.multipleUpdateCiModelInstance({update_user:L.state.username,instances:Ce.value,fields:Wl.value}),e.status=="200"?(N({type:"success",message:"更新成功"}),xe({model:h.ciModelId,model_instance_group:h.currentNodeId}),O.updateParams={},T.value={},Pe.value=[],We.value=!1):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else N({showClose:!0,message:"请输入正确内容.",type:"error"})})},Oa=H(()=>{var e,d;let s=new Array;return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(R=>{R.fields.forEach(y=>{let le=!1;y.name in O.updateParams&&(le=!0),s.push({value:y.name,label:y.verbose_name,disable:le})})}),s}),Gl=()=>{We.value=!1,O.updateParams={},T.value={},Pe.value=[]},Ql=i(!0),pl=s=>{Ql.value=s},hl=i(!0),G=i(!1),Rl=i(!1),Da=()=>{Rl.value=!0},Ua=async s=>{pl(!0);let e=await V.$api.updateCiModelInstance({update_user:L.state.username,...s});e.status=="200"?(N({type:"success",message:"更新成功"}),ke.value=!1,ze(Qe.value),await xe({model:h.ciModelId,model_instance_group:h.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},Fa=s=>!0,El=i(null),Ia=s=>s.id,Ce=i([]),Pa=s=>{Ce.value=s.map(e=>e.id)},Zl=()=>{Ce.value=[],El.value.clearSelection()},Cl=i([]),je=i({}),Na=H(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(R=>{R.fields.forEach(y=>{s[y.id]=y})}),s}),ye=H(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(R=>{R.fields.forEach(y=>{s[y.name]=y})}),s}),Xl=i(""),Sa=()=>{Xl.value.getHasConfigField()},ea=()=>{hl.value=!1,Me(()=>{hl.value=!0})},qa=s=>s.map(d=>d.id===nl.value).length>>0,Te=i({});i({});const ja=async(s=null)=>{(await V.$api.getValidationRules({...s,page:1,page_size:1e4})).data.results.forEach(d=>{Te.value[d.id]=d})},Al=H(()=>{var e,d;let s={};return(d=(e=je.value)==null?void 0:e.field_groups)==null||d.forEach(R=>{R.fields.forEach(y=>{if(y.type==="enum"){if(y.validation_rule===null)return;let le=JSON.parse(Te==null?void 0:Te.value[y==null?void 0:y.validation_rule].rule),Ze=[];Object.keys(le).forEach(ul=>{Ze.push({value:ul,label:le[ul]})}),s[y.validation_rule]=Ze}})}),s}),la=H(()=>{let s={};return je.value.field_groups.forEach(e=>{e.fields.forEach(d=>{if(d.type==="enum"){let R=JSON.parse(Te.value[d.validation_rule].rule),y={};Object.keys(R).forEach(le=>{y[le]=R[le]}),s[d.name]=y}})}),s}),vl=i({}),Ta=async(s,e)=>{let d=await V.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),R=[];d.data.results.forEach(y=>{R.push({value:y.id,label:y.instance_name})}),vl.value[e.name]=R},Ra=H(()=>{let s=new Object;for(let[e,d]of Object.entries(vl.value)){let R=new Object;d==null||d.forEach(y=>{R[y.value]=y}),s[e]=R}return s}),Ea=s=>{if(!(s==""||s==null))return[{pattern:new RegExp(Te.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]},Aa=()=>{for(const[s,e]of Object.entries(_))s!=="instance_name"&&delete _[s];je.value.field_groups.forEach(s=>{s.fields.forEach(e=>{_[e.name]=e.default})}),_.instance_name=null},fl=i([]),La=async()=>{var d;let s=await V.$api.getCiModel({},h.ciModelId);je.value=s.data;let e=[];(d=je.value.field_groups)==null||d.forEach(R=>{R.fields.forEach(y=>{e.push(y)})}),fl.value=e},ve=H(()=>{let s={enum:[],boolean:[],model_ref:[],password:[]};return fl.value.forEach(e=>{e.type==="enum"?s.enum.push(e.name):e.type==="boolean"?s.boolean.push(e.name):e.type==="model_ref"?s.model_ref.push(e.name):e.type==="password"&&s.password.push(e.name)}),s});Pl(()=>ve.value.model_ref,s=>{ve.value.model_ref.forEach(e=>{Ta(!0,{id:ye.value[e].ref_model,name:e})})},{deep:!0});const aa=i([]),ta=i(0),xl=i({}),oa=s=>{xl.value=s},na=H(()=>{let s=new Array;for(let[e,d]of Object.entries(xl.value))console.log(),e==="instance_name"?s.push({name:"唯一标识:"+d,field:e}):ve.value.model_ref.indexOf(e)!==-1?s.push({name:ye.value[e].verbose_name+":"+Ra.value[e][d].label,field:e}):ve.value.enum.indexOf(e)!==-1?(console.log(la.value),s.push({name:ye.value[e].verbose_name+":"+la.value[e][d],field:e})):s.push({name:ye.value[e].verbose_name+":"+d,field:e});return s}),za=async(s,e)=>{await C.value.removeFilterParam(s,e),Me(()=>{xe({model:h.ciModelId,model_instance_group:h.currentNodeId})})},xe=async s=>{var R;pl(!0);let e=new Array,d=await V.$api.getCiModelInstance({...s,page:Ie.value,page_size:J.value,...xl.value});ta.value=d.data.count,(R=d.data.results)==null||R.forEach(y=>{e.push({id:y.id,instance_group:y.instance_group,instance_name:y.instance_name,...y.fields})}),aa.value=e,pl(!1)};Va(async()=>{hl.value=!0,await ja(),pl(!1)});const ke=i(!1),Ya=()=>{G.value=!0,ke.value=!0,Ee.value=!0},Re=i({}),Vl=i({}),sa=(s,e=!1)=>{ke.value=!0,Ee.value=!1,G.value=e,Re.value=s,Me(()=>{Object.keys(s).forEach(d=>{d==="id"||d==="instance_group"||(ve.value.model_ref.indexOf(d)!==-1?s[d]!==null?_[d]=s[d].id:_[d]=s[d]:ve.value.password.indexOf(d)!==-1?(console.log("password"),pe.value?_[d]=yl(D.value.key,D.value.mode,s[d]):_[d]=s[d]):_[d]=s[d])}),Vl.value=JSON.parse(JSON.stringify(_))})},Ba=s=>{ke.value=!0,Ee.value=!0,G.value=!0,Re.value=s,Me(()=>{Object.keys(s).forEach(e=>{e==="id"||e==="instance_group"||(ve.value.model_ref.indexOf(e)!==-1?s[e]!==null?_[e]=s[e].id:_[e]=s[e]:ve.value.enum.indexOf(e)!==-1?_[e]=s[e].value:ve.value.password.indexOf(e)!==-1&&pe.value?_[e]=yl(D.value.key,D.value.mode,s[e]):_[e]=s[e])})}),Be({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},Qe=i(),_=Xe({instance_name:null}),ua=H(()=>{let s=Object.assign({},_);delete s.instance_name;for(let[e,d]of Object.entries(s))d!==null&&ve.value.password.indexOf(e)!==-1&&(s[e]=Kl(D.value.key,D.value.mode,d));return s}),da=H(()=>{let s=Object.assign({},sl.value);delete s.instance_name,console.log(ve.value);for(let[e,d]of Object.entries(sl.value))d!==null&&ve.value.password.indexOf(e)!==-1&&(s[e]=Kl(D.value.key,D.value.mode,d));return s}),Ee=i(!0),sl=i({}),ra=async(s,e=null)=>{s&&await s.validate(async(d,R)=>{if(d)if(Ee.value){console.log(ua.value);let y=await V.$api.addCiModelInstance({model:h.ciModelId,create_user:L.state.username,update_user:L.state.username,fields:ua.value,instance_name:_.instance_name,instance_group:[h.currentNodeId]});y.status=="201"?(N({type:"success",message:"添加成功"}),ke.value=!1,ze(s),await xe({model:h.ciModelId,model_instance_group:h.currentNodeId}),ae("getTree")):N({showClose:!0,message:"添加失败:"+JSON.stringify(y.data),type:"error"})}else{if(console.log(JSON.stringify(Vl.value)),console.log(JSON.stringify(_)),JSON.stringify(Vl.value)===JSON.stringify(_)){G.value=!1,ke.value=!1,ze(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}else{const Ze=Object.entries(Vl.value),ul=Object.entries(_),K=Ze.concat(ul).map(Ne=>JSON.stringify(Ne)),Ml=Array.from(new Set(K)).map(Ne=>JSON.parse(Ne));Ml.splice(0,Ze.length);const Q=Object.fromEntries(Ml);let Ol={};if(Object.keys(Q).forEach(Ne=>{Ol[Ne]=Q[Ne]}),sl.value=Ol,Object.keys(sl.value).length===0){G.value=!1,ke.value=!1,ze(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let y={id:Re.value.id,model:h.ciModelId,update_user:L.state.username};Object.keys(sl.value).indexOf("instance_name")===-1||(y.instance_name=sl.value.instance_name),y.fields=da.value,console.log(ve.value),console.log(y),console.log();let le=await V.$api.updateCiModelInstance(y);le.status=="200"?(N({type:"success",message:"更新成功"}),ke.value=!1,G.value=!1,ze(s),await xe({model:h.ciModelId,model_instance_group:h.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(le.data),type:"error"})}else console.log("error submit!",R),Be({title:"表单校验",message:"表单填写异常",type:"error"})})},Ja=s=>{if(G.value==!1&&Ee.value==!1){ke.value=!1;return}Hl.confirm("是否确认关闭?").then(()=>{s(),ze(Qe.value),ke.value=!1,G.value=!1}).catch(()=>{})},Ka=s=>{ze(s),ke.value=!1,G.value=!1},ia=(s=null)=>{Hl.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await V.$api.deleteCiModelInstance(Re.value.id)).status==204?(N({type:"success",message:"删除成功"}),await xe({model:h.ciModelId,model_instance_group:h.currentNodeId}),ze(Qe.value),ke.value=!1,G.value=!1,ae("getTree")):N({type:"error",message:"删除失败"})}).catch(()=>{N({type:"info",message:"取消删除"})})},ze=s=>{s&&(s.resetFields(),Re.value={})},$l=i("modelField"),Ha=(s,e)=>{console.log($l.value)};ne({getHasConfigField:Sa,getCiData:xe,initCiDataForm:Aa,getModelField:La,setLoading:pl,closeFilter:De,clearMultipleSelect:Zl,updateFilterParam:oa,reloadCiDataFilter:Oe});const Ll=i(!1),ca=i(""),Wa=s=>{Ll.value=!0,ca.value=s};return(s,e)=>{var ya,ga,ba;const d=c("el-button"),R=c("arrow-down"),y=c("el-icon"),le=c("el-dropdown-item"),Ze=c("el-dropdown-menu"),ul=c("el-dropdown"),K=c("el-tooltip"),Ml=c("vue-countdown"),Q=c("el-text"),Ol=c("el-tag"),Ne=c("el-table-column"),pa=c("el-link"),Ye=c("el-switch"),Ga=c("el-table"),Qa=c("el-pagination"),va=c("el-descriptions-item"),Za=c("el-descriptions"),Ve=c("el-space"),Ae=c("el-input"),we=c("el-form-item"),Xa=c("InfoFilled"),zl=c("el-input-number"),Yl=c("el-col"),fa=c("el-row"),Bl=c("el-form"),et=c("el-popover"),Dl=c("el-date-picker"),ml=c("el-option"),_l=c("el-select"),lt=c("el-collapse-item"),at=c("el-collapse"),Ul=c("el-tab-pane"),tt=c("el-tabs"),ot=c("el-drawer"),ma=c("el-dialog"),nt=c("el-cascader"),fe=rl("permission"),st=rl("loading"),ut=rl("copy"),_a=rl("throttle");return t(),r(te,null,[hl.value?(t(),r("div",no,[M("div",so,[M("div",uo,[me.value?(t(),u(d,{key:0,icon:g(rt),onClick:e[0]||(e[0]=n=>me.value=!1),size:"default"},null,8,["icon"])):(t(),u(d,{key:1,icon:g(it),onClick:e[1]||(e[1]=n=>me.value=!0),size:"default"},null,8,["icon"])),E((t(),u(d,{type:"primary",onClick:Ya},{default:l(()=>e[35]||(e[35]=[v("添加")])),_:1})),[[fe,`${(ya=g(w).name)==null?void 0:ya.replace("_info","")}:add`]]),E((t(),u(d,{disabled:!(Ce.value.length>>>0),onClick:e[2]||(e[2]=n=>P.value=!0)},{default:l(()=>e[36]||(e[36]=[v("转移")])),_:1},8,["disabled"])),[[fe,`${(ga=g(w).name)==null?void 0:ga.replace("_info","")}:edit`]]),E((t(),u(d,{disabled:!(Ce.value.length>>>0),onClick:ql},{default:l(()=>e[37]||(e[37]=[v("批量更新")])),_:1},8,["disabled"])),[[fe,`${(ba=g(w).name)==null?void 0:ba.replace("_info","")}:edit`]]),a(ul,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(Ze,null,{default:l(()=>{var n,Y,o,m,U;return[E((t(),u(le,{onClick:e[3]||(e[3]=_e=>jl())},{default:l(()=>e[39]||(e[39]=[v(" 更新所有 ")])),_:1})),[[fe,`${(n=g(w).name)==null?void 0:n.replace("_info","")}:update`]]),E((t(),u(le,{onClick:e[4]||(e[4]=_e=>cl())},{default:l(()=>e[40]||(e[40]=[v(" 更新唯一标识 ")])),_:1})),[[fe,`${(Y=g(w).name)==null?void 0:Y.replace("_info","")}:add`]]),E((t(),u(le,{onClick:e[5]||(e[5]=_e=>Tl())},{default:l(()=>e[41]||(e[41]=[v(" 触发同步 ")])),_:1})),[[fe,`${(o=g(w).name)==null?void 0:o.replace("_info","")}:add`]]),E((t(),r("div",null,[a(le,{disabled:!(Ce.value.length>>>0),onClick:e[6]||(e[6]=_e=>ol()),divided:""},{default:l(()=>e[42]||(e[42]=[v("批量删除")])),_:1},8,["disabled"])])),[[fe,`${(m=g(w).name)==null?void 0:m.replace("_info","")}:delete`]]),E((t(),r("div",null,[a(le,{disabled:!(Ce.value.length>>>0),onClick:e[7]||(e[7]=_e=>Ge(!1))},{default:l(()=>e[43]||(e[43]=[v("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(le,{disabled:!(Ce.value.length>>>0),onClick:e[8]||(e[8]=_e=>Ge(!0))},{default:l(()=>e[44]||(e[44]=[v("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(le,{onClick:e[9]||(e[9]=_e=>k())},{default:l(()=>e[45]||(e[45]=[v("导出所有")])),_:1})])),[[fe,`${(U=g(w).name)==null?void 0:U.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(d,{type:"primary"},{default:l(()=>[e[38]||(e[38]=v(" 更多操作")),a(y,{class:"el-icon--right"},{default:l(()=>[a(R)]),_:1})]),_:1})]),_:1})]),M("div",ro,[a(K,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(d,{icon:g(ct),circle:"",onClick:ea},null,8,["icon"])]),_:1}),pe.value?$("",!0):(t(),u(K,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var n;return[E(a(d,{icon:g(Jl),circle:"",onClick:A},null,8,["icon"]),[[fe,`${(n=g(w).name)==null?void 0:n.replace("_info","")}:showPassword`]])]}),_:1})),pe.value?(t(),u(K,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[46]||(e[46]=[M("span",null,[v("倒计时结束后自动隐藏密码"),M("br"),v("手动点击可立马隐藏")],-1)])),default:l(()=>[a(d,{circle:"",onClick:z},{default:l(()=>[a(Ml,{time:ge.value,onEnd:f,onProgress:p},{default:l(({totalSeconds:n})=>[v(x(n),1)]),_:1},8,["time"])]),_:1})]),_:1})):$("",!0),a(K,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(d,{icon:g(pt),circle:"",onClick:Da},null,8,["icon"])]),_:1}),a(K,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var n;return[E(a(d,{icon:g(vt),circle:"",onClick:e[10]||(e[10]=Y=>He.value=!0)},null,8,["icon"]),[[fe,`${(n=g(w).name)==null?void 0:n.replace("_info","")}:import`]])]}),_:1}),a(K,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(d,{icon:g(ft),circle:"",onClick:ce},null,8,["icon"])]),_:1})])]),E(M("div",io,[a(Q,{tag:"b"},{default:l(()=>e[47]||(e[47]=[v("过滤器")])),_:1}),(t(!0),r(te,null,ie(na.value,(n,Y)=>(t(),u(Ol,{key:n.name,closable:"",type:"primary",onClose:o=>za(n.field,Y)},{default:l(()=>[M("span",null,x(n.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Fl,na.value.length>>>0]]),E((t(),u(Ga,{ref_key:"ciDataTableRef",ref:El,data:aa.value,onSelectionChange:Pa,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":Ia},{default:l(()=>[a(Ne,{type:"selection",selectable:Fa,width:"55","reserve-selection":!0}),a(Ne,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(te,null,ie(Cl.value,(n,Y)=>(t(),u(Ne,{property:n.name,label:n.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120"},mt({_:2},[n.name==="mgmt_ip"?{name:"default",fn:l(o=>[a(pa,{href:`https://${o.row[n.name]}`,type:"primary",target:"_blank"},{default:l(()=>[v(x(o.row[n.name]),1)]),_:2},1032,["href"])]),key:"0"}:void 0,ve.value.boolean.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[E(a(Ye,{modelValue:o.row[n.name],"onUpdate:modelValue":U=>o.row[n.name]=U,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:U=>Ua({id:o.row.id,fields:{[n.name]:o.row[n.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[fe,{id:`${(m=g(w).name)==null?void 0:m.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,ve.value.enum.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[M("div",co,x((m=o.row[n.name])==null?void 0:m.label),1)]}),key:"2"}:void 0,ve.value.password.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m;return[pe.value?(t(),r("div",po,x(g(yl)(D.value.key,D.value.mode,o.row[n.name])),1)):(t(),r("div",vo,[((m=o.row[n.name])==null?void 0:m.length)>>0?(t(),u(Q,{key:0},{default:l(()=>e[48]||(e[48]=[v("******")])),_:1})):(t(),u(Q,{key:1}))]))]}),key:"3"}:void 0,ve.value.model_ref.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var m,U;return[M("div",{class:Fe({text_class:((m=o.row[n.name])==null?void 0:m.instance_name)>>0})},x((U=o.row[n.name])==null?void 0:U.instance_name),3)]}),key:"4"}:void 0]),1032,["property","label"]))),256)),a(Ne,{fixed:"right",width:"150",label:"操作"},{default:l(n=>[a(K,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(d,{link:"",type:"primary",icon:g(Jl),onClick:Y=>sa(n.row)},null,8,["icon","onClick"])]),_:2},1024),a(K,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var Y;return[E(a(d,{link:"",type:"primary",icon:g(_t),onClick:o=>sa(n.row,!0)},null,8,["icon","onClick"]),[[fe,`${(Y=g(w).name)==null?void 0:Y.replace("_info","")}:edit`]])]}),_:2},1024),a(K,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var Y;return[E(a(d,{link:"",type:"primary",icon:g(wa),onClick:o=>Ba(n.row)},null,8,["icon","onClick"]),[[fe,`${(Y=g(w).name)==null?void 0:Y.replace("_info","")}:edit`]])]}),_:2},1024),a(K,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>{var Y;return[E(a(d,{link:"",type:"primary",icon:g(yt),onClick:o=>Wa(n.row)},null,8,["icon","onClick"]),[[fe,`${(Y=g(w).name)==null?void 0:Y.replace("_info","")}:view`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[st,Ql.value]]),a(Qa,{"current-page":Ie.value,"onUpdate:currentPage":e[11]||(e[11]=n=>Ie.value=n),"page-size":J.value,"onUpdate:pageSize":e[12]||(e[12]=n=>J.value=n),"page-sizes":[10,20,50,100,200],size:al.value,disabled:Ke.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:ta.value,onSizeChange:I,onCurrentChange:Se,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[M("div",fo,[a(Q,null,{default:l(()=>[v("已选择 "+x(Ce.value.length)+" 条",1)]),_:1})])]),_:1},8,["current-page","page-size","size","disabled","total"])])):$("",!0),a(ot,{modelValue:ke.value,"onUpdate:modelValue":e[23]||(e[23]=n=>ke.value=n),class:"edit-drawer",direction:"rtl",size:"45%","before-close":Ja},{header:l(()=>[Ee.value?(t(),u(Q,{key:1,tag:"b"},{default:l(()=>e[49]||(e[49]=[v("实例信息 ")])),_:1})):(t(),u(Za,{key:0,title:"实例信息"},{default:l(()=>[a(va,{label:"唯一标识"},{default:l(()=>{var n;return[v(x((n=Re.value)==null?void 0:n.instance_name),1)]}),_:1}),a(va,{label:"所属分组"},{default:l(()=>{var n;return[(t(!0),r(te,null,ie((n=Re.value)==null?void 0:n.instance_group,(Y,o)=>(t(),u(Q,{key:o},{default:l(()=>[v(x(Y.group_path),1)]),_:2},1024))),128))]}),_:1})]),_:1}))]),default:l(()=>[a(tt,{modelValue:$l.value,"onUpdate:modelValue":e[18]||(e[18]=n=>$l.value=n),type:"card",class:"demo-tabs",onTabClick:Ha},{default:l(()=>[a(Ul,{label:"资产信息",name:"modelField"},{default:l(()=>[a(Bl,{ref_key:"ciDataFormRef",ref:Qe,style:{"max-width":"100%"},model:_,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[G.value?(t(),u(we,{key:0,prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>e[50]||(e[50]=[v("唯一标识")])),_:1}),a(K,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:1})]),_:1})]),default:l(()=>[G.value?(t(),u(Ae,{key:0,modelValue:_.instance_name,"onUpdate:modelValue":e[13]||(e[13]=n=>_.instance_name=n),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",mo,x(_.instance_name),1))]),_:1})):$("",!0),a(at,{modelValue:F.value,"onUpdate:modelValue":e[17]||(e[17]=n=>F.value=n)},{default:l(()=>[(t(!0),r(te,null,ie(je.value.field_groups,(n,Y)=>(t(),u(lt,{name:Y,key:Y},{title:l(()=>[a(Q,{tag:"b",size:"large"},{default:l(()=>[v(x(n.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(fa,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(te,null,ie(n.fields,(o,m)=>(t(),u(Yl,{span:12},{default:l(()=>[o.type==="string"?(t(),u(we,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:Ea(o.validation_rule)},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(Ae,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",_o,[_[o.name]!=null?(t(),r("div",yo,[o.name==="mgmt_ip"?(t(),u(pa,{key:0,href:`https://${_[o.name]}`,type:"primary",target:"_blank"},{default:l(()=>[v(x(_[o.name]),1)]),_:2},1032,["href"])):(t(),r("span",{key:1,class:Fe(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(_[o.name]),3))])):(t(),r("span",go,"--"))]))]),_:2},1032,["label","prop","required","rules"])):$("",!0),o.type==="json"?(t(),u(we,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),a(K,{placement:"right",effect:"dark"},{content:l(()=>e[51]||(e[51]=[v(" json类型字段"),M("br",null,null,-1),v("请输入json格式数据! ")])),default:l(()=>[a(y,null,{default:l(()=>[a(Xa)]),_:1})]),_:1}),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(Ae,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",bo,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",wo,"--"))]))]),_:2},1032,["label","prop","required"])):$("",!0),["text"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(Ae,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ko,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(_[o.name]),3)):(t(),r("span",ho,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),u(we,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[a(Ye,{modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!G.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):$("",!0),["float"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[o.unit!==null?(t(),u(Q,{key:0,tag:"b"},{default:l(()=>[v(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),u(Q,{key:1,tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),u(K,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(zl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Co,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",xo,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>{var U,_e;return[G.value?(t(),u(Ae,{key:1,modelValue:_[o.name],"onUpdate:modelValue":dl=>_[o.name]=dl,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Vo,[((U=_[o.name])==null?void 0:U.length)>>0?(t(),r("div",$o,[pe.value?(t(),r("span",Mo,x(g(yl)(D.value.key,D.value.mode,_[o.name])),1)):(t(),r("span",{key:1,class:Fe({requiredClass:o.required}),onMouseenter:e[15]||(e[15]=dl=>se.value=!0),onMouseleave:e[16]||(e[16]=dl=>se.value=!1)},[e[53]||(e[53]=v("******** ")),E((t(),u(et,{width:380,trigger:"click",onAfterLeave:be},{reference:l(()=>[a(y,null,{default:l(()=>[E(a(g(Jl),null,null,512),[[Fl,se.value&&!pe.value]])]),_:1})]),default:l(()=>[a(Bl,{ref_for:!0,ref_key:"passFormRef",ref:de,inline:!0,model:W,"require-asterisk-position":"right"},{default:l(()=>[a(fa,{align:"middle"},{default:l(()=>[a(Yl,{span:20},{default:l(()=>[a(we,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(Ae,{type:"password",modelValue:W.secret,"onUpdate:modelValue":e[14]||(e[14]=dl=>W.secret=dl),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(Yl,{span:2},{default:l(()=>[a(we,null,{default:l(()=>[a(d,{type:"primary",size:"small",onClick:dl=>he(de.value,_[o.name])},{default:l(()=>e[52]||(e[52]=[v("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),X.value?(t(),u(Q,{key:0,tag:"b"},{default:l(()=>[v("密码: "+x(ue.value)+" ",1),a(K,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(y,null,{default:l(()=>[E(a(g(wa),null,null,512),[[ut,ue.value]])]),_:1})]),_:1})]),_:1})):$("",!0)]),_:2},1024)),[[fe,`${(_e=g(w).name)==null?void 0:_e.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",Oo,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[o.unit!==null?(t(),u(Q,{key:0,tag:"b"},{default:l(()=>[v(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),u(Q,{key:1,tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),u(K,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(zl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Do,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",Uo,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(Dl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Fo,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},x(_[o.name]),3)):(t(),r("span",Io,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(Dl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Po,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},x(_[o.name]),3)):(t(),r("span",No,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>{var U;return[G.value?(t(),u(_l,{key:1,modelValue:_[o.name],"onUpdate:modelValue":_e=>_[o.name]=_e,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(te,null,ie(Al.value[o.validation_rule],_e=>(t(),u(ml,{key:_e.value,label:_e.label,value:_e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",So,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},x((U=Re.value[o.name])==null?void 0:U.label),3)):(t(),r("span",qo,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?$("",!0):(t(),u(we,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Ve,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),u(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(g($e))]),_:1})]),_:2},1032,["content"])):$("",!0)]),_:2},1024)]),default:l(()=>[G.value?(t(),u(_l,{key:1,modelValue:_[o.name],"onUpdate:modelValue":U=>_[o.name]=U,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(te,null,ie(vl.value[o.name],(U,_e)=>(t(),u(ml,{key:_e,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",jo,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(Re.value[o.name].instance_name),3)):(t(),r("span",To,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1}),Ee.value?$("",!0):(t(),u(Ul,{key:0,label:"监控信息",name:"monitor",disabled:""},{default:l(()=>e[54]||(e[54]=[v("111")])),_:1})),Ee.value?$("",!0):(t(),u(Ul,{key:1,label:"关联关系",name:"relations",disabled:""},{default:l(()=>e[55]||(e[55]=[v("222")])),_:1})),Ee.value?$("",!0):(t(),u(Ul,{key:2,label:"变更记录",name:"changelog",disabled:""},{default:l(()=>e[56]||(e[56]=[v("Role")])),_:1}))]),_:1},8,["modelValue"])]),footer:l(()=>{var n,Y,o,m;return[E(M("div",Ro,[a(d,{onClick:e[19]||(e[19]=U=>Ka(Qe.value))},{default:l(()=>e[57]||(e[57]=[v("取消")])),_:1}),Ee.value?(t(),r("div",Eo,[a(d,{type:"primary",onClick:e[20]||(e[20]=U=>ra(Qe.value))},{default:l(()=>e[58]||(e[58]=[v("添加")])),_:1})])):(t(),r("div",Ao,[G.value?(t(),r("div",Lo,[qa((n=Re.value)==null?void 0:n.instance_group)?E((t(),u(d,{key:0,type:"danger",onClick:ia},{default:l(()=>e[59]||(e[59]=[v("删除")])),_:1})),[[fe,`${(Y=g(w).name)==null?void 0:Y.replace("_info","")}:delete`]]):E((t(),u(K,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(d,{type:"danger",onClick:ia,disabled:""},{default:l(()=>e[60]||(e[60]=[v("删除")])),_:1})]),_:1})),[[fe,`${(o=g(w).name)==null?void 0:o.replace("_info","")}:delete`]]),E((t(),u(d,{type:"primary",onClick:e[21]||(e[21]=U=>ra(Qe.value))},{default:l(()=>e[61]||(e[61]=[v("保存")])),_:1})),[[_a]])])):(t(),r("div",zo,[E((t(),u(d,{type:"primary",onClick:e[22]||(e[22]=U=>G.value=!0)},{default:l(()=>e[62]||(e[62]=[v("编辑")])),_:1})),[[fe,`${(m=g(w).name)==null?void 0:m.replace("_info","")}:edit`]])]))]))],512),[[Fl,$l.value==="modelField"]])]}),_:1},8,["modelValue"]),a(ma,{modelValue:We.value,"onUpdate:modelValue":e[25]||(e[25]=n=>We.value=n),title:"批量更新",width:"500","before-close":Gl},{footer:l(()=>[M("div",ln,[a(d,{onClick:Gl},{default:l(()=>e[63]||(e[63]=[v("取消")])),_:1}),a(d,{onClick:e[24]||(e[24]=gl(n=>Ue(),["prevent"]))},{default:l(()=>e[64]||(e[64]=[v("新增字段")])),_:1}),E((t(),u(d,{type:"primary",onClick:Ma,disabled:!(Pe.value.length>0)},{default:l(()=>e[65]||(e[65]=[v("保存")])),_:1},8,["disabled"])),[[_a]])])]),default:l(()=>[a(Bl,{ref_key:"multipleFormRef",ref:bl,style:{"max-width":"1000px"},model:O,"label-width":"auto"},{default:l(()=>[(t(!0),r(te,null,ie(Pe.value,(n,Y)=>{var o;return t(),u(we,{key:`param-${n}`,label:"字段"+(Y+1),prop:`updateParams.${n}`,rules:re((o=ye.value[n])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(Ve,null,{default:l(()=>[a(_l,{"model-value":n.startsWith("__temp")?void 0:n,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:m=>wl(Y,m)},{default:l(()=>[(t(!0),r(te,null,ie(Oa.value,m=>(t(),u(ml,{key:m.value,label:m.label,value:m.value,disabled:m.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),n&&!n.startsWith("__temp")?(t(),r("div",Yo,[["text","json"].indexOf(ye.value[n].type)>>>-1?["string"].indexOf(ye.value[n].type)>>>-1?["enum"].indexOf(ye.value[n].type)>>>-1?["model_ref"].indexOf(ye.value[n].type)>>>-1?["boolean"].indexOf(ye.value[n].type)>>>-1?["integer"].indexOf(ye.value[n].type)>>>-1?["float"].indexOf(ye.value[n].type)>>>-1?["date"].indexOf(ye.value[n].type)>>>-1?["datetime"].indexOf(ye.value[n].type)>>>-1?(t(),r("div",en,[a(Ae,{modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Xo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>qe(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?$("",!0):(t(),u(Dl,{key:0,modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Zo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>qe(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?$("",!0):(t(),u(Dl,{key:0,modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Qo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>qe(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?$("",!0):(t(),u(zl,{key:0,modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Go,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>qe(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?$("",!0):(t(),u(Ae,{key:0,modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Wo,[a(Ye,{modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Ho,[a(_l,{modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(te,null,ie(vl.value[n],(m,U)=>(t(),u(ml,{key:U,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Ko,[a(_l,{modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ie(Al.value[ye.value[n].validation_rule],m=>(t(),u(ml,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Jo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>qe(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?$("",!0):(t(),u(Ae,{key:0,modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Bo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":m=>T.value[n]=m,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:m=>qe(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?$("",!0):(t(),u(Ae,{key:0,modelValue:O.updateParams[n],"onUpdate:modelValue":m=>O.updateParams[n]=m,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):$("",!0),a(d,{class:"mt-2",icon:g(gt),circle:"",onClick:gl(m=>kl(Y,n),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(ma,{modelValue:P.value,"onUpdate:modelValue":e[28]||(e[28]=n=>P.value=n),title:"实例组编辑",width:"500"},{footer:l(()=>[M("div",an,[a(d,{onClick:e[27]||(e[27]=n=>P.value=!1)},{default:l(()=>e[66]||(e[66]=[v("取消")])),_:1}),a(d,{type:"primary",onClick:Sl},{default:l(()=>e[67]||(e[67]=[v(" 提交更新 ")])),_:1})])]),default:l(()=>[a(nt,{options:h.treeData,props:b,clearable:"",modelValue:Le.value,"onUpdate:modelValue":e[26]||(e[26]=n=>Le.value=n),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),q.value?(t(),u(Ot,{key:1,isShowUpload:He.value,"onUpdate:isShowUpload":e[29]||(e[29]=n=>He.value=n),ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,onGetCiData:xe},null,8,["isShowUpload","ciModelId","currentNodeId"])):$("",!0),q.value?(t(),u(oo,{key:2,ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,allModelFieldByNameObj:ye.value,enumOptionObj:Al.value,validationRulesObj:Te.value,allModelField:fl.value,modelRefOptions:vl.value,showFilter:ee.value,"onUpdate:showFilter":e[30]||(e[30]=n=>ee.value=n),onUpdateFilterParam:oa,onGetCiData:xe,ref_key:"ciDataFilterRef",ref:C},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):$("",!0),a(jt,{ciModelId:h.ciModelId,allModelField:fl.value,allModelFieldInfo:Na.value,isShowTableCol:Rl.value,"onUpdate:isShowTableCol":e[31]||(e[31]=n=>Rl.value=n),hasConfigField:Cl.value,"onUpdate:hasConfigField":e[32]||(e[32]=n=>Cl.value=n),onReloadTable:ea,ref_key:"ciDataTableColRef",ref:Xl},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(Rt,{showAllPassDia:Z.value,"onUpdate:showAllPassDia":e[33]||(e[33]=n=>Z.value=n)},null,8,["showAllPassDia"]),a(At,{qCodeContext:ca.value,showqCodeDia:Ll.value,"onUpdate:showqCodeDia":e[34]||(e[34]=n=>Ll.value=n)},null,8,["qCodeContext","showqCodeDia"])],64)}}}),on=Nl(tn,[["__scopeId","data-v-b5584b06"]]),nn=bt("ci",()=>{const oe=i([]),ne=Xe({filterParams:[]});i([]);const B=i([]);return i({}),{setFilterList:L=>{console.log(L),B.value=L,console.log(B.value)},saveFilterParams:L=>{console.log(L),ne.filterParams=L},setModelList:L=>{oe.value=L}}},{persist:!0}),sn={class:"card ci_data_tree"},un={class:"custom-tree-node"},dn={class:"table-box"},rn=ll({__name:"cidataView",setup(oe){const ne=xa(),{proxy:B}=Il(),V=i(!0),j=nn(),w=i(!1);i(""),i(!1);const L=i(),ae=i([]),h=i("");Pl(h,k=>{D.value.filter(k)});const me=(k,b)=>k?b.label.toLowerCase().includes(k.toLowerCase()):!0,F=k=>!(k.level>He.value-1||k.label==="空闲池"),ee=async()=>{w.value=!0;let k=await B.$api.getCiModelTree({model:q.value});console.log(k),ae.value=[k.data],Me(()=>{ge.value===1&&(D.value.setCurrentKey(k.data.id),ge.value=D.value.getCurrentKey())}),w.value=!1},ce=i([]),q=i(""),Oe=async()=>{let k=await B.$api.getCiModel();ce.value=k.data.results,j.setModelList(ce.value),q.value=ce.value.find(b=>b.name==="hosts").id};H(()=>{let k={};return ce.value.forEach(b=>{k[b.id]=b}),k});const C=i(""),De=async()=>{ge.value=1,console.log(q.value),await ee(),await C.value.closeFilter(),await C.value.updateFilterParam({}),await C.value.clearMultipleSelect(),C.value.reloadCiDataFilter(),await C.value.setLoading(!0),await C.value.getModelField(),await C.value.getHasConfigField(),await C.value.setLoading(!1),await C.value.initCiDataForm(),await C.value.getCiData({model:q.value,model_instance_group:ge.value})};Va(async()=>{console.log(123),await Oe(),await ee(),C.value.setLoading(!0),await C.value.getModelField(),await C.value.getHasConfigField(),await C.value.setLoading(!1),await C.value.initCiDataForm(),await C.value.getCiData({model:q.value,model_instance_group:D.value.getCurrentKey()})});const Z=k=>k.built_in?!1:k.children?!(k.children.length>>>0):!0,D=i(),pe=i(),ge=i(1),A=i(!1),f=i(100),p=(k,b)=>{ue.value=!1;let P=f.value++;D.value.append({id:P,label:"新建子目录",level:b.level+1,parent:b.id,model:q.value},k),D.value.setCurrentKey(P),de.value=P,Me(()=>{pe.value.focus()})},z=(k,b)=>{let P=f.value++;ue.value=!1,D.value.insertAfter({id:P,label:"新建目录",level:b.level,parent:k.parent.data.id,model:q.value},k),D.value.setCurrentKey(P),de.value=P,Me(()=>{pe.value.focus()})},se=()=>{ge.value=D.value.getCurrentKey(),C.value.clearMultipleSelect(),C.value.setLoading(!0),C.value.getCiData({model:q.value,model_instance_group:D.value.getCurrentKey()}),C.value.setLoading(!0)},be=k=>{A.value=!A.value,k.isShowEdit=A.value},de=i(99999),W=i(""),ue=i(!0),X=k=>{ue.value=!0,console.log(k),W.value=k.label,de.value=k.id,Me(()=>{pe.value.focus()})},he=async(k,b)=>{if(de.value=99999,!W.value)N.warning("名称不可为空"),D.value.remove(b);else if(ue.value){if(W.value==b.label)return!1;{let P=await B.$api.updateCiModelTree({id:b.id,label:W.value});P.status=="200"?(N({type:"success",message:"更新成功"}),b.label=W.value,ee(),W.value=""):N({showClose:!0,message:"更新失败:"+JSON.stringify(P.data),type:"error"}),console.log(b)}}else{b.label=W.value,console.log(b);let P=await B.$api.addCiModelTree(b);P.status=="201"?(N({type:"success",message:"添加成功"}),ee(),W.value=""):(N({showClose:!0,message:"添加失败:"+JSON.stringify(P.data),type:"error"}),D.value.remove(b))}},Ie=k=>{k&&Hl.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await B.$api.deleteCiModelTree(k.data.id)).status==200?(N({type:"success",message:"删除成功"}),await ee()):N({type:"error",message:"删除失败"})}).catch(()=>{})},J=i(""),al=(k,b)=>{J.value=k,console.log(J.value)},Ke=(k,b,P)=>{},I=(k,b,P)=>{},Se=(k,b,P)=>{},S=async(k,b,P,Le)=>{if(b.data.id===k.data.id)return;let nl=await B.$api.updateCiModelTree({id:k.data.id,target_id:b.data.id,position:P});nl.status=="200"?(N({type:"success",message:"更新排序成功"}),ee()):N({showClose:!0,message:"更新排序失败:"+JSON.stringify(nl.data),type:"error"})},tl=(k,b,P,Le)=>{},He=i(5),ol=(k,b,P)=>b.data.built_in?!1:P!=="inner",Ge=k=>!k.data.built_in;return(k,b)=>{const P=c("el-text"),Le=c("el-col"),nl=c("el-option"),Sl=c("el-select"),bl=c("el-row"),We=c("el-divider"),T=c("el-input"),qe=c("a-menu-item"),ql=c("a-menu"),il=c("a-dropdown"),jl=c("el-space"),cl=rl("permission"),Tl=rl("loading");return t(),r(te,null,[E(M("div",sn,[a(bl,{align:"middle",justify:"start"},{default:l(()=>[a(Le,{span:8},{default:l(()=>[a(P,{tag:"b"},{default:l(()=>b[7]||(b[7]=[v("实例树")])),_:1})]),_:1}),a(Le,{span:14},{default:l(()=>[a(Sl,{modelValue:q.value,"onUpdate:modelValue":b[0]||(b[0]=re=>q.value=re),placeholder:"Select",onChange:b[1]||(b[1]=re=>De())},{default:l(()=>[(t(!0),r(te,null,ie(ce.value,re=>(t(),u(nl,{key:re.id,label:re.verbose_name,value:re.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(We),a(T,{modelValue:h.value,"onUpdate:modelValue":b[2]||(b[2]=re=>h.value=re),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),E((t(),u(g(Ct),{style:{"max-width":"280px",height:"auto"},"allow-drop":ol,"allow-drag":Ge,data:ae.value,draggable:!0,"default-expand-all":"","node-key":"id",onNodeDragStart:al,onNodeDragEnter:Ke,onNodeDragLeave:I,onNodeDragOver:Se,onNodeDragEnd:S,onNodeDrop:tl,"highlight-current":!0,"current-node-key":ge.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:D,onNodeClick:se,"filter-node-method":me},{default:l(({node:re,data:O})=>{var Pe;return[M("div",un,[de.value===O.id?(t(),u(T,{key:0,modelValue:W.value,"onUpdate:modelValue":b[3]||(b[3]=Ue=>W.value=Ue),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:pe,onBlur:Ue=>he(Ue,O),onKeyup:b[4]||(b[4]=wt(Ue=>Ue.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),u(P,{key:1,size:"default"},{default:l(()=>[v(x(re.label),1),a(P,{size:"small"},{default:l(()=>[v("("+x(O.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),E((t(),r("div",{class:Fe(["actionClass",{is_show_action:re.isShowEdit}])},[a(jl,null,{default:l(()=>[O.built_in?$("",!0):(t(),u(g(kt),{key:0,onClick:gl(Ue=>X(O),["stop"])},null,8,["onClick"])),a(il,{trigger:["click"],ref_key:"aDropdownRef",ref:L,onOpenChange:Ue=>be(re)},{overlay:l(()=>[a(ql,null,{default:l(()=>{var Ue,wl;return[E((t(),r("div",null,[O.level!==1?(t(),u(qe,{key:"0",onClick:kl=>z(re,O)},{default:l(()=>b[8]||(b[8]=[v(" 添加同级节点 ")])),_:2},1032,["onClick"])):$("",!0),F(O)?(t(),u(qe,{key:"1",onClick:kl=>p(re,O)},{default:l(()=>b[9]||(b[9]=[v(" 添加子节点 ")])),_:2},1032,["onClick"])):$("",!0)])),[[cl,`${(Ue=g(ne).name)==null?void 0:Ue.replace("_info","")}:add`]]),E((t(),r("div",null,[Z(O)?(t(),u(qe,{key:"2",onClick:kl=>Ie(re)},{default:l(()=>b[10]||(b[10]=[v(" 删除节点 ")])),_:2},1032,["onClick"])):$("",!0)])),[[cl,`${(wl=g(ne).name)==null?void 0:wl.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(g(ht),{onClick:b[5]||(b[5]=gl(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[cl,`${(Pe=g(ne).name)==null?void 0:Pe.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[Tl,w.value]])],512),[[Fl,V.value]]),M("div",dn,[a(on,{ciModelId:q.value,treeData:ae.value,currentNodeId:ge.value,ref_key:"ciDataShowRef",ref:C,onGetTree:ee,showTree:V.value,"onUpdate:showTree":b[6]||(b[6]=re=>V.value=re)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),mn=Nl(rn,[["__scopeId","data-v-c3cc4c42"]]);export{mn as default};
