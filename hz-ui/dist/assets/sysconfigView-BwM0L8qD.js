import{d as h,u as w,M as S,c as V,r as C,aN as E,e as c,o as k,f as x,g as s,w as r,h as $,t as I,bo as D,cn as R,co as N,c4 as y,k as K}from"./index-PyXmV4Ip.js";import{u as B}from"./config-M4pnh6si.js";const n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function T(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}let f;const L=new Uint8Array(16);function M(){if(!f){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");f=crypto.getRandomValues.bind(crypto)}return f(L)}const j=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),v={randomUUID:j};function z(e,t,l){var a;if(v.randomUUID&&!e)return v.randomUUID();e=e||{};const o=e.random??((a=e.rng)==null?void 0:a.call(e))??M();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,T(o)}const A={class:"card"},G={style:{"margin-right":"20px"}},H=h({__name:"securityConfig",setup(e){const{proxy:t}=K();w();const l=B(),o=S(()=>l.gmCry),a=V({key:"",region:"",date:""}),i=C({}),p=async()=>{let u=await t.$api.getSysConfig({param_name:"secret_key"});i.value=u.data.results[0]},_=async()=>{let u=z().replace(/-/g,"").slice(0,16);const b=N.service({lock:!0,text:"更新中...",background:"rgba(0, 0, 0, 0.7)"});let m=await t.$api.updateSysConfig({id:i.value.id,param_name:"secret_key",param_value:u});if(m.status=="200"){console.log(`旧密钥：${o.value.key};新密钥：${m.data.param_value}`);let d=await t.$api.reEncrypt({},3e5);d.status=="204"||d.status=="200"?y({title:"Success",message:"数据重新加密成功~",type:"success",duration:3e3}):(y({title:"Error",message:"数据重新加密失败！",type:"error"}),console.log("数据重新加密失败"));let g=await t.$api.getSysConfig({params:"gm"});l.setGmCry(g.data)}else y({title:"Error",message:"密钥更新失败！",type:"error",duration:3e3}),console.log("更新密钥失败");setTimeout(()=>{b.close()},2e3)};return E(()=>{p()}),(u,b)=>{const m=c("el-button"),d=c("el-tooltip"),g=c("el-form-item"),U=c("el-form");return k(),x("div",A,[s(U,{model:a,class:"demo-form-inline"},{default:r(()=>[s(g,{label:"密码密钥"},{default:r(()=>[$("span",G,I(o.value.key),1),s(d,{class:"box-item",effect:"dark",content:"更新密钥",placement:"top"},{default:r(()=>[s(m,{size:"small",onClick:_,type:"warning",icon:D(R),circle:""},null,8,["icon"])]),_:1})]),_:1})]),_:1},8,["model"])])}}}),q={class:"card"},O=h({__name:"sysconfigView",setup(e){w();const t=C("security"),l=(o,a)=>{console.log(o,a)};return(o,a)=>{const i=c("el-tab-pane"),p=c("el-tabs");return k(),x("div",q,[s(p,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=_=>t.value=_),class:"demo-tabs",onTabClick:l},{default:r(()=>[s(i,{label:"安全参数",name:"security"},{default:r(()=>[s(H)]),_:1})]),_:1},8,["modelValue"])])}}});export{O as default};
