import{d as te,b as ae,u as se,r as d,M as oe,c as ne,aN as re,e as n,b3 as ue,o as c,f as m,h as k,bO as D,bo as b,O as g,w as s,j as v,g as a,F as x,b1 as V,t as A,c0 as ie,c1 as de,aD as ce,bV as pe,c4 as _,k as _e}from"./index-D4V34ywu.js";const fe={class:"card"},me={class:"table-header"},be={class:"header-button-lf"},ge={class:"flexJstart gap-5"},ve={class:"flexJstart gap-5"},ke=te({__name:"userGroupView",setup(ye){const C=ae(),{proxy:f}=_e();se();const h=d([]),$=d(!1),p=d(!1),R=d(null),G=d([]),E=d("add");oe(()=>{let t=new Object;return G.value.forEach(e=>{t[e.id]=e}),t});const o=ne({group_name:"",role_ids:[],user_ids:[]}),B=t=>{t&&t.resetFields()},q=async()=>{let t=await f.$api.getRole();G.value=t.data.results},F=d([]),L=async()=>{let t=await f.$api.user();F.value=t.data.results},y=async()=>{let t=await f.$api.getUserGroup();h.value=t.data.results,console.log(h.value)},z=d(null),N=()=>{p.value=!1},H=()=>{p.value=!0},O=d({}),T=d(!0),K=t=>{O.value=t,console.log(t),p.value=!0,T.value=!1,ce(()=>{Object.keys(o).forEach(e=>{["user_ids"].includes(e)?o[e]=t.users.map(i=>i.id):["role_ids"].includes(e)?o[e]=t.roles.map(i=>i.id):o[e]=t[e]})}),console.log(o)},P=t=>{pe.confirm("是否确认删除?","删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await f.$api.deleteUserGroup(t)).status==204?(_({type:"success",message:"删除成功"}),await y()):_({type:"error",message:"删除失败"})}).catch(()=>{_({type:"info",message:"取消删除"})})},Q=async t=>{await t.validate(async(e,i)=>{if(e)if(T.value){let r=await f.$api.addUserGroup({...o});r.status=="201"?(_({type:"success",message:"添加成功"}),p.value=!1,B(t),await y()):_({showClose:!0,message:"添加失败:"+JSON.stringify(r.data),type:"error"})}else{let r=await f.$api.updateUserGroup({id:O.value.id,...o});r.status=="200"?(_({type:"success",message:"更新成功"}),p.value=!1,B(t),await y()):_({showClose:!0,message:"更新失败:"+JSON.stringify(r.data),type:"error"})}})};return re(async()=>{await q(),await L(),await y()}),(t,e)=>{var S;const i=n("el-button"),r=n("el-table-column"),j=n("el-tag"),I=n("el-tooltip"),W=n("el-table"),X=n("el-input"),w=n("el-form-item"),J=n("el-option"),M=n("el-select"),Y=n("el-row"),Z=n("el-form"),ee=n("el-dialog"),U=ue("permission");return c(),m("div",fe,[k("div",me,[k("div",be,[D((c(),g(i,{type:"primary",onClick:H},{default:s(()=>e[5]||(e[5]=[v("添加")])),_:1})),[[U,`${(S=b(C).name)==null?void 0:S.replace("_info","")}:add`]])])]),a(W,{ref_key:"multipleTableRef",ref:z,data:h.value,style:{width:"100%"},border:""},{default:s(()=>[a(r,{property:"group_name",label:"用户组名",sortable:"custom"}),a(r,{property:"user_count",label:"关联用户数"}),a(r,{property:"users",label:"用户列表"},{default:s(l=>[k("div",ge,[(c(!0),m(x,null,V(l.row.users,u=>(c(),g(j,{key:u},{default:s(()=>[v(A(u.username),1)]),_:2},1024))),128))])]),_:1}),a(r,{property:"roles",label:"角色列表"},{default:s(l=>[k("div",ve,[(c(!0),m(x,null,V(l.row.roles,u=>(c(),g(j,{key:u},{default:s(()=>[v(A(u.role),1)]),_:2},1024))),128))])]),_:1}),a(r,{fixed:"right",width:"100",label:"操作"},{default:s(l=>[a(I,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:s(()=>{var u;return[D(a(i,{disabled:l.row.group_name==="系统管理组",link:"",type:"primary",icon:b(ie),onClick:le=>K(l.row)},null,8,["disabled","icon","onClick"]),[[U,`${(u=b(C).name)==null?void 0:u.replace("_info","")}:edit`]])]}),_:2},1024),a(I,{class:"box-item",effect:"dark",content:"删除",placement:"top"},{default:s(()=>{var u;return[D(a(i,{link:"",disabled:l.row.group_name==="系统管理组",type:"danger",icon:b(de),onClick:le=>P(l.row.id)},null,8,["disabled","icon","onClick"]),[[U,`${(u=b(C).name)==null?void 0:u.replace("_info","")}:delete`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"]),a(ee,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),title:E.value=="add"?"新增用户组":"编辑用户组",width:"45%","before-close":N},{default:s(()=>[a(Z,{inline:!0,model:o,class:"demo-form-inline","label-position":"right",ref_key:"userGroupFrom",ref:R,"status-icon":""},{default:s(()=>[a(w,{label:"用户组名称",prop:"group_name",rules:[{required:!0}]},{default:s(()=>[a(X,{modelValue:o.group_name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.group_name=l),placeholder:"",clearable:"",disabled:$.value,style:{width:"220px"}},null,8,["modelValue","disabled"])]),_:1}),a(w,{label:"关联用户",prop:"user_ids"},{default:s(()=>[a(M,{modelValue:o.user_ids,"onUpdate:modelValue":e[1]||(e[1]=l=>o.user_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:$.value,style:{width:"220px"}},{default:s(()=>[(c(!0),m(x,null,V(F.value,l=>(c(),g(J,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(w,{label:"关联角色",prop:"role_ids"},{default:s(()=>[a(M,{modelValue:o.role_ids,"onUpdate:modelValue":e[2]||(e[2]=l=>o.role_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:$.value,style:{width:"220px"}},{default:s(()=>[(c(!0),m(x,null,V(G.value,l=>(c(),g(J,{key:l.id,label:l.role,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(Y,{style:{"justify-content":"space-around"}},{default:s(()=>[a(w,null,{default:s(()=>[a(i,{onClick:N},{default:s(()=>e[6]||(e[6]=[v("取消")])),_:1}),a(i,{type:"primary",onClick:e[3]||(e[3]=l=>Q(R.value))},{default:s(()=>e[7]||(e[7]=[v(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ke as default};
