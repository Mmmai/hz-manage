import{d as M,ao as O,g as U,ap as q,r as y,z as H,e as w,D as d,o as f,w as o,b as i,k as s,i as c,aA as K,s as W,_ as z}from"./index-Gch8CQn_.js";const G={class:"my-header"},Q=["id"],j=["innerHTML"],J={class:"dialog-footer"},P=M({__name:"nearLogCom",props:O(["url","highlightKey"],{isShow:{},isShowModifiers:{}}),emits:["update:isShow"],setup(x,{expose:T}){const{proxy:u}=U(),N=(t,e)=>{if(e){const l=new RegExp(e,"gi");return t.replace(l,'<span style="background-color: #ff9b2d;">$&</span>')}else return t},L=q(x,"isShow"),R=x,_=y(10),b=y(10),$=async()=>{_.value+=10,await k(m.value),v(u.$refs.nearLogRef,0)},C=async()=>{b.value+=10,await k(m.value),v(u.$refs.nearLogRef,p.value.length)},A=()=>{_.value=10,b.value=10,h.value=0},p=y([]),m=y(""),k=async t=>{let l=(await u.$api.lokiNearQuery({url:R.url,targetLog:t,limit:_.value,direction:"backward"})).data.queryResult,n=(await u.$api.lokiNearQuery({url:R.url,targetLog:t,limit:b.value,direction:"forward"})).data.queryResult;p.value=[...l,...n]},S=async t=>{m.value=t,L.value=!0,await k(t),W(()=>{v(u.$refs.nearLogRef,h.value)})};function v(t,e,l=!0){const a=t.$el.querySelectorAll(".el-table__body tbody .el-table__row");let n=0;for(let g=0;g<a.length&&g!==e;g++)if(n+=a[g].offsetHeight,!l){n*=e-2;break}t.scrollTo(0,n)}const h=y(0);H(()=>p.value,t=>{h.value=t.findIndex(e=>e.lokiTime===m.value.lokiTime)});const F=()=>{v(u.$refs.nearLogRef,h.value)},B=({row:t})=>{if(t.lokiTime==m.value.lokiTime)return"highlight-class"},I=t=>{let e=[];t.forEach(a=>{e.push(`${a.logTime},${a.level},${a.logLine}
`)});let l=u.$commonFunc.getCurrentTimeString("-","-","_",":",":");console.log(l),u.$commonFunc.downloadArray(`export-log-${l}`,e)};return T({showNearLog:S}),(t,e)=>{const l=w("el-button"),a=w("el-table-column"),n=w("el-tag"),g=w("el-table"),V=w("el-dialog");return f(),d(V,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=r=>L.value=r),title:"日志上下文",width:"95%",top:"9vh",onClose:A},{header:o(({close:r,titleId:D,titleClass:E})=>[c("div",G,[c("div",{id:D,class:K(E),style:{display:"flex","justify-content":"space-between"}},[e[3]||(e[3]=c("span",null,"日志上下文",-1)),i(l,{type:"primary",onClick:e[0]||(e[0]=X=>I(p.value)),style:{"margin-right":"20px"}},{default:o(()=>e[2]||(e[2]=[s(" 下载日志 ")])),_:1})],10,Q)])]),footer:o(()=>[c("div",J,[i(l,{type:"primary",onClick:$},{default:o(()=>e[10]||(e[10]=[s("往前翻")])),_:1}),i(l,{type:"primary",onClick:C},{default:o(()=>e[11]||(e[11]=[s("往后翻")])),_:1}),i(l,{type:"primary",onClick:F},{default:o(()=>e[12]||(e[12]=[s("跳转到分析行")])),_:1})])]),default:o(()=>[i(g,{data:p.value,ref:"nearLogRef",style:{width:"100%"},height:"600","row-class-name":B},{default:o(()=>[i(a,{type:"index",width:"50"}),i(a,{label:"日志时间",prop:"logTime",width:"200px"}),i(a,{label:"日志等级",prop:"level",width:"100px"},{default:o(r=>[r.row.level=="DEBUG"?(f(),d(n,{key:0,type:"primary",effect:"light"},{default:o(()=>e[4]||(e[4]=[s("DEBUG")])),_:1})):r.row.level=="INFO"?(f(),d(n,{key:1,type:"success",effect:"light"},{default:o(()=>e[5]||(e[5]=[s("INFO")])),_:1})):r.row.level=="WARN"?(f(),d(n,{key:2,type:"warning",effect:"light"},{default:o(()=>e[6]||(e[6]=[s("WARN")])),_:1})):r.row.level=="ERROR"?(f(),d(n,{key:3,type:"danger",effect:"light"},{default:o(()=>e[7]||(e[7]=[s("ERROR")])),_:1})):r.row.level=="FATAL"?(f(),d(n,{key:4,type:"danger",effect:"light"},{default:o(()=>e[8]||(e[8]=[s("FATAL")])),_:1})):(f(),d(n,{key:5,type:"info",effect:"light"},{default:o(()=>e[9]||(e[9]=[s("UNKNOWN")])),_:1}))]),_:1}),i(a,{label:"日志内容"},{default:o(({row:r})=>[c("span",{innerHTML:N(r.logLine,R.highlightKey)},null,8,j)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}}),Z=z(P,[["__scopeId","data-v-d830aa43"]]);export{Z as n};
