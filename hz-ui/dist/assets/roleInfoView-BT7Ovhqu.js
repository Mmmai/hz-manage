import{d as j,j as Z,x as G,g as H,r as d,a as K,v as L,z as Q,h as o,c as W,o as C,b as v,f as t,w as s,m as X,cM as Y,q as R,t as N,B as ee,k as te,b_ as i,aP as T,_ as ae}from"./index-Cm0tF2Sj.js";import{T as se}from"./treeTransfer-0YCCccR7.js";const le={class:"divVertical"},oe={class:"card flexJstart gap-5",style:{height:"50px",flex:"none"}},ne={class:"card",style:{flex:"none"}},re={class:"card"},ie={style:{"text-align":"center"}},de=j({__name:"roleInfoView",setup(ue){const B=Z(),I=G(),{proxy:u}=H(),c=d(!1),S=d(!1),m=d(null),y=d("menuPermission"),b=d(),J=()=>{},V=()=>{B.push({path:"/settings/role"})},l=K({role:"",role_name:""}),z={role:[{required:!0,message:"请输入角色英文名",trigger:"blur"},{validator:(a,e,r)=>{/^[a-zA-Z]+$/.test(e)?r():r(new Error("请输入纯英文"))}}],role_name:[{required:!0,message:"请输入角色中文名称",trigger:"blur"}]},p=L(()=>l.role==="sysadmin"),w=d([]),_=d([]),f=async()=>{let a=await u.$api.getRoleInfo(m.value);a.status==200&&(l.role=a.data.role,l.role_name=a.data.role_name,_.value=a.data.rolePermission.map(e=>e))},g=async()=>{let a=await u.$api.getPermissionToRole();w.value=a.data.results},A=async()=>{b.value.validate(async a=>{if(a)if(c){let e=await u.$api.roleadd({...l,rolePermission:_.value});e.status==201?(i({type:"success",message:"创建成功"}),V()):i({type:"error",message:`更新失败: ${JSON.stringify(e.data)}`})}else{let e=await u.$api.roleupdate({id:m.value,...l});e.status==200?(i({type:"success",message:"更新成功"}),f()):i({type:"error",message:`更新失败: ${JSON.stringify(e.data)}`})}})},D=(a,e,r)=>{p.value||c.value||(e=="right"?F(r):M(r))},F=async a=>{let e=await u.$api.addRolePermissions(m.value,{button_ids:a});e.status==200?(i({type:"success",message:"权限添加成功"}),T(()=>{f(),g()})):i({type:"error",message:`权限添加失败: ${JSON.stringify(e.data)}`})},M=async a=>{let e=await u.$api.removeRolePermissions(m.value,{button_ids:a});e.status==200?(i({type:"success",message:"权限删除成功"}),T(()=>{f(),g()})):i({type:"error",message:`权限删除失败: ${JSON.stringify(e.data)}`})};return Q(async()=>{m.value=I.path.split("/").at(-1),m.value.includes("new")?(c.value=!0,S.value=!0):await f(),await g()}),(a,e)=>{const r=o("el-button"),O=o("el-tooltip"),U=o("el-text"),x=o("el-input"),k=o("el-form-item"),$=o("el-col"),h=o("el-row"),q=o("el-form"),P=o("el-tab-pane"),E=o("el-tabs");return C(),W("div",le,[v("div",oe,[t(O,{class:"box-item",effect:"dark",content:"返回角色列表",placement:"top"},{default:s(()=>[t(r,{onClick:e[0]||(e[0]=n=>V()),icon:X(Y),plain:"",size:"small"},null,8,["icon"])]),_:1}),t(U,{tag:"b",size:"large"},{default:s(()=>[R(N(c.value?"创建新角色":`角色详情【${l.role_name}】`),1)]),_:1})]),v("div",ne,[t(q,{ref_key:"roleFormRef",ref:b,model:l,rules:z,"label-width":"100px",style:{width:"100%","margin-top":"10px"}},{default:s(()=>[t(h,{gutter:20},{default:s(()=>[t($,{span:8},{default:s(()=>[t(k,{label:"角色",prop:"role"},{default:s(()=>[t(x,{modelValue:l.role,"onUpdate:modelValue":e[1]||(e[1]=n=>l.role=n),placeholder:"请输入角色英文名",disabled:!c.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),t($,{span:8},{default:s(()=>[t(k,{label:"角色名称",prop:"role_name"},{default:s(()=>[t(x,{modelValue:l.role_name,"onUpdate:modelValue":e[2]||(e[2]=n=>l.role_name=n),placeholder:"请输入角色中文名称",disabled:p.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),t(h,{justify:"center"},{default:s(()=>[p.value?te("",!0):(C(),ee(r,{key:0,type:"primary",onClick:e[3]||(e[3]=n=>A())},{default:s(()=>[R(N(c.value?"添加":"更新"),1)]),_:1}))]),_:1})]),v("div",re,[t(E,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=n=>y.value=n),type:"card",class:"demo-tabs",onTabClick:J},{default:s(()=>[t(P,{label:"菜单权限",name:"menuPermission"},{default:s(()=>[v("div",ie,[t(se,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=n=>_.value=n),data:w.value,"leaf-only":!0,"hide-fully-assigned-parents":!0,titles:["可选权限","已选权限"],"check-strictly":!1,onChange:D,disabled:p.value},null,8,["modelValue","data","disabled"])])]),_:1}),t(P,{label:"资产权限",name:"cmdbPermission"})]),_:1},8,["modelValue"])])])}}}),pe=ae(de,[["__scopeId","data-v-891af9ff"]]);export{pe as default};
