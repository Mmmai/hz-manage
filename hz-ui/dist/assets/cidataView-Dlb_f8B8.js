import{d as rl,ar as Ke,g as gl,as as dl,r as i,a as yl,e as c,D as d,o as t,w as l,b as a,i as $,k as p,c as r,F as M,t as x,v as h,at as De,an as xa,ap as S,A as E,z as El,a7 as te,a8 as ce,E as Va,au as pt,s as ke,_ as Al,av as ul,u as $a,aw as Ol,h as Ma,q as Oa,ak as _l,ab as Y,ax as vt,ay as ft,ae as mt,az as Xl,aA as _t,aB as yt,aC as gt,ac as Tl,aD as bt,aE as Ie,al as wt,aF as ha,aG as kt,am as ht,aH as Ca,I as ea,j as Ct,aI as xt,aJ as Vt,aK as $t}from"./index-Cz_bWT0-.js";import{l as Mt}from"./vue-draggable-plus-3yIePYDR.js";import{u as Da}from"./config-BdGNFcz2.js";import{e as Zl,d as ml}from"./gmCrypto-er9ak39U.js";import{u as Ot}from"./ci-BDfs6AkH.js";const Dt={class:"flexJstart gap-1"},Ut={key:0,class:"flexJstart gap-1"},It={key:3,class:"flexJstart gap-1"},Ft=rl({__name:"ciDataUpload",props:Ke(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:Ke(["getCiData"],["update:isShowUpload"]),setup(ee,{emit:me}){const{proxy:J}=gl(),O=ee,A=me,y=dl(ee,"isShowUpload"),X=i([]),ae=i(null),C=["xlsx"],oe=i(10),F=i({}),pe=i({}),ne=yl({"Content-Type":"multipart/form-data"}),le=i({}),se=async()=>{Object.keys(pe.value).length>0?Object.entries(pe.value).forEach(async([B,b])=>{let _=await J.$api.importCiDataStatus(b);F.value[B]=_.data,_.data.status==="completed"&&delete pe.value[B]}):(clearInterval(ve),ve=null,A("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId}))};let ve=null;const G=async B=>{let b=new FormData;b.append("file",B.file),b.append("model",O.ciModelId);let _=await J.$api.importCiData(b,ne,2*60*1e3);_.status==200?(pe.value[B.file.uid]=_.data,le.value[B.file.uid]=!0,ve===null&&(ve=setInterval(se,2e3))):(le.value[B.file.uid]=!1,S({message:`导入异常: ${JSON.stringify(_.data)}`,type:"error",showClose:!0}))},ue=()=>{},q=B=>{let b=B.name;if(B.type!=""||B.type!=null||B.type!=null){const _=B.name.replace(/.+\./,"").toLowerCase();return B.size/1024/1024<100?C.includes(_)?X.value.find(de=>de.name==b&&de.lastModified==B.lastModified)?(S({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(S({message:`不能上传${_}类型的文件`,type:"error",showClose:!0}),!1):(S.error("上传文件大小不能超过 100MB!"),!1)}},U=async B=>{await J.$api.downloadErrorRecords({error_file_key:B})},ze=async()=>{await J.$api.downloadImportTemplate({model:O.ciModelId})};return(B,b)=>{const _=c("upload-filled"),m=c("el-icon"),K=c("el-col"),de=c("el-button"),he=c("el-row"),_e=c("Loading"),ye=c("CircleCheck"),H=c("el-link"),fe=c("el-upload"),Z=c("el-dialog");return t(),d(Z,{modelValue:y.value,"onUpdate:modelValue":b[1]||(b[1]=L=>y.value=L),title:"导入",width:"800"},{default:l(()=>[a(fe,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:ae,headers:ne,"http-request":G,"file-list":X.value,"before-upload":q,limit:oe.value,onOnChange:ue,"show-file-list":""},{tip:l(()=>[a(he,{justify:"space-between",align:"middle"},{default:l(()=>[a(K,{span:18},{default:l(()=>b[2]||(b[2]=[$("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(K,{span:3},{default:l(()=>[a(de,{link:"",type:"primary",onClick:b[0]||(b[0]=L=>ze())},{default:l(()=>b[3]||(b[3]=[p("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:L,index:Ze})=>{var He,Ge,I,Fe,j,We,Qe,il,el;return[$("div",Dt,[$("span",null,x(L.name),1),le.value[L.uid]==!0?(t(),r("div",Ut,[((He=F.value[L.uid])==null?void 0:He.status)!=="completed"?(t(),d(m,{key:0,class:"is-loading"},{default:l(()=>[a(_e)]),_:1})):((Ge=F.value[L.uid])==null?void 0:Ge.failed)>>>0?(t(),d(m,{key:1},{default:l(()=>[a(h(De),{color:"var(--el-color-warning)"})]),_:1})):(t(),d(m,{key:2},{default:l(()=>[a(ye,{color:"var(--el-color-success)"})]),_:1})),F.value[L.uid]?(t(),r("div",It,[$("span",null,x(`进度: ${(I=F.value[L.uid])==null?void 0:I.progress}%`),1),$("span",null,x(`结果: 总条数: ${(Fe=F.value[L.uid])==null?void 0:Fe.total},创建: ${(j=F.value[L.uid])==null?void 0:j.created},更新: ${(We=F.value[L.uid])==null?void 0:We.updated},跳过: ${(Qe=F.value[L.uid])==null?void 0:Qe.skipped},失败: ${(il=F.value[L.uid])==null?void 0:il.failed}.`),1),((el=F.value[L.uid])==null?void 0:el.failed)>>>0?(t(),d(H,{key:0,type:"danger",onClick:Dl=>{var cl;return U((cl=F.value[L.uid])==null?void 0:cl.error_file_key)}},{default:l(()=>b[4]||(b[4]=[p("查看导入失败数据")])),_:2},1032,["onClick"])):M("",!0)])):M("",!0)])):le.value[L.uid]==!1?(t(),d(m,{key:1},{default:l(()=>[a(h(xa),{color:"var(--el-color-error)"})]),_:1})):M("",!0)])]}),default:l(()=>[a(m,{class:"el-icon--upload"},{default:l(()=>[a(_)]),_:1}),b[5]||(b[5]=$("div",{class:"el-upload__text"},[p("拖拽文件到此或者 "),$("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])}}}),Nt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Pt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},St={style:{width:"100%",overflow:"auto"}},qt={class:"listItem"},jt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Tt={class:"listItem"},Et={style:{flex:"auto"}},At=rl({__name:"ciDataTableCol",props:Ke(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:Ke(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(ee,{expose:me,emit:J}){const O=ee,A=dl(ee,"isShowTableCol"),y=dl(ee,"hasConfigField"),{proxy:X}=gl(),ae=i(""),C=i(""),oe=E(()=>ae.value===""?B.value:B.value.filter(b=>b.verbose_name.includes(ae.value)));function F(){A.value=!1}const pe=b=>{y.value.push(b)},ne=b=>{let _=y.value.indexOf(b);y.value.splice(_,1)},le=b=>{console.log("start",b)},se=b=>{console.log("onEnd",b),console.log(y.value)},ve=()=>{console.log("update")},G=i({}),ue=async()=>{let b=await X.$api.getCiModelCol({model:O.ciModelId});G.value=b.data;let _=[];b.data.fields_preferred.forEach(m=>{_.push(O.allModelFieldInfo[m])}),y.value=_},q=E(()=>y.value.map(b=>b.id)),U=J;El(()=>y.value,b=>{console.log("更新表格"),U("reloadTable")},{deep:!0});const ze=async()=>{let b=await X.$api.updateCiModelCol({id:G.value.id,fields_preferred:q.value});b.status=="200"?(S({type:"success",message:"更新成功"}),ke(()=>{C.value.clear(),A.value=!1})):S({showClose:!0,message:"更新失败:"+JSON.stringify(b.data),type:"error"})},B=E(()=>O.allModelField.filter(b=>!y.value.includes(b)));return me({getHasConfigField:ue}),(b,_)=>{const m=c("el-text"),K=c("el-divider"),de=c("el-input"),he=c("el-icon"),_e=c("el-button"),ye=c("el-drawer");return t(),d(ye,{modelValue:A.value,"onUpdate:modelValue":_[2]||(_[2]=H=>A.value=H),direction:"rtl",size:"40%"},{header:l(()=>[a(m,{tag:"b"},{default:l(()=>_[3]||(_[3]=[p("表格列显示配置")])),_:1})]),default:l(()=>[$("div",Nt,[$("div",Pt,[a(m,{tag:"b"},{default:l(()=>_[4]||(_[4]=[p("模型字段")])),_:1}),a(K),a(de,{modelValue:ae.value,"onUpdate:modelValue":_[0]||(_[0]=H=>ae.value=H),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:C},null,8,["modelValue"]),$("div",St,[(t(!0),r(te,null,ce(oe.value,(H,fe)=>(t(),r("div",{key:fe},[$("div",qt,[$("span",null,x(H.verbose_name),1),a(he,null,{default:l(()=>[a(h(Va),{onClick:Z=>pe(H)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),$("div",jt,[a(m,{tag:"b"},{default:l(()=>_[5]||(_[5]=[p("已显示字段")])),_:1}),a(K),a(h(Mt),{"force-fallback":!0,"scroll-sensitivity":200,ref:"el",modelValue:y.value,"onUpdate:modelValue":_[1]||(_[1]=H=>y.value=H),onStart:le,onUpdate:ve,onEnd:se,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(te,null,ce(y.value,(H,fe)=>(t(),r("div",{key:fe},[$("div",Tt,[$("span",null,x(H.verbose_name),1),a(he,null,{default:l(()=>[a(h(pt),{onClick:Z=>ne(H)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[$("div",Et,[a(_e,{onClick:F},{default:l(()=>_[6]||(_[6]=[p("取消")])),_:1}),a(_e,{type:"primary",onClick:ze},{default:l(()=>_[7]||(_[7]=[p("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),Rt=Al(At,[["__scopeId","data-v-3859704e"]]),zt={class:"dialog-footer"},Lt=rl({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(ee){const me=Da(),J=dl(ee,"showAllPassDia"),O=E(()=>me.gmCry),A=i(),y=yl({secret:null,time:3});i(""),i(!1);const X=async oe=>{oe.validate(async F=>{F&&(y.secret===O.value.key?(ul({title:"操作成功",message:"解密成功,"+y.time+"分钟后过期！",type:"success",duration:2e3}),me.updateShowAllPass(!0),J.value=!1,me.setShowAllPassTime(y.time*60*1e3),ae(A.value)):ul({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},ae=oe=>{oe&&oe.resetFields()},C=()=>{J.value=!1,ae(A.value)};return(oe,F)=>{const pe=c("el-input"),ne=c("el-form-item"),le=c("el-input-number"),se=c("el-form"),ve=c("el-button"),G=c("el-dialog");return t(),d(G,{modelValue:J.value,"onUpdate:modelValue":F[3]||(F[3]=ue=>J.value=ue),title:"查看密码",width:"400"},{footer:l(()=>[$("div",zt,[a(ve,{onClick:C},{default:l(()=>F[5]||(F[5]=[p("取消")])),_:1}),a(ve,{type:"primary",onClick:F[2]||(F[2]=ue=>X(A.value))},{default:l(()=>F[6]||(F[6]=[p(" 查看 ")])),_:1})])]),default:l(()=>[a(se,{ref_key:"allPassFormRef",ref:A,inline:!0,model:y,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(ne,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(pe,{type:"password",modelValue:y.secret,"onUpdate:modelValue":F[0]||(F[0]=ue=>y.secret=ue),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(ne,{label:"有效时间",prop:"time"},{default:l(()=>[a(le,{modelValue:y.time,"onUpdate:modelValue":F[1]||(F[1]=ue=>y.time=ue),min:1,step:1,max:30},{suffix:l(()=>F[4]||(F[4]=[$("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Yt={style:{display:"flex","justify-content":"center"}},Bt=rl({__name:"ciDataqCode",props:Ke(["qCodeContext"],{showqCodeDia:{},showqCodeDiaModifiers:{}}),emits:["update:showqCodeDia"],setup(ee){const{proxy:me}=gl();$a();const J=dl(ee,"showqCodeDia"),O=ee;return(A,y)=>{const X=c("a-qrcode"),ae=c("el-dialog");return t(),d(ae,{modelValue:J.value,"onUpdate:modelValue":y[0]||(y[0]=C=>J.value=C),title:"实例二维码",width:"600"},{default:l(()=>[$("div",Yt,[a(X,{value:JSON.stringify(O.qCodeContext),size:500},null,8,["value"])])]),_:1},8,["modelValue"])}}}),Jt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Kt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Ht={style:{width:"100%",overflow:"auto"}},Gt={class:"listItem"},Wt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Qt={style:{"margin-right":"5px"}},Xt={style:{float:"left"}},Zt={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},eo={key:0},lo={key:1},ao={key:0},to={key:1},oo={key:2},no={key:3},so={style:{flex:"auto"}},uo=rl({__name:"ciDataFilter",props:Ke(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:Ke(["getCiData","updateFilterParam"],["update:showFilter"]),setup(ee,{expose:me,emit:J}){const O=ee,A=dl(ee,"showFilter"),y=i(""),X=i(""),ae=E(()=>y.value===""?le.value:le.value.filter(_=>_.verbose_name.includes(y.value))),{proxy:C}=gl();function oe(){A.value=!1}const F=_=>{q.value.push(_)},pe=_=>{let m=G.filterParams.indexOf(_);q.value.splice(m,1)},ne=(_,m)=>{_==="instance_name"?G.instance_name="":q.value.splice(m,1),ke(()=>{se("updateFilterParam",U.value)})},le=E(()=>O.allModelField.filter(_=>!q.value.includes(_)));i({});const se=J,ve=i(""),G=yl({filterParams:[],instance_name:""}),ue=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"在列表",description:"以,分隔"},{value:"not:in:",label:"不在列表",description:"以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"not:null",label:"非空",description:"正则表达式"}]),q=i([]),U=E(()=>{let _=new Object;return G.filterParams.forEach(m=>{if(m.match==="null"||m.match==="not:null"){_[m.name]=m.match;return}if(m.value!==""){let K=null;m.value!==null?K=m.value:K="null",m.match==="="?_[m.name]=K:_[m.name]=m.match+K}}),G.instance_name!==""&&(_.instance_name=G.instance_name),_}),ze=()=>{console.log(U.value),se("updateFilterParam",U.value),console.log(U.value),ke(()=>{se("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId})}),A.value=!1},B=E(()=>{var _;return(_=G.filterParams)==null?void 0:_.map(m=>m.name)});El(()=>q.value,_=>{var K;let m=new Array;(K=q.value)==null||K.forEach((de,he)=>{var _e;if(((_e=B.value)==null?void 0:_e.indexOf(de.name))>>>-1)m.push({name:de.name,value:"",match:"=",label:de.verbose_name});else{let ye=G.filterParams.findIndex(H=>H.name===de.name);m.push(G.filterParams[ye])}}),G.filterParams=m},{deep:!0});const b=_=>{_&&(_.resetFields(),se("updateFilterParam",U.value),ke(()=>{se("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId})}))};return me({removeFilterParam:ne}),(_,m)=>{const K=c("el-text"),de=c("el-divider"),he=c("el-input"),_e=c("el-icon"),ye=c("el-form-item"),H=c("el-button"),fe=c("el-option"),Z=c("el-select"),L=c("el-switch"),Ze=c("el-space"),He=c("el-form"),Ge=c("el-drawer");return t(),d(Ge,{modelValue:A.value,"onUpdate:modelValue":m[4]||(m[4]=I=>A.value=I),direction:"rtl",size:"50%","before-close":oe},{header:l(()=>[a(K,{tag:"b"},{default:l(()=>m[5]||(m[5]=[p("筛选")])),_:1})]),default:l(()=>[$("div",Jt,[$("div",Kt,[a(K,{tag:"b"},{default:l(()=>m[6]||(m[6]=[p("模型字段")])),_:1}),a(de),a(he,{modelValue:y.value,"onUpdate:modelValue":m[0]||(m[0]=I=>y.value=I),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:X},null,8,["modelValue"]),$("div",Ht,[(t(!0),r(te,null,ce(ae.value,(I,Fe)=>(t(),r("div",{key:Fe},[$("div",Gt,[$("span",null,x(I.verbose_name),1),a(_e,null,{default:l(()=>[a(h(Va),{onClick:j=>F(I)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),$("div",Wt,[a(K,{tag:"b"},{default:l(()=>m[7]||(m[7]=[p("过滤器")])),_:1}),a(de),a(He,{ref_key:"filterFormRef",ref:ve,model:G,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(Ze,{wrap:""},{default:l(()=>[a(ye,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(he,{modelValue:G.instance_name,"onUpdate:modelValue":m[1]||(m[1]=I=>G.instance_name=I),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(te,null,ce(G.filterParams,(I,Fe)=>(t(),d(ye,{key:I.index,prop:"filterParams."+Fe+".value"},{label:l(()=>[$("span",Qt,x(I.label),1),a(H,{icon:h(xa),size:"small",circle:"",onClick:Ol(j=>pe(I),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(Ze,null,{default:l(()=>[a(Z,{modelValue:I.match,"onUpdate:modelValue":j=>I.match=j,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(te,null,ce(ue.value,j=>(t(),d(fe,{key:j.value,label:j.label,value:j.value},{default:l(()=>[$("span",Xt,x(j.label),1),$("span",Zt,x(j.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),I.match==="null"||I.match==="not:null"?(t(),r("div",eo)):(t(),r("div",lo,[["enum"].indexOf(O.allModelFieldByNameObj[I.name].type)>>>-1?["model_ref"].indexOf(O.allModelFieldByNameObj[I.name].type)>>>-1?["boolean"].indexOf(O.allModelFieldByNameObj[I.name].type)>>>-1?(t(),r("div",no,[a(he,{modelValue:I.value,"onUpdate:modelValue":j=>I.value=j,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",oo,[a(L,{modelValue:I.value,"onUpdate:modelValue":j=>I.value=j,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",to,[a(Z,{modelValue:I.value,"onUpdate:modelValue":j=>I.value=j,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ce(O.modelRefOptions[I.name],j=>(t(),d(fe,{key:j.value,label:j.label,value:j.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",ao,[a(Z,{modelValue:I.value,"onUpdate:modelValue":j=>I.value=j,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ce(O.enumOptionObj[O.allModelFieldByNameObj[I.name].validation_rule],j=>(t(),d(fe,{key:j.value,label:j.label,value:j.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[$("div",so,[a(H,{onClick:m[2]||(m[2]=I=>b(ve.value))},{default:l(()=>m[8]||(m[8]=[p("重置")])),_:1}),a(H,{onClick:m[3]||(m[3]=I=>ze()),type:"primary"},{default:l(()=>m[9]||(m[9]=[p("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),ro=Al(uo,[["__scopeId","data-v-8bcd5a33"]]),io={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},co={class:"table-header"},po={class:"header-button-lf"},vo={class:"header-button-ri"},fo={class:"flexJstart gap-1",style:{overflow:"auto"}},mo={class:"text_class"},_o={key:0,class:"text_class"},yo={key:1},go={style:{display:"flex","justify-content":"space-between",width:"100%"}},bo={style:{display:"flex","justify-content":"space-between"}},wo={key:1,class:"requiredClass"},ko={key:0},ho={key:0},Co={key:1},xo={key:0},Vo={key:1},$o={key:0},Mo={key:1},Oo={key:0},Do={key:1},Uo={key:0},Io={key:0},Fo={key:0},No={key:1},Po={key:0},So={key:1},qo={key:0},jo={key:1},To={key:0},Eo={key:1},Ao={key:0},Ro={key:1},zo={key:0},Lo={key:1},Yo={style:{flex:"auto"},class:"footerButtonClass"},Bo={key:0},Jo={key:1},Ko={key:0},Ho={key:1},Go={key:0},Wo={key:0},Qo={key:1},Xo={key:2},Zo={key:3},en={key:4},ln={key:5},an={key:6},tn={key:7},on={key:8},nn={key:9},sn={class:"dialog-footer"},un={class:"dialog-footer"},dn=rl({__name:"ciDataShow",props:Ke(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:Ke(["getTree"],["update:showTree"]),setup(ee,{expose:me,emit:J}){const{proxy:O}=gl(),A=Da(),y=Ma(),X=$a(),ae=J,C=ee,oe=dl(ee,"showTree"),F=i([0]),pe=i(!1),ne=()=>{pe.value=!0},le=i(!0),se=()=>{le.value=!1,ke(()=>{le.value=!0})},ve=i(""),G=()=>{pe.value=!1},ue=i(!1),q=E(()=>A.gmCry),U=E(()=>A.showAllPass),ze=E(()=>A.showAllPassTime),B=async()=>{ue.value=!0},b=()=>{A.updateShowAllPass(!1),ul({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},_=s=>{A.setShowAllPassTime(s.totalMilliseconds)},m=()=>{ue.value=!1,A.updateShowAllPass(!1),A.setShowAllPassTime(0),ul({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},K=i(!1),de=()=>{H.value=!1,Ye(he.value[0]),ye.value=""},he=i(),_e=yl({secret:null}),ye=i(""),H=i(!1),fe=async(s,e)=>{s[0].validate(async u=>{u&&(_e.secret===q.value.key?(ye.value=ml(q.value.key,q.value.mode,e),H.value=!0):(ul({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),H.value=!1,ye.value=""))})},Z=i(1),L=i(10),Ze=i("default"),He=i(!1),Ge=()=>{Me({model:C.ciModelId,model_instance_group:C.currentNodeId})},I=()=>{Me({model:C.ciModelId,model_instance_group:C.currentNodeId})},Fe=E(()=>Fl.value.map(s=>s.name)),j=E(()=>Vl.value.map(s=>s.name)),We=i(!1),Qe=E(()=>ge.value?{all:!0,group:C.currentNodeId,params:pl.value}:{group:C.currentNodeId,params:pl.value}),il=async()=>{let s=new Object;ge.value?s={update_user:X.state.username,...Qe.value}:s={update_user:X.state.username,instances:re.value},console.log(s),tl.value=!0;let e=await O.$api.bulkDeleteCiModelInstance(s,60*1e3);console.log(e),e.status=="200"?(S({type:"success",message:"删除成功"}),Cl.value.clearSelection(),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),setTimeout(()=>{ae("getTree")},2e3)):S({type:"error",message:`删除失败:${JSON.stringify(e.data)}`}),tl.value=!1},el=async s=>{s?await O.$api.exportCiData({model:C.ciModelId,fields:j.value,instances:re.value}):await O.$api.exportCiData({model:C.ciModelId,fields:Fe.value,instances:re.value})},Dl=async()=>{console.log(Qe.value);let s=await O.$api.exportCiData({all:!0,model:C.ciModelId,group:C.currentNodeId,params:pl.value});console.log(s)},cl={multiple:!0,value:"id"},Xe=i(!1),k=i([]),g=E(()=>C.treeData[0].children[0].id),T=E(()=>C.treeData[0].id),Ne=async()=>{var w;let s=[];(w=k.value)==null||w.forEach(V=>{s.push(V[V.length-1])});let e=new Object;ge.value?e={all:!0,groups:s,instances:[]}:e={instances:re.value,groups:s};let u=await O.$api.setCiDataToTree(e);u.status=="201"?(S({type:"success",message:"更新成功"}),Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),la(),ae("getTree")):S({showClose:!0,message:"更新失败:"+JSON.stringify(u.data),type:"error"}),k.value=[],Xe.value=!1},ll=i(""),al=i(!1),R=i({}),Le=(s,e)=>{s?P.updateParams[e]="null":P.updateParams[e]=null},bl=()=>{al.value=!0};i(!1);const Rl=s=>{var e;if(s!==void 0&&((e=qe.value[s])==null?void 0:e.field_type)==="string")return s==""||s==null?void 0:[{pattern:new RegExp(qe.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]};E(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(w=>{w.fields.forEach(V=>{var N;V.type==="string"&&V.validation_rule!==""&&V.validation_rule!==null&&(s["updateParams."+V.name]=[{pattern:new RegExp((N=qe.value[V.validation_rule])==null?void 0:N.rule),message:"不符合正则表达式",trigger:"blur"}])})}),s});const P=yl({updateParams:{}}),Pe=i([]),wl=()=>{const s=Object.keys(P.updateParams).length,e=`__temp_param_${s}`;Pe.value[s]=e,P.updateParams[e]=""},zl=(s,e)=>{console.log(e),P.updateParams[e]=void 0,delete P.updateParams[Pe.value[s]],Pe.value[s]=e},Ce=(s,e)=>{Pe.value.splice(s,1),delete R.value[e],delete P.updateParams[e]},$e=E(()=>{let s=new Object;for(let[e,u]of Object.entries(P.updateParams))u==="null"?s[e]=null:s[e]=u,ie.value.password.indexOf(e)!==-1&&(s[e]=Zl(q.value.key,q.value.mode,u));return s});i(!1);const Ul=()=>{ll.value.validate(async s=>{if(s){let e=new Object;ge.value?e={update_user:X.state.username,fields:$e.value,model:C.ciModelId,...Qe.value}:e={update_user:X.state.username,instances:re.value,fields:$e.value};const u=Ca.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});let w=await O.$api.multipleUpdateCiModelInstance(e);w.status=="200"?(S({type:"success",message:"更新成功"}),Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),P.updateParams={},R.value={},Pe.value=[],al.value=!1):S({showClose:!0,message:"更新失败:"+JSON.stringify(w.data),type:"error"}),ke(()=>u.close())}else S({showClose:!0,message:"请输入正确内容.",type:"error"})})},Ue=E(()=>{var e,u;let s=new Array;return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(w=>{w.fields.forEach(V=>{let N=!1;V.name in P.updateParams&&(N=!0),s.push({value:V.name,label:V.verbose_name,disable:N})})}),s}),kl=()=>{al.value=!1,P.updateParams={},R.value={},Pe.value=[]},tl=i(!0),hl=s=>{tl.value=s},Il=i(!0),W=i(!1),Ll=i(!1),Ua=()=>{Ll.value=!0},Ia=async s=>{hl(!0);let e=await O.$api.updateCiModelInstance({update_user:X.state.username,...s});e.status=="200"?(S({type:"success",message:"更新成功"}),Ve.value=!1,Ye(ol.value),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId})):S({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},Fa=s=>!ge.value,Cl=i(null),Na=s=>s.id,re=i([]),Pa=s=>{re.value=s.map(e=>e.id)},ge=i(!1),Sa=s=>{s?re.value.length===0&&Cl.value.toggleAllSelection():(re.value=[],Cl.value.clearSelection()),console.log(re.value)},la=()=>{re.value=[],Cl.value.clearSelection()},Fl=i([]),Se=i({}),qa=E(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(w=>{w.fields.forEach(V=>{s[V.id]=V})}),s}),be=E(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(w=>{w.fields.forEach(V=>{s[V.name]=V})}),s}),aa=i(""),ja=()=>{aa.value.getHasConfigField()},ta=()=>{Il.value=!1,ke(()=>{Il.value=!0})},Ta=s=>s.map(u=>u.id===g.value).length>>0,qe=i({});i({});const Ea=async(s=null)=>{(await O.$api.getValidationRules({...s,page:1,page_size:1e4})).data.results.forEach(u=>{qe.value[u.id]=u})},Yl=E(()=>{var e,u;let s={};return(u=(e=Se.value)==null?void 0:e.field_groups)==null||u.forEach(w=>{w.fields.forEach(V=>{if(V.type==="enum"){if(V.validation_rule===null)return;let N=JSON.parse(qe==null?void 0:qe.value[V==null?void 0:V.validation_rule].rule),Ee=[];Object.keys(N).forEach(nl=>{Ee.push({value:nl,label:N[nl]})}),s[V.validation_rule]=Ee}})}),s}),oa=E(()=>{let s={};return Se.value.field_groups.forEach(e=>{e.fields.forEach(u=>{if(u.type==="enum"){let w=JSON.parse(qe.value[u.validation_rule].rule),V={};Object.keys(w).forEach(N=>{V[N]=w[N]}),s[u.name]=V}})}),s}),xl=i({}),Aa=async(s,e)=>{let u=await O.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),w=[];u.data.results.forEach(V=>{w.push({value:V.id,label:V.instance_name})}),xl.value[e.name]=w},Ra=E(()=>{let s=new Object;for(let[e,u]of Object.entries(xl.value)){let w=new Object;u==null||u.forEach(V=>{w[V.value]=V}),s[e]=w}return s}),za=s=>{if(!(s==""||s==null))return[{pattern:new RegExp(qe.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]},La=()=>{for(const[s,e]of Object.entries(v))s!=="instance_name"&&delete v[s];Se.value.field_groups.forEach(s=>{s.fields.forEach(e=>{v[e.name]=e.default})}),v.instance_name=null},Vl=i([]),Ya=async()=>{var u;let s=await O.$api.getCiModel({},C.ciModelId);Se.value=s.data;let e=[];(u=Se.value.field_groups)==null||u.forEach(w=>{w.fields.forEach(V=>{e.push(V)})}),Vl.value=e},ie=E(()=>{let s={enum:[],boolean:[],model_ref:[],password:[]};return Vl.value.forEach(e=>{e.type==="enum"?s.enum.push(e.name):e.type==="boolean"?s.boolean.push(e.name):e.type==="model_ref"?s.model_ref.push(e.name):e.type==="password"&&s.password.push(e.name)}),s});El(()=>ie.value.model_ref,s=>{ie.value.model_ref.forEach(e=>{Aa(!0,{id:be.value[e].ref_model,name:e})})},{deep:!0});const na=i([]),Bl=i(0),pl=i({}),sa=s=>{pl.value=s},ua=E(()=>{let s=new Array;for(let[e,u]of Object.entries(pl.value))console.log(),e==="instance_name"?s.push({name:"唯一标识:"+u,field:e}):ie.value.model_ref.indexOf(e)!==-1?s.push({name:be.value[e].verbose_name+":"+Ra.value[e][u].label,field:e}):ie.value.enum.indexOf(e)!==-1?(console.log(oa.value),s.push({name:be.value[e].verbose_name+":"+oa.value[e][u],field:e})):s.push({name:be.value[e].verbose_name+":"+u,field:e});return s}),Ba=async(s,e)=>{await ve.value.removeFilterParam(s,e),ke(()=>{Me({model:C.ciModelId,model_instance_group:C.currentNodeId})})},Me=async s=>{var w;hl(!0);let e=new Array,u=await O.$api.getCiModelInstance({...s,page:Z.value,page_size:L.value,...pl.value});Bl.value=u.data.count,(w=u.data.results)==null||w.forEach(V=>{e.push({id:V.id,instance_group:V.instance_group,instance_name:V.instance_name,...V.fields})}),na.value=e,ke(()=>{ge.value=!1,hl(!1)})};Oa(async()=>{Il.value=!0,await Ea(),hl(!1)});const Ve=i(!1),Ja=()=>{W.value=!0,Ve.value=!0,Te.value=!0},je=i({}),Nl=i({}),da=(s,e=!1)=>{Ve.value=!0,Te.value=!1,W.value=e,je.value=s,ke(()=>{Object.keys(s).forEach(u=>{u==="id"||u==="instance_group"||(ie.value.model_ref.indexOf(u)!==-1?s[u]!==null?v[u]=s[u].id:v[u]=s[u]:ie.value.password.indexOf(u)!==-1?U.value?(console.log(s[u]),console.log(ml(q.value.key,q.value.mode,s[u])),v[u]=ml(q.value.key,q.value.mode,s[u])):(console.log(s[u]),v[u]=s[u]):v[u]=s[u])}),console.log(v),Nl.value=JSON.parse(JSON.stringify(v))})},Ka=s=>{Ve.value=!0,Te.value=!0,W.value=!0,je.value=s,ke(()=>{Object.keys(s).forEach(e=>{e==="id"||e==="instance_group"||(ie.value.model_ref.indexOf(e)!==-1?s[e]!==null?v[e]=s[e].id:v[e]=s[e]:ie.value.enum.indexOf(e)!==-1?v[e]=s[e].value:ie.value.password.indexOf(e)!==-1?U.value?v[e]=ml(q.value.key,q.value.mode,s[e]):v[e]=null:v[e]=s[e])})}),ul({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},ol=i(),v=yl({instance_name:null}),ra=E(()=>{let s=Object.assign({},v);delete s.instance_name;for(let[e,u]of Object.entries(s))u!==null&&ie.value.password.indexOf(e)!==-1&&(s[e]=Zl(q.value.key,q.value.mode,u));return s}),ia=E(()=>{let s=Object.assign({},vl.value);delete s.instance_name,console.log(ie.value);for(let[e,u]of Object.entries(vl.value))u!==null&&ie.value.password.indexOf(e)!==-1&&(s[e]=Zl(q.value.key,q.value.mode,u));return s}),Te=i(!0),vl=i({}),ca=async(s,e=null)=>{s&&await s.validate(async(u,w)=>{if(u){const V=Ca.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});if(Te.value){console.log(ra.value);let N=await O.$api.addCiModelInstance({model:C.ciModelId,create_user:X.state.username,update_user:X.state.username,fields:ra.value,instance_name:v.instance_name,instance_group:[C.currentNodeId]});setTimeout(()=>{V.close()},200),N.status=="201"?(S({type:"success",message:"添加成功"}),Ve.value=!1,Ye(s),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),ae("getTree")):S({showClose:!0,message:"添加失败:"+JSON.stringify(N.data),type:"error"})}else{if(console.log(JSON.stringify(Nl.value)),console.log(JSON.stringify(v)),JSON.stringify(Nl.value)===JSON.stringify(v)){W.value=!1,Ve.value=!1,Ye(s),S({showClose:!0,message:"无更新,关闭窗口",type:"info"}),setTimeout(()=>{V.close()},200);return}else{const nl=Object.entries(Nl.value),Kl=Object.entries(v),Hl=nl.concat(Kl).map(Be=>JSON.stringify(Be)),Q=Array.from(new Set(Hl)).map(Be=>JSON.parse(Be));Q.splice(0,nl.length);const Sl=Object.fromEntries(Q);let sl={};if(Object.keys(Sl).forEach(Be=>{sl[Be]=Sl[Be]}),vl.value=sl,Object.keys(vl.value).length===0){W.value=!1,Ve.value=!1,Ye(s),S({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let N={id:je.value.id,model:C.ciModelId,update_user:X.state.username};Object.keys(vl.value).indexOf("instance_name")===-1||(N.instance_name=vl.value.instance_name),N.fields=ia.value,console.log(ie.value),console.log(N),console.log();let Ee=await O.$api.updateCiModelInstance(N);Ee.status=="200"?(S({type:"success",message:"更新成功"}),Ve.value=!1,W.value=!1,Ye(s),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId})):S({showClose:!0,message:"更新失败:"+JSON.stringify(Ee.data),type:"error"}),setTimeout(()=>{V.close()},200)}}else console.log("error submit!",w),ul({title:"表单校验",message:"表单填写异常",type:"error"})})},Ha=s=>{if(W.value==!1&&Te.value==!1){Ve.value=!1;return}ea.confirm("是否确认关闭?").then(()=>{s(),Ye(ol.value),Ve.value=!1,W.value=!1}).catch(()=>{})},Ga=s=>{Ye(s),Ve.value=!1,W.value=!1},pa=(s=null)=>{ea.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await O.$api.deleteCiModelInstance(je.value.id)).status==204?(S({type:"success",message:"删除成功"}),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),Ye(ol.value),Ve.value=!1,W.value=!1,ae("getTree")):S({type:"error",message:"删除失败"})}).catch(()=>{S({type:"info",message:"取消删除"})})},Ye=s=>{s&&(s.resetFields(),je.value={})},Pl=i("modelField"),Wa=(s,e)=>{console.log(Pl.value)};me({getHasConfigField:ja,getCiData:Me,initCiDataForm:La,getModelField:Ya,setLoading:hl,closeFilter:G,clearMultipleSelect:la,updateFilterParam:sa,reloadCiDataFilter:se});const Jl=i(!1),va=i(""),Qa=s=>{Jl.value=!0,va.value=s},Xa=({row:s,column:e,rowIndex:u,columnIndex:w})=>{if(u===0&&w===0&&ge.value)return"selectAllBtnDis"};return(s,e)=>{var ga,ba,wa;const u=c("el-button"),w=c("el-tooltip"),V=c("arrow-down"),N=c("el-icon"),Ee=c("el-dropdown-item"),nl=c("el-dropdown-menu"),Kl=c("el-dropdown"),Hl=c("vue-countdown"),Q=c("el-text"),Sl=c("el-tag"),sl=c("el-table-column"),Be=c("el-link"),Je=c("el-switch"),Za=c("el-table"),et=c("el-checkbox"),lt=c("el-pagination"),fa=c("el-descriptions-item"),at=c("el-descriptions"),Oe=c("el-space"),Ae=c("el-input"),xe=c("el-form-item"),tt=c("InfoFilled"),Gl=c("el-input-number"),Wl=c("el-col"),ma=c("el-row"),Ql=c("el-form"),ot=c("el-popover"),ql=c("el-date-picker"),$l=c("el-option"),Ml=c("el-select"),nt=c("el-collapse-item"),st=c("el-collapse"),jl=c("el-tab-pane"),ut=c("el-tabs"),dt=c("el-drawer"),_a=c("el-dialog"),rt=c("el-cascader"),we=_l("permission"),it=_l("loading"),ct=_l("copy"),ya=_l("throttle");return t(),r(te,null,[Il.value?(t(),r("div",io,[$("div",co,[$("div",po,[oe.value?(t(),d(u,{key:0,icon:h(vt),onClick:e[0]||(e[0]=n=>oe.value=!1),size:"default"},null,8,["icon"])):(t(),d(u,{key:1,icon:h(ft),onClick:e[1]||(e[1]=n=>oe.value=!0),size:"default"},null,8,["icon"])),Y((t(),d(u,{type:"primary",onClick:Ja},{default:l(()=>e[34]||(e[34]=[p("添加")])),_:1})),[[we,`${(ga=h(y).name)==null?void 0:ga.replace("_info","")}:add`]]),(re.value.length>>>0||ge.value)&&T.value!==ee.currentNodeId?Y((t(),d(u,{key:3,disabled:!((re.value.length>>>0||ge.value)&&T.value!==ee.currentNodeId),content:"勾选实例且非<所有>分组才支持转移~",onClick:e[3]||(e[3]=n=>Xe.value=!0)},{default:l(()=>e[36]||(e[36]=[p("转移")])),_:1},8,["disabled"])),[[we,`${(ba=h(y).name)==null?void 0:ba.replace("_info","")}:edit`]]):(t(),d(w,{key:2,class:"box-item",effect:"dark",content:"勾选实例且非<所有>分组才支持转移~",placement:"top"},{default:l(()=>{var n;return[Y((t(),d(u,{disabled:!((re.value.length>>>0||ge.value)&&T.value!==ee.currentNodeId),onClick:e[2]||(e[2]=z=>Xe.value=!0)},{default:l(()=>e[35]||(e[35]=[p("转移")])),_:1},8,["disabled"])),[[we,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:edit`]])]}),_:1})),Y((t(),d(u,{disabled:!(re.value.length>>>0||ge.value),onClick:bl},{default:l(()=>e[37]||(e[37]=[p("批量更新")])),_:1},8,["disabled"])),[[we,`${(wa=h(y).name)==null?void 0:wa.replace("_info","")}:edit`]]),a(Kl,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(nl,null,{default:l(()=>{var n,z;return[Y((t(),r("div",null,[a(Ee,{disabled:!(re.value.length>>>0||ge.value),onClick:e[4]||(e[4]=o=>il()),divided:""},{default:l(()=>e[39]||(e[39]=[p("批量删除")])),_:1},8,["disabled"])])),[[we,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:delete`]]),Y((t(),r("div",null,[a(Ee,{disabled:!(re.value.length>>>0),onClick:e[5]||(e[5]=o=>el(!1))},{default:l(()=>e[40]||(e[40]=[p("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(Ee,{disabled:!(re.value.length>>>0),onClick:e[6]||(e[6]=o=>el(!0))},{default:l(()=>e[41]||(e[41]=[p("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(Ee,{onClick:e[7]||(e[7]=o=>Dl())},{default:l(()=>e[42]||(e[42]=[p("导出所有")])),_:1})])),[[we,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(u,{type:"primary"},{default:l(()=>[e[38]||(e[38]=p(" 更多操作")),a(N,{class:"el-icon--right"},{default:l(()=>[a(V)]),_:1})]),_:1})]),_:1})]),$("div",vo,[a(w,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(u,{icon:h(mt),circle:"",onClick:ta},null,8,["icon"])]),_:1}),U.value?M("",!0):(t(),d(w,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var n;return[Y(a(u,{icon:h(Xl),circle:"",onClick:B},null,8,["icon"]),[[we,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:showPassword`]])]}),_:1})),U.value?(t(),d(w,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[43]||(e[43]=[$("span",null,[p("倒计时结束后自动隐藏密码"),$("br"),p("手动点击可立马隐藏")],-1)])),default:l(()=>[a(u,{circle:"",onClick:m},{default:l(()=>[a(Hl,{time:ze.value,onEnd:b,onProgress:_},{default:l(({totalSeconds:n})=>[p(x(n),1)]),_:1},8,["time"])]),_:1})]),_:1})):M("",!0),a(w,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(u,{icon:h(_t),circle:"",onClick:Ua},null,8,["icon"])]),_:1}),a(w,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var n;return[Y(a(u,{icon:h(yt),circle:"",onClick:e[8]||(e[8]=z=>We.value=!0)},null,8,["icon"]),[[we,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:import`]])]}),_:1}),a(w,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(u,{icon:h(gt),circle:"",onClick:ne},null,8,["icon"])]),_:1})])]),Y($("div",fo,[a(Q,{tag:"b"},{default:l(()=>e[44]||(e[44]=[p("过滤器")])),_:1}),(t(!0),r(te,null,ce(ua.value,(n,z)=>(t(),d(Sl,{key:n.name,closable:"",type:"primary",onClose:o=>Ba(n.field,z)},{default:l(()=>[$("span",null,x(n.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Tl,ua.value.length>>>0]]),Y((t(),d(Za,{ref_key:"ciDataTableRef",ref:Cl,data:na.value,onSelectionChange:Pa,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":Na},{default:l(()=>[a(sl,{"header-cell-class-name":Xa,type:"selection",selectable:Fa,width:"40",disable:ge.value,"reserve-selection":!0},null,8,["disable"]),a(sl,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(te,null,ce(Fl.value,(n,z)=>(t(),d(sl,{property:n.name,label:n.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120","max-width":"220"},bt({_:2},[n.name==="mgmt_ip"?{name:"default",fn:l(o=>[a(Be,{href:`https://${o.row[n.name]}`,type:"primary",target:"_blank"},{default:l(()=>[p(x(o.row[n.name]),1)]),_:2},1032,["href"])]),key:"0"}:void 0,ie.value.boolean.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[Y(a(Je,{modelValue:o.row[n.name],"onUpdate:modelValue":D=>o.row[n.name]=D,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:D=>Ia({id:o.row.id,fields:{[n.name]:o.row[n.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[we,{id:`${(f=h(y).name)==null?void 0:f.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,ie.value.enum.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[$("div",mo,x((f=o.row[n.name])==null?void 0:f.label),1)]}),key:"2"}:void 0,ie.value.password.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[U.value?(t(),r("div",_o,x(h(ml)(q.value.key,q.value.mode,o.row[n.name])),1)):(t(),r("div",yo,[((f=o.row[n.name])==null?void 0:f.length)>>0?(t(),d(Q,{key:0},{default:l(()=>{var D;return[p(x("*".repeat((D=o.row[n.name])==null?void 0:D.length)),1)]}),_:2},1024)):(t(),d(Q,{key:1}))]))]}),key:"3"}:void 0,ie.value.model_ref.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f,D;return[$("div",{class:Ie({text_class:((f=o.row[n.name])==null?void 0:f.instance_name)>>0})},x((D=o.row[n.name])==null?void 0:D.instance_name),3)]}),key:"4"}:void 0]),1032,["property","label"]))),256)),a(sl,{fixed:"right",width:"150",label:"操作"},{default:l(n=>[a(w,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(u,{link:"",type:"primary",icon:h(Xl),onClick:z=>da(n.row)},null,8,["icon","onClick"])]),_:2},1024),a(w,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:h(wt),onClick:o=>da(n.row,!0)},null,8,["icon","onClick"]),[[we,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:edit`]])]}),_:2},1024),a(w,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:h(ha),onClick:o=>Ka(n.row)},null,8,["icon","onClick"]),[[we,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:edit`]])]}),_:2},1024),a(w,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:h(kt),onClick:o=>Qa(n.row)},null,8,["icon","onClick"]),[[we,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:view`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[it,tl.value]]),a(lt,{"current-page":Z.value,"onUpdate:currentPage":e[10]||(e[10]=n=>Z.value=n),"page-size":L.value,"onUpdate:pageSize":e[11]||(e[11]=n=>L.value=n),"page-sizes":[10,20,50,100,200],size:Ze.value,disabled:He.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:Bl.value,onSizeChange:Ge,onCurrentChange:I,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[$("div",go,[$("div",bo,[a(et,{modelValue:ge.value,"onUpdate:modelValue":e[9]||(e[9]=n=>ge.value=n),label:"全选",size:"default",onChange:Sa},null,8,["modelValue"])]),a(Q,null,{default:l(()=>[p("已选择 "+x(ge.value?Bl.value:re.value.length)+" 条",1)]),_:1})])]),_:1},8,["current-page","page-size","size","disabled","total"])])):M("",!0),a(dt,{modelValue:Ve.value,"onUpdate:modelValue":e[22]||(e[22]=n=>Ve.value=n),class:"edit-drawer",direction:"rtl",size:"45%","before-close":Ha},{header:l(()=>[Te.value?(t(),d(Q,{key:1,tag:"b"},{default:l(()=>e[45]||(e[45]=[p("实例信息 ")])),_:1})):(t(),d(at,{key:0,title:"实例信息"},{default:l(()=>[a(fa,{label:"唯一标识"},{default:l(()=>{var n;return[p(x((n=je.value)==null?void 0:n.instance_name),1)]}),_:1}),a(fa,{label:"所属分组"},{default:l(()=>{var n;return[(t(!0),r(te,null,ce((n=je.value)==null?void 0:n.instance_group,(z,o)=>(t(),d(Q,{key:o},{default:l(()=>[p(x(z.group_path),1)]),_:2},1024))),128))]}),_:1})]),_:1}))]),default:l(()=>[a(ut,{modelValue:Pl.value,"onUpdate:modelValue":e[17]||(e[17]=n=>Pl.value=n),type:"card",class:"demo-tabs",onTabClick:Wa},{default:l(()=>[a(jl,{label:"资产信息",name:"modelField"},{default:l(()=>[a(Ql,{ref_key:"ciDataFormRef",ref:ol,style:{"max-width":"100%"},model:v,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[W.value?(t(),d(xe,{key:0,prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>e[46]||(e[46]=[p("唯一标识")])),_:1}),a(w,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:1})]),_:1})]),default:l(()=>[W.value?(t(),d(Ae,{key:0,modelValue:v.instance_name,"onUpdate:modelValue":e[12]||(e[12]=n=>v.instance_name=n),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",wo,x(v.instance_name),1))]),_:1})):M("",!0),a(st,{modelValue:F.value,"onUpdate:modelValue":e[16]||(e[16]=n=>F.value=n)},{default:l(()=>[(t(!0),r(te,null,ce(Se.value.field_groups,(n,z)=>(t(),d(nt,{name:z,key:z},{title:l(()=>[a(Q,{tag:"b",size:"large"},{default:l(()=>[p(x(n.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(ma,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(te,null,ce(n.fields,(o,f)=>(t(),d(Wl,{span:12},{default:l(()=>[o.type==="string"?(t(),d(xe,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:za(o.validation_rule)},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Ae,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ko,[v[o.name]!=null?(t(),r("div",ho,[o.name==="mgmt_ip"?(t(),d(Be,{key:0,href:`https://${v[o.name]}`,type:"primary",target:"_blank"},{default:l(()=>[p(x(v[o.name]),1)]),_:2},1032,["href"])):(t(),r("span",{key:1,class:Ie(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(v[o.name]),3))])):(t(),r("span",Co,"--"))]))]),_:2},1032,["label","prop","required","rules"])):M("",!0),o.type==="json"?(t(),d(xe,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),a(w,{placement:"right",effect:"dark"},{content:l(()=>e[47]||(e[47]=[p(" json类型字段"),$("br",null,null,-1),p("请输入json格式数据! ")])),default:l(()=>[a(N,null,{default:l(()=>[a(tt)]),_:1})]),_:1}),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Ae,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",xo,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},x(v[o.name]),3)):(t(),r("span",Vo,"--"))]))]),_:2},1032,["label","prop","required"])):M("",!0),["text"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Ae,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",$o,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(v[o.name]),3)):(t(),r("span",Mo,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),d(xe,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[a(Je,{modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!W.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):M("",!0),["float"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(Q,{key:0,tag:"b"},{default:l(()=>[p(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(Q,{key:1,tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(w,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Gl,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Oo,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},x(v[o.name]),3)):(t(),r("span",Do,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>{var D,Re,ka;return[W.value?(t(),d(Ae,{key:1,modelValue:v[o.name],"onUpdate:modelValue":fl=>v[o.name]=fl,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Uo,[((D=v[o.name])==null?void 0:D.length)>>0?(t(),r("div",Io,[U.value?(t(),r("span",Fo,x(h(ml)(q.value.key,q.value.mode,v[o.name])),1)):(t(),r("span",{key:1,class:Ie([{requiredClass:o.required},"hide-text"]),onMouseenter:e[14]||(e[14]=fl=>K.value=!0),onMouseleave:e[15]||(e[15]=fl=>K.value=!1)},[p(x("*".repeat((Re=v[o.name])==null?void 0:Re.length))+" ",1),Y((t(),d(ot,{width:380,trigger:"click",onAfterLeave:de},{reference:l(()=>[a(N,null,{default:l(()=>[Y(a(h(Xl),null,null,512),[[Tl,K.value&&!U.value]])]),_:1})]),default:l(()=>[a(Ql,{ref_for:!0,ref_key:"passFormRef",ref:he,inline:!0,model:_e,"require-asterisk-position":"right"},{default:l(()=>[a(ma,{align:"middle"},{default:l(()=>[a(Wl,{span:20},{default:l(()=>[a(xe,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(Ae,{type:"password",modelValue:_e.secret,"onUpdate:modelValue":e[13]||(e[13]=fl=>_e.secret=fl),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(Wl,{span:2},{default:l(()=>[a(xe,null,{default:l(()=>[a(u,{type:"primary",size:"small",onClick:fl=>fe(he.value,v[o.name])},{default:l(()=>e[48]||(e[48]=[p("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),H.value?(t(),d(Q,{key:0,tag:"b"},{default:l(()=>[p("密码: "+x(ye.value)+" ",1),a(w,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(N,null,{default:l(()=>[Y(a(h(ha),null,null,512),[[ct,ye.value]])]),_:1})]),_:1})]),_:1})):M("",!0)]),_:2},1024)),[[we,`${(ka=h(y).name)==null?void 0:ka.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",No,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(Q,{key:0,tag:"b"},{default:l(()=>[p(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(Q,{key:1,tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(w,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Gl,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Po,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},x(v[o.name]),3)):(t(),r("span",So,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(ql,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",qo,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},x(v[o.name]),3)):(t(),r("span",jo,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(ql,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",To,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},x(v[o.name]),3)):(t(),r("span",Eo,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>{var D;return[W.value?(t(),d(Ml,{key:1,modelValue:v[o.name],"onUpdate:modelValue":Re=>v[o.name]=Re,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(te,null,ce(Yl.value[o.validation_rule],Re=>(t(),d($l,{key:Re.value,label:Re.label,value:Re.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",Ao,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},x((D=je.value[o.name])==null?void 0:D.label),3)):(t(),r("span",Ro,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?M("",!0):(t(),d(xe,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(w,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(N,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Ml,{key:1,modelValue:v[o.name],"onUpdate:modelValue":D=>v[o.name]=D,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(te,null,ce(xl.value[o.name],(D,Re)=>(t(),d($l,{key:Re,label:D.label,value:D.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",zo,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},x(je.value[o.name].instance_name),3)):(t(),r("span",Lo,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1}),Te.value?M("",!0):(t(),d(jl,{key:0,label:"监控信息",name:"monitor",disabled:""},{default:l(()=>e[49]||(e[49]=[p("111")])),_:1})),Te.value?M("",!0):(t(),d(jl,{key:1,label:"关联关系",name:"relations",disabled:""},{default:l(()=>e[50]||(e[50]=[p("222")])),_:1})),Te.value?M("",!0):(t(),d(jl,{key:2,label:"变更记录",name:"changelog",disabled:""},{default:l(()=>e[51]||(e[51]=[p("Role")])),_:1}))]),_:1},8,["modelValue"])]),footer:l(()=>{var n,z,o,f;return[Y($("div",Yo,[a(u,{onClick:e[18]||(e[18]=D=>Ga(ol.value))},{default:l(()=>e[52]||(e[52]=[p("取消")])),_:1}),Te.value?(t(),r("div",Bo,[a(u,{type:"primary",onClick:e[19]||(e[19]=D=>ca(ol.value))},{default:l(()=>e[53]||(e[53]=[p("添加")])),_:1})])):(t(),r("div",Jo,[W.value?(t(),r("div",Ko,[Ta((n=je.value)==null?void 0:n.instance_group)?Y((t(),d(u,{key:0,type:"danger",onClick:pa},{default:l(()=>e[54]||(e[54]=[p("删除")])),_:1})),[[we,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:delete`]]):Y((t(),d(w,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(u,{type:"danger",onClick:pa,disabled:""},{default:l(()=>e[55]||(e[55]=[p("删除")])),_:1})]),_:1})),[[we,`${(o=h(y).name)==null?void 0:o.replace("_info","")}:delete`]]),Y((t(),d(u,{type:"primary",onClick:e[20]||(e[20]=D=>ca(ol.value))},{default:l(()=>e[56]||(e[56]=[p("保存")])),_:1})),[[ya]])])):(t(),r("div",Ho,[Y((t(),d(u,{type:"primary",onClick:e[21]||(e[21]=D=>W.value=!0)},{default:l(()=>e[57]||(e[57]=[p("编辑")])),_:1})),[[we,`${(f=h(y).name)==null?void 0:f.replace("_info","")}:edit`]])]))]))],512),[[Tl,Pl.value==="modelField"]])]}),_:1},8,["modelValue"]),a(_a,{modelValue:al.value,"onUpdate:modelValue":e[24]||(e[24]=n=>al.value=n),title:"批量更新",width:"500","before-close":kl},{footer:l(()=>[$("div",sn,[a(u,{onClick:kl},{default:l(()=>e[58]||(e[58]=[p("取消")])),_:1}),a(u,{onClick:e[23]||(e[23]=Ol(n=>wl(),["prevent"]))},{default:l(()=>e[59]||(e[59]=[p("新增字段")])),_:1}),Y((t(),d(u,{type:"primary",onClick:Ul,disabled:!(Pe.value.length>0)},{default:l(()=>e[60]||(e[60]=[p("保存")])),_:1},8,["disabled"])),[[ya]])])]),default:l(()=>[a(Ql,{ref_key:"multipleFormRef",ref:ll,style:{"max-width":"1000px"},model:P,"label-width":"auto"},{default:l(()=>[(t(!0),r(te,null,ce(Pe.value,(n,z)=>{var o;return t(),d(xe,{key:`param-${n}`,label:"字段"+(z+1),prop:`updateParams.${n}`,rules:Rl((o=be.value[n])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(Oe,null,{default:l(()=>[a(Ml,{"model-value":n.startsWith("__temp")?void 0:n,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:f=>zl(z,f)},{default:l(()=>[(t(!0),r(te,null,ce(Ue.value,f=>(t(),d($l,{key:f.value,label:f.label,value:f.value,disabled:f.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),n&&!n.startsWith("__temp")?(t(),r("div",Go,[["text","json"].indexOf(be.value[n].type)>>>-1?["string"].indexOf(be.value[n].type)>>>-1?["enum"].indexOf(be.value[n].type)>>>-1?["model_ref"].indexOf(be.value[n].type)>>>-1?["boolean"].indexOf(be.value[n].type)>>>-1?["integer"].indexOf(be.value[n].type)>>>-1?["float"].indexOf(be.value[n].type)>>>-1?["date"].indexOf(be.value[n].type)>>>-1?["datetime"].indexOf(be.value[n].type)>>>-1?(t(),r("div",nn,[a(Ae,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",on,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Le(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(ql,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",tn,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Le(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(ql,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",an,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Le(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Gl,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",ln,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Le(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Ae,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",en,[a(Je,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Zo,[a(Ml,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(te,null,ce(xl.value[n],(f,D)=>(t(),d($l,{key:D,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Xo,[a(Ml,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ce(Yl.value[be.value[n].validation_rule],f=>(t(),d($l,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Qo,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Le(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Ae,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Wo,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Le(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Ae,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):M("",!0),a(u,{class:"mt-2",icon:h(ht),circle:"",onClick:Ol(f=>Ce(z,n),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(_a,{modelValue:Xe.value,"onUpdate:modelValue":e[27]||(e[27]=n=>Xe.value=n),title:"实例组编辑",width:"500"},{footer:l(()=>[$("div",un,[a(u,{onClick:e[26]||(e[26]=n=>Xe.value=!1)},{default:l(()=>e[61]||(e[61]=[p("取消")])),_:1}),a(u,{type:"primary",onClick:Ne},{default:l(()=>e[62]||(e[62]=[p(" 提交更新 ")])),_:1})])]),default:l(()=>[a(rt,{options:C.treeData,props:cl,clearable:"",modelValue:k.value,"onUpdate:modelValue":e[25]||(e[25]=n=>k.value=n),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),le.value?(t(),d(Ft,{key:1,isShowUpload:We.value,"onUpdate:isShowUpload":e[28]||(e[28]=n=>We.value=n),ciModelId:C.ciModelId,currentNodeId:C.currentNodeId,onGetCiData:Me},null,8,["isShowUpload","ciModelId","currentNodeId"])):M("",!0),le.value?(t(),d(ro,{key:2,ciModelId:C.ciModelId,currentNodeId:C.currentNodeId,allModelFieldByNameObj:be.value,enumOptionObj:Yl.value,validationRulesObj:qe.value,allModelField:Vl.value,modelRefOptions:xl.value,showFilter:pe.value,"onUpdate:showFilter":e[29]||(e[29]=n=>pe.value=n),onUpdateFilterParam:sa,onGetCiData:Me,ref_key:"ciDataFilterRef",ref:ve},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):M("",!0),a(Rt,{ciModelId:C.ciModelId,allModelField:Vl.value,allModelFieldInfo:qa.value,isShowTableCol:Ll.value,"onUpdate:isShowTableCol":e[30]||(e[30]=n=>Ll.value=n),hasConfigField:Fl.value,"onUpdate:hasConfigField":e[31]||(e[31]=n=>Fl.value=n),onReloadTable:ta,ref_key:"ciDataTableColRef",ref:aa},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(Lt,{showAllPassDia:ue.value,"onUpdate:showAllPassDia":e[32]||(e[32]=n=>ue.value=n)},null,8,["showAllPassDia"]),a(Bt,{qCodeContext:va.value,showqCodeDia:Jl.value,"onUpdate:showqCodeDia":e[33]||(e[33]=n=>Jl.value=n)},null,8,["qCodeContext","showqCodeDia"])],64)}}}),rn=Al(dn,[["__scopeId","data-v-a6d493bd"]]),cn={class:"card ci_data_tree"},pn={class:"custom-tree-node"},vn={class:"table-box"},fn=rl({name:"cidata",__name:"cidataView",setup(ee){const me=Ma(),{proxy:J}=gl(),O=i(!0),A=Ot(),y=i(""),X=i(!1);i(""),i(!1);const ae=i(),C=i([]),oe=i("");El(oe,k=>{b.value.filter(k)});const F=(k,g)=>k?g.label.toLowerCase().includes(k.toLowerCase()):!0,pe=k=>!(k.level>Dl.value-1||k.label==="空闲池"),ne=async()=>{X.value=!0;let k=await J.$api.getCiModelTree({model:y.value});console.log(k),C.value=[k.data],ke(()=>{m.value===1&&(b.value.setCurrentKey(k.data.id),m.value=b.value.getCurrentKey())}),X.value=!1},le=E(()=>A.ciLastModel),se=i([]),ve=async()=>{let k=await J.$api.getCiModel();se.value=k.data.results,A.setModelList(se.value),console.log(le.value),le.value===void 0||le.value===null?(y.value=se.value.find(g=>g.name==="hosts").id,ke(()=>{A.setCiLastModel(y.value)})):y.value=le.value},G=i([]),ue=async()=>{let k=await J.$api.getCiModelGroup();G.value=k.data.results},q=E(()=>{let k=new Array;return G.value.forEach(g=>{let T=new Array;se.value.forEach(Ne=>{Ne.model_group===g.id&&T.push({value:Ne.id,label:Ne.verbose_name})}),k.push({value:g.id,label:g.verbose_name,children:T})}),k});E(()=>{let k={};return se.value.forEach(g=>{k[g.id]=g}),k});const U=i(""),ze=async()=>{A.setCiLastModel(y.value),m.value=1,await ne(),await U.value.closeFilter(),await U.value.updateFilterParam({}),await U.value.clearMultipleSelect(),U.value.reloadCiDataFilter(),await U.value.setLoading(!0),await U.value.getModelField(),await U.value.getHasConfigField(),await U.value.setLoading(!1),await U.value.initCiDataForm(),await U.value.getCiData({model:y.value,model_instance_group:m.value})};Oa(async()=>{await ue(),await ve(),await ne(),U.value.setLoading(!0),await U.value.getModelField(),await U.value.getHasConfigField(),await U.value.setLoading(!1),await U.value.initCiDataForm(),await U.value.getCiData({model:y.value,model_instance_group:b.value.getCurrentKey()})});const B=k=>k.built_in?!1:k.children?!(k.children.length>>>0):!0,b=i(),_=i(),m=i(1),K=i(!1),de=i(100),he=(k,g)=>{L.value=!1;let T=de.value++;b.value.append({id:T,label:"新建子目录",level:g.level+1,parent:g.id,model:y.value},k),b.value.setCurrentKey(T),fe.value=T,ke(()=>{_.value.focus()})},_e=(k,g)=>{let T=de.value++;L.value=!1,b.value.insertAfter({id:T,label:"新建目录",level:g.level,parent:k.parent.data.id,model:y.value},k),b.value.setCurrentKey(T),fe.value=T,ke(()=>{_.value.focus()})},ye=()=>{m.value=b.value.getCurrentKey(),U.value.clearMultipleSelect(),U.value.setLoading(!0),U.value.getCiData({model:y.value,model_instance_group:b.value.getCurrentKey()}),U.value.setLoading(!0)},H=k=>{K.value=!K.value,k.isShowEdit=K.value},fe=i(99999),Z=i(""),L=i(!0),Ze=k=>{L.value=!0,console.log(k),Z.value=k.label,fe.value=k.id,ke(()=>{_.value.focus()})},He=async(k,g)=>{if(fe.value=99999,!Z.value)S.warning("名称不可为空"),b.value.remove(g);else if(L.value){if(Z.value==g.label)return!1;{let T=await J.$api.updateCiModelTree({id:g.id,label:Z.value});T.status=="200"?(S({type:"success",message:"更新成功"}),g.label=Z.value,ne(),Z.value=""):S({showClose:!0,message:"更新失败:"+JSON.stringify(T.data),type:"error"}),console.log(g)}}else{g.label=Z.value,console.log(g);let T=await J.$api.addCiModelTree(g);T.status=="201"?(S({type:"success",message:"添加成功"}),ne(),Z.value=""):(S({showClose:!0,message:"添加失败:"+JSON.stringify(T.data),type:"error"}),b.value.remove(g))}},Ge=k=>{k&&ea.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await J.$api.deleteCiModelTree(k.data.id)).status==200?(S({type:"success",message:"删除成功"}),await ne()):S({type:"error",message:"删除失败"})}).catch(()=>{})},I=i(""),Fe=(k,g)=>{I.value=k,console.log(I.value)},j=(k,g,T)=>{},We=(k,g,T)=>{},Qe=(k,g,T)=>{},il=async(k,g,T,Ne)=>{if(g.data.id===k.data.id)return;let ll=await J.$api.updateCiModelTree({id:k.data.id,target_id:g.data.id,position:T});ll.status=="200"?(S({type:"success",message:"更新排序成功"}),ne()):S({showClose:!0,message:"更新排序失败:"+JSON.stringify(ll.data),type:"error"})},el=(k,g,T,Ne)=>{},Dl=i(5),cl=(k,g,T)=>g.data.built_in?!1:T!=="inner",Xe=k=>!k.data.built_in;return(k,g)=>{const T=c("el-text"),Ne=c("el-col"),ll=c("el-tree-select"),al=c("el-row"),R=c("el-divider"),Le=c("el-input"),bl=c("a-menu-item"),Rl=c("a-menu"),P=c("a-dropdown"),Pe=c("el-space"),wl=_l("permission"),zl=_l("loading");return t(),r(te,null,[Y($("div",cn,[a(al,{align:"middle",justify:"start"},{default:l(()=>[a(Ne,{span:8},{default:l(()=>[a(T,{tag:"b"},{default:l(()=>g[7]||(g[7]=[p("实例树")])),_:1})]),_:1}),a(Ne,{span:14},{default:l(()=>[a(ll,{modelValue:y.value,"onUpdate:modelValue":g[0]||(g[0]=Ce=>y.value=Ce),data:q.value,onChange:g[1]||(g[1]=Ce=>ze()),"render-after-expand":!1,style:{display:"block",width:"100%",height:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1}),a(R),a(Le,{modelValue:oe.value,"onUpdate:modelValue":g[2]||(g[2]=Ce=>oe.value=Ce),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),Y((t(),d(h($t),{style:{"max-width":"280px",height:"auto"},"allow-drop":cl,"allow-drag":Xe,data:C.value,draggable:!0,"default-expand-all":"","node-key":"id",onNodeDragStart:Fe,onNodeDragEnter:j,onNodeDragLeave:We,onNodeDragOver:Qe,onNodeDragEnd:il,onNodeDrop:el,"highlight-current":!0,"current-node-key":m.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:b,onNodeClick:ye,"filter-node-method":F},{default:l(({node:Ce,data:$e})=>{var Ul;return[$("div",pn,[fe.value===$e.id?(t(),d(Le,{key:0,modelValue:Z.value,"onUpdate:modelValue":g[3]||(g[3]=Ue=>Z.value=Ue),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:_,onBlur:Ue=>He(Ue,$e),onKeyup:g[4]||(g[4]=Ct(Ue=>Ue.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),d(T,{key:1,size:"default"},{default:l(()=>[p(x(Ce.label),1),a(T,{size:"small"},{default:l(()=>[p("("+x($e.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),Y((t(),r("div",{class:Ie(["actionClass",{is_show_action:Ce.isShowEdit}])},[a(Pe,null,{default:l(()=>[$e.built_in?M("",!0):(t(),d(h(xt),{key:0,onClick:Ol(Ue=>Ze($e),["stop"])},null,8,["onClick"])),a(P,{trigger:["click"],ref_key:"aDropdownRef",ref:ae,onOpenChange:Ue=>H(Ce)},{overlay:l(()=>[a(Rl,null,{default:l(()=>{var Ue,kl;return[Y((t(),r("div",null,[$e.level!==1?(t(),d(bl,{key:"0",onClick:tl=>_e(Ce,$e)},{default:l(()=>g[8]||(g[8]=[p(" 添加同级节点 ")])),_:2},1032,["onClick"])):M("",!0),pe($e)?(t(),d(bl,{key:"1",onClick:tl=>he(Ce,$e)},{default:l(()=>g[9]||(g[9]=[p(" 添加子节点 ")])),_:2},1032,["onClick"])):M("",!0)])),[[wl,`${(Ue=h(me).name)==null?void 0:Ue.replace("_info","")}:add`]]),Y((t(),r("div",null,[B($e)?(t(),d(bl,{key:"2",onClick:tl=>Ge(Ce)},{default:l(()=>g[10]||(g[10]=[p(" 删除节点 ")])),_:2},1032,["onClick"])):M("",!0)])),[[wl,`${(kl=h(me).name)==null?void 0:kl.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(h(Vt),{onClick:g[5]||(g[5]=Ol(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[wl,`${(Ul=h(me).name)==null?void 0:Ul.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[zl,X.value]])],512),[[Tl,O.value]]),$("div",vn,[a(rn,{ciModelId:y.value,treeData:C.value,currentNodeId:m.value,ref_key:"ciDataShowRef",ref:U,onGetTree:ne,showTree:O.value,"onUpdate:showTree":g[6]||(g[6]=Ce=>O.value=Ce)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),wn=Al(fn,[["__scopeId","data-v-b1319819"]]);export{wn as default};
