import{d as ll,aB as Be,bu as el,r as i,c as Ze,e as c,o as t,O as d,w as l,g as a,h as $,j as v,t as x,f as r,bo as b,c5 as Ve,P as V,c2 as wa,c4 as N,k as Pl,M as H,bI as Nl,F as te,b1 as ie,bS as ka,c6 as st,aD as $e,_ as Sl,c7 as Xe,u as ha,bQ as bl,b as Ca,aN as xa,b3 as rl,c8 as ut,c9 as dt,bO as Y,b_ as rt,ca as Jl,cb as it,cc as ct,cd as pt,bF as Il,Y as vt,aE as Fe,c0 as ft,ce as ba,cf as mt,c1 as _t,bV as Hl,cg as yt,i as gt,ch as bt,ci as wt,cj as kt}from"./index-DbTZdHLp.js";import{l as ht}from"./vue-draggable-plus-DEgAJFIW.js";import{u as Va}from"./config-CYpKbXkl.js";import{e as Kl,d as gl}from"./gmCrypto-CNDMR_hv.js";const Ct={class:"flexJstart gap-1"},xt={key:0,class:"flexJstart gap-1"},Vt={key:3,class:"flexJstart gap-1"},$t=ll({__name:"ciDataUpload",props:Be(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:Be(["getCiData"],["update:isShowUpload"]),setup(oe,{emit:ne}){const{proxy:B}=Pl(),M=oe,j=ne,k=el(oe,"isShowUpload"),A=i([]),ae=i(null),h=["xlsx"],fe=i(10),D=i({}),le=i({}),ce=Ze({"Content-Type":"multipart/form-data"}),q=i({}),Me=async()=>{Object.keys(le.value).length>0?Object.entries(le.value).forEach(async([E,m])=>{let p=await B.$api.importCiDataStatus(m);D.value[E]=p.data,p.data.status==="completed"&&delete le.value[E]}):(clearInterval(C),C=null,j("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId}))};let C=null;const Oe=async E=>{let m=new FormData;m.append("file",E.file),m.append("model",M.ciModelId);let p=await B.$api.importCiData(m,ce,2*60*1e3);p.status==200?(le.value[E.file.uid]=p.data,q.value[E.file.uid]=!0,C===null&&(C=setInterval(Me,2e3))):(q.value[E.file.uid]=!1,N({message:`导入异常: ${JSON.stringify(p.data)}`,type:"error",showClose:!0}))},Z=()=>{},O=E=>{let m=E.name;if(E.type!=""||E.type!=null||E.type!=null){const p=E.name.replace(/.+\./,"").toLowerCase();return E.size/1024/1024<5?h.includes(p)?A.value.find(ge=>ge.name==m&&ge.lastModified==E.lastModified)?(N({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(N({message:`不能上传${p}类型的文件`,type:"error",showClose:!0}),!1):(N.error("上传文件大小不能超过 5MB!"),!1)}},pe=async E=>{await B.$api.downloadErrorRecords({error_file_key:E})},ye=async()=>{await B.$api.downloadImportTemplate({model:M.ciModelId})};return(E,m)=>{const p=c("upload-filled"),L=c("el-icon"),se=c("el-col"),ge=c("el-button"),re=c("el-row"),G=c("Loading"),ue=c("CircleCheck"),ee=c("el-link"),ke=c("el-upload"),Ie=c("el-dialog");return t(),d(Ie,{modelValue:k.value,"onUpdate:modelValue":m[1]||(m[1]=J=>k.value=J),title:"导入",width:"800"},{default:l(()=>[a(ke,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:ae,headers:ce,"http-request":Oe,"file-list":A.value,"before-upload":O,limit:fe.value,onOnChange:Z,"show-file-list":""},{tip:l(()=>[a(re,{justify:"space-between",align:"middle"},{default:l(()=>[a(se,{span:18},{default:l(()=>m[2]||(m[2]=[$("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(se,{span:3},{default:l(()=>[a(ge,{link:"",type:"primary",onClick:m[0]||(m[0]=J=>ye())},{default:l(()=>m[3]||(m[3]=[v("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:J,index:al})=>{var Je,U,Ne,S,tl,Ke,ol,We,w;return[$("div",Ct,[$("span",null,x(J.name),1),q.value[J.uid]==!0?(t(),r("div",xt,[((Je=D.value[J.uid])==null?void 0:Je.status)!=="completed"?(t(),d(L,{key:0,class:"is-loading"},{default:l(()=>[a(G)]),_:1})):((U=D.value[J.uid])==null?void 0:U.failed)>>>0?(t(),d(L,{key:1},{default:l(()=>[a(b(Ve),{color:"var(--el-color-warning)"})]),_:1})):(t(),d(L,{key:2},{default:l(()=>[a(ue,{color:"var(--el-color-success)"})]),_:1})),D.value[J.uid]?(t(),r("div",Vt,[$("span",null,x(`进度: ${(Ne=D.value[J.uid])==null?void 0:Ne.progress}%`),1),$("span",null,x(`结果: 总条数: ${(S=D.value[J.uid])==null?void 0:S.total},创建: ${(tl=D.value[J.uid])==null?void 0:tl.created},更新: ${(Ke=D.value[J.uid])==null?void 0:Ke.updated},跳过: ${(ol=D.value[J.uid])==null?void 0:ol.skipped},失败: ${(We=D.value[J.uid])==null?void 0:We.failed}.`),1),((w=D.value[J.uid])==null?void 0:w.failed)>>>0?(t(),d(ee,{key:0,type:"danger",onClick:g=>{var I;return pe((I=D.value[J.uid])==null?void 0:I.error_file_key)}},{default:l(()=>m[4]||(m[4]=[v("查看导入失败数据")])),_:2},1032,["onClick"])):V("",!0)])):V("",!0)])):q.value[J.uid]==!1?(t(),d(L,{key:1},{default:l(()=>[a(b(wa),{color:"var(--el-color-error)"})]),_:1})):V("",!0)])]}),default:l(()=>[a(L,{class:"el-icon--upload"},{default:l(()=>[a(p)]),_:1}),m[5]||(m[5]=$("div",{class:"el-upload__text"},[v("拖拽文件到此或者 "),$("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])}}}),Mt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Ot={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Dt={style:{width:"100%",overflow:"auto"}},Ut={class:"listItem"},Ft={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},It={class:"listItem"},Pt={style:{flex:"auto"}},Nt=ll({__name:"ciDataTableCol",props:Be(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:Be(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(oe,{expose:ne,emit:B}){const M=oe,j=el(oe,"isShowTableCol"),k=el(oe,"hasConfigField"),{proxy:A}=Pl(),ae=i(""),h=i(""),fe=H(()=>ae.value===""?E.value:E.value.filter(m=>m.verbose_name.includes(ae.value)));function D(){j.value=!1}const le=m=>{k.value.push(m)},ce=m=>{let p=k.value.indexOf(m);k.value.splice(p,1)},q=m=>{console.log("start",m)},Me=m=>{console.log("onEnd",m),console.log(k.value)},C=()=>{console.log("update")},Oe=i({}),Z=async()=>{let m=await A.$api.getCiModelCol({model:M.ciModelId});Oe.value=m.data;let p=[];m.data.fields_preferred.forEach(L=>{p.push(M.allModelFieldInfo[L])}),k.value=p},O=H(()=>k.value.map(m=>m.id)),pe=B;Nl(()=>k.value,m=>{console.log("更新表格"),pe("reloadTable")},{deep:!0});const ye=async()=>{let m=await A.$api.updateCiModelCol({id:Oe.value.id,fields_preferred:O.value});m.status=="200"?(N({type:"success",message:"更新成功"}),$e(()=>{h.value.clear(),j.value=!1})):N({showClose:!0,message:"更新失败:"+JSON.stringify(m.data),type:"error"})},E=H(()=>M.allModelField.filter(m=>!k.value.includes(m)));return ne({getHasConfigField:Z}),(m,p)=>{const L=c("el-text"),se=c("el-divider"),ge=c("el-input"),re=c("el-icon"),G=c("el-button"),ue=c("el-drawer");return t(),d(ue,{modelValue:j.value,"onUpdate:modelValue":p[2]||(p[2]=ee=>j.value=ee),direction:"rtl",size:"40%"},{header:l(()=>[a(L,{tag:"b"},{default:l(()=>p[3]||(p[3]=[v("表格列显示配置")])),_:1})]),default:l(()=>[$("div",Mt,[$("div",Ot,[a(L,{tag:"b"},{default:l(()=>p[4]||(p[4]=[v("模型字段")])),_:1}),a(se),a(ge,{modelValue:ae.value,"onUpdate:modelValue":p[0]||(p[0]=ee=>ae.value=ee),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:h},null,8,["modelValue"]),$("div",Dt,[(t(!0),r(te,null,ie(fe.value,(ee,ke)=>(t(),r("div",{key:ke},[$("div",Ut,[$("span",null,x(ee.verbose_name),1),a(re,null,{default:l(()=>[a(b(ka),{onClick:Ie=>le(ee)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),$("div",Ft,[a(L,{tag:"b"},{default:l(()=>p[5]||(p[5]=[v("已显示字段")])),_:1}),a(se),a(b(ht),{"force-fallback":!0,"scroll-sensitivity":200,ref:"el",modelValue:k.value,"onUpdate:modelValue":p[1]||(p[1]=ee=>k.value=ee),onStart:q,onUpdate:C,onEnd:Me,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(te,null,ie(k.value,(ee,ke)=>(t(),r("div",{key:ke},[$("div",It,[$("span",null,x(ee.verbose_name),1),a(re,null,{default:l(()=>[a(b(st),{onClick:Ie=>ce(ee)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[$("div",Pt,[a(G,{onClick:D},{default:l(()=>p[6]||(p[6]=[v("取消")])),_:1}),a(G,{type:"primary",onClick:ye},{default:l(()=>p[7]||(p[7]=[v("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),St=Sl(Nt,[["__scopeId","data-v-3859704e"]]),qt={class:"dialog-footer"},jt=ll({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(oe){const ne=Va(),B=el(oe,"showAllPassDia"),M=H(()=>ne.gmCry),j=i(),k=Ze({secret:null,time:3});i(""),i(!1);const A=async fe=>{fe.validate(async D=>{D&&(k.secret===M.value.key?(Xe({title:"操作成功",message:"解密成功,"+k.time+"分钟后过期！",type:"success",duration:2e3}),ne.updateShowAllPass(!0),B.value=!1,ne.setShowAllPassTime(k.time*60*1e3),ae(j.value)):Xe({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},ae=fe=>{fe&&fe.resetFields()},h=()=>{B.value=!1,ae(j.value)};return(fe,D)=>{const le=c("el-input"),ce=c("el-form-item"),q=c("el-input-number"),Me=c("el-form"),C=c("el-button"),Oe=c("el-dialog");return t(),d(Oe,{modelValue:B.value,"onUpdate:modelValue":D[3]||(D[3]=Z=>B.value=Z),title:"查看密码",width:"400"},{footer:l(()=>[$("div",qt,[a(C,{onClick:h},{default:l(()=>D[5]||(D[5]=[v("取消")])),_:1}),a(C,{type:"primary",onClick:D[2]||(D[2]=Z=>A(j.value))},{default:l(()=>D[6]||(D[6]=[v(" 查看 ")])),_:1})])]),default:l(()=>[a(Me,{ref_key:"allPassFormRef",ref:j,inline:!0,model:k,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(ce,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(le,{type:"password",modelValue:k.secret,"onUpdate:modelValue":D[0]||(D[0]=Z=>k.secret=Z),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(ce,{label:"有效时间",prop:"time"},{default:l(()=>[a(q,{modelValue:k.time,"onUpdate:modelValue":D[1]||(D[1]=Z=>k.time=Z),min:1,step:1,max:30},{suffix:l(()=>D[4]||(D[4]=[$("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Tt={style:{display:"flex","justify-content":"center"}},Rt=ll({__name:"ciDataqCode",props:Be(["qCodeContext"],{showqCodeDia:{},showqCodeDiaModifiers:{}}),emits:["update:showqCodeDia"],setup(oe){ha();const ne=el(oe,"showqCodeDia"),B=oe;return(M,j)=>{const k=c("a-qrcode"),A=c("el-dialog");return t(),d(A,{modelValue:ne.value,"onUpdate:modelValue":j[0]||(j[0]=ae=>ne.value=ae),title:"实例二维码",width:"600"},{default:l(()=>[$("div",Tt,[a(k,{value:JSON.stringify(B.qCodeContext),size:500},null,8,["value"])])]),_:1},8,["modelValue"])}}}),Et={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},At={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Lt={style:{width:"100%",overflow:"auto"}},zt={class:"listItem"},Yt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Bt={style:{"margin-right":"5px"}},Jt={style:{float:"left"}},Kt={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Ht={key:0},Wt={key:1},Gt={key:0},Qt={key:1},Xt={key:2},Zt={key:3},eo={style:{flex:"auto"}},lo=ll({__name:"ciDataFilter",props:Be(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:Be(["getCiData","updateFilterParam"],["update:showFilter"]),setup(oe,{expose:ne,emit:B}){const M=oe,j=el(oe,"showFilter"),k=i(""),A=i(""),ae=H(()=>k.value===""?ce.value:ce.value.filter(m=>m.verbose_name.includes(k.value)));function h(){j.value=!1}const fe=m=>{Z.value.push(m)},D=m=>{let p=C.filterParams.indexOf(m);Z.value.splice(p,1)},le=(m,p)=>{m==="instance_name"?C.instance_name="":Z.value.splice(p,1),$e(()=>{q("updateFilterParam",O.value)})},ce=H(()=>M.allModelField.filter(m=>!Z.value.includes(m)));i({});const q=B,Me=i(""),C=Ze({filterParams:[],instance_name:""}),Oe=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"包含",description:"包含以,分隔"},{value:"not:in:",label:"不包含",description:"不包含以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"not:null",label:"非空",description:"正则表达式"}]),Z=i([]),O=H(()=>{let m=new Object;return C.filterParams.forEach(p=>{if(p.match==="null"||p.match==="not:null"){m[p.name]=p.match;return}if(p.value!==""){let L=null;p.value!==null?L=p.value:L="null",p.match==="="?m[p.name]=L:m[p.name]=p.match+L}}),C.instance_name!==""&&(m.instance_name=C.instance_name),m}),pe=()=>{console.log(O.value),q("updateFilterParam",O.value),console.log(O.value),$e(()=>{q("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId})}),j.value=!1},ye=H(()=>{var m;return(m=C.filterParams)==null?void 0:m.map(p=>p.name)});Nl(()=>Z.value,m=>{var L;let p=new Array;(L=Z.value)==null||L.forEach((se,ge)=>{var re;if(((re=ye.value)==null?void 0:re.indexOf(se.name))>>>-1)p.push({name:se.name,value:"",match:"=",label:se.verbose_name});else{let G=C.filterParams.findIndex(ue=>ue.name===se.name);p.push(C.filterParams[G])}}),C.filterParams=p},{deep:!0});const E=m=>{m&&(m.resetFields(),q("updateFilterParam",O.value),$e(()=>{q("getCiData",{model:M.ciModelId,model_instance_group:M.currentNodeId})}))};return ne({removeFilterParam:le}),(m,p)=>{const L=c("el-text"),se=c("el-divider"),ge=c("el-input"),re=c("el-icon"),G=c("el-form-item"),ue=c("el-button"),ee=c("el-option"),ke=c("el-select"),Ie=c("el-switch"),J=c("el-space"),al=c("el-form"),Je=c("el-drawer");return t(),d(Je,{modelValue:j.value,"onUpdate:modelValue":p[4]||(p[4]=U=>j.value=U),direction:"rtl",size:"50%","before-close":h},{header:l(()=>[a(L,{tag:"b"},{default:l(()=>p[5]||(p[5]=[v("筛选")])),_:1})]),default:l(()=>[$("div",Et,[$("div",At,[a(L,{tag:"b"},{default:l(()=>p[6]||(p[6]=[v("模型字段")])),_:1}),a(se),a(ge,{modelValue:k.value,"onUpdate:modelValue":p[0]||(p[0]=U=>k.value=U),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:A},null,8,["modelValue"]),$("div",Lt,[(t(!0),r(te,null,ie(ae.value,(U,Ne)=>(t(),r("div",{key:Ne},[$("div",zt,[$("span",null,x(U.verbose_name),1),a(re,null,{default:l(()=>[a(b(ka),{onClick:S=>fe(U)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),$("div",Yt,[a(L,{tag:"b"},{default:l(()=>p[7]||(p[7]=[v("过滤器")])),_:1}),a(se),a(al,{ref_key:"filterFormRef",ref:Me,model:C,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(J,{wrap:""},{default:l(()=>[a(G,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(ge,{modelValue:C.instance_name,"onUpdate:modelValue":p[1]||(p[1]=U=>C.instance_name=U),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(te,null,ie(C.filterParams,(U,Ne)=>(t(),d(G,{key:U.index,prop:"filterParams."+Ne+".value"},{label:l(()=>[$("span",Bt,x(U.label),1),a(ue,{icon:b(wa),size:"small",circle:"",onClick:bl(S=>D(U),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(J,null,{default:l(()=>[a(ke,{modelValue:U.match,"onUpdate:modelValue":S=>U.match=S,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(te,null,ie(Oe.value,S=>(t(),d(ee,{key:S.value,label:S.label,value:S.value},{default:l(()=>[$("span",Jt,x(S.label),1),$("span",Kt,x(S.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),U.match==="null"||U.match==="not:null"?(t(),r("div",Ht)):(t(),r("div",Wt,[["enum"].indexOf(M.allModelFieldByNameObj[U.name].type)>>>-1?["model_ref"].indexOf(M.allModelFieldByNameObj[U.name].type)>>>-1?["boolean"].indexOf(M.allModelFieldByNameObj[U.name].type)>>>-1?(t(),r("div",Zt,[a(ge,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Xt,[a(Ie,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Qt,[a(ke,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ie(M.modelRefOptions[U.name],S=>(t(),d(ee,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Gt,[a(ke,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ie(M.enumOptionObj[M.allModelFieldByNameObj[U.name].validation_rule],S=>(t(),d(ee,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[$("div",eo,[a(ue,{onClick:p[2]||(p[2]=U=>E(Me.value))},{default:l(()=>p[8]||(p[8]=[v("重置")])),_:1}),a(ue,{onClick:p[3]||(p[3]=U=>pe()),type:"primary"},{default:l(()=>p[9]||(p[9]=[v("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),ao=Sl(lo,[["__scopeId","data-v-7192e7fd"]]),to={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},oo={class:"table-header"},no={class:"header-button-lf"},so={class:"header-button-ri"},uo={class:"flexJstart gap-1",style:{overflow:"auto"}},ro={class:"text_class"},io={key:0,class:"text_class"},co={key:1},po={style:{display:"flex","justify-content":"space-between",width:"100%"}},vo={key:1,class:"requiredClass"},fo={key:0},mo={key:0},_o={key:1},yo={key:0},go={key:1},bo={key:0},wo={key:1},ko={key:0},ho={key:1},Co={key:0},xo={key:0},Vo={key:0},$o={key:1},Mo={key:0},Oo={key:1},Do={key:0},Uo={key:1},Fo={key:0},Io={key:1},Po={key:0},No={key:1},So={key:0},qo={key:1},jo={style:{flex:"auto"},class:"footerButtonClass"},To={key:0},Ro={key:1},Eo={key:0},Ao={key:1},Lo={key:0},zo={key:0},Yo={key:1},Bo={key:2},Jo={key:3},Ko={key:4},Ho={key:5},Wo={key:6},Go={key:7},Qo={key:8},Xo={key:9},Zo={class:"dialog-footer"},en={class:"dialog-footer"},ln=ll({__name:"ciDataShow",props:Be(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:Be(["getTree"],["update:showTree"]),setup(oe,{expose:ne,emit:B}){const{proxy:M}=Pl(),j=Va(),k=Ca(),A=ha(),ae=B,h=oe,fe=el(oe,"showTree"),D=i([0]),le=i(!1),ce=()=>{le.value=!0},q=i(!0),Me=()=>{q.value=!1,$e(()=>{q.value=!0})},C=i(""),Oe=()=>{le.value=!1},Z=i(!1),O=H(()=>j.gmCry),pe=H(()=>j.showAllPass),ye=H(()=>j.showAllPassTime),E=async()=>{Z.value=!0},m=()=>{j.updateShowAllPass(!1),Xe({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},p=s=>{j.setShowAllPassTime(s.totalMilliseconds)},L=()=>{Z.value=!1,j.updateShowAllPass(!1),j.setShowAllPassTime(0),Xe({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},se=i(!1),ge=()=>{ee.value=!1,ze(re.value[0]),ue.value=""},re=i(),G=Ze({secret:null}),ue=i(""),ee=i(!1),ke=async(s,e)=>{s[0].validate(async u=>{u&&(G.secret===O.value.key?(ue.value=gl(O.value.key,O.value.mode,e),ee.value=!0):(Xe({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),ee.value=!1,ue.value=""))})},Ie=i(1),J=i(10),al=i("default"),Je=i(!1),U=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},Ne=()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})},S=H(()=>xl.value.map(s=>s.name)),tl=H(()=>ml.value.map(s=>s.name)),Ke=i(!1),ol=async()=>{(await M.$api.bulkDeleteCiModelInstance({instances:he.value})).status=="200"?(N({type:"success",message:"删除成功"}),El.value.clearSelection(),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):N({type:"error",message:"删除失败"})},We=async s=>{s?await M.$api.exportCiData({model:h.ciModelId,fields:tl.value,instances:he.value}):await M.$api.exportCiData({model:h.ciModelId,fields:S.value,instances:he.value})},w=async()=>{let s=await M.$api.exportCiData({model:h.ciModelId});console.log(s)},g={multiple:!0,value:"id"},I=i(!1),Le=i([]),nl=H(()=>h.treeData[0].children[0].id),ql=async()=>{var u;let s=[];(u=Le.value)==null||u.forEach(R=>{s.push(R[R.length-1])});let e=await M.$api.setCiDataToTree({instances:he.value,groups:s});e.status=="201"?(N({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),Ql(),ae("getTree")):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}),Le.value=[],I.value=!1},wl=i(""),He=i(!1),T=i({}),Se=(s,e)=>{s?P.updateParams[e]="null":P.updateParams[e]=null},jl=()=>{il.value=!1,He.value=!0},il=i(!1),Tl=()=>{il.value=!0,He.value=!0},cl=s=>{var e;if(s!==void 0&&((e=je.value[s])==null?void 0:e.field_type)==="string")return s==""||s==null?void 0:[{pattern:new RegExp(je.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]};H(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(R=>{R.fields.forEach(y=>{var de;y.type==="string"&&y.validation_rule!==""&&y.validation_rule!==null&&(s["updateParams."+y.name]=[{pattern:new RegExp((de=je.value[y.validation_rule])==null?void 0:de.rule),message:"不符合正则表达式",trigger:"blur"}])})}),s});const P=Ze({updateParams:{}}),W=i([]),De=()=>{const s=Object.keys(P.updateParams).length,e=`__temp_param_${s}`;W.value[s]=e,P.updateParams[e]=""},kl=(s,e)=>{console.log(e),P.updateParams[e]=void 0,delete P.updateParams[W.value[s]],W.value[s]=e},Ue=(s,e)=>{W.value.splice(s,1),delete T.value[e],delete P.updateParams[e]},pl=H(()=>{let s=new Object;for(let[e,u]of Object.entries(P.updateParams))u==="null"?s[e]=null:s[e]=u,ve.value.password.indexOf(e)!==-1&&(s[e]=Kl(O.value.key,O.value.mode,u));return s}),hl=()=>{wl.value.validate(async s=>{if(s){let e;il.value?e=await M.$api.allUpdateCiModelInstance({update_user:A.state.username,fields:pl.value,model:h.ciModelId,model_instance_group:h.currentNodeId,conditions:Vl.value}):e=await M.$api.multipleUpdateCiModelInstance({update_user:A.state.username,instances:he.value,fields:pl.value}),e.status=="200"?(N({type:"success",message:"更新成功"}),Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),P.updateParams={},T.value={},W.value=[],He.value=!1):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})}else N({showClose:!0,message:"请输入正确内容.",type:"error"})})},$a=H(()=>{var e,u;let s=new Array;return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(R=>{R.fields.forEach(y=>{let de=!1;y.name in P.updateParams&&(de=!0),s.push({value:y.name,label:y.verbose_name,disable:de})})}),s}),Wl=()=>{He.value=!1,P.updateParams={},T.value={},W.value=[]},Gl=i(!0),vl=s=>{Gl.value=s},Cl=i(!0),Q=i(!1),Rl=i(!1),Ma=()=>{Rl.value=!0},Oa=async s=>{vl(!0);let e=await M.$api.updateCiModelInstance({update_user:A.state.username,...s});e.status=="200"?(N({type:"success",message:"更新成功"}),we.value=!1,ze(Ge.value),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},Da=s=>!0,El=i(null),Ua=s=>s.id,he=i([]),Fa=s=>{he.value=s.map(e=>e.id)},Ql=()=>{he.value=[],El.value.clearSelection()},xl=i([]),qe=i({}),Ia=H(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(R=>{R.fields.forEach(y=>{s[y.id]=y})}),s}),me=H(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(R=>{R.fields.forEach(y=>{s[y.name]=y})}),s}),Xl=i(""),Pa=()=>{Xl.value.getHasConfigField()},Zl=()=>{Cl.value=!1,$e(()=>{Cl.value=!0})},Na=s=>s.map(u=>u.id===nl.value).length>>0,je=i({});i({});const Sa=async(s=null)=>{(await M.$api.getValidationRules({...s,page:1,page_size:1e4})).data.results.forEach(u=>{je.value[u.id]=u})},Al=H(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(R=>{R.fields.forEach(y=>{if(y.type==="enum"){if(y.validation_rule===null)return;let de=JSON.parse(je==null?void 0:je.value[y==null?void 0:y.validation_rule].rule),Qe=[];Object.keys(de).forEach(ul=>{Qe.push({value:ul,label:de[ul]})}),s[y.validation_rule]=Qe}})}),s}),ea=H(()=>{let s={};return qe.value.field_groups.forEach(e=>{e.fields.forEach(u=>{if(u.type==="enum"){let R=JSON.parse(je.value[u.validation_rule].rule),y={};Object.keys(R).forEach(de=>{y[de]=R[de]}),s[u.name]=y}})}),s}),fl=i({}),qa=async(s,e)=>{let u=await M.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),R=[];u.data.results.forEach(y=>{R.push({value:y.id,label:y.instance_name})}),fl.value[e.name]=R},ja=H(()=>{let s=new Object;for(let[e,u]of Object.entries(fl.value)){let R=new Object;u==null||u.forEach(y=>{R[y.value]=y}),s[e]=R}return s}),Ta=s=>{if(!(s==""||s==null))return[{pattern:new RegExp(je.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]},Ra=()=>{for(const[s,e]of Object.entries(_))s!=="instance_name"&&delete _[s];qe.value.field_groups.forEach(s=>{s.fields.forEach(e=>{_[e.name]=e.default})}),_.instance_name=null},ml=i([]),Ea=async()=>{var u;let s=await M.$api.getCiModel({},h.ciModelId);qe.value=s.data;let e=[];(u=qe.value.field_groups)==null||u.forEach(R=>{R.fields.forEach(y=>{e.push(y)})}),ml.value=e},ve=H(()=>{let s={enum:[],boolean:[],model_ref:[],password:[]};return ml.value.forEach(e=>{e.type==="enum"?s.enum.push(e.name):e.type==="boolean"?s.boolean.push(e.name):e.type==="model_ref"?s.model_ref.push(e.name):e.type==="password"&&s.password.push(e.name)}),s});Nl(()=>ve.value.model_ref,s=>{ve.value.model_ref.forEach(e=>{qa(!0,{id:me.value[e].ref_model,name:e})})},{deep:!0});const la=i([]),aa=i(0),Vl=i({}),ta=s=>{Vl.value=s},oa=H(()=>{let s=new Array;for(let[e,u]of Object.entries(Vl.value))console.log(),e==="instance_name"?s.push({name:"唯一标识:"+u,field:e}):ve.value.model_ref.indexOf(e)!==-1?s.push({name:me.value[e].verbose_name+":"+ja.value[e][u].label,field:e}):ve.value.enum.indexOf(e)!==-1?(console.log(ea.value),s.push({name:me.value[e].verbose_name+":"+ea.value[e][u],field:e})):s.push({name:me.value[e].verbose_name+":"+u,field:e});return s}),Aa=async(s,e)=>{await C.value.removeFilterParam(s,e),$e(()=>{Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})})},Ce=async s=>{var R;vl(!0);let e=new Array,u=await M.$api.getCiModelInstance({...s,page:Ie.value,page_size:J.value,...Vl.value});aa.value=u.data.count,(R=u.data.results)==null||R.forEach(y=>{e.push({id:y.id,instance_group:y.instance_group,instance_name:y.instance_name,...y.fields})}),la.value=e,vl(!1)};xa(async()=>{Cl.value=!0,await Sa(),vl(!1)});const we=i(!1),La=()=>{Q.value=!0,we.value=!0,Re.value=!0},Te=i({}),$l=i({}),na=(s,e=!1)=>{we.value=!0,Re.value=!1,Q.value=e,Te.value=s,$e(()=>{Object.keys(s).forEach(u=>{u==="id"||u==="instance_group"||(ve.value.model_ref.indexOf(u)!==-1?s[u]!==null?_[u]=s[u].id:_[u]=s[u]:ve.value.password.indexOf(u)!==-1?(console.log("password"),pe.value?_[u]=gl(O.value.key,O.value.mode,s[u]):_[u]=s[u]):_[u]=s[u])}),$l.value=JSON.parse(JSON.stringify(_))})},za=s=>{we.value=!0,Re.value=!0,Q.value=!0,Te.value=s,$e(()=>{Object.keys(s).forEach(e=>{e==="id"||e==="instance_group"||(ve.value.model_ref.indexOf(e)!==-1?s[e]!==null?_[e]=s[e].id:_[e]=s[e]:ve.value.enum.indexOf(e)!==-1?_[e]=s[e].value:ve.value.password.indexOf(e)!==-1&&pe.value?_[e]=gl(O.value.key,O.value.mode,s[e]):_[e]=s[e])})}),Xe({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},Ge=i(),_=Ze({instance_name:null}),sa=H(()=>{let s=Object.assign({},_);delete s.instance_name;for(let[e,u]of Object.entries(s))u!==null&&ve.value.password.indexOf(e)!==-1&&(s[e]=Kl(O.value.key,O.value.mode,u));return s}),ua=H(()=>{let s=Object.assign({},sl.value);delete s.instance_name,console.log(ve.value);for(let[e,u]of Object.entries(sl.value))u!==null&&ve.value.password.indexOf(e)!==-1&&(s[e]=Kl(O.value.key,O.value.mode,u));return s}),Re=i(!0),sl=i({}),da=async(s,e=null)=>{s&&await s.validate(async(u,R)=>{if(u)if(Re.value){console.log(sa.value);let y=await M.$api.addCiModelInstance({model:h.ciModelId,create_user:A.state.username,update_user:A.state.username,fields:sa.value,instance_name:_.instance_name,instance_group:[h.currentNodeId]});y.status=="201"?(N({type:"success",message:"添加成功"}),we.value=!1,ze(s),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),ae("getTree")):N({showClose:!0,message:"添加失败:"+JSON.stringify(y.data),type:"error"})}else{if(console.log(JSON.stringify($l.value)),console.log(JSON.stringify(_)),JSON.stringify($l.value)===JSON.stringify(_)){Q.value=!1,we.value=!1,ze(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}else{const Qe=Object.entries($l.value),ul=Object.entries(_),K=Qe.concat(ul).map(Pe=>JSON.stringify(Pe)),Ol=Array.from(new Set(K)).map(Pe=>JSON.parse(Pe));Ol.splice(0,Qe.length);const X=Object.fromEntries(Ol);let Dl={};if(Object.keys(X).forEach(Pe=>{Dl[Pe]=X[Pe]}),sl.value=Dl,Object.keys(sl.value).length===0){Q.value=!1,we.value=!1,ze(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let y={id:Te.value.id,model:h.ciModelId,update_user:A.state.username};Object.keys(sl.value).indexOf("instance_name")===-1||(y.instance_name=sl.value.instance_name),y.fields=ua.value,console.log(ve.value),console.log(y),console.log();let de=await M.$api.updateCiModelInstance(y);de.status=="200"?(N({type:"success",message:"更新成功"}),we.value=!1,Q.value=!1,ze(s),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(de.data),type:"error"})}else console.log("error submit!",R),Xe({title:"表单校验",message:"表单填写异常",type:"error"})})},Ya=s=>{if(Q.value==!1&&Re.value==!1){we.value=!1;return}Hl.confirm("是否确认关闭?").then(()=>{s(),ze(Ge.value),we.value=!1,Q.value=!1}).catch(()=>{})},Ba=s=>{ze(s),we.value=!1,Q.value=!1},ra=(s=null)=>{Hl.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await M.$api.deleteCiModelInstance(Te.value.id)).status==204?(N({type:"success",message:"删除成功"}),await Ce({model:h.ciModelId,model_instance_group:h.currentNodeId}),ze(Ge.value),we.value=!1,Q.value=!1,ae("getTree")):N({type:"error",message:"删除失败"})}).catch(()=>{N({type:"info",message:"取消删除"})})},ze=s=>{s&&(s.resetFields(),Te.value={})},Ml=i("modelField"),Ja=(s,e)=>{console.log(Ml.value)};ne({getHasConfigField:Pa,getCiData:Ce,initCiDataForm:Ra,getModelField:Ea,setLoading:vl,closeFilter:Oe,clearMultipleSelect:Ql,updateFilterParam:ta,reloadCiDataFilter:Me});const Ll=i(!1),ia=i(""),Ka=s=>{Ll.value=!0,ia.value=s};return(s,e)=>{var _a,ya,ga;const u=c("el-button"),R=c("arrow-down"),y=c("el-icon"),de=c("el-dropdown-item"),Qe=c("el-dropdown-menu"),ul=c("el-dropdown"),K=c("el-tooltip"),Ol=c("vue-countdown"),X=c("el-text"),Dl=c("el-tag"),Pe=c("el-table-column"),ca=c("el-link"),Ye=c("el-switch"),Ha=c("el-table"),Wa=c("el-pagination"),pa=c("el-descriptions-item"),Ga=c("el-descriptions"),xe=c("el-space"),Ee=c("el-input"),be=c("el-form-item"),Qa=c("InfoFilled"),zl=c("el-input-number"),Yl=c("el-col"),va=c("el-row"),Bl=c("el-form"),Xa=c("el-popover"),Ul=c("el-date-picker"),_l=c("el-option"),yl=c("el-select"),Za=c("el-collapse-item"),et=c("el-collapse"),Fl=c("el-tab-pane"),lt=c("el-tabs"),at=c("el-drawer"),fa=c("el-dialog"),tt=c("el-cascader"),_e=rl("permission"),ot=rl("loading"),nt=rl("copy"),ma=rl("throttle");return t(),r(te,null,[Cl.value?(t(),r("div",to,[$("div",oo,[$("div",no,[fe.value?(t(),d(u,{key:0,icon:b(ut),onClick:e[0]||(e[0]=n=>fe.value=!1),size:"default"},null,8,["icon"])):(t(),d(u,{key:1,icon:b(dt),onClick:e[1]||(e[1]=n=>fe.value=!0),size:"default"},null,8,["icon"])),Y((t(),d(u,{type:"primary",onClick:La},{default:l(()=>e[33]||(e[33]=[v("添加")])),_:1})),[[_e,`${(_a=b(k).name)==null?void 0:_a.replace("_info","")}:add`]]),Y((t(),d(u,{disabled:!(he.value.length>>>0),onClick:e[2]||(e[2]=n=>I.value=!0)},{default:l(()=>e[34]||(e[34]=[v("转移")])),_:1},8,["disabled"])),[[_e,`${(ya=b(k).name)==null?void 0:ya.replace("_info","")}:edit`]]),Y((t(),d(u,{disabled:!(he.value.length>>>0),onClick:jl},{default:l(()=>e[35]||(e[35]=[v("批量更新")])),_:1},8,["disabled"])),[[_e,`${(ga=b(k).name)==null?void 0:ga.replace("_info","")}:edit`]]),a(ul,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(Qe,null,{default:l(()=>{var n,z,o;return[Y((t(),d(de,{onClick:e[3]||(e[3]=f=>Tl())},{default:l(()=>e[37]||(e[37]=[v(" 更新所有 ")])),_:1})),[[_e,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:update`]]),Y((t(),r("div",null,[a(de,{disabled:!(he.value.length>>>0),onClick:e[4]||(e[4]=f=>ol()),divided:""},{default:l(()=>e[38]||(e[38]=[v("批量删除")])),_:1},8,["disabled"])])),[[_e,`${(z=b(k).name)==null?void 0:z.replace("_info","")}:delete`]]),Y((t(),r("div",null,[a(de,{disabled:!(he.value.length>>>0),onClick:e[5]||(e[5]=f=>We(!1))},{default:l(()=>e[39]||(e[39]=[v("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(de,{disabled:!(he.value.length>>>0),onClick:e[6]||(e[6]=f=>We(!0))},{default:l(()=>e[40]||(e[40]=[v("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(de,{onClick:e[7]||(e[7]=f=>w())},{default:l(()=>e[41]||(e[41]=[v("导出所有")])),_:1})])),[[_e,`${(o=b(k).name)==null?void 0:o.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(u,{type:"primary"},{default:l(()=>[e[36]||(e[36]=v(" 更多操作")),a(y,{class:"el-icon--right"},{default:l(()=>[a(R)]),_:1})]),_:1})]),_:1})]),$("div",so,[a(K,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(u,{icon:b(rt),circle:"",onClick:Zl},null,8,["icon"])]),_:1}),pe.value?V("",!0):(t(),d(K,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var n;return[Y(a(u,{icon:b(Jl),circle:"",onClick:E},null,8,["icon"]),[[_e,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:showPassword`]])]}),_:1})),pe.value?(t(),d(K,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[42]||(e[42]=[$("span",null,[v("倒计时结束后自动隐藏密码"),$("br"),v("手动点击可立马隐藏")],-1)])),default:l(()=>[a(u,{circle:"",onClick:L},{default:l(()=>[a(Ol,{time:ye.value,onEnd:m,onProgress:p},{default:l(({totalSeconds:n})=>[v(x(n),1)]),_:1},8,["time"])]),_:1})]),_:1})):V("",!0),a(K,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(u,{icon:b(it),circle:"",onClick:Ma},null,8,["icon"])]),_:1}),a(K,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var n;return[Y(a(u,{icon:b(ct),circle:"",onClick:e[8]||(e[8]=z=>Ke.value=!0)},null,8,["icon"]),[[_e,`${(n=b(k).name)==null?void 0:n.replace("_info","")}:import`]])]}),_:1}),a(K,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(u,{icon:b(pt),circle:"",onClick:ce},null,8,["icon"])]),_:1})])]),Y($("div",uo,[a(X,{tag:"b"},{default:l(()=>e[43]||(e[43]=[v("过滤器")])),_:1}),(t(!0),r(te,null,ie(oa.value,(n,z)=>(t(),d(Dl,{key:n.name,closable:"",type:"primary",onClose:o=>Aa(n.field,z)},{default:l(()=>[$("span",null,x(n.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Il,oa.value.length>>>0]]),Y((t(),d(Ha,{ref_key:"ciDataTableRef",ref:El,data:la.value,onSelectionChange:Fa,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":Ua},{default:l(()=>[a(Pe,{type:"selection",selectable:Da,width:"55","reserve-selection":!0}),a(Pe,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(te,null,ie(xl.value,(n,z)=>(t(),d(Pe,{property:n.name,label:n.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120"},vt({_:2},[n.name==="mgmt_ip"?{name:"default",fn:l(o=>[a(ca,{href:`https://${o.row[n.name]}`,type:"primary",target:"_blank"},{default:l(()=>[v(x(o.row[n.name]),1)]),_:2},1032,["href"])]),key:"0"}:void 0,ve.value.boolean.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[Y(a(Ye,{modelValue:o.row[n.name],"onUpdate:modelValue":F=>o.row[n.name]=F,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:F=>Oa({id:o.row.id,fields:{[n.name]:o.row[n.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[_e,{id:`${(f=b(k).name)==null?void 0:f.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,ve.value.enum.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[$("div",ro,x((f=o.row[n.name])==null?void 0:f.label),1)]}),key:"2"}:void 0,ve.value.password.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[pe.value?(t(),r("div",io,x(b(gl)(O.value.key,O.value.mode,o.row[n.name])),1)):(t(),r("div",co,[((f=o.row[n.name])==null?void 0:f.length)>>0?(t(),d(X,{key:0},{default:l(()=>e[44]||(e[44]=[v("******")])),_:1})):(t(),d(X,{key:1}))]))]}),key:"3"}:void 0,ve.value.model_ref.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f,F;return[$("div",{class:Fe({text_class:((f=o.row[n.name])==null?void 0:f.instance_name)>>0})},x((F=o.row[n.name])==null?void 0:F.instance_name),3)]}),key:"4"}:void 0]),1032,["property","label"]))),256)),a(Pe,{fixed:"right",width:"150",label:"操作"},{default:l(n=>[a(K,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(u,{link:"",type:"primary",icon:b(Jl),onClick:z=>na(n.row)},null,8,["icon","onClick"])]),_:2},1024),a(K,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:b(ft),onClick:o=>na(n.row,!0)},null,8,["icon","onClick"]),[[_e,`${(z=b(k).name)==null?void 0:z.replace("_info","")}:edit`]])]}),_:2},1024),a(K,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:b(ba),onClick:o=>za(n.row)},null,8,["icon","onClick"]),[[_e,`${(z=b(k).name)==null?void 0:z.replace("_info","")}:edit`]])]}),_:2},1024),a(K,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:b(mt),onClick:o=>Ka(n.row)},null,8,["icon","onClick"]),[[_e,`${(z=b(k).name)==null?void 0:z.replace("_info","")}:view`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ot,Gl.value]]),a(Wa,{"current-page":Ie.value,"onUpdate:currentPage":e[9]||(e[9]=n=>Ie.value=n),"page-size":J.value,"onUpdate:pageSize":e[10]||(e[10]=n=>J.value=n),"page-sizes":[10,20,50,100,200],size:al.value,disabled:Je.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:aa.value,onSizeChange:U,onCurrentChange:Ne,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[$("div",po,[a(X,null,{default:l(()=>[v("已选择 "+x(he.value.length)+" 条",1)]),_:1})])]),_:1},8,["current-page","page-size","size","disabled","total"])])):V("",!0),a(at,{modelValue:we.value,"onUpdate:modelValue":e[21]||(e[21]=n=>we.value=n),class:"edit-drawer",direction:"rtl",size:"45%","before-close":Ya},{header:l(()=>[Re.value?(t(),d(X,{key:1,tag:"b"},{default:l(()=>e[45]||(e[45]=[v("实例信息 ")])),_:1})):(t(),d(Ga,{key:0,title:"实例信息"},{default:l(()=>[a(pa,{label:"唯一标识"},{default:l(()=>{var n;return[v(x((n=Te.value)==null?void 0:n.instance_name),1)]}),_:1}),a(pa,{label:"所属分组"},{default:l(()=>{var n;return[(t(!0),r(te,null,ie((n=Te.value)==null?void 0:n.instance_group,(z,o)=>(t(),d(X,{key:o},{default:l(()=>[v(x(z.group_path),1)]),_:2},1024))),128))]}),_:1})]),_:1}))]),default:l(()=>[a(lt,{modelValue:Ml.value,"onUpdate:modelValue":e[16]||(e[16]=n=>Ml.value=n),type:"card",class:"demo-tabs",onTabClick:Ja},{default:l(()=>[a(Fl,{label:"资产信息",name:"modelField"},{default:l(()=>[a(Bl,{ref_key:"ciDataFormRef",ref:Ge,style:{"max-width":"100%"},model:_,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[Q.value?(t(),d(be,{key:0,prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>e[46]||(e[46]=[v("唯一标识")])),_:1}),a(K,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:1})]),_:1})]),default:l(()=>[Q.value?(t(),d(Ee,{key:0,modelValue:_.instance_name,"onUpdate:modelValue":e[11]||(e[11]=n=>_.instance_name=n),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",vo,x(_.instance_name),1))]),_:1})):V("",!0),a(et,{modelValue:D.value,"onUpdate:modelValue":e[15]||(e[15]=n=>D.value=n)},{default:l(()=>[(t(!0),r(te,null,ie(qe.value.field_groups,(n,z)=>(t(),d(Za,{name:z,key:z},{title:l(()=>[a(X,{tag:"b",size:"large"},{default:l(()=>[v(x(n.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(va,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(te,null,ie(n.fields,(o,f)=>(t(),d(Yl,{span:12},{default:l(()=>[o.type==="string"?(t(),d(be,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:Ta(o.validation_rule)},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",fo,[_[o.name]!=null?(t(),r("div",mo,[o.name==="mgmt_ip"?(t(),d(ca,{key:0,href:`https://${_[o.name]}`,type:"primary",target:"_blank"},{default:l(()=>[v(x(_[o.name]),1)]),_:2},1032,["href"])):(t(),r("span",{key:1,class:Fe(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(_[o.name]),3))])):(t(),r("span",_o,"--"))]))]),_:2},1032,["label","prop","required","rules"])):V("",!0),o.type==="json"?(t(),d(be,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),a(K,{placement:"right",effect:"dark"},{content:l(()=>e[47]||(e[47]=[v(" json类型字段"),$("br",null,null,-1),v("请输入json格式数据! ")])),default:l(()=>[a(y,null,{default:l(()=>[a(Qa)]),_:1})]),_:1}),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",yo,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",go,"--"))]))]),_:2},1032,["label","prop","required"])):V("",!0),["text"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",bo,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},x(_[o.name]),3)):(t(),r("span",wo,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),d(be,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[a(Ye,{modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!Q.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):V("",!0),["float"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(X,{key:0,tag:"b"},{default:l(()=>[v(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(X,{key:1,tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(K,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(zl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ko,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",ho,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>{var F,Ae;return[Q.value?(t(),d(Ee,{key:1,modelValue:_[o.name],"onUpdate:modelValue":dl=>_[o.name]=dl,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Co,[((F=_[o.name])==null?void 0:F.length)>>0?(t(),r("div",xo,[pe.value?(t(),r("span",Vo,x(b(gl)(O.value.key,O.value.mode,_[o.name])),1)):(t(),r("span",{key:1,class:Fe({requiredClass:o.required}),onMouseenter:e[13]||(e[13]=dl=>se.value=!0),onMouseleave:e[14]||(e[14]=dl=>se.value=!1)},[e[49]||(e[49]=v("******** ")),Y((t(),d(Xa,{width:380,trigger:"click",onAfterLeave:ge},{reference:l(()=>[a(y,null,{default:l(()=>[Y(a(b(Jl),null,null,512),[[Il,se.value&&!pe.value]])]),_:1})]),default:l(()=>[a(Bl,{ref_for:!0,ref_key:"passFormRef",ref:re,inline:!0,model:G,"require-asterisk-position":"right"},{default:l(()=>[a(va,{align:"middle"},{default:l(()=>[a(Yl,{span:20},{default:l(()=>[a(be,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(Ee,{type:"password",modelValue:G.secret,"onUpdate:modelValue":e[12]||(e[12]=dl=>G.secret=dl),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(Yl,{span:2},{default:l(()=>[a(be,null,{default:l(()=>[a(u,{type:"primary",size:"small",onClick:dl=>ke(re.value,_[o.name])},{default:l(()=>e[48]||(e[48]=[v("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),ee.value?(t(),d(X,{key:0,tag:"b"},{default:l(()=>[v("密码: "+x(ue.value)+" ",1),a(K,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(y,null,{default:l(()=>[Y(a(b(ba),null,null,512),[[nt,ue.value]])]),_:1})]),_:1})]),_:1})):V("",!0)]),_:2},1024)),[[_e,`${(Ae=b(k).name)==null?void 0:Ae.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",$o,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(X,{key:0,tag:"b"},{default:l(()=>[v(x(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(X,{key:1,tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(K,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(zl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Mo,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(_[o.name]),3)):(t(),r("span",Oo,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(Ul,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Do,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},x(_[o.name]),3)):(t(),r("span",Uo,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(Ul,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Fo,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},x(_[o.name]),3)):(t(),r("span",Io,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>{var F;return[Q.value?(t(),d(yl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":Ae=>_[o.name]=Ae,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(te,null,ie(Al.value[o.validation_rule],Ae=>(t(),d(_l,{key:Ae.value,label:Ae.label,value:Ae.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",Po,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe({requiredClass:o.required})},x((F=Te.value[o.name])==null?void 0:F.label),3)):(t(),r("span",No,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?V("",!0):(t(),d(be,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(xe,{size:2},{default:l(()=>[a(X,{tag:"b"},{default:l(()=>[v(x(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(K,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(y,null,{default:l(()=>[a(b(Ve))]),_:1})]),_:2},1032,["content"])):V("",!0)]),_:2},1024)]),default:l(()=>[Q.value?(t(),d(yl,{key:1,modelValue:_[o.name],"onUpdate:modelValue":F=>_[o.name]=F,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(te,null,ie(fl.value[o.name],(F,Ae)=>(t(),d(_l,{key:Ae,label:F.label,value:F.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",So,[_[o.name]!=null?(t(),r("span",{key:0,class:Fe(["text_class",{requiredClass:o.required}])},x(Te.value[o.name].instance_name),3)):(t(),r("span",qo,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1}),Re.value?V("",!0):(t(),d(Fl,{key:0,label:"监控信息",name:"monitor",disabled:""},{default:l(()=>e[50]||(e[50]=[v("111")])),_:1})),Re.value?V("",!0):(t(),d(Fl,{key:1,label:"关联关系",name:"relations",disabled:""},{default:l(()=>e[51]||(e[51]=[v("222")])),_:1})),Re.value?V("",!0):(t(),d(Fl,{key:2,label:"变更记录",name:"changelog",disabled:""},{default:l(()=>e[52]||(e[52]=[v("Role")])),_:1}))]),_:1},8,["modelValue"])]),footer:l(()=>{var n,z,o,f;return[Y($("div",jo,[a(u,{onClick:e[17]||(e[17]=F=>Ba(Ge.value))},{default:l(()=>e[53]||(e[53]=[v("取消")])),_:1}),Re.value?(t(),r("div",To,[a(u,{type:"primary",onClick:e[18]||(e[18]=F=>da(Ge.value))},{default:l(()=>e[54]||(e[54]=[v("添加")])),_:1})])):(t(),r("div",Ro,[Q.value?(t(),r("div",Eo,[Na((n=Te.value)==null?void 0:n.instance_group)?Y((t(),d(u,{key:0,type:"danger",onClick:ra},{default:l(()=>e[55]||(e[55]=[v("删除")])),_:1})),[[_e,`${(z=b(k).name)==null?void 0:z.replace("_info","")}:delete`]]):Y((t(),d(K,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(u,{type:"danger",onClick:ra,disabled:""},{default:l(()=>e[56]||(e[56]=[v("删除")])),_:1})]),_:1})),[[_e,`${(o=b(k).name)==null?void 0:o.replace("_info","")}:delete`]]),Y((t(),d(u,{type:"primary",onClick:e[19]||(e[19]=F=>da(Ge.value))},{default:l(()=>e[57]||(e[57]=[v("保存")])),_:1})),[[ma]])])):(t(),r("div",Ao,[Y((t(),d(u,{type:"primary",onClick:e[20]||(e[20]=F=>Q.value=!0)},{default:l(()=>e[58]||(e[58]=[v("编辑")])),_:1})),[[_e,`${(f=b(k).name)==null?void 0:f.replace("_info","")}:edit`]])]))]))],512),[[Il,Ml.value==="modelField"]])]}),_:1},8,["modelValue"]),a(fa,{modelValue:He.value,"onUpdate:modelValue":e[23]||(e[23]=n=>He.value=n),title:"批量更新",width:"500","before-close":Wl},{footer:l(()=>[$("div",Zo,[a(u,{onClick:Wl},{default:l(()=>e[59]||(e[59]=[v("取消")])),_:1}),a(u,{onClick:e[22]||(e[22]=bl(n=>De(),["prevent"]))},{default:l(()=>e[60]||(e[60]=[v("新增字段")])),_:1}),Y((t(),d(u,{type:"primary",onClick:hl,disabled:!(W.value.length>0)},{default:l(()=>e[61]||(e[61]=[v("保存")])),_:1},8,["disabled"])),[[ma]])])]),default:l(()=>[a(Bl,{ref_key:"multipleFormRef",ref:wl,style:{"max-width":"1000px"},model:P,"label-width":"auto"},{default:l(()=>[(t(!0),r(te,null,ie(W.value,(n,z)=>{var o;return t(),d(be,{key:`param-${n}`,label:"字段"+(z+1),prop:`updateParams.${n}`,rules:cl((o=me.value[n])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(xe,null,{default:l(()=>[a(yl,{"model-value":n.startsWith("__temp")?void 0:n,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:f=>kl(z,f)},{default:l(()=>[(t(!0),r(te,null,ie($a.value,f=>(t(),d(_l,{key:f.value,label:f.label,value:f.value,disabled:f.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),n&&!n.startsWith("__temp")?(t(),r("div",Lo,[["text","json"].indexOf(me.value[n].type)>>>-1?["string"].indexOf(me.value[n].type)>>>-1?["enum"].indexOf(me.value[n].type)>>>-1?["model_ref"].indexOf(me.value[n].type)>>>-1?["boolean"].indexOf(me.value[n].type)>>>-1?["integer"].indexOf(me.value[n].type)>>>-1?["float"].indexOf(me.value[n].type)>>>-1?["date"].indexOf(me.value[n].type)>>>-1?["datetime"].indexOf(me.value[n].type)>>>-1?(t(),r("div",Xo,[a(Ee,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Qo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":f=>T.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),d(Ul,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Go,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":f=>T.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),d(Ul,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Wo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":f=>T.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),d(zl,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Ho,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":f=>T.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),d(Ee,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Ko,[a(Ye,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Jo,[a(yl,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(te,null,ie(fl.value[n],(f,F)=>(t(),d(_l,{key:F,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Bo,[a(yl,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(te,null,ie(Al.value[me.value[n].validation_rule],f=>(t(),d(_l,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Yo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":f=>T.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),d(Ee,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",zo,[a(Ye,{modelValue:T.value[n],"onUpdate:modelValue":f=>T.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Se(T.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),T.value[n]?V("",!0):(t(),d(Ee,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):V("",!0),a(u,{class:"mt-2",icon:b(_t),circle:"",onClick:bl(f=>Ue(z,n),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(fa,{modelValue:I.value,"onUpdate:modelValue":e[26]||(e[26]=n=>I.value=n),title:"实例组编辑",width:"500"},{footer:l(()=>[$("div",en,[a(u,{onClick:e[25]||(e[25]=n=>I.value=!1)},{default:l(()=>e[62]||(e[62]=[v("取消")])),_:1}),a(u,{type:"primary",onClick:ql},{default:l(()=>e[63]||(e[63]=[v(" 提交更新 ")])),_:1})])]),default:l(()=>[a(tt,{options:h.treeData,props:g,clearable:"",modelValue:Le.value,"onUpdate:modelValue":e[24]||(e[24]=n=>Le.value=n),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),q.value?(t(),d($t,{key:1,isShowUpload:Ke.value,"onUpdate:isShowUpload":e[27]||(e[27]=n=>Ke.value=n),ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,onGetCiData:Ce},null,8,["isShowUpload","ciModelId","currentNodeId"])):V("",!0),q.value?(t(),d(ao,{key:2,ciModelId:h.ciModelId,currentNodeId:h.currentNodeId,allModelFieldByNameObj:me.value,enumOptionObj:Al.value,validationRulesObj:je.value,allModelField:ml.value,modelRefOptions:fl.value,showFilter:le.value,"onUpdate:showFilter":e[28]||(e[28]=n=>le.value=n),onUpdateFilterParam:ta,onGetCiData:Ce,ref_key:"ciDataFilterRef",ref:C},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):V("",!0),a(St,{ciModelId:h.ciModelId,allModelField:ml.value,allModelFieldInfo:Ia.value,isShowTableCol:Rl.value,"onUpdate:isShowTableCol":e[29]||(e[29]=n=>Rl.value=n),hasConfigField:xl.value,"onUpdate:hasConfigField":e[30]||(e[30]=n=>xl.value=n),onReloadTable:Zl,ref_key:"ciDataTableColRef",ref:Xl},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(jt,{showAllPassDia:Z.value,"onUpdate:showAllPassDia":e[31]||(e[31]=n=>Z.value=n)},null,8,["showAllPassDia"]),a(Rt,{qCodeContext:ia.value,showqCodeDia:Ll.value,"onUpdate:showqCodeDia":e[32]||(e[32]=n=>Ll.value=n)},null,8,["qCodeContext","showqCodeDia"])],64)}}}),an=Sl(ln,[["__scopeId","data-v-72573d39"]]),tn=yt("ci",()=>{const oe=i([]),ne=Ze({filterParams:[]});i([]);const B=i([]);return i({}),{setFilterList:A=>{console.log(A),B.value=A,console.log(B.value)},saveFilterParams:A=>{console.log(A),ne.filterParams=A},setModelList:A=>{oe.value=A}}},{persist:!0}),on={class:"card ci_data_tree"},nn={class:"custom-tree-node"},sn={class:"table-box"},un=ll({__name:"cidataView",setup(oe){const ne=Ca(),{proxy:B}=Pl(),M=i(!0),j=tn(),k=i(!1);i(""),i(!1);const A=i(),ae=i([]),h=i("");Nl(h,w=>{O.value.filter(w)});const fe=(w,g)=>w?g.label.toLowerCase().includes(w.toLowerCase()):!0,D=w=>!(w.level>Ke.value-1||w.label==="空闲池"),le=async()=>{k.value=!0;let w=await B.$api.getCiModelTree({model:q.value});console.log(w),ae.value=[w.data],$e(()=>{ye.value===1&&(O.value.setCurrentKey(w.data.id),ye.value=O.value.getCurrentKey())}),k.value=!1},ce=i([]),q=i(""),Me=async()=>{let w=await B.$api.getCiModel();ce.value=w.data.results,j.setModelList(ce.value),q.value=ce.value.find(g=>g.name==="hosts").id};H(()=>{let w={};return ce.value.forEach(g=>{w[g.id]=g}),w});const C=i(""),Oe=async()=>{ye.value=1,console.log(q.value),await le(),await C.value.closeFilter(),await C.value.updateFilterParam({}),await C.value.clearMultipleSelect(),C.value.reloadCiDataFilter(),await C.value.setLoading(!0),await C.value.getModelField(),await C.value.getHasConfigField(),await C.value.setLoading(!1),await C.value.initCiDataForm(),await C.value.getCiData({model:q.value,model_instance_group:ye.value})};xa(async()=>{console.log(123),await Me(),await le(),C.value.setLoading(!0),await C.value.getModelField(),await C.value.getHasConfigField(),await C.value.setLoading(!1),await C.value.initCiDataForm(),await C.value.getCiData({model:q.value,model_instance_group:O.value.getCurrentKey()})});const Z=w=>w.built_in?!1:w.children?!(w.children.length>>>0):!0,O=i(),pe=i(),ye=i(1),E=i(!1),m=i(100),p=(w,g)=>{ue.value=!1;let I=m.value++;O.value.append({id:I,label:"新建子目录",level:g.level+1,parent:g.id,model:q.value},w),O.value.setCurrentKey(I),re.value=I,$e(()=>{pe.value.focus()})},L=(w,g)=>{let I=m.value++;ue.value=!1,O.value.insertAfter({id:I,label:"新建目录",level:g.level,parent:w.parent.data.id,model:q.value},w),O.value.setCurrentKey(I),re.value=I,$e(()=>{pe.value.focus()})},se=()=>{ye.value=O.value.getCurrentKey(),C.value.clearMultipleSelect(),C.value.setLoading(!0),C.value.getCiData({model:q.value,model_instance_group:O.value.getCurrentKey()}),C.value.setLoading(!0)},ge=w=>{E.value=!E.value,w.isShowEdit=E.value},re=i(99999),G=i(""),ue=i(!0),ee=w=>{ue.value=!0,console.log(w),G.value=w.label,re.value=w.id,$e(()=>{pe.value.focus()})},ke=async(w,g)=>{if(re.value=99999,!G.value)N.warning("名称不可为空"),O.value.remove(g);else if(ue.value){if(G.value==g.label)return!1;{let I=await B.$api.updateCiModelTree({id:g.id,label:G.value});I.status=="200"?(N({type:"success",message:"更新成功"}),g.label=G.value,le(),G.value=""):N({showClose:!0,message:"更新失败:"+JSON.stringify(I.data),type:"error"}),console.log(g)}}else{g.label=G.value,console.log(g);let I=await B.$api.addCiModelTree(g);I.status=="201"?(N({type:"success",message:"添加成功"}),le(),G.value=""):(N({showClose:!0,message:"添加失败:"+JSON.stringify(I.data),type:"error"}),O.value.remove(g))}},Ie=w=>{w&&Hl.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await B.$api.deleteCiModelTree(w.data.id)).status==200?(N({type:"success",message:"删除成功"}),await le()):N({type:"error",message:"删除失败"})}).catch(()=>{})},J=i(""),al=(w,g)=>{J.value=w,console.log(J.value)},Je=(w,g,I)=>{},U=(w,g,I)=>{},Ne=(w,g,I)=>{},S=async(w,g,I,Le)=>{if(g.data.id===w.data.id)return;let nl=await B.$api.updateCiModelTree({id:w.data.id,target_id:g.data.id,position:I});nl.status=="200"?(N({type:"success",message:"更新排序成功"}),le()):N({showClose:!0,message:"更新排序失败:"+JSON.stringify(nl.data),type:"error"})},tl=(w,g,I,Le)=>{},Ke=i(5),ol=(w,g,I)=>g.data.built_in?!1:I!=="inner",We=w=>!w.data.built_in;return(w,g)=>{const I=c("el-text"),Le=c("el-col"),nl=c("el-option"),ql=c("el-select"),wl=c("el-row"),He=c("el-divider"),T=c("el-input"),Se=c("a-menu-item"),jl=c("a-menu"),il=c("a-dropdown"),Tl=c("el-space"),cl=rl("permission"),P=rl("loading");return t(),r(te,null,[Y($("div",on,[a(wl,{align:"middle",justify:"start"},{default:l(()=>[a(Le,{span:8},{default:l(()=>[a(I,{tag:"b"},{default:l(()=>g[7]||(g[7]=[v("实例树")])),_:1})]),_:1}),a(Le,{span:14},{default:l(()=>[a(ql,{modelValue:q.value,"onUpdate:modelValue":g[0]||(g[0]=W=>q.value=W),placeholder:"Select",onChange:g[1]||(g[1]=W=>Oe())},{default:l(()=>[(t(!0),r(te,null,ie(ce.value,W=>(t(),d(nl,{key:W.id,label:W.verbose_name,value:W.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(He),a(T,{modelValue:h.value,"onUpdate:modelValue":g[2]||(g[2]=W=>h.value=W),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),Y((t(),d(b(kt),{style:{"max-width":"280px",height:"auto"},"allow-drop":ol,"allow-drag":We,data:ae.value,draggable:!0,"default-expand-all":"","node-key":"id",onNodeDragStart:al,onNodeDragEnter:Je,onNodeDragLeave:U,onNodeDragOver:Ne,onNodeDragEnd:S,onNodeDrop:tl,"highlight-current":!0,"current-node-key":ye.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:O,onNodeClick:se,"filter-node-method":fe},{default:l(({node:W,data:De})=>{var kl;return[$("div",nn,[re.value===De.id?(t(),d(T,{key:0,modelValue:G.value,"onUpdate:modelValue":g[3]||(g[3]=Ue=>G.value=Ue),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:pe,onBlur:Ue=>ke(Ue,De),onKeyup:g[4]||(g[4]=gt(Ue=>Ue.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),d(I,{key:1,size:"default"},{default:l(()=>[v(x(W.label),1),a(I,{size:"small"},{default:l(()=>[v("("+x(De.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),Y((t(),r("div",{class:Fe(["actionClass",{is_show_action:W.isShowEdit}])},[a(Tl,null,{default:l(()=>[De.built_in?V("",!0):(t(),d(b(bt),{key:0,onClick:bl(Ue=>ee(De),["stop"])},null,8,["onClick"])),a(il,{trigger:["click"],ref_key:"aDropdownRef",ref:A,onOpenChange:Ue=>ge(W)},{overlay:l(()=>[a(jl,null,{default:l(()=>{var Ue,pl;return[Y((t(),r("div",null,[De.level!==1?(t(),d(Se,{key:"0",onClick:hl=>L(W,De)},{default:l(()=>g[8]||(g[8]=[v(" 添加同级节点 ")])),_:2},1032,["onClick"])):V("",!0),D(De)?(t(),d(Se,{key:"1",onClick:hl=>p(W,De)},{default:l(()=>g[9]||(g[9]=[v(" 添加子节点 ")])),_:2},1032,["onClick"])):V("",!0)])),[[cl,`${(Ue=b(ne).name)==null?void 0:Ue.replace("_info","")}:add`]]),Y((t(),r("div",null,[Z(De)?(t(),d(Se,{key:"2",onClick:hl=>Ie(W)},{default:l(()=>g[10]||(g[10]=[v(" 删除节点 ")])),_:2},1032,["onClick"])):V("",!0)])),[[cl,`${(pl=b(ne).name)==null?void 0:pl.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(b(wt),{onClick:g[5]||(g[5]=bl(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[cl,`${(kl=b(ne).name)==null?void 0:kl.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[P,k.value]])],512),[[Il,M.value]]),$("div",sn,[a(an,{ciModelId:q.value,treeData:ae.value,currentNodeId:ye.value,ref_key:"ciDataShowRef",ref:C,onGetTree:le,showTree:M.value,"onUpdate:showTree":g[6]||(g[6]=W=>M.value=W)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),vn=Sl(un,[["__scopeId","data-v-c3cc4c42"]]);export{vn as default};
