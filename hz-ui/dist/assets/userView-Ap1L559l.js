<<<<<<<< HEAD:hz-ui/dist/assets/userView-DTu-VLWV.js
import{d as Me,x as Ge,j as Ke,g as We,a as z,r as n,bP as Ye,z as He,h as d,bc as de,c as E,o as u,b as U,f as a,bV as x,m as b,B as h,w as o,q as C,l as Qe,F as B,i as O,aa as Xe,t as ue,cc as Ze,p as el,cD as ll,cd as al,bM as sl,c4 as K,b_ as f,aP as ie,_ as ol}from"./index-Cm0tF2Sj.js";const tl={class:"card"},rl={class:"user-header"},nl={class:"flexJstart gap-5"},dl={class:"flexJstart gap-5"},ul={class:"demo-pagination-block"},il={class:"dialog-footer"},pl=Me({name:"user",__name:"userView",setup(cl){const $=Ge(),pe=Ke(),{proxy:i}=We(),R=z({search:""}),j=n(!1),W=n([]),ce=n("auto"),me=n([{prop:"username",label:"用户名称"},{prop:"real_name",label:"真实姓名"},{prop:"status",label:"状态"},{prop:"groups",label:"用户组列表"},{prop:"roles",label:"角色列表"},{prop:"expire_time",label:"到期时间"}]),fe=z({password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,message:"密码长度不能低于5",trigger:"blur"}],confirmPassword:[{validator:(l,e,t)=>{(_.value==="add"||v.value)&&e===""?t(new Error("请再次输入密码")):(_.value==="add"||v.value)&&e!==r.password?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]}),A=n(1),L=n(10),ge=n(!1),_e=n(!1),ve=n(!1),Y=n(0),g=z({page:A.value,size:L.value,search:"",ordering:"id"}),we=n(!1),H=n([]),ye=async l=>{let e=await i.$api.getRole(l);H.value=e.data.results},Q=n([]),be=async()=>{let l=await i.$api.getUserGroup();Q.value=l.data.results},k=async l=>{j.value=!0;let e=await i.$api.user(l);W.value=e.data.results,Y.value=e.data.count,j.value=!1},Ve=l=>{g.size=l,k(g)},he=l=>{g.page=l,k(g)},P=n(!1),r=z({username:"",real_name:null,password:"",confirmPassword:"",status:!0,role_ids:[],group_ids:[],expire_time:new Date(2999,1,1)}),_=n("add"),N=n({}),Ce=()=>{_.value="add",P.value=!0,v.value=!0},ke=()=>{P.value=!1,i.$refs.userFrom.resetFields()},xe=l=>{K.confirm("是否确认关闭?").then(()=>{l(),i.$refs.userFrom.resetFields()}).catch(()=>{})},Pe=(l,e)=>{if(Array.isArray(l)&&Array.isArray(e)){if(l.length!==e.length)return!1;const t=[...l].sort(),c=[...e].sort();return JSON.stringify(t)===JSON.stringify(c)}return l===e},$e=()=>{const l={};for(const e in r)if(e!=="confirmPassword"){if(_.value==="add"){l[e]=r[e];continue}Pe(r[e],N.value[e])||(console.log("key",e),l[e]=r[e])}return console.log("changedData",v.value),_.value==="edit"&&v.value&&(console.log(123),l.password=r.password),console.log("123333",l),l},De=()=>{i.$refs.userFrom.validate(async l=>{if(l)if(_.value=="add"){let e=await i.$api.useradd(r);console.log(e),e.status==201?(P.value=!1,i.$refs.userFrom.resetFields(),k(g)):f({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{const e=$e();if(console.log("changedData",e),Object.keys(e).length===0){P.value=!1,f({showClose:!0,message:"没有变更任何数据",type:"info"});return}console.log("变更的数据:",JSON.stringify(e));let t=await i.$api.userupdate({id:X.value.id,...e});console.log(t),t.status==200?(P.value=!1,i.$refs.userFrom.resetFields(),k(g)):(console.log(),f({showClose:!0,message:"更新失败:"+JSON.stringify(t.data),type:"error"}))}else f({showClose:!0,message:"请输入正确内容.",type:"error"});console.log(r)})},Ue=async l=>{let e=await i.$api.userupdate({status:l.status,id:l.id});e.status==200?(f({type:"success",message:"更新成功"}),k(g)):f({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},X=n({}),Se=l=>{_.value="edit",v.value=!1,P.value=!0,X.value=l,N.value={username:l.username,real_name:l.real_name,status:l.status,role_ids:l.roles?l.roles.map(e=>e.id):[],group_ids:l.groups?l.groups.map(e=>e.id):[],password:l.password},ie(()=>{Object.keys(r).forEach(e=>{if(["group_ids"].includes(e)){const t=l.groups?l.groups.map(c=>c.id):[];r[e]=t,N.value[e]=[...t]}else if(["role_ids"].includes(e)){const t=l.roles?l.roles.map(c=>c.id):[];r[e]=t,N.value[e]=[...t]}else r[e]=l[e],N.value[e]=l[e]}),r.confirmPassword=""}),console.log(r)},Fe=l=>{K.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await i.$api.userdel(l.id)).status==204?f({type:"success",message:"删除成功"}):f({type:"error",message:"删除失败"}),k(g)}).catch(()=>{f({type:"info",message:"Delete canceled"})})},I=n([]),ze=(l,e)=>l.username!="admin",Ee=l=>{I.value=l},Ne=()=>{K.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let l=[];for(let t in I.value)l.push(I.value[t].id);console.log(l),(await i.$api.usermuldel({pks:l})).status==204?f({type:"success",message:"删除成功"}):f({type:"error",message:"删除失败"}),k(g)}).catch(()=>{f({type:"info",message:"Delete canceled"})})},Z=async()=>{g.search=R.search,k(g)},S=n(!1);Ye(()=>r.username,l=>{l=="admin"?S.value=!0:S.value=!1});const v=n(!1),qe=()=>{v.value=!0,r.password="",r.confirmPassword=""},q=n(!1),J=n(),p=z({username:"",password:"",confirmPassword:"",userId:0}),Be=z({password:[{validator:(l,e,t)=>{e===""?t(new Error("请输入密码")):(e.length<6&&t(new Error("密码长度不能少于6位")),t())},trigger:"blur"}],confirmPassword:[{validator:(l,e,t)=>{e===""?t(new Error("请再次输入密码")):e!==p.password?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]}),Oe=l=>{p.username=l.username,p.userId=l.id,p.password="",p.confirmPassword="",q.value=!0,ie(()=>{var e;(e=J.value)==null||e.clearValidate()})},Re=async()=>{J.value&&await J.value.validate(async(l,e)=>{if(l){const t=await i.$api.userupdate({id:p.userId,password:p.password});t.status===200?(f.success("密码重置成功"),q.value=!1):f.error("密码重置失败: "+JSON.stringify(t.data))}})},Ie=l=>{pe.push({name:"permission",query:{user:l.id}})};return He(()=>{ye(g),be(),k(g)}),(l,e)=>{var re,ne;const t=d("el-button"),c=d("el-input"),m=d("el-form-item"),M=d("el-form"),G=d("el-table-column"),ee=d("el-switch"),le=d("el-tag"),ae=d("el-tooltip"),Je=d("el-table"),Te=d("el-pagination"),F=d("el-col"),T=d("el-row"),se=d("el-option"),oe=d("el-select"),je=d("el-date-picker"),te=d("el-dialog"),D=de("permission"),Ae=de("loading");return u(),E("div",tl,[U("div",rl,[U("div",null,[x((u(),h(t,{type:"primary",onClick:Ce},{default:o(()=>[...e[17]||(e[17]=[C("新增",-1)])]),_:1})),[[D,`${(re=b($).name)==null?void 0:re.replace("_info","")}:add`]]),x((u(),h(t,{disabled:I.value.length==0,type:"danger",onClick:Ne},{default:o(()=>[...e[18]||(e[18]=[C("批量删除",-1)])]),_:1},8,["disabled"])),[[D,`${(ne=b($).name)==null?void 0:ne.replace("_info","")}:delete`]])]),a(M,{inline:!0,model:R,class:"demo-form-inline"},{default:o(()=>[a(m,{label:"用户名检索"},{default:o(()=>[a(c,{modelValue:R.search,"onUpdate:modelValue":e[0]||(e[0]=s=>R.search=s),placeholder:"请输入用户名",clearable:"",onKeyup:Qe(Z,["enter"])},null,8,["modelValue"])]),_:1}),a(m,null,{default:o(()=>[a(t,{type:"primary",size:"small",onClick:Z},{default:o(()=>[...e[19]||(e[19]=[C("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),U("div",null,[x((u(),h(Je,{border:"",data:W.value,style:{width:"100%"},"max-height":"500px","table-layout":ce.value,onSelectionChange:Ee},{default:o(()=>[a(G,{type:"selection",width:"50",selectable:ze}),(u(!0),E(B,null,O(me.value,s=>(u(),h(G,{key:s.prop,label:s.label,prop:s.prop},Xe({_:2},[s.prop==="status"?{name:"default",fn:o(w=>{var y;return[x(a(ee,{modelValue:w.row.status,"onUpdate:modelValue":V=>w.row.status=V,disabled:w.row.username=="admin",class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:V=>Ue(w.row)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),[[D,{id:`${(y=b($).name)==null?void 0:y.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,s.prop==="groups"?{name:"default",fn:o(w=>[U("div",nl,[(u(!0),E(B,null,O(w.row.groups,y=>(u(),h(le,{key:y},{default:o(()=>[C(ue(y.group_name),1)]),_:2},1024))),128))])]),key:"1"}:void 0,s.prop==="roles"?{name:"default",fn:o(w=>[U("div",dl,[(u(!0),E(B,null,O(w.row.roles,y=>(u(),h(le,{key:y,type:"warning"},{default:o(()=>[C(ue(y.role_name),1)]),_:2},1024))),128))])]),key:"2"}:void 0]),1032,["label","prop"]))),128)),a(G,{fixed:"right",label:"操作",width:"180"},{default:o(s=>{var w,y;return[x(a(t,{link:"",type:"primary",icon:b(Ze),onClick:V=>Se(s.row)},null,8,["icon","onClick"]),[[D,`${(w=b($).name)==null?void 0:w.replace("_info","")}:edit`]]),a(ae,{content:"重置密码",placement:"top"},{default:o(()=>{var V;return[x(a(t,{link:"",type:"primary",icon:b(el),onClick:Le=>Oe(s.row)},null,8,["icon","onClick"]),[[D,`${(V=b($).name)==null?void 0:V.replace("_info","")}:edit`]])]}),_:2},1024),a(ae,{content:"权限配置",placement:"top"},{default:o(()=>{var V;return[x(a(t,{link:"",type:"primary",icon:b(ll),onClick:Le=>Ie(s.row)},null,8,["icon","onClick"]),[[D,`${(V=b($).name)==null?void 0:V.replace("_info","")}:edit`]])]}),_:2},1024),x(a(t,{disabled:s.row.username=="admin",link:"",type:"danger",icon:b(al),onClick:V=>Fe(s.row)},null,8,["disabled","icon","onClick"]),[[D,`${(y=b($).name)==null?void 0:y.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data","table-layout"])),[[Ae,j.value]])]),U("div",ul,[a(Te,{"current-page":A.value,"onUpdate:currentPage":e[1]||(e[1]=s=>A.value=s),"page-size":L.value,"onUpdate:pageSize":e[2]||(e[2]=s=>L.value=s),"page-sizes":[10,20,30,40],small:ge.value,disabled:ve.value,background:_e.value,layout:"total, sizes, prev, pager, next, jumper",total:Y.value,"hide-on-single-page":we.value,onSizeChange:Ve,onCurrentChange:he},null,8,["current-page","page-size","small","disabled","background","total","hide-on-single-page"])]),a(te,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=s=>P.value=s),title:_.value=="add"?"新增用户":"编辑用户",width:"40%","before-close":xe},{default:o(()=>[a(M,{inline:!0,model:r,class:"demo-form-inline",ref:"userFrom","label-position":"right","label-width":"auto","status-icon":"",rules:fe},{default:o(()=>[a(T,null,{default:o(()=>[a(F,{span:12},{default:o(()=>[a(m,{label:"用户名称",prop:"username",rules:[{required:!0}]},{default:o(()=>[a(c,{modelValue:r.username,"onUpdate:modelValue":e[3]||(e[3]=s=>r.username=s),placeholder:"",clearable:"",disabled:_.value!="add",style:{width:"200px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a(F,{span:12},{default:o(()=>[a(m,{label:"真实名称",prop:"real_name"},{default:o(()=>[a(c,{modelValue:r.real_name,"onUpdate:modelValue":e[4]||(e[4]=s=>r.real_name=s),placeholder:"",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(T,null,{default:o(()=>[a(F,{span:12},{default:o(()=>[a(m,{label:"用户组",prop:"group_ids",required:""},{default:o(()=>[a(oe,{modelValue:r.group_ids,"onUpdate:modelValue":e[5]||(e[5]=s=>r.group_ids=s),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:S.value,style:{width:"200px"}},{default:o(()=>[(u(!0),E(B,null,O(Q.value,s=>(u(),h(se,{key:s.id,label:s.group_name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),a(F,{span:12},{default:o(()=>[a(m,{label:"角色",prop:"role_ids"},{default:o(()=>[a(oe,{modelValue:r.role_ids,"onUpdate:modelValue":e[6]||(e[6]=s=>r.role_ids=s),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:S.value,style:{width:"200px"}},{default:o(()=>[(u(!0),E(B,null,O(H.value,s=>(u(),h(se,{key:s.id,label:s.role_name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(T,null,{default:o(()=>[a(F,{span:12,style:{display:"flex","flex-direction":"column"}},{default:o(()=>[a(m,{label:"有效期",prop:"expire_time"},{default:o(()=>[a(je,{modelValue:r.expire_time,"onUpdate:modelValue":e[7]||(e[7]=s=>r.expire_time=s),type:"date",placeholder:"选择日期",disabled:S.value,style:{width:"200px"}},null,8,["modelValue","disabled"])]),_:1}),a(m,{label:"状态",prop:"status"},{default:o(()=>[a(ee,{modelValue:r.status,"onUpdate:modelValue":e[8]||(e[8]=s=>r.status=s),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N",disabled:S.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a(F,{span:12},{default:o(()=>[a(m,{label:"密码",prop:"password",required:_.value==="add"||v.value},{default:o(()=>[v.value?(u(),h(c,{key:0,modelValue:r.password,"onUpdate:modelValue":e[9]||(e[9]=s=>r.password=s),type:"password",autocomplete:"off","show-password":!0},null,8,["modelValue"])):(u(),h(t,{key:1,link:"",type:"primary",onClick:qe},{default:o(()=>[...e[20]||(e[20]=[C("重置密码",-1)])]),_:1}))]),_:1},8,["required"]),x(a(m,{label:"确认密码",prop:"confirmPassword",required:_.value==="add"||v.value},{default:o(()=>[a(c,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=s=>r.confirmPassword=s),type:"password",autocomplete:"off","show-password":""},null,8,["modelValue"])]),_:1},8,["required"]),[[sl,_.value==="add"||v.value]])]),_:1})]),_:1}),a(T,{style:{"justify-content":"flex-end"}},{default:o(()=>[a(m,null,{default:o(()=>[a(t,{onClick:ke},{default:o(()=>[...e[21]||(e[21]=[C("取消",-1)])]),_:1}),a(t,{type:"primary",onClick:De},{default:o(()=>[...e[22]||(e[22]=[C(" 确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(te,{modelValue:q.value,"onUpdate:modelValue":e[16]||(e[16]=s=>q.value=s),title:"重置密码",width:"30%"},{footer:o(()=>[U("span",il,[a(t,{onClick:e[15]||(e[15]=s=>q.value=!1)},{default:o(()=>[...e[23]||(e[23]=[C("取消",-1)])]),_:1}),a(t,{type:"primary",onClick:Re},{default:o(()=>[...e[24]||(e[24]=[C("确定",-1)])]),_:1})])]),default:o(()=>[a(M,{ref_key:"pwdFormRef",ref:J,model:p,rules:Be,"label-width":"100px"},{default:o(()=>[a(m,{label:"用户名"},{default:o(()=>[a(c,{modelValue:p.username,"onUpdate:modelValue":e[12]||(e[12]=s=>p.username=s),disabled:""},null,8,["modelValue"])]),_:1}),a(m,{label:"新密码",prop:"password"},{default:o(()=>[a(c,{modelValue:p.password,"onUpdate:modelValue":e[13]||(e[13]=s=>p.password=s),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(m,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[a(c,{modelValue:p.confirmPassword,"onUpdate:modelValue":e[14]||(e[14]=s=>p.confirmPassword=s),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),vl=ol(pl,[["__scopeId","data-v-15afb296"]]);export{vl as default};
========
import{d as Me,x as Ge,j as Ke,g as We,a as z,r as n,bP as Ye,z as He,h as d,bc as de,c as E,o as u,b as U,f as a,bV as x,m as b,B as h,w as o,q as C,l as Qe,F as B,i as O,aa as Xe,t as ue,cc as Ze,p as el,cD as ll,cd as al,bM as sl,c4 as K,b_ as f,aP as ie,_ as ol}from"./index-D37lWo2y.js";const tl={class:"card"},rl={class:"user-header"},nl={class:"flexJstart gap-5"},dl={class:"flexJstart gap-5"},ul={class:"demo-pagination-block"},il={class:"dialog-footer"},pl=Me({name:"user",__name:"userView",setup(cl){const $=Ge(),pe=Ke(),{proxy:i}=We(),R=z({search:""}),j=n(!1),W=n([]),ce=n("auto"),me=n([{prop:"username",label:"用户名称"},{prop:"real_name",label:"真实姓名"},{prop:"status",label:"状态"},{prop:"groups",label:"用户组列表"},{prop:"roles",label:"角色列表"},{prop:"expire_time",label:"到期时间"}]),fe=z({password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,message:"密码长度不能低于5",trigger:"blur"}],confirmPassword:[{validator:(l,e,t)=>{(_.value==="add"||v.value)&&e===""?t(new Error("请再次输入密码")):(_.value==="add"||v.value)&&e!==r.password?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]}),A=n(1),L=n(10),ge=n(!1),_e=n(!1),ve=n(!1),Y=n(0),g=z({page:A.value,size:L.value,search:"",ordering:"id"}),we=n(!1),H=n([]),ye=async l=>{let e=await i.$api.getRole(l);H.value=e.data.results},Q=n([]),be=async()=>{let l=await i.$api.getUserGroup();Q.value=l.data.results},k=async l=>{j.value=!0;let e=await i.$api.user(l);W.value=e.data.results,Y.value=e.data.count,j.value=!1},Ve=l=>{g.size=l,k(g)},he=l=>{g.page=l,k(g)},P=n(!1),r=z({username:"",real_name:null,password:"",confirmPassword:"",status:!0,role_ids:[],group_ids:[],expire_time:new Date(2999,1,1)}),_=n("add"),N=n({}),Ce=()=>{_.value="add",P.value=!0,v.value=!0},ke=()=>{P.value=!1,i.$refs.userFrom.resetFields()},xe=l=>{K.confirm("是否确认关闭?").then(()=>{l(),i.$refs.userFrom.resetFields()}).catch(()=>{})},Pe=(l,e)=>{if(Array.isArray(l)&&Array.isArray(e)){if(l.length!==e.length)return!1;const t=[...l].sort(),c=[...e].sort();return JSON.stringify(t)===JSON.stringify(c)}return l===e},$e=()=>{const l={};for(const e in r)if(e!=="confirmPassword"){if(_.value==="add"){l[e]=r[e];continue}Pe(r[e],N.value[e])||(console.log("key",e),l[e]=r[e])}return console.log("changedData",v.value),_.value==="edit"&&v.value&&(console.log(123),l.password=r.password),console.log("123333",l),l},De=()=>{i.$refs.userFrom.validate(async l=>{if(l)if(_.value=="add"){let e=await i.$api.useradd(r);console.log(e),e.status==201?(P.value=!1,i.$refs.userFrom.resetFields(),k(g)):f({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{const e=$e();if(console.log("changedData",e),Object.keys(e).length===0){P.value=!1,f({showClose:!0,message:"没有变更任何数据",type:"info"});return}console.log("变更的数据:",JSON.stringify(e));let t=await i.$api.userupdate({id:X.value.id,...e});console.log(t),t.status==200?(P.value=!1,i.$refs.userFrom.resetFields(),k(g)):(console.log(),f({showClose:!0,message:"更新失败:"+JSON.stringify(t.data),type:"error"}))}else f({showClose:!0,message:"请输入正确内容.",type:"error"});console.log(r)})},Ue=async l=>{let e=await i.$api.userupdate({status:l.status,id:l.id});e.status==200?(f({type:"success",message:"更新成功"}),k(g)):f({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},X=n({}),Se=l=>{_.value="edit",v.value=!1,P.value=!0,X.value=l,N.value={username:l.username,real_name:l.real_name,status:l.status,role_ids:l.roles?l.roles.map(e=>e.id):[],group_ids:l.groups?l.groups.map(e=>e.id):[],password:l.password},ie(()=>{Object.keys(r).forEach(e=>{if(["group_ids"].includes(e)){const t=l.groups?l.groups.map(c=>c.id):[];r[e]=t,N.value[e]=[...t]}else if(["role_ids"].includes(e)){const t=l.roles?l.roles.map(c=>c.id):[];r[e]=t,N.value[e]=[...t]}else r[e]=l[e],N.value[e]=l[e]}),r.confirmPassword=""}),console.log(r)},Fe=l=>{K.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await i.$api.userdel(l.id)).status==204?f({type:"success",message:"删除成功"}):f({type:"error",message:"删除失败"}),k(g)}).catch(()=>{f({type:"info",message:"Delete canceled"})})},I=n([]),ze=(l,e)=>l.username!="admin",Ee=l=>{I.value=l},Ne=()=>{K.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let l=[];for(let t in I.value)l.push(I.value[t].id);console.log(l),(await i.$api.usermuldel({pks:l})).status==204?f({type:"success",message:"删除成功"}):f({type:"error",message:"删除失败"}),k(g)}).catch(()=>{f({type:"info",message:"Delete canceled"})})},Z=async()=>{g.search=R.search,k(g)},S=n(!1);Ye(()=>r.username,l=>{l=="admin"?S.value=!0:S.value=!1});const v=n(!1),qe=()=>{v.value=!0,r.password="",r.confirmPassword=""},q=n(!1),J=n(),p=z({username:"",password:"",confirmPassword:"",userId:0}),Be=z({password:[{validator:(l,e,t)=>{e===""?t(new Error("请输入密码")):(e.length<6&&t(new Error("密码长度不能少于6位")),t())},trigger:"blur"}],confirmPassword:[{validator:(l,e,t)=>{e===""?t(new Error("请再次输入密码")):e!==p.password?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]}),Oe=l=>{p.username=l.username,p.userId=l.id,p.password="",p.confirmPassword="",q.value=!0,ie(()=>{var e;(e=J.value)==null||e.clearValidate()})},Re=async()=>{J.value&&await J.value.validate(async(l,e)=>{if(l){const t=await i.$api.userupdate({id:p.userId,password:p.password});t.status===200?(f.success("密码重置成功"),q.value=!1):f.error("密码重置失败: "+JSON.stringify(t.data))}})},Ie=l=>{pe.push({name:"permission",query:{user:l.id}})};return He(()=>{ye(g),be(),k(g)}),(l,e)=>{var re,ne;const t=d("el-button"),c=d("el-input"),m=d("el-form-item"),M=d("el-form"),G=d("el-table-column"),ee=d("el-switch"),le=d("el-tag"),ae=d("el-tooltip"),Je=d("el-table"),Te=d("el-pagination"),F=d("el-col"),T=d("el-row"),se=d("el-option"),oe=d("el-select"),je=d("el-date-picker"),te=d("el-dialog"),D=de("permission"),Ae=de("loading");return u(),E("div",tl,[U("div",rl,[U("div",null,[x((u(),h(t,{type:"primary",onClick:Ce},{default:o(()=>[...e[17]||(e[17]=[C("新增",-1)])]),_:1})),[[D,`${(re=b($).name)==null?void 0:re.replace("_info","")}:add`]]),x((u(),h(t,{disabled:I.value.length==0,type:"danger",onClick:Ne},{default:o(()=>[...e[18]||(e[18]=[C("批量删除",-1)])]),_:1},8,["disabled"])),[[D,`${(ne=b($).name)==null?void 0:ne.replace("_info","")}:delete`]])]),a(M,{inline:!0,model:R,class:"demo-form-inline"},{default:o(()=>[a(m,{label:"用户名检索"},{default:o(()=>[a(c,{modelValue:R.search,"onUpdate:modelValue":e[0]||(e[0]=s=>R.search=s),placeholder:"请输入用户名",clearable:"",onKeyup:Qe(Z,["enter"])},null,8,["modelValue"])]),_:1}),a(m,null,{default:o(()=>[a(t,{type:"primary",size:"small",onClick:Z},{default:o(()=>[...e[19]||(e[19]=[C("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),U("div",null,[x((u(),h(Je,{border:"",data:W.value,style:{width:"100%"},"max-height":"500px","table-layout":ce.value,onSelectionChange:Ee},{default:o(()=>[a(G,{type:"selection",width:"50",selectable:ze}),(u(!0),E(B,null,O(me.value,s=>(u(),h(G,{key:s.prop,label:s.label,prop:s.prop},Xe({_:2},[s.prop==="status"?{name:"default",fn:o(w=>{var y;return[x(a(ee,{modelValue:w.row.status,"onUpdate:modelValue":V=>w.row.status=V,disabled:w.row.username=="admin",class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:V=>Ue(w.row)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),[[D,{id:`${(y=b($).name)==null?void 0:y.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,s.prop==="groups"?{name:"default",fn:o(w=>[U("div",nl,[(u(!0),E(B,null,O(w.row.groups,y=>(u(),h(le,{key:y},{default:o(()=>[C(ue(y.group_name),1)]),_:2},1024))),128))])]),key:"1"}:void 0,s.prop==="roles"?{name:"default",fn:o(w=>[U("div",dl,[(u(!0),E(B,null,O(w.row.roles,y=>(u(),h(le,{key:y,type:"warning"},{default:o(()=>[C(ue(y.role_name),1)]),_:2},1024))),128))])]),key:"2"}:void 0]),1032,["label","prop"]))),128)),a(G,{fixed:"right",label:"操作",width:"180"},{default:o(s=>{var w,y;return[x(a(t,{link:"",type:"primary",icon:b(Ze),onClick:V=>Se(s.row)},null,8,["icon","onClick"]),[[D,`${(w=b($).name)==null?void 0:w.replace("_info","")}:edit`]]),a(ae,{content:"重置密码",placement:"top"},{default:o(()=>{var V;return[x(a(t,{link:"",type:"primary",icon:b(el),onClick:Le=>Oe(s.row)},null,8,["icon","onClick"]),[[D,`${(V=b($).name)==null?void 0:V.replace("_info","")}:edit`]])]}),_:2},1024),a(ae,{content:"权限配置",placement:"top"},{default:o(()=>{var V;return[x(a(t,{link:"",type:"primary",icon:b(ll),onClick:Le=>Ie(s.row)},null,8,["icon","onClick"]),[[D,`${(V=b($).name)==null?void 0:V.replace("_info","")}:edit`]])]}),_:2},1024),x(a(t,{disabled:s.row.username=="admin",link:"",type:"danger",icon:b(al),onClick:V=>Fe(s.row)},null,8,["disabled","icon","onClick"]),[[D,`${(y=b($).name)==null?void 0:y.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data","table-layout"])),[[Ae,j.value]])]),U("div",ul,[a(Te,{"current-page":A.value,"onUpdate:currentPage":e[1]||(e[1]=s=>A.value=s),"page-size":L.value,"onUpdate:pageSize":e[2]||(e[2]=s=>L.value=s),"page-sizes":[10,20,30,40],small:ge.value,disabled:ve.value,background:_e.value,layout:"total, sizes, prev, pager, next, jumper",total:Y.value,"hide-on-single-page":we.value,onSizeChange:Ve,onCurrentChange:he},null,8,["current-page","page-size","small","disabled","background","total","hide-on-single-page"])]),a(te,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=s=>P.value=s),title:_.value=="add"?"新增用户":"编辑用户",width:"40%","before-close":xe},{default:o(()=>[a(M,{inline:!0,model:r,class:"demo-form-inline",ref:"userFrom","label-position":"right","label-width":"auto","status-icon":"",rules:fe},{default:o(()=>[a(T,null,{default:o(()=>[a(F,{span:12},{default:o(()=>[a(m,{label:"用户名称",prop:"username",rules:[{required:!0}]},{default:o(()=>[a(c,{modelValue:r.username,"onUpdate:modelValue":e[3]||(e[3]=s=>r.username=s),placeholder:"",clearable:"",disabled:_.value!="add",style:{width:"200px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a(F,{span:12},{default:o(()=>[a(m,{label:"真实名称",prop:"real_name"},{default:o(()=>[a(c,{modelValue:r.real_name,"onUpdate:modelValue":e[4]||(e[4]=s=>r.real_name=s),placeholder:"",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(T,null,{default:o(()=>[a(F,{span:12},{default:o(()=>[a(m,{label:"用户组",prop:"group_ids",required:""},{default:o(()=>[a(oe,{modelValue:r.group_ids,"onUpdate:modelValue":e[5]||(e[5]=s=>r.group_ids=s),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:S.value,style:{width:"200px"}},{default:o(()=>[(u(!0),E(B,null,O(Q.value,s=>(u(),h(se,{key:s.id,label:s.group_name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),a(F,{span:12},{default:o(()=>[a(m,{label:"角色",prop:"role_ids"},{default:o(()=>[a(oe,{modelValue:r.role_ids,"onUpdate:modelValue":e[6]||(e[6]=s=>r.role_ids=s),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:S.value,style:{width:"200px"}},{default:o(()=>[(u(!0),E(B,null,O(H.value,s=>(u(),h(se,{key:s.id,label:s.role_name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(T,null,{default:o(()=>[a(F,{span:12,style:{display:"flex","flex-direction":"column"}},{default:o(()=>[a(m,{label:"有效期",prop:"expire_time"},{default:o(()=>[a(je,{modelValue:r.expire_time,"onUpdate:modelValue":e[7]||(e[7]=s=>r.expire_time=s),type:"date",placeholder:"选择日期",disabled:S.value,style:{width:"200px"}},null,8,["modelValue","disabled"])]),_:1}),a(m,{label:"状态",prop:"status"},{default:o(()=>[a(ee,{modelValue:r.status,"onUpdate:modelValue":e[8]||(e[8]=s=>r.status=s),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N",disabled:S.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a(F,{span:12},{default:o(()=>[a(m,{label:"密码",prop:"password",required:_.value==="add"||v.value},{default:o(()=>[v.value?(u(),h(c,{key:0,modelValue:r.password,"onUpdate:modelValue":e[9]||(e[9]=s=>r.password=s),type:"password",autocomplete:"off","show-password":!0},null,8,["modelValue"])):(u(),h(t,{key:1,link:"",type:"primary",onClick:qe},{default:o(()=>[...e[20]||(e[20]=[C("重置密码",-1)])]),_:1}))]),_:1},8,["required"]),x(a(m,{label:"确认密码",prop:"confirmPassword",required:_.value==="add"||v.value},{default:o(()=>[a(c,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=s=>r.confirmPassword=s),type:"password",autocomplete:"off","show-password":""},null,8,["modelValue"])]),_:1},8,["required"]),[[sl,_.value==="add"||v.value]])]),_:1})]),_:1}),a(T,{style:{"justify-content":"flex-end"}},{default:o(()=>[a(m,null,{default:o(()=>[a(t,{onClick:ke},{default:o(()=>[...e[21]||(e[21]=[C("取消",-1)])]),_:1}),a(t,{type:"primary",onClick:De},{default:o(()=>[...e[22]||(e[22]=[C(" 确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(te,{modelValue:q.value,"onUpdate:modelValue":e[16]||(e[16]=s=>q.value=s),title:"重置密码",width:"30%"},{footer:o(()=>[U("span",il,[a(t,{onClick:e[15]||(e[15]=s=>q.value=!1)},{default:o(()=>[...e[23]||(e[23]=[C("取消",-1)])]),_:1}),a(t,{type:"primary",onClick:Re},{default:o(()=>[...e[24]||(e[24]=[C("确定",-1)])]),_:1})])]),default:o(()=>[a(M,{ref_key:"pwdFormRef",ref:J,model:p,rules:Be,"label-width":"100px"},{default:o(()=>[a(m,{label:"用户名"},{default:o(()=>[a(c,{modelValue:p.username,"onUpdate:modelValue":e[12]||(e[12]=s=>p.username=s),disabled:""},null,8,["modelValue"])]),_:1}),a(m,{label:"新密码",prop:"password"},{default:o(()=>[a(c,{modelValue:p.password,"onUpdate:modelValue":e[13]||(e[13]=s=>p.password=s),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(m,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[a(c,{modelValue:p.confirmPassword,"onUpdate:modelValue":e[14]||(e[14]=s=>p.confirmPassword=s),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),vl=ol(pl,[["__scopeId","data-v-15afb296"]]);export{vl as default};
>>>>>>>> hz-manager/cmdb_permission:hz-ui/dist/assets/userView-Ap1L559l.js
