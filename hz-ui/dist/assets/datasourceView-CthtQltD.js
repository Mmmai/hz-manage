import{d as S,r as y,ar as te,g as z,e as i,D as V,o as r,w as o,b as s,c as f,F as R,h as oe,B as le,a as ae,q as ne,aj as I,i as x,aa as J,k as _,v as re,a7 as K,a8 as ue,t as ie,ag as de,I as T,ao as m,s as ce,_ as me}from"./index-iGnbKzkN.js";const pe="data:image/png;base64,UklGRvwAAABXRUJQVlA4WAoAAAAQAAAAFwAAJQAAQUxQSHAAAAABb2CQbeTkjWCH8AaH8BERuT4yZAg3tW070SVooKKlwsTXgAR6JCABBVgAATmVk3O+buDWU0b0fwKAqCLJPABguNw5wGuFKQxF96KEDyX5KOVP6fg3/Cn7j1I+lGRWfKO4eK1lgPkt7V0A8YYkCw8AVlA4IGYAAAAQBACdASoYACYAPpE8mUelo6KhMAgAsBIJaQAAW+s2662i0nJdBG5PEAD++6IltdJt8QJkhngfTRlkqka+RVwFB0J3GZNNKzD60Ml88hxJHH7f1wYMZXqW/yVcAhDP7mmnPsGgAAA=",_e="/assets/loki_source-27HzMRux.svg",fe="/assets/welcome-VFYC1WKN.png",ge="/assets/zabbix_source-CG7-J5m_.svg",ve={key:0},G=S({__name:"lokiSource",props:{formData:{},formDataModifiers:{}},emits:["update:formData"],setup(B,{expose:g}){const k=y("right"),l=te(B,"formData"),{proxy:C}=z();return g({resetForm:()=>{C.$refs.formRef.resetFields(),console.log("test"),console.log(l)}}),(h,a)=>{const c=i("el-input"),p=i("el-form-item"),b=i("el-switch"),u=i("el-form");return r(),V(u,{"label-position":k.value,model:l.value,"label-width":"auto",style:{"max-width":"400px"},ref:"formRef"},{default:o(()=>[s(p,{label:"数据源名称",rules:[{required:!0}]},{default:o(()=>[s(c,{modelValue:l.value.source_name,"onUpdate:modelValue":a[0]||(a[0]=n=>l.value.source_name=n)},null,8,["modelValue"])]),_:1}),s(p,{label:"URL"},{default:o(()=>[s(c,{modelValue:l.value.url,"onUpdate:modelValue":a[1]||(a[1]=n=>l.value.url=n)},null,8,["modelValue"])]),_:1}),s(p,{label:"认证"},{default:o(()=>[s(b,{modelValue:l.value.isAuth,"onUpdate:modelValue":a[2]||(a[2]=n=>l.value.isAuth=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),l.value.isAuth?(r(),f("div",ve,[s(p,{label:"用户名"},{default:o(()=>[s(c,{modelValue:l.value.username,"onUpdate:modelValue":a[3]||(a[3]=n=>l.value.username=n)},null,8,["modelValue"])]),_:1}),s(p,{label:"密码"},{default:o(()=>[s(c,{modelValue:l.value.password,"onUpdate:modelValue":a[4]||(a[4]=n=>l.value.password=n),type:"password"},null,8,["modelValue"])]),_:1})])):R("",!0),s(p,{label:"默认"},{default:o(()=>[s(b,{modelValue:l.value.isDefault,"onUpdate:modelValue":a[5]||(a[5]=n=>l.value.isDefault=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),s(p,{label:"是否启用"},{default:o(()=>[s(b,{modelValue:l.value.isUsed,"onUpdate:modelValue":a[6]||(a[6]=n=>l.value.isUsed=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1})]),_:1},8,["label-position","model"])}}}),Q=S({__name:"zabbixSource",setup(B){const{proxy:g}=z();return y(!1),(k,l)=>(r(),f("div",null,"zabbix"))}}),ye={class:"card"},Ae={class:"context-body"},be={class:"el-card-context"},we={style:{display:"flex","justify-content":"space-between","align-content":"center"}},xe=["src"],Ve=["src"],ke={style:{margin:"10px 0px 0px 10px"}},Ce={key:0,class:"dialog-footer"},he={key:1,class:"dialog-footer"},De=S({__name:"datasourceView",setup(B){const{proxy:g}=z(),k=oe(),l=y(!1),C=e=>new URL(Object.assign({"/src/assets/images/lashen.png":pe,"/src/assets/images/loki_source.svg":_e,"/src/assets/images/welcome.png":fe,"/src/assets/images/zabbix_source.svg":ge})[`/src/assets/images/${e}`],import.meta.url).href,v=y(!1),h=y(!1),a=le(""),c=()=>{Object.keys(u).forEach(e=>{u[e]=b[e]})},p=e=>{T.confirm("是否关闭?").then(()=>{c(),console.log(u),e()}).catch(()=>{})},b={source_name:"",source_type:"",url:"",isAuth:!1,isDefault:!1,isUsed:!0,username:"",password:""},u=ae({source_name:"",source_type:"",url:"",isAuth:!1,isDefault:!1,isUsed:!0,username:"",password:""}),n=y("Loki"),E=e=>{e=="loki"?(a.value=G,u.source_type="loki",n.value="Loki"):e=="zabbix"&&(a.value=Q,u.source_type="zabbix",n.value="Zabbix"),v.value=!0,h.value=!0},M=async()=>{let e=await g.$api.dataSourceAdd(u);console.log(e),e.data.code=="200"?(m({type:"success",message:"添加成功"}),c(),v.value=!1,D()):m({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})},$=async()=>{l.value=!0;let e=await g.$api.lokiLabelGet({url:u.url});console.log(e),e.timeout?m({message:`数据源异常，${e.message}`,type:"error"}):e.status==200?m({message:"数据源可用~",type:"success"}):m({message:`数据源异常，${e.statusText}`,type:"error"}),ce(()=>{l.value=!1})},L=y([]),D=async()=>{let e=await g.$api.dataSourceGet();console.log(e),L.value=e.data.results},U=y(""),N=e=>{v.value=!0,h.value=!1,e.source_type=="loki"?(a.value=G,n.value="Loki"):e.source_type=="zabbix"&&(a.value=Q,n.value="Zabbix"),U.value=e.id,console.log(U.value);let t=["id","update_time","create_time"];Object.keys(e).forEach(w=>{t.indexOf(w)===-1&&(u[w]=e[w])})},P=async()=>{let e=await g.$api.dataSourceUpdate({id:U.value,...u});console.log(e),e.status==200?(m({type:"success",message:"更新成功"}),c(),v.value=!1,D()):m({type:"error",message:"更新失败"}),c()},W=e=>{T.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await g.$api.dataSourceDel(U.value)).status==204?(m({type:"success",message:"删除成功"}),c(),v.value=!1,D()):m({type:"error",message:"删除失败"})}).catch(()=>{m({type:"info",message:"Delete canceled"})})};return ne(async()=>{await D()}),(e,t)=>{const w=i("arrow-down"),O=i("el-icon"),A=i("el-button"),F=i("el-dropdown-item"),j=i("el-dropdown-menu"),Y=i("el-dropdown"),H=i("el-divider"),q=i("el-card"),Z=i("el-dialog"),X=I("permission"),ee=I("loading");return r(),f(K,null,[x("div",ye,[s(Y,{style:{"margin-left":"15px","margin-right":"15px"},onCommand:E},{dropdown:o(()=>[s(j,null,{default:o(()=>[s(F,{command:"loki"},{default:o(()=>t[3]||(t[3]=[_("loki")])),_:1}),s(F,{command:"zabbix"},{default:o(()=>t[4]||(t[4]=[_("zabbix")])),_:1})]),_:1})]),default:o(()=>{var d;return[J((r(),V(A,{type:"primary"},{default:o(()=>[t[2]||(t[2]=_(" 添加")),s(O,{class:"el-icon--right"},{default:o(()=>[s(w)]),_:1})]),_:1})),[[X,`${(d=re(k).name)==null?void 0:d.replace("_info","")}:add`]])]}),_:1}),s(H),x("div",Ae,[(r(!0),f(K,null,ue(L.value,(d,se)=>(r(),f("div",{class:"el-card-div",key:se},[s(q,{style:{width:"250px"},shadow:"hover",onClick:Ue=>N(d)},{default:o(()=>[x("div",be,[x("div",we,[d.source_type=="loki"?(r(),f("img",{key:0,src:C("loki_source.svg"),alt:"Icon",style:{width:"30px",height:"30px"}},null,8,xe)):d.source_type=="zabbix"?(r(),f("img",{key:1,src:C("zabbix_source.svg"),alt:"Icon",style:{width:"30px",height:"30px"}},null,8,Ve)):R("",!0),x("span",ke,ie(d.source_name),1)]),d.isDefault?(r(),V(A,{key:0,type:"success",size:"small",round:""},{default:o(()=>t[5]||(t[5]=[_("默认")])),_:1})):R("",!0)])]),_:2},1032,["onClick"])]))),128))])]),s(Z,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=d=>v.value=d),title:n.value,width:"500","before-close":p},{footer:o(()=>[h.value?(r(),f("div",he,[s(A,{type:"success",onClick:$},{default:o(()=>t[9]||(t[9]=[_("测试")])),_:1}),s(A,{type:"primary",onClick:M},{default:o(()=>t[10]||(t[10]=[_("添加")])),_:1})])):(r(),f("div",Ce,[s(A,{type:"danger",onClick:W},{default:o(()=>t[6]||(t[6]=[_("删除")])),_:1}),J((r(),V(A,{type:"success",onClick:$},{default:o(()=>t[7]||(t[7]=[_("测试")])),_:1})),[[ee,l.value]]),s(A,{type:"primary",onClick:P},{default:o(()=>t[8]||(t[8]=[_("更新")])),_:1})]))]),default:o(()=>[(r(),V(de(a.value),{formData:u,"onUpdate:formData":t[0]||(t[0]=d=>u=d),ref:"childRef"},null,40,["formData"]))]),_:1},8,["modelValue","title"])],64)}}}),Re=me(De,[["__scopeId","data-v-665839ba"]]);export{Re as default};
