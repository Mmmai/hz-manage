import{d as ne,g as oe,x as re,j as ue,r as c,z as ie,b_ as H,h as i,bc as de,c as v,o as p,f as s,w as t,b as _,q as o,t as n,B as y,bV as _e,k as z,F as ce,i as pe,l as me,_ as fe}from"./index-Ch0lsCs7.js";import{A as ve}from"./ansi_up-SVqyao32.js";const ge={class:"node-detail-view"},ye={key:1},be={class:"card-header"},he={class:"header-actions"},ke={class:"task-item-header"},xe={key:0,style:{flex:"1"}},we={class:"task-detail-dialog"},Ce={class:"error-message"},Ne={class:"output-container"},Se=["innerHTML"],Ve={key:1,class:"no-output"},Te={class:"dialog-footer"},Ie=ne({__name:"nodeInfoView",setup(ze){const{proxy:D}=oe(),$=new ve,C=re(),P=ue(),N=c(""),d=c({id:"",model_instance_name:"",ip_address:"",model_name:"",proxy_name:"",enable_sync:!0,manage_status:2,agent_status:2}),S=c([]),b=c(!1),f=c(1),h=c(10),M=c(0),k=c(""),x=c(!1),u=c({id:"",created_at:"",completed_at:"",status:2,cost_time:0,error_message:"",results:"",asset_info:null}),J=c("overview"),E=e=>{if(!e)return"";try{let a="";return typeof e=="string"?a=JSON.parse(e):typeof e=="object"&&(e.stdout?a=e.stdout:e.results?a=typeof e.results=="string"?e.results:JSON.stringify(e.results,null,2):a=JSON.stringify(e,null,2)),$.ansi_to_html(a)}catch(a){return console.error("Failed to process ANSI codes:",a),W(e)}};ie(()=>{N.value=C.params.nodeId?C.params.nodeId:C.path.split("/").at(-1),R(),w()});const K=()=>{P.push({path:"/node_control/nodeManage"})},R=async()=>{try{const e=await D.$api.getNodeDetail(N.value);e.status===200&&(d.value=e.data)}catch{H.error("获取节点信息失败")}},w=async()=>{b.value=!0;try{const e={node_id:N.value,page:f.value,page_size:h.value};k.value&&(e.task_name=k.value);const a=await D.$api.getNodeInfoTasks(e);a.status===200&&(S.value=a.data.results,M.value=a.data.count)}catch{H.error("获取任务历史失败")}finally{b.value=!1}},V=()=>{f.value=1,w()},q=e=>{u.value={id:e.id,created_at:e.created_at,completed_at:e.completed_at,status:e.status,cost_time:e.cost_time,error_message:e.error_message,results:e.results,record_info:e.record_info,task_name:e.task_name},x.value=!0},G=e=>{h.value=e,f.value=1,w()},Q=e=>{f.value=e,w()},O=e=>e===1?"success":e===0?"danger":"info",B=e=>e===1?"正常":e===0?"异常":"未知",T=e=>({0:"danger",1:"success",2:"info"})[e]||"info",U=e=>({0:"失败",1:"成功",2:"未知"})[e]||"未知",I=e=>e?new Date(e).toLocaleString("zh-CN"):"未知",W=e=>{if(!e)return"";try{if(typeof e=="string"){const a=JSON.parse(e);return JSON.stringify(a,null,2)}return JSON.stringify(e,null,2)}catch{return typeof e=="string"?e:JSON.stringify(e,null,2)}};return(e,a)=>{const X=i("el-page-header"),g=i("el-card"),r=i("el-descriptions-item"),m=i("el-tag"),A=i("el-descriptions"),Y=i("el-input"),L=i("el-button"),Z=i("el-tooltip"),j=i("el-timeline-item"),ee=i("el-timeline"),te=i("el-pagination"),F=i("el-tab-pane"),ae=i("el-tabs"),se=i("el-dialog"),le=de("loading");return p(),v("div",ge,[s(g,{class:"breadcrumb-card"},{default:t(()=>[s(X,{onBack:K},{content:t(()=>[...a[6]||(a[6]=[_("span",null," 节点详情",-1)])]),_:1})]),_:1}),s(g,{class:"node-info-card"},{header:t(()=>[...a[7]||(a[7]=[_("div",{class:"card-header"},[_("span",null,"节点基本信息")],-1)])]),default:t(()=>[s(A,{column:2,border:""},{default:t(()=>[s(r,{label:"实例名称"},{default:t(()=>[o(n(d.value.model_instance_name),1)]),_:1}),s(r,{label:"节点ID"},{default:t(()=>[o(n(d.value.id),1)]),_:1}),s(r,{label:"IP地址"},{default:t(()=>[o(n(d.value.ip_address),1)]),_:1}),s(r,{label:"模型"},{default:t(()=>[o(n(d.value.model_name),1)]),_:1}),s(r,{label:"代理"},{default:t(()=>[d.value.proxy_name?(p(),y(m,{key:0},{default:t(()=>[o(n(d.value.proxy_name),1)]),_:1})):(p(),v("span",ye,"无"))]),_:1}),s(r,{label:"同步状态"},{default:t(()=>[s(m,{type:d.value.enable_sync?"success":"danger"},{default:t(()=>[o(n(d.value.enable_sync?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),s(r,{label:"管理状态"},{default:t(()=>[s(m,{type:O(d.value.manage_status)},{default:t(()=>[o(n(B(d.value.manage_status)),1)]),_:1},8,["type"])]),_:1}),s(r,{label:"Agent状态"},{default:t(()=>[s(m,{type:O(d.value.agent_status)},{default:t(()=>[o(n(B(d.value.agent_status)),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1}),s(g,{class:"task-history-card"},{header:t(()=>[_("div",be,[a[9]||(a[9]=_("span",null,"任务执行历史",-1)),_("div",he,[s(Y,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=l=>k.value=l),placeholder:"按任务名过滤",clearable:"",style:{width:"200px","margin-right":"10px"},onClear:V,onKeyup:me(V,["enter"])},null,8,["modelValue"]),s(L,{type:"primary",onClick:V},{default:t(()=>[...a[8]||(a[8]=[o("刷新",-1)])]),_:1})])])]),default:t(()=>[_e((p(),y(ee,null,{default:t(()=>[(p(!0),v(ce,null,pe(S.value,l=>(p(),y(j,{key:l.id,type:T(l.status),timestamp:I(l.created_at),placement:"top"},{default:t(()=>[s(g,{shadow:"hover",onClick:De=>q(l)},{default:t(()=>[s(Z,{content:"点击查看任务详情",placement:"top"},{default:t(()=>[_("div",ke,[s(m,{type:"primary",size:"small"},{default:t(()=>[o(n(l.task_name),1)]),_:2},1024),s(m,{type:T(l.status),size:"small"},{default:t(()=>[o(n(U(l.status)),1)]),_:2},1032,["type"]),_("span",null,"耗时: "+n(l.cost_time)+" 秒",1),l.error_message?(p(),v("span",xe,"错误信息: "+n(l.error_message),1)):z("",!0)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["type","timestamp"]))),128)),S.value.length===0&&!b.value?(p(),y(j,{key:0},{default:t(()=>[s(g,null,{default:t(()=>[...a[10]||(a[10]=[_("div",{class:"empty-task"},"暂无任务执行历史",-1)])]),_:1})]),_:1})):z("",!0)]),_:1})),[[le,b.value]]),s(te,{"current-page":f.value,"onUpdate:currentPage":a[1]||(a[1]=l=>f.value=l),"page-size":h.value,"onUpdate:pageSize":a[2]||(a[2]=l=>h.value=l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:M.value,onSizeChange:G,onCurrentChange:Q,style:{"margin-top":"20px","justify-content":"flex-end",display:"flex"}},null,8,["current-page","page-size","total"])]),_:1}),s(se,{modelValue:x.value,"onUpdate:modelValue":a[5]||(a[5]=l=>x.value=l),title:"任务执行详情",width:"70%",top:"5vh"},{footer:t(()=>[_("span",Te,[s(L,{onClick:a[4]||(a[4]=l=>x.value=!1)},{default:t(()=>[...a[11]||(a[11]=[o("关闭",-1)])]),_:1})])]),default:t(()=>[_("div",we,[s(ae,{modelValue:J.value,"onUpdate:modelValue":a[3]||(a[3]=l=>J.value=l)},{default:t(()=>[s(F,{label:"概览",name:"overview"},{default:t(()=>[s(A,{column:1,border:""},{default:t(()=>[s(r,{label:"任务ID"},{default:t(()=>[o(n(u.value.id),1)]),_:1}),s(r,{label:"任务名称"},{default:t(()=>[o(n(u.value.task_name),1)]),_:1}),s(r,{label:"执行时间"},{default:t(()=>[o(n(I(u.value.created_at)),1)]),_:1}),s(r,{label:"完成时间"},{default:t(()=>[o(n(u.value.completed_at?I(u.value.completed_at):"未完成"),1)]),_:1}),s(r,{label:"状态"},{default:t(()=>[s(m,{type:T(u.value.status)},{default:t(()=>[o(n(U(u.value.status)),1)]),_:1},8,["type"])]),_:1}),s(r,{label:"耗时"},{default:t(()=>[o(n(u.value.cost_time?u.value.cost_time+" 秒":"未知"),1)]),_:1}),u.value.error_message?(p(),y(r,{key:0,label:"错误信息"},{default:t(()=>[_("div",Ce,n(u.value.error_message),1)]),_:1})):z("",!0)]),_:1})]),_:1}),s(F,{label:"详细输出",name:"output"},{default:t(()=>[_("div",Ne,[u.value.results?(p(),v("pre",{key:0,class:"output-pre",innerHTML:E(u.value.results)},null,8,Se)):(p(),v("div",Ve,"暂无详细输出"))])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}}),Oe=fe(Ie,[["__scopeId","data-v-d4cc6e89"]]);export{Oe as default};
