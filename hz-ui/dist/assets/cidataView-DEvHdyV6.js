import{d as sl,ao as Ke,g as fl,ap as nl,r as i,a as vl,e as c,D as d,o as t,w as l,b as a,i as $,k as p,c as r,F as M,t as V,v as h,aq as De,aj as ha,al as N,A as T,z as El,a7 as le,a8 as ce,E as Ca,ar as it,s as Ve,_ as Al,an as ol,u as xa,as as Ml,h as Va,q as $a,ag as pl,aa as Y,at as ct,au as pt,ad as vt,av as Ql,aw as ft,ax as mt,ay as _t,ab as Tl,az as yt,aA as Ie,ah as gt,aB as ka,aC as bt,ai as wt,I as Zl,j as kt,aD as ht,aE as Ct,aF as xt}from"./index-Gch8CQn_.js";import{l as Vt}from"./vue-draggable-plus-DEv7jPz0.js";import{u as Ma}from"./config-LD_K2_zU.js";import{e as Xl,d as $l}from"./gmCrypto-D6mL4DDE.js";import{u as $t}from"./ci-e_cgVoUj.js";const Mt={class:"flexJstart gap-1"},Ot={key:0,class:"flexJstart gap-1"},Dt={key:3,class:"flexJstart gap-1"},Ut=sl({__name:"ciDataUpload",props:Ke(["ciModelId","currentNodeId"],{isShowUpload:{},isShowUploadModifiers:{}}),emits:Ke(["getCiData"],["update:isShowUpload"]),setup(ee,{emit:me}){const{proxy:J}=fl(),O=ee,A=me,y=nl(ee,"isShowUpload"),X=i([]),ae=i(null),C=["xlsx"],te=i(10),I=i({}),pe=i({}),oe=vl({"Content-Type":"multipart/form-data"}),ne=i({}),se=async()=>{Object.keys(pe.value).length>0?Object.entries(pe.value).forEach(async([B,b])=>{let _=await J.$api.importCiDataStatus(b);I.value[B]=_.data,_.data.status==="completed"&&delete pe.value[B]}):(clearInterval(ve),ve=null,A("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId}))};let ve=null;const G=async B=>{let b=new FormData;b.append("file",B.file),b.append("model",O.ciModelId);let _=await J.$api.importCiData(b,oe,2*60*1e3);_.status==200?(pe.value[B.file.uid]=_.data,ne.value[B.file.uid]=!0,ve===null&&(ve=setInterval(se,2e3))):(ne.value[B.file.uid]=!1,N({message:`导入异常: ${JSON.stringify(_.data)}`,type:"error",showClose:!0}))},ue=()=>{},E=B=>{let b=B.name;if(B.type!=""||B.type!=null||B.type!=null){const _=B.name.replace(/.+\./,"").toLowerCase();return B.size/1024/1024<100?C.includes(_)?X.value.find(de=>de.name==b&&de.lastModified==B.lastModified)?(N({type:"error",message:"该文件已上传！",showClose:!0}),!1):!0:(N({message:`不能上传${_}类型的文件`,type:"error",showClose:!0}),!1):(N.error("上传文件大小不能超过 100MB!"),!1)}},D=async B=>{await J.$api.downloadErrorRecords({error_file_key:B})},Le=async()=>{await J.$api.downloadImportTemplate({model:O.ciModelId})};return(B,b)=>{const _=c("upload-filled"),m=c("el-icon"),K=c("el-col"),de=c("el-button"),we=c("el-row"),_e=c("Loading"),ye=c("CircleCheck"),H=c("el-link"),fe=c("el-upload"),Z=c("el-dialog");return t(),d(Z,{modelValue:y.value,"onUpdate:modelValue":b[1]||(b[1]=L=>y.value=L),title:"导入",width:"800"},{default:l(()=>[a(fe,{class:"upload-demo",drag:"",action:"",ref_key:"refUpload",ref:ae,headers:oe,"http-request":G,"file-list":X.value,"before-upload":E,limit:te.value,onOnChange:ue,"show-file-list":""},{tip:l(()=>[a(we,{justify:"space-between",align:"middle"},{default:l(()=>[a(K,{span:18},{default:l(()=>b[2]||(b[2]=[$("div",null,"只支持从此系统下载的模板导入，请按右侧按钮下载模板!",-1)])),_:1}),a(K,{span:3},{default:l(()=>[a(de,{link:"",type:"primary",onClick:b[0]||(b[0]=L=>Le())},{default:l(()=>b[3]||(b[3]=[p("点击下载模板")])),_:1})]),_:1})]),_:1})]),file:l(({file:L,index:Ze})=>{var He,Ge,U,Pe,S,We,Qe,ul,el;return[$("div",Mt,[$("span",null,V(L.name),1),ne.value[L.uid]==!0?(t(),r("div",Ot,[((He=I.value[L.uid])==null?void 0:He.status)!=="completed"?(t(),d(m,{key:0,class:"is-loading"},{default:l(()=>[a(_e)]),_:1})):((Ge=I.value[L.uid])==null?void 0:Ge.failed)>>>0?(t(),d(m,{key:1},{default:l(()=>[a(h(De),{color:"var(--el-color-warning)"})]),_:1})):(t(),d(m,{key:2},{default:l(()=>[a(ye,{color:"var(--el-color-success)"})]),_:1})),I.value[L.uid]?(t(),r("div",Dt,[$("span",null,V(`进度: ${(U=I.value[L.uid])==null?void 0:U.progress}%`),1),$("span",null,V(`结果: 总条数: ${(Pe=I.value[L.uid])==null?void 0:Pe.total},创建: ${(S=I.value[L.uid])==null?void 0:S.created},更新: ${(We=I.value[L.uid])==null?void 0:We.updated},跳过: ${(Qe=I.value[L.uid])==null?void 0:Qe.skipped},失败: ${(ul=I.value[L.uid])==null?void 0:ul.failed}.`),1),((el=I.value[L.uid])==null?void 0:el.failed)>>>0?(t(),d(H,{key:0,type:"danger",onClick:Ol=>{var dl;return D((dl=I.value[L.uid])==null?void 0:dl.error_file_key)}},{default:l(()=>b[4]||(b[4]=[p("查看导入失败数据")])),_:2},1032,["onClick"])):M("",!0)])):M("",!0)])):ne.value[L.uid]==!1?(t(),d(m,{key:1},{default:l(()=>[a(h(ha),{color:"var(--el-color-error)"})]),_:1})):M("",!0)])]}),default:l(()=>[a(m,{class:"el-icon--upload"},{default:l(()=>[a(_)]),_:1}),b[5]||(b[5]=$("div",{class:"el-upload__text"},[p("拖拽文件到此或者 "),$("em",null,"点击上传文件")],-1))]),_:1},8,["headers","file-list","limit"])]),_:1},8,["modelValue"])}}}),It={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Ft={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Pt={style:{width:"100%",overflow:"auto"}},Nt={class:"listItem"},St={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},qt={class:"listItem"},jt={style:{flex:"auto"}},Tt=sl({__name:"ciDataTableCol",props:Ke(["ciModelId","allModelFieldInfo","allModelField"],{isShowTableCol:{},isShowTableColModifiers:{},hasConfigField:{},hasConfigFieldModifiers:{}}),emits:Ke(["reloadTable"],["update:isShowTableCol","update:hasConfigField"]),setup(ee,{expose:me,emit:J}){const O=ee,A=nl(ee,"isShowTableCol"),y=nl(ee,"hasConfigField"),{proxy:X}=fl(),ae=i(""),C=i(""),te=T(()=>ae.value===""?B.value:B.value.filter(b=>b.verbose_name.includes(ae.value)));function I(){A.value=!1}const pe=b=>{y.value.push(b)},oe=b=>{let _=y.value.indexOf(b);y.value.splice(_,1)},ne=b=>{console.log("start",b)},se=b=>{console.log("onEnd",b),console.log(y.value)},ve=()=>{console.log("update")},G=i({}),ue=async()=>{let b=await X.$api.getCiModelCol({model:O.ciModelId});G.value=b.data;let _=[];b.data.fields_preferred.forEach(m=>{_.push(O.allModelFieldInfo[m])}),y.value=_},E=T(()=>y.value.map(b=>b.id)),D=J;El(()=>y.value,b=>{console.log("更新表格"),D("reloadTable")},{deep:!0});const Le=async()=>{let b=await X.$api.updateCiModelCol({id:G.value.id,fields_preferred:E.value});b.status=="200"?(N({type:"success",message:"更新成功"}),Ve(()=>{C.value.clear(),A.value=!1})):N({showClose:!0,message:"更新失败:"+JSON.stringify(b.data),type:"error"})},B=T(()=>O.allModelField.filter(b=>!y.value.includes(b)));return me({getHasConfigField:ue}),(b,_)=>{const m=c("el-text"),K=c("el-divider"),de=c("el-input"),we=c("el-icon"),_e=c("el-button"),ye=c("el-drawer");return t(),d(ye,{modelValue:A.value,"onUpdate:modelValue":_[2]||(_[2]=H=>A.value=H),direction:"rtl",size:"40%"},{header:l(()=>[a(m,{tag:"b"},{default:l(()=>_[3]||(_[3]=[p("表格列显示配置")])),_:1})]),default:l(()=>[$("div",It,[$("div",Ft,[a(m,{tag:"b"},{default:l(()=>_[4]||(_[4]=[p("模型字段")])),_:1}),a(K),a(de,{modelValue:ae.value,"onUpdate:modelValue":_[0]||(_[0]=H=>ae.value=H),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:C},null,8,["modelValue"]),$("div",Pt,[(t(!0),r(le,null,ce(te.value,(H,fe)=>(t(),r("div",{key:fe},[$("div",Nt,[$("span",null,V(H.verbose_name),1),a(we,null,{default:l(()=>[a(h(Ca),{onClick:Z=>pe(H)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),$("div",St,[a(m,{tag:"b"},{default:l(()=>_[5]||(_[5]=[p("已显示字段")])),_:1}),a(K),a(h(Vt),{"force-fallback":!0,"scroll-sensitivity":200,ref:"el",modelValue:y.value,"onUpdate:modelValue":_[1]||(_[1]=H=>y.value=H),onStart:ne,onUpdate:ve,onEnd:se,style:{width:"100%",overflow:"auto"}},{default:l(()=>[(t(!0),r(le,null,ce(y.value,(H,fe)=>(t(),r("div",{key:fe},[$("div",qt,[$("span",null,V(H.verbose_name),1),a(we,null,{default:l(()=>[a(h(it),{onClick:Z=>oe(H)},null,8,["onClick"])]),_:2},1024)])]))),128))]),_:1},8,["modelValue"])])])]),footer:l(()=>[$("div",jt,[a(_e,{onClick:I},{default:l(()=>_[6]||(_[6]=[p("取消")])),_:1}),a(_e,{type:"primary",onClick:Le},{default:l(()=>_[7]||(_[7]=[p("保存")])),_:1})])]),_:1},8,["modelValue"])}}}),Et=Al(Tt,[["__scopeId","data-v-3859704e"]]),At={class:"dialog-footer"},Rt=sl({__name:"ciDataShowPass",props:{showAllPassDia:{},showAllPassDiaModifiers:{}},emits:["update:showAllPassDia"],setup(ee){const me=Ma(),J=nl(ee,"showAllPassDia"),O=T(()=>me.gmCry),A=i(),y=vl({secret:null,time:3});i(""),i(!1);const X=async te=>{te.validate(async I=>{I&&(y.secret===O.value.key?(ol({title:"操作成功",message:"解密成功,"+y.time+"分钟后过期！",type:"success",duration:2e3}),me.updateShowAllPass(!0),J.value=!1,me.setShowAllPassTime(y.time*60*1e3),ae(A.value)):ol({title:"操作失败",message:"密钥错误",type:"warning",duration:2e3}))})},ae=te=>{te&&te.resetFields()},C=()=>{J.value=!1,ae(A.value)};return(te,I)=>{const pe=c("el-input"),oe=c("el-form-item"),ne=c("el-input-number"),se=c("el-form"),ve=c("el-button"),G=c("el-dialog");return t(),d(G,{modelValue:J.value,"onUpdate:modelValue":I[3]||(I[3]=ue=>J.value=ue),title:"查看密码",width:"400"},{footer:l(()=>[$("div",At,[a(ve,{onClick:C},{default:l(()=>I[5]||(I[5]=[p("取消")])),_:1}),a(ve,{type:"primary",onClick:I[2]||(I[2]=ue=>X(A.value))},{default:l(()=>I[6]||(I[6]=[p(" 查看 ")])),_:1})])]),default:l(()=>[a(se,{ref_key:"allPassFormRef",ref:A,inline:!0,model:y,"require-asterisk-position":"right","label-position":"left"},{default:l(()=>[a(oe,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(pe,{type:"password",modelValue:y.secret,"onUpdate:modelValue":I[0]||(I[0]=ue=>y.secret=ue),"show-password":"",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(oe,{label:"有效时间",prop:"time"},{default:l(()=>[a(ne,{modelValue:y.time,"onUpdate:modelValue":I[1]||(I[1]=ue=>y.time=ue),min:1,step:1,max:30},{suffix:l(()=>I[4]||(I[4]=[$("span",null,"分钟",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),zt={style:{display:"flex","justify-content":"center"}},Lt=sl({__name:"ciDataqCode",props:Ke(["qCodeContext"],{showqCodeDia:{},showqCodeDiaModifiers:{}}),emits:["update:showqCodeDia"],setup(ee){const{proxy:me}=fl();xa();const J=nl(ee,"showqCodeDia"),O=ee;return(A,y)=>{const X=c("a-qrcode"),ae=c("el-dialog");return t(),d(ae,{modelValue:J.value,"onUpdate:modelValue":y[0]||(y[0]=C=>J.value=C),title:"实例二维码",width:"600"},{default:l(()=>[$("div",zt,[a(X,{value:JSON.stringify(O.qCodeContext),size:500},null,8,["value"])])]),_:1},8,["modelValue"])}}}),Yt={style:{display:"flex","justify-content":"space-around",gap:"20px",height:"100%"}},Bt={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Jt={style:{width:"100%",overflow:"auto"}},Kt={class:"listItem"},Ht={class:"card",style:{flex:"1",display:"flex","flex-direction":"column"}},Gt={style:{"margin-right":"5px"}},Wt={style:{float:"left"}},Qt={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Xt={key:0},Zt={key:1},eo={key:0},lo={key:1},ao={key:2},to={key:3},oo={style:{flex:"auto"}},no=sl({__name:"ciDataFilter",props:Ke(["ciModelId","currentNodeId","allModelField","allModelFieldByNameObj","enumOptionObj","validationRulesObj","modelRefOptions"],{showFilter:{},showFilterModifiers:{}}),emits:Ke(["getCiData","updateFilterParam"],["update:showFilter"]),setup(ee,{expose:me,emit:J}){const O=ee,A=nl(ee,"showFilter"),y=i(""),X=i(""),ae=T(()=>y.value===""?ne.value:ne.value.filter(_=>_.verbose_name.includes(y.value))),{proxy:C}=fl();function te(){A.value=!1}const I=_=>{E.value.push(_)},pe=_=>{let m=G.filterParams.indexOf(_);E.value.splice(m,1)},oe=(_,m)=>{_==="instance_name"?G.instance_name="":E.value.splice(m,1),Ve(()=>{se("updateFilterParam",D.value)})},ne=T(()=>O.allModelField.filter(_=>!E.value.includes(_)));i({});const se=J,ve=i(""),G=vl({filterParams:[],instance_name:""}),ue=i([{value:"=",label:"等于",description:"等于"},{value:"not:",label:"不等于",description:"不等于"},{value:"like:",label:"模糊匹配",description:"模糊匹配"},{value:"not:like:",label:"反向模糊",description:"反向模糊匹配"},{value:"in:",label:"在列表",description:"以,分隔"},{value:"not:in:",label:"不在列表",description:"以,分隔"},{value:"regex:",label:"正则",description:"正则表达式"},{value:"null",label:"空",description:"正则表达式"},{value:"not:null",label:"非空",description:"正则表达式"}]),E=i([]),D=T(()=>{let _=new Object;return G.filterParams.forEach(m=>{if(m.match==="null"||m.match==="not:null"){_[m.name]=m.match;return}if(m.value!==""){let K=null;m.value!==null?K=m.value:K="null",m.match==="="?_[m.name]=K:_[m.name]=m.match+K}}),G.instance_name!==""&&(_.instance_name=G.instance_name),_}),Le=()=>{console.log(D.value),se("updateFilterParam",D.value),console.log(D.value),Ve(()=>{se("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId})}),A.value=!1},B=T(()=>{var _;return(_=G.filterParams)==null?void 0:_.map(m=>m.name)});El(()=>E.value,_=>{var K;let m=new Array;(K=E.value)==null||K.forEach((de,we)=>{var _e;if(((_e=B.value)==null?void 0:_e.indexOf(de.name))>>>-1)m.push({name:de.name,value:"",match:"=",label:de.verbose_name});else{let ye=G.filterParams.findIndex(H=>H.name===de.name);m.push(G.filterParams[ye])}}),G.filterParams=m},{deep:!0});const b=_=>{_&&(_.resetFields(),se("updateFilterParam",D.value),Ve(()=>{se("getCiData",{model:O.ciModelId,model_instance_group:O.currentNodeId})}))};return me({removeFilterParam:oe}),(_,m)=>{const K=c("el-text"),de=c("el-divider"),we=c("el-input"),_e=c("el-icon"),ye=c("el-form-item"),H=c("el-button"),fe=c("el-option"),Z=c("el-select"),L=c("el-switch"),Ze=c("el-space"),He=c("el-form"),Ge=c("el-drawer");return t(),d(Ge,{modelValue:A.value,"onUpdate:modelValue":m[4]||(m[4]=U=>A.value=U),direction:"rtl",size:"50%","before-close":te},{header:l(()=>[a(K,{tag:"b"},{default:l(()=>m[5]||(m[5]=[p("筛选")])),_:1})]),default:l(()=>[$("div",Yt,[$("div",Bt,[a(K,{tag:"b"},{default:l(()=>m[6]||(m[6]=[p("模型字段")])),_:1}),a(de),a(we,{modelValue:y.value,"onUpdate:modelValue":m[0]||(m[0]=U=>y.value=U),style:{width:"100%","margin-bottom":"10px"},placeholder:"筛选字段名称",clearable:"",ref_key:"filterInputRef",ref:X},null,8,["modelValue"]),$("div",Jt,[(t(!0),r(le,null,ce(ae.value,(U,Pe)=>(t(),r("div",{key:Pe},[$("div",Kt,[$("span",null,V(U.verbose_name),1),a(_e,null,{default:l(()=>[a(h(Ca),{onClick:S=>I(U)},null,8,["onClick"])]),_:2},1024)])]))),128))])]),$("div",Ht,[a(K,{tag:"b"},{default:l(()=>m[7]||(m[7]=[p("过滤器")])),_:1}),a(de),a(He,{ref_key:"filterFormRef",ref:ve,model:G,"label-width":"auto",style:{width:"100%"},"label-position":"top"},{default:l(()=>[a(Ze,{wrap:""},{default:l(()=>[a(ye,{label:"唯一标识",prop:"instance_name"},{default:l(()=>[a(we,{modelValue:G.instance_name,"onUpdate:modelValue":m[1]||(m[1]=U=>G.instance_name=U),type:"textarea",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),(t(!0),r(le,null,ce(G.filterParams,(U,Pe)=>(t(),d(ye,{key:U.index,prop:"filterParams."+Pe+".value"},{label:l(()=>[$("span",Gt,V(U.label),1),a(H,{icon:h(ha),size:"small",circle:"",onClick:Ml(S=>pe(U),["prevent"])},null,8,["icon","onClick"])]),default:l(()=>[a(Ze,null,{default:l(()=>[a(Z,{modelValue:U.match,"onUpdate:modelValue":S=>U.match=S,placeholder:"匹配方式",style:{"max-width":"100px",width:"120px"}},{default:l(()=>[(t(!0),r(le,null,ce(ue.value,S=>(t(),d(fe,{key:S.value,label:S.label,value:S.value},{default:l(()=>[$("span",Wt,V(S.label),1),$("span",Qt,V(S.description),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),U.match==="null"||U.match==="not:null"?(t(),r("div",Xt)):(t(),r("div",Zt,[["enum"].indexOf(O.allModelFieldByNameObj[U.name].type)>>>-1?["model_ref"].indexOf(O.allModelFieldByNameObj[U.name].type)>>>-1?["boolean"].indexOf(O.allModelFieldByNameObj[U.name].type)>>>-1?(t(),r("div",to,[a(we,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",ao,[a(L,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",lo,[a(Z,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(le,null,ce(O.modelRefOptions[U.name],S=>(t(),d(fe,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",eo,[a(Z,{modelValue:U.value,"onUpdate:modelValue":S=>U.value=S,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(le,null,ce(O.enumOptionObj[O.allModelFieldByNameObj[U.name].validation_rule],S=>(t(),d(fe,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]))]),_:2},1024)]),_:2},1032,["prop"]))),128))]),_:1})]),_:1},8,["model"])])])]),footer:l(()=>[$("div",oo,[a(H,{onClick:m[2]||(m[2]=U=>b(ve.value))},{default:l(()=>m[8]||(m[8]=[p("重置")])),_:1}),a(H,{onClick:m[3]||(m[3]=U=>Le()),type:"primary"},{default:l(()=>m[9]||(m[9]=[p("搜索")])),_:1})])]),_:1},8,["modelValue"])}}}),so=Al(no,[["__scopeId","data-v-8bcd5a33"]]),uo={key:0,class:"card table-main",style:{width:"100%",flex:"1"}},ro={class:"table-header"},io={class:"header-button-lf"},co={class:"header-button-ri"},po={class:"flexJstart gap-1",style:{overflow:"auto"}},vo={class:"text_class"},fo={key:0,class:"text_class"},mo={key:1},_o={style:{display:"flex","justify-content":"space-between",width:"100%"}},yo={style:{display:"flex","justify-content":"space-between"}},go={key:1,class:"requiredClass"},bo={key:0},wo={key:0},ko={key:1},ho={key:0},Co={key:1},xo={key:0},Vo={key:1},$o={key:0},Mo={key:1},Oo={key:0},Do={key:0},Uo={key:0},Io={key:1},Fo={key:0},Po={key:1},No={key:0},So={key:1},qo={key:0},jo={key:1},To={key:0},Eo={key:1},Ao={key:0},Ro={key:1},zo={style:{flex:"auto"},class:"footerButtonClass"},Lo={key:0},Yo={key:1},Bo={key:0},Jo={key:1},Ko={key:0},Ho={key:0},Go={key:1},Wo={key:2},Qo={key:3},Xo={key:4},Zo={key:5},en={key:6},ln={key:7},an={key:8},tn={key:9},on={class:"dialog-footer"},nn={class:"dialog-footer"},sn=sl({__name:"ciDataShow",props:Ke(["ciModelId","treeData","currentNodeId"],{showTree:{},showTreeModifiers:{}}),emits:Ke(["getTree"],["update:showTree"]),setup(ee,{expose:me,emit:J}){const{proxy:O}=fl(),A=Ma(),y=Va(),X=xa(),ae=J,C=ee,te=nl(ee,"showTree"),I=i([0]),pe=i(!1),oe=()=>{pe.value=!0},ne=i(!0),se=()=>{ne.value=!1,Ve(()=>{ne.value=!0})},ve=i(""),G=()=>{pe.value=!1},ue=i(!1),E=T(()=>A.gmCry),D=T(()=>A.showAllPass),Le=T(()=>A.showAllPassTime),B=async()=>{ue.value=!0},b=()=>{A.updateShowAllPass(!1),ol({title:"操作成功",message:"密码到期已自动屏蔽",type:"success",duration:2e3})},_=s=>{A.setShowAllPassTime(s.totalMilliseconds)},m=()=>{ue.value=!1,A.updateShowAllPass(!1),A.setShowAllPassTime(0),ol({title:"success",message:"密码已屏蔽",type:"success",duration:2e3})},K=i(!1),de=()=>{H.value=!1,Be(we.value[0]),ye.value=""},we=i(),_e=vl({secret:null}),ye=i(""),H=i(!1),fe=async(s,e)=>{s[0].validate(async u=>{u&&(_e.secret===E.value.key?(ye.value=$l(E.value.key,E.value.mode,e),H.value=!0):(ol({title:"Warning",message:"密钥错误",type:"warning",duration:2e3}),H.value=!1,ye.value=""))})},Z=i(1),L=i(10),Ze=i("default"),He=i(!1),Ge=()=>{Me({model:C.ciModelId,model_instance_group:C.currentNodeId})},U=()=>{Me({model:C.ciModelId,model_instance_group:C.currentNodeId})},Pe=T(()=>Il.value.map(s=>s.name)),S=T(()=>hl.value.map(s=>s.name)),We=i(!1),Qe=T(()=>he.value?{all:!0,group:C.currentNodeId,params:Cl}:{group:C.currentNodeId,params:Cl}),ul=async()=>{let s=new Object;he.value?s={update_user:X.state.username,...Qe}:s={update_user:X.state.username,instances:re.value};let e=await O.$api.bulkDeleteCiModelInstance(s);e.status=="200"?(N({type:"success",message:"删除成功"}),wl.value.clearSelection(),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId})):N({type:"error",message:`删除失败:${e.data}`})},el=async s=>{s?await O.$api.exportCiData({model:C.ciModelId,fields:S.value,instances:re.value}):await O.$api.exportCiData({model:C.ciModelId,fields:Pe.value,instances:re.value})},Ol=async()=>{let s=await O.$api.exportCiData({model:C.ciModelId,...Qe});console.log(s)},dl={multiple:!0,value:"id"},Xe=i(!1),w=i([]),g=T(()=>C.treeData[0].children[0].id),q=T(()=>C.treeData[0].id),Ne=async()=>{var u;let s=[];(u=w.value)==null||u.forEach(k=>{s.push(k[k.length-1])});let e=await O.$api.setCiDataToTree({instances:re.value,groups:s});e.status=="201"?(N({type:"success",message:"更新成功"}),Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),ea(),ae("getTree")):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}),w.value=[],Xe.value=!1},ll=i(""),al=i(!1),R=i({}),Ye=(s,e)=>{s?P.updateParams[e]="null":P.updateParams[e]=null},ml=()=>{al.value=!0};i(!1);const Rl=s=>{var e;if(s!==void 0&&((e=je.value[s])==null?void 0:e.field_type)==="string")return s==""||s==null?void 0:[{pattern:new RegExp(je.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]};T(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(k=>{k.fields.forEach(x=>{var j;x.type==="string"&&x.validation_rule!==""&&x.validation_rule!==null&&(s["updateParams."+x.name]=[{pattern:new RegExp((j=je.value[x.validation_rule])==null?void 0:j.rule),message:"不符合正则表达式",trigger:"blur"}])})}),s});const P=vl({updateParams:{}}),Se=i([]),_l=()=>{const s=Object.keys(P.updateParams).length,e=`__temp_param_${s}`;Se.value[s]=e,P.updateParams[e]=""},zl=(s,e)=>{console.log(e),P.updateParams[e]=void 0,delete P.updateParams[Se.value[s]],Se.value[s]=e},ke=(s,e)=>{Se.value.splice(s,1),delete R.value[e],delete P.updateParams[e]},$e=T(()=>{let s=new Object;for(let[e,u]of Object.entries(P.updateParams))u==="null"?s[e]=null:s[e]=u,ie.value.password.indexOf(e)!==-1&&(s[e]=Xl(E.value.key,E.value.mode,u));return s}),Dl=()=>{ll.value.validate(async s=>{if(s){let e=new Object;he.value?e={update_user:X.state.username,fields:$e.value,model:C.ciModelId,...Qe}:e={update_user:X.state.username,instances:re.value,fields:$e.value};let u=await O.$api.multipleUpdateCiModelInstance(e);u.status=="200"?(N({type:"success",message:"更新成功"}),Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),P.updateParams={},R.value={},Se.value=[],al.value=!1):N({showClose:!0,message:"更新失败:"+JSON.stringify(u.data),type:"error"})}else N({showClose:!0,message:"请输入正确内容.",type:"error"})})},Ue=T(()=>{var e,u;let s=new Array;return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(k=>{k.fields.forEach(x=>{let j=!1;x.name in P.updateParams&&(j=!0),s.push({value:x.name,label:x.verbose_name,disable:j})})}),s}),yl=()=>{al.value=!1,P.updateParams={},R.value={},Se.value=[]},gl=i(!0),bl=s=>{gl.value=s},Ul=i(!0),W=i(!1),Ll=i(!1),Oa=()=>{Ll.value=!0},Da=async s=>{bl(!0);let e=await O.$api.updateCiModelInstance({update_user:X.state.username,...s});e.status=="200"?(N({type:"success",message:"更新成功"}),xe.value=!1,Be(tl.value),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},Ua=s=>!he.value,wl=i(null),Ia=s=>s.id,re=i([]),Fa=s=>{re.value=s.map(e=>e.id)},he=i(!1),Pa=s=>{s?re.value.length===0&&wl.value.toggleAllSelection():(re.value=[],wl.value.clearSelection()),console.log(re.value)},ea=()=>{re.value=[],wl.value.clearSelection()},Il=i([]),qe=i({}),Na=T(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(k=>{k.fields.forEach(x=>{s[x.id]=x})}),s}),ge=T(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(k=>{k.fields.forEach(x=>{s[x.name]=x})}),s}),la=i(""),Sa=()=>{la.value.getHasConfigField()},aa=()=>{Ul.value=!1,Ve(()=>{Ul.value=!0})},qa=s=>s.map(u=>u.id===g.value).length>>0,je=i({});i({});const ja=async(s=null)=>{(await O.$api.getValidationRules({...s,page:1,page_size:1e4})).data.results.forEach(u=>{je.value[u.id]=u})},Yl=T(()=>{var e,u;let s={};return(u=(e=qe.value)==null?void 0:e.field_groups)==null||u.forEach(k=>{k.fields.forEach(x=>{if(x.type==="enum"){if(x.validation_rule===null)return;let j=JSON.parse(je==null?void 0:je.value[x==null?void 0:x.validation_rule].rule),Ae=[];Object.keys(j).forEach(il=>{Ae.push({value:il,label:j[il]})}),s[x.validation_rule]=Ae}})}),s}),ta=T(()=>{let s={};return qe.value.field_groups.forEach(e=>{e.fields.forEach(u=>{if(u.type==="enum"){let k=JSON.parse(je.value[u.validation_rule].rule),x={};Object.keys(k).forEach(j=>{x[j]=k[j]}),s[u.name]=x}})}),s}),kl=i({}),Ta=async(s,e)=>{let u=await O.$api.getModelRefCi({model:e.id,page:1,page_size:5e3}),k=[];u.data.results.forEach(x=>{k.push({value:x.id,label:x.instance_name})}),kl.value[e.name]=k},Ea=T(()=>{let s=new Object;for(let[e,u]of Object.entries(kl.value)){let k=new Object;u==null||u.forEach(x=>{k[x.value]=x}),s[e]=k}return s}),Aa=s=>{if(!(s==""||s==null))return[{pattern:new RegExp(je.value[s].rule),message:"不符合正则表达式",trigger:"blur"}]},Ra=()=>{for(const[s,e]of Object.entries(v))s!=="instance_name"&&delete v[s];qe.value.field_groups.forEach(s=>{s.fields.forEach(e=>{v[e.name]=e.default})}),v.instance_name=null},hl=i([]),za=async()=>{var u;let s=await O.$api.getCiModel({},C.ciModelId);qe.value=s.data;let e=[];(u=qe.value.field_groups)==null||u.forEach(k=>{k.fields.forEach(x=>{e.push(x)})}),hl.value=e},ie=T(()=>{let s={enum:[],boolean:[],model_ref:[],password:[]};return hl.value.forEach(e=>{e.type==="enum"?s.enum.push(e.name):e.type==="boolean"?s.boolean.push(e.name):e.type==="model_ref"?s.model_ref.push(e.name):e.type==="password"&&s.password.push(e.name)}),s});El(()=>ie.value.model_ref,s=>{ie.value.model_ref.forEach(e=>{Ta(!0,{id:ge.value[e].ref_model,name:e})})},{deep:!0});const oa=i([]),Bl=i(0),Cl=i({}),na=s=>{Cl.value=s},sa=T(()=>{let s=new Array;for(let[e,u]of Object.entries(Cl.value))console.log(),e==="instance_name"?s.push({name:"唯一标识:"+u,field:e}):ie.value.model_ref.indexOf(e)!==-1?s.push({name:ge.value[e].verbose_name+":"+Ea.value[e][u].label,field:e}):ie.value.enum.indexOf(e)!==-1?(console.log(ta.value),s.push({name:ge.value[e].verbose_name+":"+ta.value[e][u],field:e})):s.push({name:ge.value[e].verbose_name+":"+u,field:e});return s}),La=async(s,e)=>{await ve.value.removeFilterParam(s,e),Ve(()=>{Me({model:C.ciModelId,model_instance_group:C.currentNodeId})})},Me=async s=>{var k;bl(!0);let e=new Array,u=await O.$api.getCiModelInstance({...s,page:Z.value,page_size:L.value,...Cl.value});Bl.value=u.data.count,(k=u.data.results)==null||k.forEach(x=>{e.push({id:x.id,instance_group:x.instance_group,instance_name:x.instance_name,...x.fields})}),oa.value=e,Ve(()=>{he.value=!1,bl(!1)})};$a(async()=>{Ul.value=!0,await ja(),bl(!1)});const xe=i(!1),Ya=()=>{W.value=!0,xe.value=!0,Ee.value=!0},Te=i({}),Fl=i({}),ua=(s,e=!1)=>{xe.value=!0,Ee.value=!1,W.value=e,Te.value=s,Ve(()=>{Object.keys(s).forEach(u=>{u==="id"||u==="instance_group"||(ie.value.model_ref.indexOf(u)!==-1?s[u]!==null?v[u]=s[u].id:v[u]=s[u]:ie.value.password.indexOf(u)!==-1?(console.log("password"),D.value?v[u]=$l(E.value.key,E.value.mode,s[u]):v[u]=s[u]):v[u]=s[u])}),Fl.value=JSON.parse(JSON.stringify(v))})},Ba=s=>{xe.value=!0,Ee.value=!0,W.value=!0,Te.value=s,Ve(()=>{Object.keys(s).forEach(e=>{e==="id"||e==="instance_group"||(ie.value.model_ref.indexOf(e)!==-1?s[e]!==null?v[e]=s[e].id:v[e]=s[e]:ie.value.enum.indexOf(e)!==-1?v[e]=s[e].value:ie.value.password.indexOf(e)!==-1&&D.value?v[e]=$l(E.value.key,E.value.mode,s[e]):v[e]=s[e])})}),ol({title:"Warning",message:"复制实例，请修改后再提交",type:"warning",duration:2e3})},tl=i(),v=vl({instance_name:null}),da=T(()=>{let s=Object.assign({},v);delete s.instance_name;for(let[e,u]of Object.entries(s))u!==null&&ie.value.password.indexOf(e)!==-1&&(s[e]=Xl(E.value.key,E.value.mode,u));return s}),ra=T(()=>{let s=Object.assign({},rl.value);delete s.instance_name,console.log(ie.value);for(let[e,u]of Object.entries(rl.value))u!==null&&ie.value.password.indexOf(e)!==-1&&(s[e]=Xl(E.value.key,E.value.mode,u));return s}),Ee=i(!0),rl=i({}),ia=async(s,e=null)=>{s&&await s.validate(async(u,k)=>{if(u)if(Ee.value){console.log(da.value);let x=await O.$api.addCiModelInstance({model:C.ciModelId,create_user:X.state.username,update_user:X.state.username,fields:da.value,instance_name:v.instance_name,instance_group:[C.currentNodeId]});x.status=="201"?(N({type:"success",message:"添加成功"}),xe.value=!1,Be(s),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),ae("getTree")):N({showClose:!0,message:"添加失败:"+JSON.stringify(x.data),type:"error"})}else{if(console.log(JSON.stringify(Fl.value)),console.log(JSON.stringify(v)),JSON.stringify(Fl.value)===JSON.stringify(v)){W.value=!1,xe.value=!1,Be(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}else{const Ae=Object.entries(Fl.value),il=Object.entries(v),Kl=Ae.concat(il).map(Fe=>JSON.stringify(Fe)),Nl=Array.from(new Set(Kl)).map(Fe=>JSON.parse(Fe));Nl.splice(0,Ae.length);const Q=Object.fromEntries(Nl);let Sl={};if(Object.keys(Q).forEach(Fe=>{Sl[Fe]=Q[Fe]}),rl.value=Sl,Object.keys(rl.value).length===0){W.value=!1,xe.value=!1,Be(s),N({showClose:!0,message:"无更新,关闭窗口",type:"info"});return}}let x={id:Te.value.id,model:C.ciModelId,update_user:X.state.username};Object.keys(rl.value).indexOf("instance_name")===-1||(x.instance_name=rl.value.instance_name),x.fields=ra.value,console.log(ie.value),console.log(x),console.log();let j=await O.$api.updateCiModelInstance(x);j.status=="200"?(N({type:"success",message:"更新成功"}),xe.value=!1,W.value=!1,Be(s),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId})):N({showClose:!0,message:"更新失败:"+JSON.stringify(j.data),type:"error"})}else console.log("error submit!",k),ol({title:"表单校验",message:"表单填写异常",type:"error"})})},Ja=s=>{if(W.value==!1&&Ee.value==!1){xe.value=!1;return}Zl.confirm("是否确认关闭?").then(()=>{s(),Be(tl.value),xe.value=!1,W.value=!1}).catch(()=>{})},Ka=s=>{Be(s),xe.value=!1,W.value=!1},ca=(s=null)=>{Zl.confirm("是否确认删除?","实例删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await O.$api.deleteCiModelInstance(Te.value.id)).status==204?(N({type:"success",message:"删除成功"}),await Me({model:C.ciModelId,model_instance_group:C.currentNodeId}),Be(tl.value),xe.value=!1,W.value=!1,ae("getTree")):N({type:"error",message:"删除失败"})}).catch(()=>{N({type:"info",message:"取消删除"})})},Be=s=>{s&&(s.resetFields(),Te.value={})},Pl=i("modelField"),Ha=(s,e)=>{console.log(Pl.value)};me({getHasConfigField:Sa,getCiData:Me,initCiDataForm:Ra,getModelField:za,setLoading:bl,closeFilter:G,clearMultipleSelect:ea,updateFilterParam:na,reloadCiDataFilter:se});const Jl=i(!1),pa=i(""),Ga=s=>{Jl.value=!0,pa.value=s},Wa=({row:s,column:e,rowIndex:u,columnIndex:k})=>{if(u===0&&k===0&&he.value)return"selectAllBtnDis"};return(s,e)=>{var ga,ba,wa;const u=c("el-button"),k=c("el-tooltip"),x=c("arrow-down"),j=c("el-icon"),Ae=c("el-dropdown-item"),il=c("el-dropdown-menu"),Kl=c("el-dropdown"),Nl=c("vue-countdown"),Q=c("el-text"),Sl=c("el-tag"),Fe=c("el-table-column"),va=c("el-link"),Je=c("el-switch"),Qa=c("el-table"),Xa=c("el-checkbox"),Za=c("el-pagination"),fa=c("el-descriptions-item"),et=c("el-descriptions"),Oe=c("el-space"),Re=c("el-input"),Ce=c("el-form-item"),lt=c("InfoFilled"),Hl=c("el-input-number"),Gl=c("el-col"),ma=c("el-row"),Wl=c("el-form"),at=c("el-popover"),ql=c("el-date-picker"),xl=c("el-option"),Vl=c("el-select"),tt=c("el-collapse-item"),ot=c("el-collapse"),jl=c("el-tab-pane"),nt=c("el-tabs"),st=c("el-drawer"),_a=c("el-dialog"),ut=c("el-cascader"),be=pl("permission"),dt=pl("loading"),rt=pl("copy"),ya=pl("throttle");return t(),r(le,null,[Ul.value?(t(),r("div",uo,[$("div",ro,[$("div",io,[te.value?(t(),d(u,{key:0,icon:h(ct),onClick:e[0]||(e[0]=n=>te.value=!1),size:"default"},null,8,["icon"])):(t(),d(u,{key:1,icon:h(pt),onClick:e[1]||(e[1]=n=>te.value=!0),size:"default"},null,8,["icon"])),Y((t(),d(u,{type:"primary",onClick:Ya},{default:l(()=>e[34]||(e[34]=[p("添加")])),_:1})),[[be,`${(ga=h(y).name)==null?void 0:ga.replace("_info","")}:add`]]),(re.value.length>>>0||he.value)&&q.value!==ee.currentNodeId?Y((t(),d(u,{key:3,disabled:!((re.value.length>>>0||he.value)&&q.value!==ee.currentNodeId),content:"勾选实例且非<所有>分组才支持转移~",onClick:e[3]||(e[3]=n=>Xe.value=!0)},{default:l(()=>e[36]||(e[36]=[p("转移")])),_:1},8,["disabled"])),[[be,`${(ba=h(y).name)==null?void 0:ba.replace("_info","")}:edit`]]):(t(),d(k,{key:2,class:"box-item",effect:"dark",content:"勾选实例且非<所有>分组才支持转移~",placement:"top"},{default:l(()=>{var n;return[Y((t(),d(u,{disabled:!((re.value.length>>>0||he.value)&&q.value!==ee.currentNodeId),onClick:e[2]||(e[2]=z=>Xe.value=!0)},{default:l(()=>e[35]||(e[35]=[p("转移")])),_:1},8,["disabled"])),[[be,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:edit`]])]}),_:1})),Y((t(),d(u,{disabled:!(re.value.length>>>0||he.value),onClick:ml},{default:l(()=>e[37]||(e[37]=[p("批量更新")])),_:1},8,["disabled"])),[[be,`${(wa=h(y).name)==null?void 0:wa.replace("_info","")}:edit`]]),a(Kl,{style:{"margin-left":"12px"}},{dropdown:l(()=>[a(il,null,{default:l(()=>{var n,z;return[Y((t(),r("div",null,[a(Ae,{disabled:!(re.value.length>>>0||he.value),onClick:e[4]||(e[4]=o=>ul()),divided:""},{default:l(()=>e[39]||(e[39]=[p("批量删除")])),_:1},8,["disabled"])])),[[be,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:delete`]]),Y((t(),r("div",null,[a(Ae,{disabled:!(re.value.length>>>0),onClick:e[5]||(e[5]=o=>el(!1))},{default:l(()=>e[40]||(e[40]=[p("导出勾选(显示字段)")])),_:1},8,["disabled"]),a(Ae,{disabled:!(re.value.length>>>0),onClick:e[6]||(e[6]=o=>el(!0))},{default:l(()=>e[41]||(e[41]=[p("导出勾选(所有字段)")])),_:1},8,["disabled"]),a(Ae,{onClick:e[7]||(e[7]=o=>Ol())},{default:l(()=>e[42]||(e[42]=[p("导出所有")])),_:1})])),[[be,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:export`]])]}),_:1})]),default:l(()=>[a(u,{type:"primary"},{default:l(()=>[e[38]||(e[38]=p(" 更多操作")),a(j,{class:"el-icon--right"},{default:l(()=>[a(x)]),_:1})]),_:1})]),_:1})]),$("div",co,[a(k,{class:"box-item",effect:"dark",content:"刷新表格",placement:"top"},{default:l(()=>[a(u,{icon:h(vt),circle:"",onClick:aa},null,8,["icon"])]),_:1}),D.value?M("",!0):(t(),d(k,{key:0,class:"box-item",effect:"dark",content:"显示密码",placement:"top"},{default:l(()=>{var n;return[Y(a(u,{icon:h(Ql),circle:"",onClick:B},null,8,["icon"]),[[be,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:showPassword`]])]}),_:1})),D.value?(t(),d(k,{key:1,class:"box-item",effect:"dark",content:"隐藏密码",placement:"top"},{content:l(()=>e[43]||(e[43]=[$("span",null,[p("倒计时结束后自动隐藏密码"),$("br"),p("手动点击可立马隐藏")],-1)])),default:l(()=>[a(u,{circle:"",onClick:m},{default:l(()=>[a(Nl,{time:Le.value,onEnd:b,onProgress:_},{default:l(({totalSeconds:n})=>[p(V(n),1)]),_:1},8,["time"])]),_:1})]),_:1})):M("",!0),a(k,{class:"box-item",effect:"dark",content:"配置表格显示列",placement:"top"},{default:l(()=>[a(u,{icon:h(ft),circle:"",onClick:Oa},null,8,["icon"])]),_:1}),a(k,{class:"box-item",effect:"dark",content:"实例导入",placement:"top"},{default:l(()=>{var n;return[Y(a(u,{icon:h(mt),circle:"",onClick:e[8]||(e[8]=z=>We.value=!0)},null,8,["icon"]),[[be,`${(n=h(y).name)==null?void 0:n.replace("_info","")}:import`]])]}),_:1}),a(k,{class:"box-item",effect:"dark",content:"打开过滤器",placement:"top"},{default:l(()=>[a(u,{icon:h(_t),circle:"",onClick:oe},null,8,["icon"])]),_:1})])]),Y($("div",po,[a(Q,{tag:"b"},{default:l(()=>e[44]||(e[44]=[p("过滤器")])),_:1}),(t(!0),r(le,null,ce(sa.value,(n,z)=>(t(),d(Sl,{key:n.name,closable:"",type:"primary",onClose:o=>La(n.field,z)},{default:l(()=>[$("span",null,V(n.name),1)]),_:2},1032,["onClose"]))),128))],512),[[Tl,sa.value.length>>>0]]),Y((t(),d(Qa,{ref_key:"ciDataTableRef",ref:wl,data:oa.value,onSelectionChange:Fa,"table-layout":"fixed","highlight-current-row":"",style:{flex:"1"},border:"","row-key":Ia},{default:l(()=>[a(Fe,{"header-cell-class-name":Wa,type:"selection",selectable:Ua,width:"40",disable:he.value,"reserve-selection":!0},null,8,["disable"]),a(Fe,{prop:"instance_name",label:"名称",fixed:"left",width:"180"}),(t(!0),r(le,null,ce(Il.value,(n,z)=>(t(),d(Fe,{property:n.name,label:n.verbose_name,"show-overflow-tooltip":"",sortable:"","min-width":"120","max-width":"220"},yt({_:2},[n.name==="mgmt_ip"?{name:"default",fn:l(o=>[a(va,{href:`https://${o.row[n.name]}`,type:"primary",target:"_blank"},{default:l(()=>[p(V(o.row[n.name]),1)]),_:2},1032,["href"])]),key:"0"}:void 0,ie.value.boolean.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[Y(a(Je,{modelValue:o.row[n.name],"onUpdate:modelValue":F=>o.row[n.name]=F,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:F=>Da({id:o.row.id,fields:{[n.name]:o.row[n.name]}})},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[be,{id:`${(f=h(y).name)==null?void 0:f.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"1"}:void 0,ie.value.enum.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[$("div",vo,V((f=o.row[n.name])==null?void 0:f.label),1)]}),key:"2"}:void 0,ie.value.password.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f;return[D.value?(t(),r("div",fo,V(h($l)(E.value.key,E.value.mode,o.row[n.name])),1)):(t(),r("div",mo,[((f=o.row[n.name])==null?void 0:f.length)>>0?(t(),d(Q,{key:0},{default:l(()=>e[45]||(e[45]=[p("******")])),_:1})):(t(),d(Q,{key:1}))]))]}),key:"3"}:void 0,ie.value.model_ref.indexOf(n.name)!=-1?{name:"default",fn:l(o=>{var f,F;return[$("div",{class:Ie({text_class:((f=o.row[n.name])==null?void 0:f.instance_name)>>0})},V((F=o.row[n.name])==null?void 0:F.instance_name),3)]}),key:"4"}:void 0]),1032,["property","label"]))),256)),a(Fe,{fixed:"right",width:"150",label:"操作"},{default:l(n=>[a(k,{class:"box-item",effect:"dark",content:"查看详情",placement:"top"},{default:l(()=>[a(u,{link:"",type:"primary",icon:h(Ql),onClick:z=>ua(n.row)},null,8,["icon","onClick"])]),_:2},1024),a(k,{class:"box-item",effect:"dark",content:"编辑",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:h(gt),onClick:o=>ua(n.row,!0)},null,8,["icon","onClick"]),[[be,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:edit`]])]}),_:2},1024),a(k,{class:"box-item",effect:"dark",content:"克隆",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:h(ka),onClick:o=>Ba(n.row)},null,8,["icon","onClick"]),[[be,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:edit`]])]}),_:2},1024),a(k,{class:"box-item",effect:"dark",content:"点击查看二维码",placement:"top"},{default:l(()=>{var z;return[Y(a(u,{link:"",type:"primary",icon:h(bt),onClick:o=>Ga(n.row)},null,8,["icon","onClick"]),[[be,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:view`]])]}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[dt,gl.value]]),a(Za,{"current-page":Z.value,"onUpdate:currentPage":e[10]||(e[10]=n=>Z.value=n),"page-size":L.value,"onUpdate:pageSize":e[11]||(e[11]=n=>L.value=n),"page-sizes":[10,20,50,100,200],size:Ze.value,disabled:He.value,layout:"slot,total, sizes, prev, pager, next, jumper",total:Bl.value,onSizeChange:Ge,onCurrentChange:U,style:{"margin-top":"5px","justify-content":"flex-end"}},{default:l(()=>[$("div",_o,[$("div",yo,[a(Xa,{modelValue:he.value,"onUpdate:modelValue":e[9]||(e[9]=n=>he.value=n),label:"全选",size:"default",onChange:Pa},null,8,["modelValue"])]),a(Q,null,{default:l(()=>[p("已选择 "+V(he.value?Bl.value:re.value.length)+" 条",1)]),_:1})])]),_:1},8,["current-page","page-size","size","disabled","total"])])):M("",!0),a(st,{modelValue:xe.value,"onUpdate:modelValue":e[22]||(e[22]=n=>xe.value=n),class:"edit-drawer",direction:"rtl",size:"45%","before-close":Ja},{header:l(()=>[Ee.value?(t(),d(Q,{key:1,tag:"b"},{default:l(()=>e[46]||(e[46]=[p("实例信息 ")])),_:1})):(t(),d(et,{key:0,title:"实例信息"},{default:l(()=>[a(fa,{label:"唯一标识"},{default:l(()=>{var n;return[p(V((n=Te.value)==null?void 0:n.instance_name),1)]}),_:1}),a(fa,{label:"所属分组"},{default:l(()=>{var n;return[(t(!0),r(le,null,ce((n=Te.value)==null?void 0:n.instance_group,(z,o)=>(t(),d(Q,{key:o},{default:l(()=>[p(V(z.group_path),1)]),_:2},1024))),128))]}),_:1})]),_:1}))]),default:l(()=>[a(nt,{modelValue:Pl.value,"onUpdate:modelValue":e[17]||(e[17]=n=>Pl.value=n),type:"card",class:"demo-tabs",onTabClick:Ha},{default:l(()=>[a(jl,{label:"资产信息",name:"modelField"},{default:l(()=>[a(Wl,{ref_key:"ciDataFormRef",ref:tl,style:{"max-width":"100%"},model:v,"label-width":"auto","status-icon":"","label-position":"top",disabled:!1,"require-asterisk-position":"right"},{default:l(()=>[W.value?(t(),d(Ce,{key:0,prop:"instance_name",required:"",style:{"margin-left":"30px"}},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>e[47]||(e[47]=[p("唯一标识")])),_:1}),a(k,{content:"唯一命名标识",placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:1})]),_:1})]),default:l(()=>[W.value?(t(),d(Re,{key:0,modelValue:v.instance_name,"onUpdate:modelValue":e[12]||(e[12]=n=>v.instance_name=n),style:{width:"240px"}},null,8,["modelValue"])):(t(),r("span",go,V(v.instance_name),1))]),_:1})):M("",!0),a(ot,{modelValue:I.value,"onUpdate:modelValue":e[16]||(e[16]=n=>I.value=n)},{default:l(()=>[(t(!0),r(le,null,ce(qe.value.field_groups,(n,z)=>(t(),d(tt,{name:z,key:z},{title:l(()=>[a(Q,{tag:"b",size:"large"},{default:l(()=>[p(V(n.verbose_name),1)]),_:2},1024)]),default:l(()=>[a(ma,{style:{"margin-left":"30px"}},{default:l(()=>[(t(!0),r(le,null,ce(n.fields,(o,f)=>(t(),d(Gl,{span:12},{default:l(()=>[o.type==="string"?(t(),d(Ce,{key:0,label:o.verbose_name,prop:o.name,required:o.required,rules:Aa(o.validation_rule)},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Re,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,style:{width:"240px"}},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",bo,[v[o.name]!=null?(t(),r("div",wo,[o.name==="mgmt_ip"?(t(),d(va,{key:0,href:`https://${v[o.name]}`,type:"primary",target:"_blank"},{default:l(()=>[p(V(v[o.name]),1)]),_:2},1032,["href"])):(t(),r("span",{key:1,class:Ie(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},V(v[o.name]),3))])):(t(),r("span",ko,"--"))]))]),_:2},1032,["label","prop","required","rules"])):M("",!0),o.type==="json"?(t(),d(Ce,{key:1,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),a(k,{placement:"right",effect:"dark"},{content:l(()=>e[48]||(e[48]=[p(" json类型字段"),$("br",null,null,-1),p("请输入json格式数据! ")])),default:l(()=>[a(j,null,{default:l(()=>[a(lt)]),_:1})]),_:1}),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Re,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",ho,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},V(v[o.name]),3)):(t(),r("span",Co,"--"))]))]),_:2},1032,["label","prop","required"])):M("",!0),["text"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:2,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Re,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,style:{width:"240px"},autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",xo,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}]),style:{width:"100%"}},V(v[o.name]),3)):(t(),r("span",Vo,"--"))]))]),_:2},1032,["label","prop","required"])),o.type==="boolean"?(t(),d(Ce,{key:3,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[a(Je,{modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},disabled:!W.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label","prop","required"])):M("",!0),["float"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:4,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(Q,{key:0,tag:"b"},{default:l(()=>[p(V(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(Q,{key:1,tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(k,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Hl,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,precision:2,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",$o,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},V(v[o.name]),3)):(t(),r("span",Mo,"--"))]))]),_:2},1032,["label","prop","required"])),["password"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:5,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>{var F,ze;return[W.value?(t(),d(Re,{key:1,modelValue:v[o.name],"onUpdate:modelValue":cl=>v[o.name]=cl,style:{width:"240px"},type:"password","auto-complete":"new-password","show-password":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Oo,[((F=v[o.name])==null?void 0:F.length)>>0?(t(),r("div",Do,[D.value?(t(),r("span",Uo,V(h($l)(E.value.key,E.value.mode,v[o.name])),1)):(t(),r("span",{key:1,class:Ie({requiredClass:o.required}),onMouseenter:e[14]||(e[14]=cl=>K.value=!0),onMouseleave:e[15]||(e[15]=cl=>K.value=!1)},[e[50]||(e[50]=p("******** ")),Y((t(),d(at,{width:380,trigger:"click",onAfterLeave:de},{reference:l(()=>[a(j,null,{default:l(()=>[Y(a(h(Ql),null,null,512),[[Tl,K.value&&!D.value]])]),_:1})]),default:l(()=>[a(Wl,{ref_for:!0,ref_key:"passFormRef",ref:we,inline:!0,model:_e,"require-asterisk-position":"right"},{default:l(()=>[a(ma,{align:"middle"},{default:l(()=>[a(Gl,{span:20},{default:l(()=>[a(Ce,{label:"密钥",prop:"secret",rules:[{required:!0,message:"输入密钥",trigger:"blur"}]},{default:l(()=>[a(Re,{type:"password",modelValue:_e.secret,"onUpdate:modelValue":e[13]||(e[13]=cl=>_e.secret=cl),"show-password":"","auto-complete":"new-password",placeholder:"输入密钥查看密码",clearable:"",style:{width:"250px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(Gl,{span:2},{default:l(()=>[a(Ce,null,{default:l(()=>[a(u,{type:"primary",size:"small",onClick:cl=>fe(we.value,v[o.name])},{default:l(()=>e[49]||(e[49]=[p("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"]),H.value?(t(),d(Q,{key:0,tag:"b"},{default:l(()=>[p("密码: "+V(ye.value)+" ",1),a(k,{class:"box-item",effect:"dark",content:"点击复制密码",placement:"top"},{default:l(()=>[a(j,null,{default:l(()=>[Y(a(h(ka),null,null,512),[[rt,ye.value]])]),_:1})]),_:1})]),_:1})):M("",!0)]),_:2},1024)),[[be,`${(ze=h(y).name)==null?void 0:ze.replace("_info","")}:showPassword`]])],34))])):(t(),r("span",Io,"--"))]))]}),_:2},1032,["label","prop","required"])),["integer"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:6,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[o.unit!==null?(t(),d(Q,{key:0,tag:"b"},{default:l(()=>[p(V(o.verbose_name+"("+o.unit+")"),1)]),_:2},1024)):(t(),d(Q,{key:1,tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024)),o.description.length!=0?(t(),d(k,{key:2,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Hl,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,step:1},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",Fo,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},V(v[o.name]),3)):(t(),r("span",Po,"--"))]))]),_:2},1032,["label","prop","required"])),["date"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:7,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(ql,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",No,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},V(v[o.name]),3)):(t(),r("span",So,"--"))]))]),_:2},1032,["label","prop","required"])),["datetime"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:8,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(ql,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):(t(),r("div",qo,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},V(v[o.name]),3)):(t(),r("span",jo,"--"))]))]),_:2},1032,["label","prop","required"])),["enum"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:9,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>{var F;return[W.value?(t(),d(Vl,{key:1,modelValue:v[o.name],"onUpdate:modelValue":ze=>v[o.name]=ze,placeholder:"请选择",style:{width:"240px"}},{default:l(()=>[(t(!0),r(le,null,ce(Yl.value[o.validation_rule],ze=>(t(),d(xl,{key:ze.value,label:ze.label,value:ze.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",To,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie({requiredClass:o.required})},V((F=Te.value[o.name])==null?void 0:F.label),3)):(t(),r("span",Eo,"--"))]))]}),_:2},1032,["label","prop","required"])),["model_ref"].indexOf(o.type)>>>-1?M("",!0):(t(),d(Ce,{key:10,label:o.verbose_name,prop:o.name,required:o.required},{label:l(()=>[a(Oe,{size:2},{default:l(()=>[a(Q,{tag:"b"},{default:l(()=>[p(V(o.verbose_name),1)]),_:2},1024),o.description.length!=0?(t(),d(k,{key:0,content:o.description,placement:"right",effect:"dark"},{default:l(()=>[a(j,null,{default:l(()=>[a(h(De))]),_:1})]),_:2},1032,["content"])):M("",!0)]),_:2},1024)]),default:l(()=>[W.value?(t(),d(Vl,{key:1,modelValue:v[o.name],"onUpdate:modelValue":F=>v[o.name]=F,clearable:"",placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(le,null,ce(kl.value[o.name],(F,ze)=>(t(),d(xl,{key:ze,label:F.label,value:F.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),r("div",Ao,[v[o.name]!=null?(t(),r("span",{key:0,class:Ie(["text_class",{requiredClass:o.required}])},V(Te.value[o.name].instance_name),3)):(t(),r("span",Ro,"--"))]))]),_:2},1032,["label","prop","required"]))]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1}),Ee.value?M("",!0):(t(),d(jl,{key:0,label:"监控信息",name:"monitor",disabled:""},{default:l(()=>e[51]||(e[51]=[p("111")])),_:1})),Ee.value?M("",!0):(t(),d(jl,{key:1,label:"关联关系",name:"relations",disabled:""},{default:l(()=>e[52]||(e[52]=[p("222")])),_:1})),Ee.value?M("",!0):(t(),d(jl,{key:2,label:"变更记录",name:"changelog",disabled:""},{default:l(()=>e[53]||(e[53]=[p("Role")])),_:1}))]),_:1},8,["modelValue"])]),footer:l(()=>{var n,z,o,f;return[Y($("div",zo,[a(u,{onClick:e[18]||(e[18]=F=>Ka(tl.value))},{default:l(()=>e[54]||(e[54]=[p("取消")])),_:1}),Ee.value?(t(),r("div",Lo,[a(u,{type:"primary",onClick:e[19]||(e[19]=F=>ia(tl.value))},{default:l(()=>e[55]||(e[55]=[p("添加")])),_:1})])):(t(),r("div",Yo,[W.value?(t(),r("div",Bo,[qa((n=Te.value)==null?void 0:n.instance_group)?Y((t(),d(u,{key:0,type:"danger",onClick:ca},{default:l(()=>e[56]||(e[56]=[p("删除")])),_:1})),[[be,`${(z=h(y).name)==null?void 0:z.replace("_info","")}:delete`]]):Y((t(),d(k,{key:1,content:"无法删除非空闲池的主机",placement:"top",effect:"dark"},{default:l(()=>[a(u,{type:"danger",onClick:ca,disabled:""},{default:l(()=>e[57]||(e[57]=[p("删除")])),_:1})]),_:1})),[[be,`${(o=h(y).name)==null?void 0:o.replace("_info","")}:delete`]]),Y((t(),d(u,{type:"primary",onClick:e[20]||(e[20]=F=>ia(tl.value))},{default:l(()=>e[58]||(e[58]=[p("保存")])),_:1})),[[ya]])])):(t(),r("div",Jo,[Y((t(),d(u,{type:"primary",onClick:e[21]||(e[21]=F=>W.value=!0)},{default:l(()=>e[59]||(e[59]=[p("编辑")])),_:1})),[[be,`${(f=h(y).name)==null?void 0:f.replace("_info","")}:edit`]])]))]))],512),[[Tl,Pl.value==="modelField"]])]}),_:1},8,["modelValue"]),a(_a,{modelValue:al.value,"onUpdate:modelValue":e[24]||(e[24]=n=>al.value=n),title:"批量更新",width:"500","before-close":yl},{footer:l(()=>[$("div",on,[a(u,{onClick:yl},{default:l(()=>e[60]||(e[60]=[p("取消")])),_:1}),a(u,{onClick:e[23]||(e[23]=Ml(n=>_l(),["prevent"]))},{default:l(()=>e[61]||(e[61]=[p("新增字段")])),_:1}),Y((t(),d(u,{type:"primary",onClick:Dl,disabled:!(Se.value.length>0)},{default:l(()=>e[62]||(e[62]=[p("保存")])),_:1},8,["disabled"])),[[ya]])])]),default:l(()=>[a(Wl,{ref_key:"multipleFormRef",ref:ll,style:{"max-width":"1000px"},model:P,"label-width":"auto"},{default:l(()=>[(t(!0),r(le,null,ce(Se.value,(n,z)=>{var o;return t(),d(Ce,{key:`param-${n}`,label:"字段"+(z+1),prop:`updateParams.${n}`,rules:Rl((o=ge.value[n])==null?void 0:o.validation_rule),required:!0},{default:l(()=>[a(Oe,null,{default:l(()=>[a(Vl,{"model-value":n.startsWith("__temp")?void 0:n,placeholder:"选择字段",style:{width:"120px"},filterable:"",onChange:f=>zl(z,f)},{default:l(()=>[(t(!0),r(le,null,ce(Ue.value,f=>(t(),d(xl,{key:f.value,label:f.label,value:f.value,disabled:f.disable},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onChange"]),n&&!n.startsWith("__temp")?(t(),r("div",Ko,[["text","json"].indexOf(ge.value[n].type)>>>-1?["string"].indexOf(ge.value[n].type)>>>-1?["enum"].indexOf(ge.value[n].type)>>>-1?["model_ref"].indexOf(ge.value[n].type)>>>-1?["boolean"].indexOf(ge.value[n].type)>>>-1?["integer"].indexOf(ge.value[n].type)>>>-1?["float"].indexOf(ge.value[n].type)>>>-1?["date"].indexOf(ge.value[n].type)>>>-1?["datetime"].indexOf(ge.value[n].type)>>>-1?(t(),r("div",tn,[a(Re,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",an,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Ye(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(ql,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"datetime",placeholder:"Pick a Date",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD hh:mm:ss",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",ln,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Ye(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(ql,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"date",placeholder:"Pick a Date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",en,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Ye(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Hl,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,precision:2,step:.1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Zo,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Ye(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Re,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,step:1,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Xo,[a(Je,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Qo,[a(Vl,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,placeholder:"请选择",style:{width:"240px"},filterable:""},{default:l(()=>[(t(!0),r(le,null,ce(kl.value[n],(f,F)=>(t(),d(xl,{key:F,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Wo,[a(Vl,{modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,placeholder:"请选择",style:{width:"180px"}},{default:l(()=>[(t(!0),r(le,null,ce(Yl.value[ge.value[n].validation_rule],f=>(t(),d(xl,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(t(),r("div",Go,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Ye(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Re,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),r("div",Ho,[a(Je,{modelValue:R.value[n],"onUpdate:modelValue":f=>R.value[n]=f,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949","margin-right":"10px"},"inline-prompt":"","active-text":"置空","inactive-text":"非空",onChange:f=>Ye(R.value[n],n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),R.value[n]?M("",!0):(t(),d(Re,{key:0,modelValue:P.updateParams[n],"onUpdate:modelValue":f=>P.updateParams[n]=f,type:"textarea",autosize:"",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"]))]))])):M("",!0),a(u,{class:"mt-2",icon:h(wt),circle:"",onClick:Ml(f=>ke(z,n),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1032,["label","prop","rules"])}),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(_a,{modelValue:Xe.value,"onUpdate:modelValue":e[27]||(e[27]=n=>Xe.value=n),title:"实例组编辑",width:"500"},{footer:l(()=>[$("div",nn,[a(u,{onClick:e[26]||(e[26]=n=>Xe.value=!1)},{default:l(()=>e[63]||(e[63]=[p("取消")])),_:1}),a(u,{type:"primary",onClick:Ne},{default:l(()=>e[64]||(e[64]=[p(" 提交更新 ")])),_:1})])]),default:l(()=>[a(ut,{options:C.treeData,props:dl,clearable:"",modelValue:w.value,"onUpdate:modelValue":e[25]||(e[25]=n=>w.value=n),style:{width:"400px"}},null,8,["options","modelValue"])]),_:1},8,["modelValue"]),ne.value?(t(),d(Ut,{key:1,isShowUpload:We.value,"onUpdate:isShowUpload":e[28]||(e[28]=n=>We.value=n),ciModelId:C.ciModelId,currentNodeId:C.currentNodeId,onGetCiData:Me},null,8,["isShowUpload","ciModelId","currentNodeId"])):M("",!0),ne.value?(t(),d(so,{key:2,ciModelId:C.ciModelId,currentNodeId:C.currentNodeId,allModelFieldByNameObj:ge.value,enumOptionObj:Yl.value,validationRulesObj:je.value,allModelField:hl.value,modelRefOptions:kl.value,showFilter:pe.value,"onUpdate:showFilter":e[29]||(e[29]=n=>pe.value=n),onUpdateFilterParam:na,onGetCiData:Me,ref_key:"ciDataFilterRef",ref:ve},null,8,["ciModelId","currentNodeId","allModelFieldByNameObj","enumOptionObj","validationRulesObj","allModelField","modelRefOptions","showFilter"])):M("",!0),a(Et,{ciModelId:C.ciModelId,allModelField:hl.value,allModelFieldInfo:Na.value,isShowTableCol:Ll.value,"onUpdate:isShowTableCol":e[30]||(e[30]=n=>Ll.value=n),hasConfigField:Il.value,"onUpdate:hasConfigField":e[31]||(e[31]=n=>Il.value=n),onReloadTable:aa,ref_key:"ciDataTableColRef",ref:la},null,8,["ciModelId","allModelField","allModelFieldInfo","isShowTableCol","hasConfigField"]),a(Rt,{showAllPassDia:ue.value,"onUpdate:showAllPassDia":e[32]||(e[32]=n=>ue.value=n)},null,8,["showAllPassDia"]),a(Lt,{qCodeContext:pa.value,showqCodeDia:Jl.value,"onUpdate:showqCodeDia":e[33]||(e[33]=n=>Jl.value=n)},null,8,["qCodeContext","showqCodeDia"])],64)}}}),un=Al(sn,[["__scopeId","data-v-404fee86"]]),dn={class:"card ci_data_tree"},rn={class:"custom-tree-node"},cn={class:"table-box"},pn=sl({__name:"cidataView",setup(ee){const me=Va(),{proxy:J}=fl(),O=i(!0),A=$t(),y=i(""),X=i(!1);i(""),i(!1);const ae=i(),C=i([]),te=i("");El(te,w=>{b.value.filter(w)});const I=(w,g)=>w?g.label.toLowerCase().includes(w.toLowerCase()):!0,pe=w=>!(w.level>Ol.value-1||w.label==="空闲池"),oe=async()=>{X.value=!0;let w=await J.$api.getCiModelTree({model:y.value});console.log(w),C.value=[w.data],Ve(()=>{m.value===1&&(b.value.setCurrentKey(w.data.id),m.value=b.value.getCurrentKey())}),X.value=!1},ne=T(()=>A.ciLastModel),se=i([]),ve=async()=>{let w=await J.$api.getCiModel();se.value=w.data.results,A.setModelList(se.value),ne.value===null?y.value=se.value.find(g=>g.name==="hosts").id:y.value=ne.value},G=i([]),ue=async()=>{let w=await J.$api.getCiModelGroup();G.value=w.data.results},E=T(()=>{let w=new Array;return G.value.forEach(g=>{let q=new Array;se.value.forEach(Ne=>{Ne.model_group===g.id&&q.push({value:Ne.id,label:Ne.verbose_name})}),w.push({value:g.id,label:g.verbose_name,children:q})}),w});T(()=>{let w={};return se.value.forEach(g=>{w[g.id]=g}),w});const D=i(""),Le=async()=>{A.setCiLastModel(y.value),m.value=1,await oe(),await D.value.closeFilter(),await D.value.updateFilterParam({}),await D.value.clearMultipleSelect(),D.value.reloadCiDataFilter(),await D.value.setLoading(!0),await D.value.getModelField(),await D.value.getHasConfigField(),await D.value.setLoading(!1),await D.value.initCiDataForm(),await D.value.getCiData({model:y.value,model_instance_group:m.value})};$a(async()=>{await ue(),await ve(),await oe(),D.value.setLoading(!0),await D.value.getModelField(),await D.value.getHasConfigField(),await D.value.setLoading(!1),await D.value.initCiDataForm(),await D.value.getCiData({model:y.value,model_instance_group:b.value.getCurrentKey()})});const B=w=>w.built_in?!1:w.children?!(w.children.length>>>0):!0,b=i(),_=i(),m=i(1),K=i(!1),de=i(100),we=(w,g)=>{L.value=!1;let q=de.value++;b.value.append({id:q,label:"新建子目录",level:g.level+1,parent:g.id,model:y.value},w),b.value.setCurrentKey(q),fe.value=q,Ve(()=>{_.value.focus()})},_e=(w,g)=>{let q=de.value++;L.value=!1,b.value.insertAfter({id:q,label:"新建目录",level:g.level,parent:w.parent.data.id,model:y.value},w),b.value.setCurrentKey(q),fe.value=q,Ve(()=>{_.value.focus()})},ye=()=>{m.value=b.value.getCurrentKey(),D.value.clearMultipleSelect(),D.value.setLoading(!0),D.value.getCiData({model:y.value,model_instance_group:b.value.getCurrentKey()}),D.value.setLoading(!0)},H=w=>{K.value=!K.value,w.isShowEdit=K.value},fe=i(99999),Z=i(""),L=i(!0),Ze=w=>{L.value=!0,console.log(w),Z.value=w.label,fe.value=w.id,Ve(()=>{_.value.focus()})},He=async(w,g)=>{if(fe.value=99999,!Z.value)N.warning("名称不可为空"),b.value.remove(g);else if(L.value){if(Z.value==g.label)return!1;{let q=await J.$api.updateCiModelTree({id:g.id,label:Z.value});q.status=="200"?(N({type:"success",message:"更新成功"}),g.label=Z.value,oe(),Z.value=""):N({showClose:!0,message:"更新失败:"+JSON.stringify(q.data),type:"error"}),console.log(g)}}else{g.label=Z.value,console.log(g);let q=await J.$api.addCiModelTree(g);q.status=="201"?(N({type:"success",message:"添加成功"}),oe(),Z.value=""):(N({showClose:!0,message:"添加失败:"+JSON.stringify(q.data),type:"error"}),b.value.remove(g))}},Ge=w=>{w&&Zl.confirm("确定删除该目录吗?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await J.$api.deleteCiModelTree(w.data.id)).status==200?(N({type:"success",message:"删除成功"}),await oe()):N({type:"error",message:"删除失败"})}).catch(()=>{})},U=i(""),Pe=(w,g)=>{U.value=w,console.log(U.value)},S=(w,g,q)=>{},We=(w,g,q)=>{},Qe=(w,g,q)=>{},ul=async(w,g,q,Ne)=>{if(g.data.id===w.data.id)return;let ll=await J.$api.updateCiModelTree({id:w.data.id,target_id:g.data.id,position:q});ll.status=="200"?(N({type:"success",message:"更新排序成功"}),oe()):N({showClose:!0,message:"更新排序失败:"+JSON.stringify(ll.data),type:"error"})},el=(w,g,q,Ne)=>{},Ol=i(5),dl=(w,g,q)=>g.data.built_in?!1:q!=="inner",Xe=w=>!w.data.built_in;return(w,g)=>{const q=c("el-text"),Ne=c("el-col"),ll=c("el-tree-select"),al=c("el-row"),R=c("el-divider"),Ye=c("el-input"),ml=c("a-menu-item"),Rl=c("a-menu"),P=c("a-dropdown"),Se=c("el-space"),_l=pl("permission"),zl=pl("loading");return t(),r(le,null,[Y($("div",dn,[a(al,{align:"middle",justify:"start"},{default:l(()=>[a(Ne,{span:8},{default:l(()=>[a(q,{tag:"b"},{default:l(()=>g[7]||(g[7]=[p("实例树")])),_:1})]),_:1}),a(Ne,{span:14},{default:l(()=>[a(ll,{modelValue:y.value,"onUpdate:modelValue":g[0]||(g[0]=ke=>y.value=ke),data:E.value,onChange:g[1]||(g[1]=ke=>Le()),"render-after-expand":!1,style:{display:"block",width:"100%",height:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1}),a(R),a(Ye,{modelValue:te.value,"onUpdate:modelValue":g[2]||(g[2]=ke=>te.value=ke),clearable:"",style:{"max-width":"280px","margin-bottom":"10px"},size:"small",placeholder:"检索节点"},null,8,["modelValue"]),Y((t(),d(h(xt),{style:{"max-width":"280px",height:"auto"},"allow-drop":dl,"allow-drag":Xe,data:C.value,draggable:!0,"default-expand-all":"","node-key":"id",onNodeDragStart:Pe,onNodeDragEnter:S,onNodeDragLeave:We,onNodeDragOver:Qe,onNodeDragEnd:ul,onNodeDrop:el,"highlight-current":!0,"current-node-key":m.value,"expand-on-click-node":!1,ref_key:"treeRef",ref:b,onNodeClick:ye,"filter-node-method":I},{default:l(({node:ke,data:$e})=>{var Dl;return[$("div",rn,[fe.value===$e.id?(t(),d(Ye,{key:0,modelValue:Z.value,"onUpdate:modelValue":g[3]||(g[3]=Ue=>Z.value=Ue),modelModifiers:{trim:!0},placeholder:"请输入",ref_key:"eInputRef",ref:_,onBlur:Ue=>He(Ue,$e),onKeyup:g[4]||(g[4]=kt(Ue=>Ue.target.blur(),["enter"])),autofocus:!0,maxlength:"6",type:"text",size:"small"},null,8,["modelValue","onBlur"])):(t(),d(q,{key:1,size:"default"},{default:l(()=>[p(V(ke.label),1),a(q,{size:"small"},{default:l(()=>[p("("+V($e.instance_count)+")",1)]),_:2},1024)]),_:2},1024)),Y((t(),r("div",{class:Ie(["actionClass",{is_show_action:ke.isShowEdit}])},[a(Se,null,{default:l(()=>[$e.built_in?M("",!0):(t(),d(h(ht),{key:0,onClick:Ml(Ue=>Ze($e),["stop"])},null,8,["onClick"])),a(P,{trigger:["click"],ref_key:"aDropdownRef",ref:ae,onOpenChange:Ue=>H(ke)},{overlay:l(()=>[a(Rl,null,{default:l(()=>{var Ue,yl;return[Y((t(),r("div",null,[$e.level!==1?(t(),d(ml,{key:"0",onClick:gl=>_e(ke,$e)},{default:l(()=>g[8]||(g[8]=[p(" 添加同级节点 ")])),_:2},1032,["onClick"])):M("",!0),pe($e)?(t(),d(ml,{key:"1",onClick:gl=>we(ke,$e)},{default:l(()=>g[9]||(g[9]=[p(" 添加子节点 ")])),_:2},1032,["onClick"])):M("",!0)])),[[_l,`${(Ue=h(me).name)==null?void 0:Ue.replace("_info","")}:add`]]),Y((t(),r("div",null,[B($e)?(t(),d(ml,{key:"2",onClick:gl=>Ge(ke)},{default:l(()=>g[10]||(g[10]=[p(" 删除节点 ")])),_:2},1032,["onClick"])):M("",!0)])),[[_l,`${(yl=h(me).name)==null?void 0:yl.replace("_info","")}:delete`]])]}),_:2},1024)]),default:l(()=>[a(h(Ct),{onClick:g[5]||(g[5]=Ml(()=>{},["stop"]))})]),_:2},1032,["onOpenChange"])]),_:2},1024)],2)),[[_l,`${(Dl=h(me).name)==null?void 0:Dl.replace("_info","")}:edit`]])])]}),_:1},8,["data","current-node-key"])),[[zl,X.value]])],512),[[Tl,O.value]]),$("div",cn,[a(un,{ciModelId:y.value,treeData:C.value,currentNodeId:m.value,ref_key:"ciDataShowRef",ref:D,onGetTree:oe,showTree:O.value,"onUpdate:showTree":g[6]||(g[6]=ke=>O.value=ke)},null,8,["ciModelId","treeData","currentNodeId","showTree"])])],64)}}}),gn=Al(pn,[["__scopeId","data-v-e3859931"]]);export{gn as default};
