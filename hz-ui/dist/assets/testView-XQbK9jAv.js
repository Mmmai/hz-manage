import{d as I,g as M,u as q,r as o,m as A,n as D,e as m,c as p,o as i,b as t,w as a,k as u,F as N,p as T,t as S,i as U,cv as x}from"./index-DD1IBG_Z.js";import{A as F}from"./ansi_up-SVqyao32.js";const H={class:"card"},R=["innerHTML"],P=I({__name:"testView",setup(j){const{proxy:z}=M();q();const g=o([]),b=o("sseTest"),v=o(null),r=o(null),E=()=>{r.value=new EventSource(v.value),r.value.onmessage=l=>{console.log(l),console.log(typeof l.data),console.log(l.data.status),g.value.push(JSON.parse(l.data)),JSON.parse(l.data).status==="SUCCESS"&&r.value.close()}},J=()=>{r.value.close()};A(()=>{});const k=o(null),L=async()=>{let l=await x.request({url:"/api/v1/test_celery/",method:"post"});k.value=l.data.task_id},w=o(null),O=async l=>{let e=await x.request({url:`/api/v1/check_task/${l}/`});w.value=e.data};D(()=>{r.value&&r.value.close(),n.value&&n.value.close()});const V=new F,_=o(""),n=o(null),c=o([]),W=()=>{c.value=[],n.value=new WebSocket("/ws/ansible/"),n.value.onmessage=l=>{const e=JSON.parse(l.data);e.type==="output"?(console.log(V.ansi_to_html(e.message+`\r
`)),c.value.push(V.ansi_to_html(e.message+`\r
`))):e.type==="complete"&&(console.log(e),c.value.push(`执行完成，返回码: ${e.returncode}`),n.value.close())},n.value.onopen=()=>{n.value.send(JSON.stringify({module_args:_.value,module_name:"shell",inventory:["192.168.163.160","192.168.163.162"],username:"root",password:"thinker"}))}},$=()=>{n.value.close()};return(l,e)=>{const C=m("el-input"),d=m("el-button"),f=m("el-tab-pane"),B=m("el-tabs");return i(),p("div",H,[t(B,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=s=>b.value=s),class:"demo-tabs"},{default:a(()=>[t(f,{label:"SSE测试",name:"sseTest"},{default:a(()=>[t(C,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),style:{width:"480px"},placeholder:"输入sse接口地址"},null,8,["modelValue"]),t(d,{onClick:E},{default:a(()=>[...e[4]||(e[4]=[u("开始",-1)])]),_:1}),t(d,{type:"danger",onClick:J},{default:a(()=>[...e[5]||(e[5]=[u("终止",-1)])]),_:1}),(i(!0),p(N,null,T(g.value,(s,y)=>(i(),p("p",{key:y},S(s),1))),128))]),_:1}),t(f,{label:"celery测试",name:"celery"},{default:a(()=>[t(d,{onClick:L},{default:a(()=>[...e[6]||(e[6]=[u("提交任务",-1)])]),_:1}),t(d,{type:"primary",onClick:e[1]||(e[1]=s=>O(k.value))},{default:a(()=>[...e[7]||(e[7]=[u("查看任务状态",-1)])]),_:1}),u(" "+S(`任务ID是：${k.value}`)+" ",1),U("div",null,S(w.value),1)]),_:1}),t(f,{label:"WebSocket测试",name:"weSocketTest"},{default:a(()=>[t(C,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),style:{width:"240px"}},null,8,["modelValue"]),t(d,{onClick:W},{default:a(()=>[...e[8]||(e[8]=[u("执行",-1)])]),_:1}),t(d,{type:"danger",onClick:$},{default:a(()=>[...e[9]||(e[9]=[u("终止",-1)])]),_:1}),(i(!0),p(N,null,T(c.value,(s,y)=>(i(),p("div",{key:y},[U("div",{innerHTML:s},null,8,R)]))),128))]),_:1})]),_:1},8,["modelValue"])])}}});export{P as default};
