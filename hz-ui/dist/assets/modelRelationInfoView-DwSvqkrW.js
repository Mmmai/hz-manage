import{_ as P,aJ as Z,bw as ee,r as f,bK as le,e as n,c as x,o as s,q as m,z as b,w as l,b as e,y as ae,c7 as te,k as y,t as oe,g as de,h as ue,f as ne,l as se,a as re,m as ie,F as G,p as H,i as k,aK as K,c3 as I}from"./index-DD1IBG_Z.js";import{m as me}from"./model-DLhakzJz.js";const ce={class:"attribute-schema-editor"},pe={key:2,style:{"margin-top":"20px"}},_e={__name:"AttributeSchemaEditor",props:Z({editable:{type:Boolean,default:!1},relation:{type:Boolean,default:!1}},{schema:{},schemaModifiers:{}}),emits:["update:schema"],setup(c,{expose:O}){const p=ee(c,"schema"),q=c,_=f([]),S=()=>{p.value!==void 0&&(_.value=Object.keys(p.value).map(o=>({key:o,value:{...p.value[o]}})))},U=()=>{const o={};return _.value.forEach(i=>{i.key&&(o[i.key]={...i.value})}),o},R=()=>{q.relation?_.value.push({key:"",value:{type:"string",required:!1,verbose_name:"",default:""}}):_.value.push({key:"",value:{type:"string",required:!1,verbose_name:""}})},C=o=>{_.value.splice(o,1)},M=o=>({string:"字符串"})[o]||o;return le(()=>p.value,(o,i)=>{S()},{deep:!0,immediate:!0}),O({updateSchema:()=>{p.value=U()}}),(o,i)=>{const d=n("el-input"),r=n("el-table-column"),N=n("el-option"),w=n("el-select"),$=n("el-checkbox"),h=n("el-button"),D=n("el-table"),B=n("el-tag");return s(),x("div",ce,[c.editable?(s(),m(D,{key:0,data:_.value,style:{width:"100%"}},{default:l(()=>[e(r,{label:"属性名",width:"150"},{default:l(t=>[e(d,{modelValue:t.row.key,"onUpdate:modelValue":a=>t.row.key=a,placeholder:"属性名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(r,{label:"类型",width:"120"},{default:l(t=>[e(w,{modelValue:t.row.value.type,"onUpdate:modelValue":a=>t.row.value.type=a,placeholder:"类型"},{default:l(()=>[e(N,{label:"字符串",value:"string"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(r,{label:"显示名称",width:"150"},{default:l(t=>[e(d,{modelValue:t.row.value.verbose_name,"onUpdate:modelValue":a=>t.row.value.verbose_name=a,placeholder:"显示名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),c.relation?(s(),m(r,{key:0,prop:"value.unit",label:"单位",width:"100"},{default:l(t=>[e(d,{modelValue:t.row.value.unit,"onUpdate:modelValue":a=>t.row.value.unit=a,placeholder:"单位"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):b("",!0),c.relation?(s(),m(r,{key:1,prop:"value.default",label:"默认值",width:"120"},{default:l(t=>[e(d,{modelValue:t.row.value.default,"onUpdate:modelValue":a=>t.row.value.default=a,placeholder:"单位"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):b("",!0),e(r,{label:"必填",width:"80"},{default:l(t=>[e($,{modelValue:t.row.value.required,"onUpdate:modelValue":a=>t.row.value.required=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(r,{label:"操作",width:"80"},{default:l(t=>[e(h,{type:"danger",icon:ae(te),link:"",onClick:a=>C(t.$index)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])):(s(),m(D,{key:1,data:_.value,style:{width:"100%"}},{default:l(()=>[e(r,{prop:"key",label:"属性名",width:"150"}),e(r,{label:"类型",width:"120"},{default:l(t=>[y(oe(M(t.row.value.type)),1)]),_:1}),e(r,{prop:"value.verbose_name",label:"显示名称",width:"150"}),c.relation?(s(),m(r,{key:0,prop:"value.unit",label:"单位",width:"100"})):b("",!0),c.relation?(s(),m(r,{key:1,prop:"value.default",label:"默认值",width:"120"})):b("",!0),e(r,{label:"必填",width:"80"},{default:l(t=>[t.row.value.required?(s(),m(B,{key:0,type:"success"},{default:l(()=>[...i[0]||(i[0]=[y("是",-1)])]),_:1})):(s(),m(B,{key:1},{default:l(()=>[...i[1]||(i[1]=[y("否",-1)])]),_:1}))]),_:1})]),_:1},8,["data"])),c.editable?(s(),x("div",pe,[e(h,{type:"primary",onClick:R},{default:l(()=>[...i[2]||(i[2]=[y("添加属性",-1)])]),_:1})])):b("",!0)])}}},L=P(_e,[["__scopeId","data-v-345bbbd5"]]),fe={class:"relation-type-view"},be={class:"card-header"},ve={__name:"modelRelationInfoView",setup(c){const O=me(),{proxy:p}=de(),q=ue(),_=ne(),S=se(()=>O.modelOptions),U=()=>{_.push({path:"/cmdb/cimodelManage/modelRelation"})},R=f(null),C=f(null),M=f(null),E=f(null),o=f(!1),i=f({}),d=re({name:"",topology_type:"directed",forward_verb:"",reverse_verb:"",attribute_schema:{source:{},target:{},relation:{}},description:null,source_model:"",target_model:""}),r=()=>{C.value.updateSchema(),M.value.updateSchema(),E.value.updateSchema(),K(()=>{$.value?B():D()})},N=()=>{o.value=!1,Object.assign(d,i.value)},w=f(""),$=f(!1),h=async()=>{const t=await p.$api.getModelRelationDefineInfo(w.value);t.status===200&&Object.assign(d,t.data)},D=async()=>{const t=await p.$api.updateModelRelationDefine({id:w.value,...d});t.status==200?(I({type:"success",message:"更新成功"}),o.value=!1,K(()=>{h()})):I({type:"error",message:`更新失败:  ${JSON.stringify(t.data)}`})},B=async()=>{const t=await p.$api.addModelRelationDefine(d);t.status==201?(I.success("添加成功"),o.value=!1,R.value.resetFields(),K(()=>{U()})):I({type:"error",message:`添加失败: ${JSON.stringify(t.data)}`})};return ie(()=>{w.value=q.path.split("/").at(-1),w.value.includes("new")?($.value=!0,o.value=!0):h()}),(t,a)=>{const Q=n("el-page-header"),T=n("el-button"),W=n("el-tooltip"),A=n("el-input"),v=n("el-form-item"),g=n("el-col"),V=n("el-option"),j=n("el-select"),F=n("el-row"),X=n("el-form"),z=n("el-card"),J=n("el-tab-pane"),Y=n("el-tabs");return s(),x("div",fe,[e(z,{class:"relation-card"},{header:l(()=>[k("div",be,[e(Q,{onBack:U},{content:l(()=>[...a[11]||(a[11]=[k("span",null,"关系类型详情",-1)])]),_:1}),k("div",null,[e(W,{content:d.built_in?"内置关联关系,无法编辑!":"编辑关联关系",placement:"top"},{default:l(()=>[o.value?b("",!0):(s(),m(T,{key:0,type:"primary",onClick:a[0]||(a[0]=u=>o.value=!0),disabled:d.built_in},{default:l(()=>[...a[12]||(a[12]=[y("编辑",-1)])]),_:1},8,["disabled"]))]),_:1},8,["content"]),o.value?(s(),m(T,{key:0,type:"success",onClick:r},{default:l(()=>[...a[13]||(a[13]=[y("保存",-1)])]),_:1})):b("",!0),o.value?(s(),m(T,{key:1,onClick:N},{default:l(()=>[...a[14]||(a[14]=[y("取消",-1)])]),_:1})):b("",!0)])])]),default:l(()=>[e(X,{model:d,"label-width":"120px",disabled:!o.value,ref_key:"formRef",ref:R},{default:l(()=>[e(F,{gutter:20},{default:l(()=>[e(g,{span:6},{default:l(()=>[e(v,{label:"名称"},{default:l(()=>[e(A,{modelValue:d.name,"onUpdate:modelValue":a[1]||(a[1]=u=>d.name=u),disabled:!o.value,style:{"max-width":"300px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(g,{span:6},{default:l(()=>[e(v,{label:"拓扑关系"},{default:l(()=>[e(j,{modelValue:d.topology_type,"onUpdate:modelValue":a[2]||(a[2]=u=>d.topology_type=u),disabled:!o.value,style:{"max-width":"300px"}},{default:l(()=>[e(V,{label:"有向",value:"directed"}),e(V,{label:"无向",value:"undirected"}),e(V,{label:"有向无环",value:"daggered"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(F,{gutter:20},{default:l(()=>[e(g,{span:6},{default:l(()=>[e(v,{label:"源模型"},{default:l(()=>[e(j,{modelValue:d.source_model,"onUpdate:modelValue":a[3]||(a[3]=u=>d.source_model=u),disabled:!o.value,clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,style:{"max-width":"300px"}},{default:l(()=>[(s(!0),x(G,null,H(S.value,u=>(s(),m(V,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(g,{span:6},{default:l(()=>[e(v,{label:"目标模型"},{default:l(()=>[e(j,{modelValue:d.target_model,"onUpdate:modelValue":a[4]||(a[4]=u=>d.target_model=u),disabled:!o.value,clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,style:{"max-width":"300px"}},{default:l(()=>[(s(!0),x(G,null,H(S.value,u=>(s(),m(V,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(F,{gutter:20},{default:l(()=>[e(g,{span:6},{default:l(()=>[e(v,{label:"正向动词"},{default:l(()=>[e(A,{modelValue:d.forward_verb,"onUpdate:modelValue":a[5]||(a[5]=u=>d.forward_verb=u),disabled:!o.value,style:{"max-width":"300px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(g,{span:6},{default:l(()=>[e(v,{label:"反向动词"},{default:l(()=>[e(A,{modelValue:d.reverse_verb,"onUpdate:modelValue":a[6]||(a[6]=u=>d.reverse_verb=u),disabled:!o.value,style:{"max-width":"300px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(v,{label:"描述"},{default:l(()=>[e(A,{modelValue:d.description,"onUpdate:modelValue":a[7]||(a[7]=u=>d.description=u),type:"textarea",disabled:!o.value,style:{"max-width":"1000px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","disabled"])]),_:1}),e(z,{class:"attribute-card"},{header:l(()=>[...a[15]||(a[15]=[k("div",{class:"card-header"},[k("span",null,"属性模式")],-1)])]),default:l(()=>[e(Y,{type:"card"},{default:l(()=>[e(J,{label:"源属性"},{default:l(()=>[e(L,{ref_key:"sourceSchemaRef",ref:C,schema:d.attribute_schema.source,"onUpdate:schema":a[8]||(a[8]=u=>d.attribute_schema.source=u),editable:o.value},null,8,["schema","editable"])]),_:1}),e(J,{label:"目标属性"},{default:l(()=>[e(L,{ref_key:"targetSchemaRef",ref:M,schema:d.attribute_schema.target,"onUpdate:schema":a[9]||(a[9]=u=>d.attribute_schema.target=u),editable:o.value},null,8,["schema","editable"])]),_:1}),e(J,{label:"关系属性"},{default:l(()=>[e(L,{schema:d.attribute_schema.relation,ref_key:"relationSchemaRef",ref:E,"onUpdate:schema":a[10]||(a[10]=u=>d.attribute_schema.relation=u),editable:o.value,relation:!0},null,8,["schema","editable"])]),_:1})]),_:1})]),_:1})])}}},ge=P(ve,[["__scopeId","data-v-5c8cf3f6"]]);export{ge as default};
