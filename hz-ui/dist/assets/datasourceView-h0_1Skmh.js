import{d as z,r as b,bu as Z,e as i,o as u,O as v,w as s,g as o,f as A,P as B,k as $,b as q,bc as X,c as ee,aN as oe,b3 as se,h as x,j as f,bO as te,bo as le,F as J,b1 as ae,t as ne,b4 as re,bV as I,c4 as g,_ as ue}from"./index-_vkwOwvB.js";const ie="data:image/png;base64,UklGRvwAAABXRUJQVlA4WAoAAAAQAAAAFwAAJQAAQUxQSHAAAAABb2CQbeTkjWCH8AaH8BERuT4yZAg3tW070SVooKKlwsTXgAR6JCABBVgAATmVk3O+buDWU0b0fwKAqCLJPABguNw5wGuFKQxF96KEDyX5KOVP6fg3/Cn7j1I+lGRWfKO4eK1lgPkt7V0A8YYkCw8AVlA4IGYAAAAQBACdASoYACYAPpE8mUelo6KhMAgAsBIJaQAAW+s2662i0nJdBG5PEAD++6IltdJt8QJkhngfTRlkqka+RVwFB0J3GZNNKzD60Ml88hxJHH7f1wYMZXqW/yVcAhDP7mmnPsGgAAA=",de="/assets/loki_source-27HzMRux.svg",ce="/assets/welcome-VFYC1WKN.png",me="/assets/zabbix_source-CG7-J5m_.svg",_e={key:0},K=z({__name:"lokiSource",props:{formData:{},formDataModifiers:{}},emits:["update:formData"],setup(R,{expose:_}){const C=b("right"),l=Z(R,"formData"),{proxy:c}=$();return _({resetForm:()=>{c.$refs.formRef.resetFields(),console.log("test"),console.log(l)}}),(y,a)=>{const w=i("el-input"),m=i("el-form-item"),r=i("el-switch"),p=i("el-form");return u(),v(p,{"label-position":C.value,model:l.value,"label-width":"auto",style:{"max-width":"400px"},ref:"formRef"},{default:s(()=>[o(m,{label:"数据源名称",rules:[{required:!0}]},{default:s(()=>[o(w,{modelValue:l.value.source_name,"onUpdate:modelValue":a[0]||(a[0]=n=>l.value.source_name=n)},null,8,["modelValue"])]),_:1}),o(m,{label:"URL"},{default:s(()=>[o(w,{modelValue:l.value.url,"onUpdate:modelValue":a[1]||(a[1]=n=>l.value.url=n)},null,8,["modelValue"])]),_:1}),o(m,{label:"认证"},{default:s(()=>[o(r,{modelValue:l.value.isAuth,"onUpdate:modelValue":a[2]||(a[2]=n=>l.value.isAuth=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),l.value.isAuth?(u(),A("div",_e,[o(m,{label:"用户名"},{default:s(()=>[o(w,{modelValue:l.value.username,"onUpdate:modelValue":a[3]||(a[3]=n=>l.value.username=n)},null,8,["modelValue"])]),_:1}),o(m,{label:"密码"},{default:s(()=>[o(w,{modelValue:l.value.password,"onUpdate:modelValue":a[4]||(a[4]=n=>l.value.password=n),type:"password"},null,8,["modelValue"])]),_:1})])):B("",!0),o(m,{label:"默认"},{default:s(()=>[o(r,{modelValue:l.value.isDefault,"onUpdate:modelValue":a[5]||(a[5]=n=>l.value.isDefault=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),o(m,{label:"是否启用"},{default:s(()=>[o(r,{modelValue:l.value.isUsed,"onUpdate:modelValue":a[6]||(a[6]=n=>l.value.isUsed=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1})]),_:1},8,["label-position","model"])}}}),L=z({__name:"zabbixSource",setup(R){return b(!1),(_,C)=>(u(),A("div",null,"zabbix"))}}),pe={class:"card"},fe={class:"context-body"},ge={class:"el-card-context"},ve={style:{display:"flex","justify-content":"space-between","align-content":"center"}},be=["src"],Ae=["src"],ye={style:{margin:"10px 0px 0px 10px"}},we={class:"dialog-footer"},xe=z({__name:"datasourceView",setup(R){const{proxy:_}=$(),C=q(),l=e=>new URL(Object.assign({"/src/assets/images/lashen.png":ie,"/src/assets/images/loki_source.svg":de,"/src/assets/images/welcome.png":ce,"/src/assets/images/zabbix_source.svg":me})[`/src/assets/images/${e}`],import.meta.url).href,c=b(!1),V=b(!1),y=X(""),a=()=>{Object.keys(r).forEach(e=>{r[e]=m[e]})},w=e=>{I.confirm("是否关闭?").then(()=>{a(),console.log(r),e()}).catch(()=>{})},m={source_name:"",source_type:"",url:"",isAuth:!1,isDefault:!1,isUsed:!0,username:"",password:""},r=ee({source_name:"",source_type:"",url:"",isAuth:!1,isDefault:!1,isUsed:!0,username:"",password:""}),p=b("Loki"),n=e=>{e=="loki"?(y.value=K,r.source_type="loki",p.value="Loki"):e=="zabbix"&&(y.value=L,r.source_type="zabbix",p.value="Zabbix"),c.value=!0,V.value=!0},N=async()=>{let e=await _.$api.dataSourceAdd(r);console.log(e),e.data.code=="200"?(g({type:"success",message:"添加成功"}),a(),c.value=!1,D()):g({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})},S=b([]),D=async()=>{let e=await _.$api.dataSourceGet();console.log(e),S.value=e.data.results},U=b(""),O=e=>{c.value=!0,V.value=!1,e.source_type=="loki"?(y.value=K,p.value="Loki"):e.source_type=="zabbix"&&(y.value=L,p.value="Zabbix"),U.value=e.id,console.log(U.value);let t=["id","update_time","create_time"];Object.keys(e).forEach(k=>{t.indexOf(k)===-1&&(r[k]=e[k])})},P=async()=>{let e=await _.$api.dataSourceUpdate({id:U.value,...r});console.log(e),e.status==200?(g({type:"success",message:"更新成功"}),a(),c.value=!1,D()):g({type:"error",message:"更新失败"}),a()},Q=e=>{I.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await _.$api.dataSourceDel(U.value)).status==204?(g({type:"success",message:"删除成功"}),a(),c.value=!1,D()):g({type:"error",message:"删除失败"})}).catch(()=>{g({type:"info",message:"Delete canceled"})})};return oe(async()=>{await D()}),(e,t)=>{const k=i("arrow-down"),E=i("el-icon"),h=i("el-button"),F=i("el-dropdown-item"),G=i("el-dropdown-menu"),M=i("el-dropdown"),T=i("el-divider"),W=i("el-card"),j=i("el-dialog"),Y=se("permission");return u(),A(J,null,[x("div",pe,[o(M,{style:{"margin-left":"15px","margin-right":"15px"},onCommand:n},{dropdown:s(()=>[o(G,null,{default:s(()=>[o(F,{command:"loki"},{default:s(()=>t[3]||(t[3]=[f("loki")])),_:1}),o(F,{command:"zabbix"},{default:s(()=>t[4]||(t[4]=[f("zabbix")])),_:1})]),_:1})]),default:s(()=>{var d;return[te((u(),v(h,{type:"primary"},{default:s(()=>[t[2]||(t[2]=f(" 添加")),o(E,{class:"el-icon--right"},{default:s(()=>[o(k)]),_:1})]),_:1})),[[Y,`${(d=le(C).name)==null?void 0:d.replace("_info","")}:add`]])]}),_:1}),o(T),x("div",fe,[(u(!0),A(J,null,ae(S.value,(d,H)=>(u(),A("div",{class:"el-card-div",key:H},[o(W,{style:{width:"250px"},shadow:"hover",onClick:Ve=>O(d)},{default:s(()=>[x("div",ge,[x("div",ve,[d.source_type=="loki"?(u(),A("img",{key:0,src:l("loki_source.svg"),alt:"Icon",style:{width:"30px",height:"30px"}},null,8,be)):d.source_type=="zabbix"?(u(),A("img",{key:1,src:l("zabbix_source.svg"),alt:"Icon",style:{width:"30px",height:"30px"}},null,8,Ae)):B("",!0),x("span",ye,ne(d.source_name),1)]),d.isDefault?(u(),v(h,{key:0,type:"success",size:"small",round:""},{default:s(()=>t[5]||(t[5]=[f("默认")])),_:1})):B("",!0)])]),_:2},1032,["onClick"])]))),128))])]),o(j,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=d=>c.value=d),title:p.value,width:"500","before-close":w},{footer:s(()=>[x("div",we,[V.value==!1?(u(),v(h,{key:0,type:"danger",onClick:Q},{default:s(()=>t[6]||(t[6]=[f("删除")])),_:1})):B("",!0),V.value==!1?(u(),v(h,{key:1,type:"primary",onClick:P},{default:s(()=>t[7]||(t[7]=[f("更新")])),_:1})):(u(),v(h,{key:2,type:"primary",onClick:N},{default:s(()=>t[8]||(t[8]=[f("添加")])),_:1}))])]),default:s(()=>[(u(),v(re(y.value),{formData:r,"onUpdate:formData":t[0]||(t[0]=d=>r=d),ref:"childRef"},null,40,["formData"]))]),_:1},8,["modelValue","title"])],64)}}}),he=ue(xe,[["__scopeId","data-v-343785f0"]]);export{he as default};
