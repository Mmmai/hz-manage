import{_ as Ue,b as De,c as P,r as n,aN as Fe,bI as Be,e as d,b3 as ae,o as u,f as z,h,bO as V,bo as b,O as v,w as s,j as y,g as t,F as U,b1 as D,Y as Ne,t as te,c0 as Oe,c1 as je,k as Je,bV as R,c4 as g,aD as Te}from"./index-CCI8Hn2n.js";const Ee={class:"card"},Ie={class:"user-header"},Le={class:"flexJstart gap-5"},Me={class:"flexJstart gap-5"},Pe={class:"demo-pagination-block"},Re={__name:"userView",setup(qe){const k=De(),{proxy:i}=Je(),F=P({search:""}),J=n(!1),q=n([]),se=n("auto"),oe=n([{prop:"username",label:"用户名称"},{prop:"real_name",label:"真实姓名"},{prop:"status",label:"状态"},{prop:"groups",label:"用户组列表"},{prop:"roles",label:"角色列表"}]),T=n(1),E=n(10),ne=n(!1),re=n(!1),ue=n(!1),G=n(0),p=P({page:T.value,size:E.value,search:"",ordering:"id"}),de=n(!1),C=n([]),ie=n({});Fe(()=>{pe(p),ce(),_(p)});const pe=async a=>{let e=await i.$api.getRole(a);C.value=e.data.results,console.log(C.value);for(let r in C.value){let $=C.value[r].role,c=C.value[r].id;ie.value[c]=$}},I=n([]),ce=async()=>{let a=await i.$api.getUserGroup();I.value=a.data.results,console.log(I.value)},_=async a=>{J.value=!0;let e=await i.$api.user(a);q.value=e.data.results,G.value=e.data.count,J.value=!1},me=a=>{console.log(`${a} items per page`),p.size=a,_(p)},fe=a=>{p.page=a,console.log(a),_(p)},w=n(!1),o=P({username:"",real_name:null,password:"",status:!0,role_ids:[],group_ids:[]}),B=n("add"),ge=()=>{B.value="add",w.value=!0},_e=()=>{w.value=!1,i.$refs.userFrom.resetFields()},ve=a=>{R.confirm("是否确认关闭?").then(()=>{a(),i.$refs.userFrom.resetFields()}).catch(()=>{})},be=()=>{i.$refs.userFrom.validate(async a=>{if(a)if(B.value=="add"){let e=await i.$api.useradd(o);console.log(e),e.status==201?(w.value=!1,i.$refs.userFrom.resetFields(),_(p)):g({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})}else{console.log(JSON.stringify(o));let e=await i.$api.userupdate({id:A.value.id,...o});console.log(e),e.status==200?(w.value=!1,i.$refs.userFrom.resetFields(),_(p)):(console.log(),g({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"}))}else g({showClose:!0,message:"请输入正确内容.",type:"error"});console.log(o)})},ye=async a=>{let e=await i.$api.userupdate({status:a.status,id:a.id});e.status==200?(g({type:"success",message:"更新成功"}),_(p)):g({showClose:!0,message:"更新失败:"+JSON.stringify(e.data),type:"error"})},A=n({}),we=a=>{B.value="edit",w.value=!0,A.value=a,Te(()=>{Object.keys(o).forEach(e=>{["group_ids"].includes(e)?o[e]=a.groups.map(r=>r.id):["role_ids"].includes(e)?o[e]=a.roles.map(r=>r.id):o[e]=a[e]})}),console.log(o)},he=a=>{R.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await i.$api.userdel(a.id)).status==204?g({type:"success",message:"删除成功"}):g({type:"error",message:"删除失败"}),_(p)}).catch(()=>{g({type:"info",message:"Delete canceled"})})},N=n([]),Ve=(a,e)=>a.username!="admin",ke=a=>{N.value=a},W=()=>{R.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{let a=[];for(let r in N.value)a.push(N.value[r].id);console.log(a),(await i.$api.usermuldel({pks:a})).status==204?g({type:"success",message:"删除成功"}):g({type:"error",message:"删除失败"}),_(p)}).catch(()=>{g({type:"info",message:"Delete canceled"})})},Ce=async()=>{p.search=F.search,_(p)},x=n(!1);return Be(()=>o.username,a=>{a=="admin"?x.value=!0:x.value=!1}),(a,e)=>{var Z,ee,le;const r=d("el-button"),$=d("el-input"),c=d("el-form-item"),Y=d("el-form"),L=d("el-table-column"),H=d("el-switch"),K=d("el-tag"),xe=d("el-table"),$e=d("el-pagination"),O=d("el-col"),M=d("el-row"),Q=d("el-option"),X=d("el-select"),Se=d("el-dialog"),S=ae("permission"),ze=ae("loading");return u(),z(U,null,[h("div",Ee,[h("div",Ie,[h("div",null,[V((u(),v(r,{type:"primary",size:"small",onClick:ge},{default:s(()=>e[10]||(e[10]=[y("新增")])),_:1})),[[S,`${(Z=b(k).name)==null?void 0:Z.replace("_info","")}:add`]]),N.value.length==0?V((u(),v(r,{key:0,disabled:"",type:"danger",size:"small",onClick:W},{default:s(()=>e[11]||(e[11]=[y("批量删除")])),_:1})),[[S,`${(ee=b(k).name)==null?void 0:ee.replace("_info","")}:delete`]]):V((u(),v(r,{key:1,type:"danger",size:"small",onClick:W},{default:s(()=>e[12]||(e[12]=[y("批量删除")])),_:1})),[[S,`${(le=b(k).name)==null?void 0:le.replace("_info","")}:delete`]])]),t(Y,{inline:!0,model:F,size:"small",class:"demo-form-inline"},{default:s(()=>[t(c,{label:"用户名检索"},{default:s(()=>[t($,{modelValue:F.search,"onUpdate:modelValue":e[0]||(e[0]=l=>F.search=l),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),t(c,null,{default:s(()=>[t(r,{type:"primary",size:"small",onClick:Ce},{default:s(()=>e[13]||(e[13]=[y("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),h("div",null,[V((u(),v(xe,{border:"",data:q.value,style:{width:"100%"},"max-height":"500px","table-layout":se.value,onSelectionChange:ke},{default:s(()=>[t(L,{type:"selection",width:"50",selectable:Ve}),(u(!0),z(U,null,D(oe.value,l=>(u(),v(L,{key:l.prop,label:l.label,prop:l.prop},Ne({_:2},[l.prop==="status"?{name:"default",fn:s(m=>{var f;return[V(t(H,{modelValue:m.row.status,"onUpdate:modelValue":j=>m.row.status=j,disabled:m.row.username=="admin",class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:j=>ye(m.row)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),[[S,{id:`${(f=b(k).name)==null?void 0:f.replace("_info","")}:edit`,action:"disabled"}]])]}),key:"0"}:void 0,l.prop==="groups"?{name:"default",fn:s(m=>[h("div",Le,[(u(!0),z(U,null,D(m.row.groups,f=>(u(),v(K,{key:f},{default:s(()=>[y(te(f.group_name),1)]),_:2},1024))),128))])]),key:"1"}:void 0,l.prop==="roles"?{name:"default",fn:s(m=>[h("div",Me,[(u(!0),z(U,null,D(m.row.roles,f=>(u(),v(K,{key:f},{default:s(()=>[y(te(f.role),1)]),_:2},1024))),128))])]),key:"2"}:void 0]),1032,["label","prop"]))),128)),t(L,{fixed:"right",label:"操作",width:"150"},{default:s(l=>{var m,f;return[V(t(r,{link:"",type:"primary",icon:b(Oe),disabled:l.row.username=="admin",onClick:j=>we(l.row)},null,8,["icon","disabled","onClick"]),[[S,`${(m=b(k).name)==null?void 0:m.replace("_info","")}:edit`]]),V(t(r,{disabled:l.row.username=="admin",link:"",type:"danger",icon:b(je),onClick:j=>he(l.row)},null,8,["disabled","icon","onClick"]),[[S,`${(f=b(k).name)==null?void 0:f.replace("_info","")}:delete`]])]}),_:1})]),_:1},8,["data","table-layout"])),[[ze,J.value]])]),h("div",Pe,[t($e,{"current-page":T.value,"onUpdate:currentPage":e[1]||(e[1]=l=>T.value=l),"page-size":E.value,"onUpdate:pageSize":e[2]||(e[2]=l=>E.value=l),"page-sizes":[10,20,30,40],small:ne.value,disabled:ue.value,background:re.value,layout:"total, sizes, prev, pager, next, jumper",total:G.value,"hide-on-single-page":de.value,onSizeChange:me,onCurrentChange:fe},null,8,["current-page","page-size","small","disabled","background","total","hide-on-single-page"])])]),t(Se,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=l=>w.value=l),title:B.value=="add"?"新增用户":"编辑用户",width:"40%","before-close":ve},{default:s(()=>[t(Y,{inline:!0,model:o,class:"demo-form-inline",ref:"userFrom","status-icon":""},{default:s(()=>[t(M,null,{default:s(()=>[t(O,{span:12},{default:s(()=>[t(c,{label:"用户名称",prop:"username",rules:[{required:!0}]},{default:s(()=>[t($,{modelValue:o.username,"onUpdate:modelValue":e[3]||(e[3]=l=>o.username=l),placeholder:"",clearable:"",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),t(O,{span:12},{default:s(()=>[t(c,{label:"真实名称",prop:"real_name"},{default:s(()=>[t($,{modelValue:o.real_name,"onUpdate:modelValue":e[4]||(e[4]=l=>o.real_name=l),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(O,{span:12},{default:s(()=>[t(c,{label:"用户组",prop:"group_ids",required:""},{default:s(()=>[t(X,{modelValue:o.group_ids,"onUpdate:modelValue":e[5]||(e[5]=l=>o.group_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:x.value,style:{width:"220px"}},{default:s(()=>[(u(!0),z(U,null,D(I.value,l=>(u(),v(Q,{key:l.id,label:l.group_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),t(O,{span:12},{default:s(()=>[t(c,{label:"角色",prop:"role_ids"},{default:s(()=>[t(X,{modelValue:o.role_ids,"onUpdate:modelValue":e[6]||(e[6]=l=>o.role_ids=l),placeholder:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:x.value,style:{width:"220px"}},{default:s(()=>[(u(!0),z(U,null,D(C.value,l=>(u(),v(Q,{key:l.id,label:l.role,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(c,{label:"Password",prop:"password",required:""},{default:s(()=>[t($,{modelValue:o.password,"onUpdate:modelValue":e[7]||(e[7]=l=>o.password=l),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(c,{label:"状态",prop:"status"},{default:s(()=>[t(H,{modelValue:o.status,"onUpdate:modelValue":e[8]||(e[8]=l=>o.status=l),class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"Y","inactive-text":"N",disabled:x.value},null,8,["modelValue","disabled"])]),_:1}),t(M,{style:{"justify-content":"flex-end"}},{default:s(()=>[t(c,null,{default:s(()=>[t(r,{onClick:_e},{default:s(()=>e[14]||(e[14]=[y("取消")])),_:1}),t(r,{type:"primary",onClick:be},{default:s(()=>e[15]||(e[15]=[y(" 确定")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}},Ae=Ue(Re,[["__scopeId","data-v-735a5cb3"]]);export{Ae as default};
