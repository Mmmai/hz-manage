import{d as z,r as b,bu as Z,e as i,o as u,O as g,w as t,g as o,f as A,P as B,k as K,b as q,bc as X,c as ee,aN as oe,b3 as te,h as x,j as f,bO as le,bo as se,F,b1 as ae,t as ne,b4 as re,bV as I,c1 as v,_ as ue}from"./index-CRk9gF9P.js";const ie="data:image/png;base64,UklGRvwAAABXRUJQVlA4WAoAAAAQAAAAFwAAJQAAQUxQSHAAAAABb2CQbeTkjWCH8AaH8BERuT4yZAg3tW070SVooKKlwsTXgAR6JCABBVgAATmVk3O+buDWU0b0fwKAqCLJPABguNw5wGuFKQxF96KEDyX5KOVP6fg3/Cn7j1I+lGRWfKO4eK1lgPkt7V0A8YYkCw8AVlA4IGYAAAAQBACdASoYACYAPpE8mUelo6KhMAgAsBIJaQAAW+s2662i0nJdBG5PEAD++6IltdJt8QJkhngfTRlkqka+RVwFB0J3GZNNKzD60Ml88hxJHH7f1wYMZXqW/yVcAhDP7mmnPsGgAAA=",de="/assets/loki_source-27HzMRux.svg",ce="/assets/zabbix_source-CG7-J5m_.svg",me={key:0},L=z({__name:"lokiSource",props:{formData:{},formDataModifiers:{}},emits:["update:formData"],setup(R,{expose:p}){const C=b("right"),s=Z(R,"formData"),{proxy:c}=K();return p({resetForm:()=>{c.$refs.formRef.resetFields(),console.log("test"),console.log(s)}}),(y,a)=>{const w=i("el-input"),m=i("el-form-item"),r=i("el-switch"),_=i("el-form");return u(),g(_,{"label-position":C.value,model:s.value,"label-width":"auto",style:{"max-width":"400px"},ref:"formRef"},{default:t(()=>[o(m,{label:"数据源名称",rules:[{required:!0}]},{default:t(()=>[o(w,{modelValue:s.value.source_name,"onUpdate:modelValue":a[0]||(a[0]=n=>s.value.source_name=n)},null,8,["modelValue"])]),_:1}),o(m,{label:"URL"},{default:t(()=>[o(w,{modelValue:s.value.url,"onUpdate:modelValue":a[1]||(a[1]=n=>s.value.url=n)},null,8,["modelValue"])]),_:1}),o(m,{label:"认证"},{default:t(()=>[o(r,{modelValue:s.value.isAuth,"onUpdate:modelValue":a[2]||(a[2]=n=>s.value.isAuth=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),s.value.isAuth?(u(),A("div",me,[o(m,{label:"用户名"},{default:t(()=>[o(w,{modelValue:s.value.username,"onUpdate:modelValue":a[3]||(a[3]=n=>s.value.username=n)},null,8,["modelValue"])]),_:1}),o(m,{label:"密码"},{default:t(()=>[o(w,{modelValue:s.value.password,"onUpdate:modelValue":a[4]||(a[4]=n=>s.value.password=n),type:"password"},null,8,["modelValue"])]),_:1})])):B("",!0),o(m,{label:"默认"},{default:t(()=>[o(r,{modelValue:s.value.isDefault,"onUpdate:modelValue":a[5]||(a[5]=n=>s.value.isDefault=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),o(m,{label:"是否启用"},{default:t(()=>[o(r,{modelValue:s.value.isUsed,"onUpdate:modelValue":a[6]||(a[6]=n=>s.value.isUsed=n),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1})]),_:1},8,["label-position","model"])}}}),$=z({__name:"zabbixSource",setup(R){return b(!1),(p,C)=>(u(),A("div",null,"zabbix"))}}),pe={class:"card"},_e={class:"context-body"},fe={class:"el-card-context"},ve={style:{display:"flex","justify-content":"space-between","align-content":"center"}},ge=["src"],be=["src"],Ae={style:{margin:"10px 0px 0px 10px"}},ye={class:"dialog-footer"},we=z({__name:"datasourceView",setup(R){const{proxy:p}=K(),C=q(),s=e=>new URL(Object.assign({"/src/assets/images/lashen.png":ie,"/src/assets/images/loki_source.svg":de,"/src/assets/images/zabbix_source.svg":ce})[`/src/assets/images/${e}`],import.meta.url).href,c=b(!1),V=b(!1),y=X(""),a=()=>{Object.keys(r).forEach(e=>{r[e]=m[e]})},w=e=>{I.confirm("是否关闭?").then(()=>{a(),console.log(r),e()}).catch(()=>{})},m={source_name:"",source_type:"",url:"",isAuth:!1,isDefault:!1,isUsed:!0,username:"",password:""},r=ee({source_name:"",source_type:"",url:"",isAuth:!1,isDefault:!1,isUsed:!0,username:"",password:""}),_=b("Loki"),n=e=>{e=="loki"?(y.value=L,r.source_type="loki",_.value="Loki"):e=="zabbix"&&(y.value=$,r.source_type="zabbix",_.value="Zabbix"),c.value=!0,V.value=!0},O=async()=>{let e=await p.$api.dataSourceAdd(r);console.log(e),e.data.code=="200"?(v({type:"success",message:"添加成功"}),a(),c.value=!1,D()):v({showClose:!0,message:"添加失败:"+JSON.stringify(e.data),type:"error"})},S=b([]),D=async()=>{let e=await p.$api.dataSourceGet();console.log(e),S.value=e.data.results},U=b(""),P=e=>{c.value=!0,V.value=!1,e.source_type=="loki"?(y.value=L,_.value="Loki"):e.source_type=="zabbix"&&(y.value=$,_.value="Zabbix"),U.value=e.id,console.log(U.value);let l=["id","update_time","create_time"];Object.keys(e).forEach(k=>{l.indexOf(k)===-1&&(r[k]=e[k])})},Q=async()=>{let e=await p.$api.dataSourceUpdate({id:U.value,...r});console.log(e),e.status==200?(v({type:"success",message:"更新成功"}),a(),c.value=!1,D()):v({type:"error",message:"更新失败"}),a()},E=e=>{I.confirm("是否确认删除?","Warning",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",draggable:!0}).then(async()=>{(await p.$api.dataSourceDel(U.value)).status==204?(v({type:"success",message:"删除成功"}),a(),c.value=!1,D()):v({type:"error",message:"删除失败"})}).catch(()=>{v({type:"info",message:"Delete canceled"})})};return oe(async()=>{await D()}),(e,l)=>{const k=i("arrow-down"),G=i("el-icon"),h=i("el-button"),J=i("el-dropdown-item"),M=i("el-dropdown-menu"),N=i("el-dropdown"),T=i("el-divider"),W=i("el-card"),j=i("el-dialog"),H=te("permission");return u(),A(F,null,[x("div",pe,[o(N,{style:{"margin-left":"15px","margin-right":"15px"},onCommand:n},{dropdown:t(()=>[o(M,null,{default:t(()=>[o(J,{command:"loki"},{default:t(()=>l[3]||(l[3]=[f("loki")])),_:1}),o(J,{command:"zabbix"},{default:t(()=>l[4]||(l[4]=[f("zabbix")])),_:1})]),_:1})]),default:t(()=>{var d;return[le((u(),g(h,{type:"primary"},{default:t(()=>[l[2]||(l[2]=f(" 添加")),o(G,{class:"el-icon--right"},{default:t(()=>[o(k)]),_:1})]),_:1})),[[H,`${(d=se(C).name)==null?void 0:d.replace("_info","")}:add`]])]}),_:1}),o(T),x("div",_e,[(u(!0),A(F,null,ae(S.value,(d,Y)=>(u(),A("div",{class:"el-card-div",key:Y},[o(W,{style:{width:"250px"},shadow:"hover",onClick:xe=>P(d)},{default:t(()=>[x("div",fe,[x("div",ve,[d.source_type=="loki"?(u(),A("img",{key:0,src:s("loki_source.svg"),alt:"Icon",style:{width:"30px",height:"30px"}},null,8,ge)):d.source_type=="zabbix"?(u(),A("img",{key:1,src:s("zabbix_source.svg"),alt:"Icon",style:{width:"30px",height:"30px"}},null,8,be)):B("",!0),x("span",Ae,ne(d.source_name),1)]),d.isDefault?(u(),g(h,{key:0,type:"success",size:"small",round:""},{default:t(()=>l[5]||(l[5]=[f("默认")])),_:1})):B("",!0)])]),_:2},1032,["onClick"])]))),128))])]),o(j,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=d=>c.value=d),title:_.value,width:"500","before-close":w},{footer:t(()=>[x("div",ye,[V.value==!1?(u(),g(h,{key:0,type:"danger",onClick:E},{default:t(()=>l[6]||(l[6]=[f("删除")])),_:1})):B("",!0),V.value==!1?(u(),g(h,{key:1,type:"primary",onClick:Q},{default:t(()=>l[7]||(l[7]=[f("更新")])),_:1})):(u(),g(h,{key:2,type:"primary",onClick:O},{default:t(()=>l[8]||(l[8]=[f("添加")])),_:1}))])]),default:t(()=>[(u(),g(re(y.value),{formData:r,"onUpdate:formData":l[0]||(l[0]=d=>r=d),ref:"childRef"},null,40,["formData"]))]),_:1},8,["modelValue","title"])],64)}}}),ke=ue(we,[["__scopeId","data-v-343785f0"]]);export{ke as default};
